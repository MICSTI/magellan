var magellan=angular.module("magellan",["ui.router","ngProgress","ngAnimate"],["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]);magellan.constant("AppConfig",{"log.info":!0,"log.error":!0,"quiz.country.questions":3,"quiz.country.types":{1:"CAPITAL_OF_COUNTRY",2:"COUNTRY_OF_CAPITAL",3:"POPULATION_OF_COUNTRY",4:"AREA_OF_COUNTRY",5:"FLAG_OF_COUNTRY"},"settings.user.colors":["soft_red","thunderbird","old_brick","new_york_pink","snuff","honey_flower","san_marino","shakespeare","ming","gossip","eucalyptus","mountain_meadow","jade","confetti","california","burnt_orange","jaffa","gallery","edward","lynch"]}),magellan.controller("AppCtrl",["$scope","$state","UserSrv","CountrySrv","QuizSrv",function(e,n,t,r,o){e.app={config:{title:"Magellan",subtitle:"Test your knowledge about the countries of our world",author:"Michael Stifter"}},t.getUserFromStorage().then(function(n){e.user=n,e.$broadcast("user.loaded"),r.init().then(function(n){e.$broadcast("countries.loaded",n),o.setCountries(n)})})["catch"](function(e){}),e.isProgressBarVisible=function(){return n.is("quiz")},e.$on("app.login",function(t,u){e.user=u,r.init().then(function(n){e.$broadcast("countries.loaded",n),o.setCountries(n)}),n.go("quiz")}),e.$on("app.logout",function(t,r){e.user=null,n.go("home")})}]);var Quiz=function(){var e=null,n=[];this.start=function(){if(n.length<=0)throw Error("Cannot start a quiz without questions");return this.nextQuestion()},this.isActive=function(){return this.hasStarted()&&!this.hasEnded()},this.hasStarted=function(){return null!==e},this.hasEnded=function(){return this.hasStarted()&&e>=n.length},this.submitted=!1,this.addQuestion=function(e){if(void 0===e)throw Error("No question object passed");var t=!0,r=["config","hint","solution","answer","question","getInfo","info","points","answered","hintsAllowed","hintsRemaining"];r.forEach(function(n){if(!e.hasOwnProperty(n))throw t=!1,new Error("Question must have property '"+n+"'")}),t&&n.push(e)},this.nextQuestion=function(){return null===e?e=0:e++,!this.hasEnded()&&n[e]},this.currentQuestion=function(){return this.isActive()?n[e]:null},this.getTotalPoints=function(){if(!this.hasStarted())return null;var e=0;return n.forEach(function(n){var t=n.points();void 0!==t&&(e+=t)}),e},this.getCurrentQuestionNumber=function(){return null===e?null:e+1},this.getNumberOfQuestions=function(){return n.length}},Question=function(e){var n=null,t=null,r=null,o=null,u=0,i=null,s=null,a=!1,l=function(e){n=e.text,t=e.info||{},r=e.answer,i=e.checkAnswer||null,o=e.hints||{allowed:!1,maximum:0,cost:0,give:null}};e&&l(e),this.config=function(e){l(e)},this.question=function(){return n},this.info=function(e,n){return void 0===n?t[e]:void(t[e]=n)},this.getInfo=function(){return t},this.solution=function(){return a?r:null},this.hint=function(){if(!o.allowed)return null;if(o.allowed&&!o.give)throw new Error("Hints allowed but no give method passed");return u<o.maximum&&u++,o.give(u,r)},this.answer=function(e){if(!a&&i)return a=!0,s=i(r,e,u,o.cost,t),s=Math.max(0,s),s=Math.floor(s)},this.points=function(){if(a&&null!==s)return s},this.answered=function(){return a},this.hintsAllowed=function(){return null!==o?o.allowed:null},this.hintsRemaining=function(){var e=this.hintsAllowed();return null===e||e===!1?null:o.maximum-u}},getRandomInt=function(e,n){return Math.floor(Math.random()*(n-e+1))+e},getStringBetween=function(e,n,t){var r=e.indexOf(n),o=e.indexOf(t);return r>=0&&o>=0&&o>r?e.substr(r+1,o-r-1):null};"undefined"!=typeof module&&module.exports&&(module.exports.Question=Question,module.exports.Quiz=Quiz),angular.module("magellan").config(["$locationProvider","$stateProvider","$urlRouterProvider",function(e,n,t){e.html5Mode(!0),t.otherwise("/home"),n.state("home",{url:"/home",templateUrl:"/build/views/partials/home.partial.html",params:{action:null}}).state("quiz",{url:"/quiz",templateUrl:"/build/views/partials/quiz.partial.html"}).state("countries",{url:"/countries",templateUrl:"/build/views/partials/countries.partial.html"}).state("countries.detail",{url:"/:alpha3Code",templateUrl:"/build/views/partials/countries-detail.partial.html"}).state("login",{url:"/login",templateUrl:"/build/views/partials/login.partial.html"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}).state("register",{url:"/register",templateUrl:"/build/views/partials/register.partial.html"}).state("settings",{url:"/settings",templateUrl:"/build/views/partials/settings.partial.html"}).state("about",{url:"/about",templateUrl:"/build/views/partials/about.partial.html"}).state("highscore",{url:"/highscore",templateUrl:"/build/views/partials/highscore.partial.html"})}]),angular.module("magellan").controller("CountriesCtrl",["$scope","CountrySrv",function(e,n){var t=null,r=null,o=function(){t=n.getCountriesByLetter(),r=Object.keys(t),e.$$phase?(e.countryKeys=r,e.countriesByLetter=t):e.$apply(function(){e.countryKeys=r,e.countriesByLetter=t})};n.areCountriesLoaded()&&o(),e.$on("countries.loaded",function(){o()})}]),angular.module("magellan").controller("CountryDetailCtrl",["$scope","CountrySrv","$stateParams",function(e,n,t){var r=t.alpha3Code;n.areCountriesLoaded()&&(e.country=n.getCountryByAlpha3(r)),e.$on("countries.loaded",function(){e.$apply(function(){e.country=n.getCountryByAlpha3(r)})});var o=function(e){return n.getCountryByAlpha3(e)};e.getCountryFromService=o}]),angular.module("magellan").controller("DropdownCtrl",["$scope",function(e){function n(){u=!u}function t(){u=!0}function r(){u=!1}function o(){return u}var u=!1;e.toggleDropdown=n,e.showDropdown=t,e.hideDropdown=r,e.isDropdownVisible=o,e.handleClickOutside=function(e){console.log("CLICKED OUTSIDE")}}]),angular.module("magellan").controller("HighscoreCtrl",["$scope","ScoreSrv","LogSrv",function(e,n,t){e.scoreList=[],n.getHighscoreList().then(function(n){e.$$phase?e.scoreList=o(n):e.$apply(function(){e.scoreList=o(n)})})["catch"](function(e){t.error(e)});var r=function(n){return e.user._id===n},o=function(e){var n=0,t=null;return e.forEach(function(e){t&&e.score===t||(n++,e.rank=n+"."),t=e.score}),e};e.isMyself=r}]),angular.module("magellan").controller("HomeCtrl",["$scope","LogSrv","$stateParams",function(e,n,t){if(e.message=null,t.action){var r=t.action;switch(r){case"register.successful":e.message={type:"success",text:"Gratulation! Die Anmeldung war erfolgreich. Herzlich willkommen bei Magellan."};break;default:e.message=null}}}]),angular.module("magellan").controller("LoginCtrl",["$scope","UserSrv","FocusSrv",function(e,n,t){e.message=null,e.login=function(t,r){n.login(t,r).then(function(n){e.message=null,e.$emit("app.login",n.data)})["catch"](function(n){console.error(n);var t;t=401===n.status?"Falscher Benutzername oder Passwort":"Beim Einloggen scheint etwas schief gegangen zu sein",e.message={type:"error",text:t}})},t("#username")}]),angular.module("magellan").controller("LogoutCtrl",["$scope","UserSrv",function(e,n){n.logout().then(function(){e.$emit("app.logout")})}]),angular.module("magellan").controller("QuizDirectiveController",["$scope","QuizSrv","LogSrv","FocusSrv","ngProgressFactory",function(e,n,t,r,o){var u,i=function(){e.progressbar=o.createInstance(),e.progressbar.setParent(document.getElementById("quiz-progress")),e.progressbar.setAbsolute(),e.progressbar.setColor("#336e7b"),e.isResultsPageVisible=!1,e.achievements=[],e.bests=[],e.answerInput={},e.hint=null,e.multiplierOptions=[{value:1,label:""},{value:1e3,label:"Tsd."},{value:1e6,label:"Mio."}],u=null},s=function(){if(u=n.getCurrentQuestion(),e.hint=null,null!==u){if(u.getInfo().input&&0===u.getInfo().input.indexOf("number"))switch(u.getInfo().input){case"number.high":e.answerInput.multiplier={value:1e6,label:"Mio."};break;case"number.medium":e.answerInput.multiplier={value:1e3,label:"Tsd."};break;default:e.answerInput.multiplier={value:1,label:""}}else e.answerInput.multiplier=null;A(),r(".answerInput")}else e.progressbar.set(0)},a=function(){return u},l=function(){return n.getCurrentQuestionNumber()},c=function(){return n.getNumberOfQuizQuestions()},f=function(){return O(a().question(),"question-highlight")+"?"},g=function(){return u&&u.getInfo().media?u.getInfo().media:null},d=function(){e.isResultsPageVisible=!0},h=function(){e.$$phase?e.isResultsPageVisible=!1:e.$apply(function(){e.isResultsPageVisible=!1})},p=function(){return null!==u&&(null!==u.hintsRemaining()&&u.hintsRemaining()>0)},m=function(){if(e.answerInput.answer&&!u.answered()){var n=String(e.answerInput.answer);u.getInfo().input&&0===u.getInfo().input.indexOf("number")&&(n=n.replace(",",".")),e.answerInput.multiplier&&(n*=e.answerInput.multiplier.value),t.info("submitting answer",n),e.answerInput.points=u.answer(n),r("#btnNextQuestion")}},v=function(){return!(!n.isQuizRunning()||null===u)&&u.answered()},w=function(){n.nextQuestion(),e.answerInput.answer="",s()},b=function(){e.hint=u.hint(),r(".answerInput")},O=function(e,n){return e.replace("[","<span class='"+n+"'>").replace("]","</span>")},C=function(e){13==e.which&&m()},A=function(){var n=l()/c()*100;e.progressbar.set(n)},y=function(){return l()>=c()},_=function(n,t,r){var o=[],u=!0;if(n.indexOf("overall_best")>=0&&(o.push({text:"Du hast einen neuen absoluten Rekord geschafft!"}),u=!1),n.indexOf("overall_best_equalised")>=0&&(o.push({text:"Du hast den aktuellen absoluten Rekord eingestellt!"}),u=!1),n.indexOf("personal_best")>=0&&n.indexOf("overall_best")<0&&(o.push({text:"Du hast einen neuen persönlichen Rekord geschafft!"}),u=!1),n.indexOf("personal_best_equalised")>=0&&n.indexOf("overall_best_equalised")<0&&(o.push({text:"Du hast gleich viele Punkte geschafft wie bei deinem persönlichen Rekord!"}),u=!1),n.indexOf("new_daily_best")>=0&&0===o.length&&o.push({text:"Du hast einen neuen persönlichen Tagesrekord geschafft!"}),e.achievements=o,u&&t&&t.id&&t.date&&t.score&&r&&r.id&&r.date&&r.score){var i=[];r.type="overall",i.push(r),t.id!==r.id&&(t.type="personal",i.push(t)),e.bests=i}else e.bests=null},T=function(){d(),w(),n.conclude().then(function(e){_(e.events||[],e.personalBest,e.overallBest)})["catch"](function(e){t.error(e)})},S=function(n){var t;if("personal"===n.type)t="Dein persönlicher Rekord liegt bei <span class='bold'>{POINTS} Punkten</span>, aufgestellt am {DATE}.";else{var r=n.id===e.user._id;t=r?"Du hältst den absoluten Rekord mit <span class='bold'>{POINTS} Punkten</span>, aufgestellt am {DATE}.":"<span class='highlight'>{USERNAME}</span> hält den absoluten Rekord mit <span class='bold'>{POINTS} Punkten</span>, aufgestellt am {DATE}."}return t.replace("{POINTS}",n.score).replace("{DATE}",P(n.date)).replace("{USERNAME}",n.username)},P=function(e){return e=new Date(e),R(e.getDate(),"00")+"."+R(e.getMonth()+1,"00")+"."+(e.getYear()+1900)},R=function(e,n){return String(n+e).slice(-n.length)},I=function(){quiz=null,e.$emit("quiz.restart"),i(),s()};e.$on("quiz.start",function(e,n){h()}),i(),s(),e.getQuestion=a,e.getCurrentQuestionNumber=l,e.renderQuestionText=f,e.submitAnswer=m,e.questionAnswered=v,e.nextQuestion=w,e.handleKeyPress=C,e.getQuestionMedia=g,e.requestHint=b,e.wasLastQuestion=y,e.continueFinished=T,e.getBestText=S,e.restartQuiz=I,e.hintsAvailable=p}]),angular.module("magellan").controller("QuizCtrl",["$scope","QuizSrv","LogSrv",function(e,n,t){var r=function(e){n.init().then(function(){e&&"function"==typeof e&&e(),t.info("Quiz started")})["catch"](function(e){t.error(e)})},o=function(){return n.isQuizRunning()},u=function(){return n.hasQuizStarted()},i=function(){return n.hasQuizEnded()},s=function(){return n.getTotalPoints()};e.$on("quiz.restart",function(o,u){t.info("quiz restart"),n.dispose(),r(function(){e.$broadcast("quiz.start")})}),e.startQuiz=r,e.isQuizRunning=o,e.hasQuizStarted=u,e.hasQuizEnded=i,e.getTotalPoints=s}]),angular.module("magellan").controller("RegisterCtrl",["$scope","LogSrv","FocusSrv","UserSrv","$state","$window",function(e,n,t,r,o,u){e.newUser={},e.message=null;var i=function(t){return!!t&&void(s()&&r.register(e.newUser).then(function(n){200===n.status?(e.$emit("app.login",n.data),o.go("home",{action:"register.successful"})):e.message={type:"error",text:"Bei der Anmeldung scheint etwas schief gegangen zu sein"}})["catch"](function(t){n.error(t);var r;switch(t.message){case"Username already exists":r="Der Benutzername existiert bereits";break;default:r="Bei der Anmeldung scheint etwas schief gegangen zu sein"}e.$$phase?e.message={type:"error",text:r}:e.$apply(function(){e.message={type:"error",text:r}})}))},s=function(){e.message=null;var n=e.newUser.password,t=e.newUser.password2;return e.newUser.username&&e.newUser.email&&n&&t?""===n||""===t?e.message={type:"error",text:"Die Passwörter können nicht leer sein"}:n!==t&&(e.message={type:"error",text:"Die Passwörter stimmen nicht überein"}):e.message={type:"error",text:"Alle Felder müssen ausgefüllt sein"},!e.message},a=function(){i(!0)};e.delegateSubmit=a,e.register=i,t("#username")}]),angular.module("magellan").controller("SettingsCtrl",["$scope","AppConfig","FocusSrv","LogSrv","UserSrv",function(e,n,t,r,o){var u=function(){e.message=null;var u=n["settings.user.colors"];e.userObj={username:e.user.username,email:e.user.email,color:e.user.color},e.userColors=u;var i=function(n){e.userObj.color=n},s=function(){o.updateBasic(e.userObj).then(function(n){e.user.username=e.userObj.username,e.user.email=e.userObj.email,e.user.color=e.userObj.color,e.$apply(function(){e.message={type:"success",text:"Einstellungen wurden erfolgreich gespeichert"}})})["catch"](function(n){r.error("Update user",n);var t;switch(n.message){case"Username already exists":t="Der Benutzername ist bereits vergeben";break;default:t="Die Einstellungen konnten nicht gespeichert werden"}e.$apply(function(){e.message={type:"error",text:t}})})},a=function(){s(!0)};e.setColor=i,e.updateUser=s,e.delegateSubmit=a,t("#username")};e.user&&u(),e.$on("user.loaded",function(e,n){u()})}]),angular.module("magellan").directive("quiz",function(){return{templateUrl:"build/views/templates/quiz-directive.template.html",scope:!0,controller:"QuizDirectiveController",restrict:"E",link:function(e,n,t){}}}),angular.module("magellan").filter("renderHtml",["$sce",function(e){return function(n){return e.trustAsHtml(n)}}]),angular.module("magellan").filter("textOrNumber",["$filter",function(e){return function(n,t){return t=void 0!==t?0:t,isNaN(n)?n:e("number")(n,t)}}]),angular.module("magellan").factory("AuthInterceptor",["AuthTokenSrv",function(e){var n=function(n){var t=e.getToken();return t&&(n.headers=n.headers||{},n.headers["X-Auth"]=t),n};return{request:n}}]),angular.module("magellan").factory("AuthTokenSrv",["$window",function(e){var n=e.sessionStorage,t="auth-token",r=function(){return n.getItem(t)},o=function(e){e?n.setItem(t,e):n.removeItem(t)};return{getToken:r,setToken:o}}]),angular.module("magellan").factory("CountrySrv",["$http","IndexedDBSrv","LogSrv",function(e,n,t){var r=null,o=null,u=null,i="magellan",s="countryStore",a="countries",l="version",c=n.indexedDBAvailable(),f=function(){return g()},g=function(){return c?new Promise(function(e,a){n.createDatabase(i,s).then(p).then(m).then(v).then(d).then(h).then(function(n){r=n.countries,t.info("loaded countries from",n.loadStrategy.toUpperCase()),o={},u={},r.forEach(function(e){o[e.alpha3Code]=e;var n=e.name.substr(0,1).toUpperCase();switch(n){case"Ä":n="A";break;case"Ö":n="O";break;case"Ü":n="U"}void 0===u[n]&&(u[n]=[]),u[n].push({alpha3Code:e.alpha3Code,name:e.name})}),e(r)})["catch"](function(e){t.error("failed to load countries",e),a(e)})}):b()},d=function(e){return new Promise(function(n,t){var r,o=e.internalVersion,u=e.externalVersion;r=null===o?"api":u>o?"api":"db",e.loadStrategy=r,n(e)})},h=function(e){return new Promise(function(t,r){var o=e.loadStrategy;switch(o){case"api":b().then(function(r){e.countries=r,n.putItem(i,s,{name:a,value:r}),n.putItem(i,s,{name:l,value:e.externalVersion}),t(e)})["catch"](function(e){r(e)});break;case"db":w(e).then(function(e){t(e)})["catch"](function(e){r(e)});break;default:r("Unknown load strategy")}})},p=function(){return new Promise(function(e,n){e({})})},m=function(e){return new Promise(function(t,r){n.retrieveItem(i,s,l).then(function(n){e.internalVersion=n.value,t(e)})["catch"](function(n){e.internalVersion=null,t(e)})})},v=function(e){return O().then(function(n){return e.externalVersion=n,e})},w=function(e){return new Promise(function(t,r){n.retrieveItem(i,s,a).then(function(n){e.countries=n.value,t(e)})["catch"](function(e){t(null)})})},b=function(){return new Promise(function(n,t){e.get("/api/countries").then(function(e){n(e.data)})["catch"](function(e){t(e)})})},O=function(){return new Promise(function(n,t){e.get("/api/countries/version").then(function(e){n(e.data.version||0)})["catch"](function(e){n(0)})})},C=function(e){return null===o?null:o[e]},A=function(){return null===u?null:u},y=function(){return null!==r&&r.length>0};return{init:f,getCountryByAlpha3:C,getCountriesByLetter:A,areCountriesLoaded:y}}]),angular.module("magellan").factory("FocusSrv",["$timeout","$window",function(e,n){return function(t){e(function(){var e=n.document.querySelector(t);e&&e.focus()})}}]),angular.module("magellan").factory("IndexedDBSrv",["$window",function(e){var n="name",t=e.indexedDB||e.webkitIndexedDB||e.msIndexedDB,r=e.IDBKeyRange||e.webkitIDBKeyRange,o=e.IDBTransaction||e.webkitIDBTransaction;o&&(o.READ_WRITE=o.READ_WRITE||"readwrite",o.READ_ONLY=o.READ_ONLY||"readonly");var u=function(){return!!t},i=function(e,r){return new Promise(function(o,u){var i=t.open(e);i.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore(r,{keyPath:n})},i.onsuccess=function(e){o(e)},i.onerror=function(e){u(e)}})},s=function(e){return new Promise(function(n,r){var o=t.deleteDatabase(e);o.onsuccess=function(e){n(e)},o.onerror=function(e){r(e)}})},a=function(e,n,r){return new Promise(function(u,i){var s=t.open(e);s.onsuccess=function(e){var t=e.target.result,s=t.transaction(n,o.READ_WRITE),a=s.objectStore(n),l=a.add(r);l.onsuccess=function(e){u(e)},l.onerror=function(e){i(e)}}})},l=function(e,n,r){return new Promise(function(u,i){var s=t.open(e);s.onsuccess=function(e){var t=e.target.result,s=t.transaction(n,o.READ_WRITE),a=s.objectStore(n),l=a.put(r);l.onsuccess=function(e){u(e)},l.onerror=function(e){i(e)}}})},c=function(e,n,u){return new Promise(function(i,s){var a=null,l=t.open(e);l.onsuccess=function(e){var t=e.target.result,s=t.transaction(n,o.READ_ONLY),l=s.objectStore(n),c=r.only(u);l.openCursor(c).onsuccess=function(e){var n=e.target.result;n?(a=n.value,n["continue"]()):i(a)}},l.onerror=function(e){s(e)}})},f=function(e,n){return new Promise(function(r,u){var i=[],s=t.open(e);s.onsuccess=function(e){var t=e.target.result,u=t.transaction(n,o.READ_ONLY),s=u.objectStore(n);s.openCursor().onsuccess=function(e){var n=e.target.result;n?(i.push(n.value),n["continue"]()):r(i)}},s.onerror=function(e){u(e)}})};return{createDatabase:i,dropDatabase:s,addItem:a,putItem:l,retrieveItem:c,retrieveItems:f,indexedDBAvailable:u}}]),angular.module("magellan").factory("LogSrv",["AppConfig",function(e){var n=function(){e["log.info"]&&console.log.apply(console,arguments)},t=function(){e["log.error"]&&console.error.apply(console,arguments)};return{info:n,error:t}}]),angular.module("magellan").factory("QuizSrv",["AppConfig","CountrySrv","ScoreSrv","LogSrv",function(e,n,t,r){var o=null,u=null,i=function(e){o=e},s=function(){return null!==o&&o.length>0},a=function(){return new Promise(function(e,n){s||n("Countries have not been loaded"),u=d("country"),e(u.start())})},l=function(){u=null},c=function(){return null!==u&&(u.hasStarted()&&!u.hasEnded())},f=function(){return null!==u&&u.hasStarted()},g=function(){return null!==u&&u.hasEnded()},d=function(e){switch(e){case"country":default:return h()}},h=function(){for(var t=new Quiz,r=100,u=3,i=25,s=2.5,a=e["quiz.country.types"],l=Object.keys(a).length,c=[],f=e["quiz.country.questions"],g=0;g<f;g++){for(var d=!1;!d;){var h=o[getRandomInt(0,o.length-1)];d=c.indexOf(h.alpha3Code)<0}c.push(h.alpha3Code)}var C=0;return c.forEach(function(e){C++;var o=n.getCountryByAlpha3(e),c=a[getRandomInt(1,l)],g=p(c,o),d={type:c,input:v(c),unit:w(c)},h=m(c,o),A=b(c,r,s),y=O(c,u,i);C>=f&&(d.bonus=!0),"FLAG_OF_COUNTRY"===c&&(d.media="flag",d.alpha2Code=o.alpha2Code.toLocaleLowerCase()),t.addQuestion(new Question({text:g,info:d,answer:h,checkAnswer:A,hints:y}))}),t},p=function(e,n){switch(e){case"CAPITAL_OF_COUNTRY":return"Wie heißt die Hauptstadt von ["+n.name+"]";case"COUNTRY_OF_CAPITAL":return"["+n.capital+"] ist die Hauptstadt von welchem Land";case"POPULATION_OF_COUNTRY":return"Wie viele Menschen leben in ["+n.name+"]";case"AREA_OF_COUNTRY":return"Wie groß ist die Fläche von ["+n.name+"]";case"FLAG_OF_COUNTRY":return"Welches Land hat diese Flagge";default:return"?"}},m=function(e,n){switch(e){case"CAPITAL_OF_COUNTRY":var t=void 0!==n.altSpellings&&void 0!==n.altSpellings.capital?n.altSpellings.capital:[];return{correct:n.capital,altSpellings:t};case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":var t=void 0!==n.altSpellings&&void 0!==n.altSpellings.name?n.altSpellings.name:[];return{correct:n.name,altSpellings:t};case"POPULATION_OF_COUNTRY":return{correct:n.population};case"AREA_OF_COUNTRY":return{correct:n.area};default:return"?"}},v=function(e){switch(e){case"POPULATION_OF_COUNTRY":return"number.high";case"AREA_OF_COUNTRY":return"number.medium";case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":default:return"text.standard"}},w=function(e){switch(e){case"AREA_OF_COUNTRY":return"km²";case"POPULATION_OF_COUNTRY":return"Einwohner";default:return null}},b=function(e,n,t){switch(e){case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":return function(e,r,o,u,i){var s=r===e.correct||e.altSpellings&&e.altSpellings.indexOf(r)>=0,a=s?n:0;return o>0&&(a-=o*u),void 0!==i&&void 0!==i.bonus&&i.bonus===!0&&(a*=t),a};case"POPULATION_OF_COUNTRY":case"AREA_OF_COUNTRY":return function(e,n,r,o,u){var i,s=Math.abs(n-e.correct)/e.correct*100;return i=s<=3?100:s<=6?90:s<=9?80:s<=12?70:s<=14?60:s<=16?50:s<=18?40:s<=20?30:s<=25?20:s<=30?10:0,r>0&&(i-=r*o),void 0!==u&&void 0!==u.bonus&&u.bonus===!0&&(i*=t),i};default:return"?"}},O=function(e,n,t){switch(e){case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":return{allowed:!0,maximum:n,cost:t,give:function(e,n){return n.correct.substr(0,e)}};case"POPULATION_OF_COUNTRY":case"AREA_OF_COUNTRY":return{allowed:!1};default:return"?"}},C=function(){return c()?u.getCurrentQuestionNumber():null},A=function(){return c()?u.getNumberOfQuestions():null},y=function(){return c()?u.currentQuestion():null},_=function(){c()&&u.nextQuestion()},T=function(){return null===u?null:u.getTotalPoints()},S=function(){return new Promise(function(e,n){null!==u&&u.hasEnded()?(u.submitted===!0&&n("Quiz has already been submitted"),u.submitted=!0,t.putHighscore(u.getTotalPoints()).then(function(n){e(n)})["catch"](function(e){n(e)})):n("No quiz is currently running")})};return{init:a,setCountries:i,isQuizRunning:c,hasQuizStarted:f,hasQuizEnded:g,getCurrentQuestionNumber:C,getNumberOfQuizQuestions:A,getCurrentQuestion:y,nextQuestion:_,getTotalPoints:T,conclude:S,dispose:l}}]),angular.module("magellan").factory("ScoreSrv",["$http",function(e){var n=function(){return new Promise(function(n,t){e.get("/api/scores/all").success(function(e){n(e)}).error(function(e){t(e)})})},t=function(){return new Promise(function(n,t){e.get("/api/scores/user").success(function(e){n(e)}).error(function(e){t(e)})})},r=function(){return new Promise(function(n,t){e.get("/api/scores/high").success(function(e){n(e)}).error(function(e){t(e)})})},o=function(n){return new Promise(function(t,r){e.put("/api/scores",{score:n}).success(function(e){t(e)}).error(function(e){r(e)})})};return{getHighscoreList:n,getUserHighscore:t,getOverallHighscore:r,putHighscore:o}}]),angular.module("magellan").factory("UserSrv",["$http","AuthTokenSrv","AppConfig",function(e,n,t){var r=this,o=function(){return e.get("/api/user")},u=function(){return new Promise(function(e,t){var r=n.getToken();r?(n.setToken(r),o().then(function(n){e(n.data)})["catch"](function(e){t(e)})):t("No token in storage")})},i=function(t,u){return e.post("/api/session",{username:t,password:u}).then(function(e){return r.token=e.data,n.setToken(r.token),o()})},s=function(){return new Promise(function(e,t){r.token=null,n.setToken(),e()})},a=function(n){return new Promise(function(r,o){var u=t["settings.user.colors"];n.color=u[getRandomInt(0,u.length-1)],e.post("/api/user",n).success(function(e){i(n.username,n.password).then(function(e){r(e)})["catch"](function(e){o(e)})}).error(function(e){o(e)})})},l=function(n){return new Promise(function(t,r){e.put("/api/user/basic",n).success(function(e){t(e)}).error(function(e){r(e)})})};return{getUser:o,getUserFromStorage:u,login:i,logout:s,register:a,updateBasic:l}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjcmlwdC5qcyIsIm1vZGVscy5qcyIsInJvdXRlcy5qcyIsImNvbnRyb2xsZXJzL2NvdW50cmllcy5jdHJsLmpzIiwiY29udHJvbGxlcnMvY291bnRyeS1kZXRhaWwuY3RybC5qcyIsImNvbnRyb2xsZXJzL2Ryb3Bkb3duLmN0cmwuanMiLCJjb250cm9sbGVycy9oaWdoc2NvcmUuY3RybC5qcyIsImNvbnRyb2xsZXJzL2hvbWUuY3RybC5qcyIsImNvbnRyb2xsZXJzL2xvZ2luLmN0cmwuanMiLCJjb250cm9sbGVycy9sb2dvdXQuY3RybC5qcyIsImNvbnRyb2xsZXJzL3F1aXotZGlyZWN0aXZlLmN0cmwuanMiLCJjb250cm9sbGVycy9xdWl6LmN0cmwuanMiLCJjb250cm9sbGVycy9yZWdpc3Rlci5jdHJsLmpzIiwiY29udHJvbGxlcnMvc2V0dGluZ3MuY3RybC5qcyIsImRpcmVjdGl2ZXMvcXVpei5kaXJlY3RpdmUuanMiLCJmaWx0ZXJzL3JlbmRlckh0bWwuZmlsdGVyLmpzIiwiZmlsdGVycy90ZXh0T3JOdW1iZXIuanMiLCJpbnRlcmNlcHRvcnMvYXV0aC5pbnRlcmNlcHRvci5qcyIsInNlcnZpY2VzL2F1dGgtdG9rZW4uc2VydmljZS5qcyIsInNlcnZpY2VzL2NvdW50cnkuc2VydmljZS5qcyIsInNlcnZpY2VzL2ZvY3VzLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9pbmRleGVkLWRiLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9sb2cuc2VydmljZS5qcyIsInNlcnZpY2VzL3F1aXouc2VydmljZS5qcyIsInNlcnZpY2VzL3Njb3JlLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyLnNlcnZpY2UuanMiXSwibmFtZXMiOlsibWFnZWxsYW4iLCJhbmd1bGFyIiwibW9kdWxlIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCJjb25zdGFudCIsImxvZy5pbmZvIiwibG9nLmVycm9yIiwicXVpei5jb3VudHJ5LnF1ZXN0aW9ucyIsInF1aXouY291bnRyeS50eXBlcyIsIjEiLCIyIiwiMyIsIjQiLCI1Iiwic2V0dGluZ3MudXNlci5jb2xvcnMiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJHN0YXRlIiwiVXNlclNydiIsIkNvdW50cnlTcnYiLCJRdWl6U3J2IiwiYXBwIiwiY29uZmlnIiwidGl0bGUiLCJzdWJ0aXRsZSIsImF1dGhvciIsImdldFVzZXJGcm9tU3RvcmFnZSIsInRoZW4iLCJ1c2VyIiwiJGJyb2FkY2FzdCIsImluaXQiLCJjb3VudHJpZXMiLCJzZXRDb3VudHJpZXMiLCJlcnIiLCJpc1Byb2dyZXNzQmFyVmlzaWJsZSIsImlzIiwiJG9uIiwiZXZlbnQiLCJkYXRhIiwiZ28iLCJRdWl6IiwiY3VycmVudFF1ZXN0aW9uSWR4IiwicXVlc3Rpb25zIiwidGhpcyIsInN0YXJ0IiwibGVuZ3RoIiwiRXJyb3IiLCJuZXh0UXVlc3Rpb24iLCJpc0FjdGl2ZSIsImhhc1N0YXJ0ZWQiLCJoYXNFbmRlZCIsInN1Ym1pdHRlZCIsImFkZFF1ZXN0aW9uIiwicXVlc3Rpb24iLCJ1bmRlZmluZWQiLCJ2YWxpZCIsIm5lY2Vzc2FyeVByb3BlcnRpZXMiLCJmb3JFYWNoIiwicHJvcGVydHkiLCJoYXNPd25Qcm9wZXJ0eSIsImN1cnJlbnRRdWVzdGlvbiIsImdldFRvdGFsUG9pbnRzIiwidG90YWxQb2ludHMiLCJwb2ludHMiLCJnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIiLCJnZXROdW1iZXJPZlF1ZXN0aW9ucyIsIlF1ZXN0aW9uIiwib3B0aW9ucyIsInRleHQiLCJpbmZvIiwiYW5zd2VyIiwiaGludHMiLCJoaW50c1VzZWQiLCJjaGVja0Fuc3dlciIsImFuc3dlcmVkIiwib3B0cyIsImFsbG93ZWQiLCJtYXhpbXVtIiwiY29zdCIsImdpdmUiLCJwcm9wIiwidmFsdWUiLCJnZXRJbmZvIiwic29sdXRpb24iLCJoaW50Iiwic3VibWl0dGVkQW5zd2VyIiwiTWF0aCIsIm1heCIsImZsb29yIiwiaGludHNBbGxvd2VkIiwiaGludHNSZW1haW5pbmciLCJnZXRSYW5kb21JbnQiLCJtaW4iLCJyYW5kb20iLCJnZXRTdHJpbmdCZXR3ZWVuIiwiZmlyc3RTdHJpbmciLCJzZWNvbmRTdHJpbmciLCJmaXJzdFBvcyIsImluZGV4T2YiLCJzZWNvbmRQb3MiLCJzdWJzdHIiLCJleHBvcnRzIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsImh0bWw1TW9kZSIsIm90aGVyd2lzZSIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJwYXJhbXMiLCJhY3Rpb24iLCJjb3VudHJpZXNCeUxldHRlciIsImNvdW50cnlLZXlzIiwiZ2V0Q291bnRyaWVzQnlMZXR0ZXIiLCJPYmplY3QiLCJrZXlzIiwiJCRwaGFzZSIsIiRhcHBseSIsImFyZUNvdW50cmllc0xvYWRlZCIsIiRzdGF0ZVBhcmFtcyIsImFscGhhM0NvZGUiLCJjb3VudHJ5IiwiZ2V0Q291bnRyeUJ5QWxwaGEzIiwiZ2V0Q291bnRyeUZyb21TZXJ2aWNlIiwiYWxwaGEzIiwidG9nZ2xlRHJvcGRvd24iLCJ2aXNpYmxlIiwic2hvd0Ryb3Bkb3duIiwiaGlkZURyb3Bkb3duIiwiaXNEcm9wZG93blZpc2libGUiLCJoYW5kbGVDbGlja091dHNpZGUiLCJjb25zb2xlIiwibG9nIiwiU2NvcmVTcnYiLCJMb2dTcnYiLCJzY29yZUxpc3QiLCJnZXRIaWdoc2NvcmVMaXN0IiwibGlzdCIsImNyZWF0ZVJhbmtpbmciLCJlcnJvciIsImlzTXlzZWxmIiwiaWQiLCJfaWQiLCJyYW5rIiwicHJldmlvdXNTY29yZSIsImVudHJ5Iiwic2NvcmUiLCJtZXNzYWdlIiwidHlwZSIsIkZvY3VzU3J2IiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwicmVzcG9uc2UiLCIkZW1pdCIsIm1lc3NhZ2VUZXh0Iiwic3RhdHVzIiwibG9nb3V0IiwibmdQcm9ncmVzc0ZhY3RvcnkiLCJpbml0Q3RybCIsInByb2dyZXNzYmFyIiwiY3JlYXRlSW5zdGFuY2UiLCJzZXRQYXJlbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic2V0QWJzb2x1dGUiLCJzZXRDb2xvciIsImlzUmVzdWx0c1BhZ2VWaXNpYmxlIiwiYWNoaWV2ZW1lbnRzIiwiYmVzdHMiLCJhbnN3ZXJJbnB1dCIsIm11bHRpcGxpZXJPcHRpb25zIiwibGFiZWwiLCJ1cGRhdGVVaSIsImdldEN1cnJlbnRRdWVzdGlvbiIsImlucHV0IiwibXVsdGlwbGllciIsInVwZGF0ZVByb2dyZXNzQmFyIiwic2V0IiwiZ2V0UXVlc3Rpb24iLCJnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMiLCJyZW5kZXJRdWVzdGlvblRleHQiLCJyZW5kZXIiLCJnZXRRdWVzdGlvbk1lZGlhIiwibWVkaWEiLCJzaG93UmVzdWx0c1BhZ2UiLCJoaWRlUmVzdWx0c1BhZ2UiLCJoaW50c0F2YWlsYWJsZSIsInN1Ym1pdEFuc3dlciIsIlN0cmluZyIsInJlcGxhY2UiLCJxdWVzdGlvbkFuc3dlcmVkIiwiaXNRdWl6UnVubmluZyIsInJlcXVlc3RIaW50IiwiY2xhc3NOYW1lIiwiaGFuZGxlS2V5UHJlc3MiLCJrZXlFdmVudCIsIndoaWNoIiwicHJvZ3Jlc3NQZXJjZW50Iiwid2FzTGFzdFF1ZXN0aW9uIiwicGFyc2VFdmVudHMiLCJldmVudHMiLCJwZXJzb25hbEJlc3QiLCJvdmVyYWxsQmVzdCIsInNob3dCZXN0cyIsImRhdGUiLCJjb250aW51ZUZpbmlzaGVkIiwiY29uY2x1ZGUiLCJnZXRCZXN0VGV4dCIsImJlc3QiLCJmcm9tTXlzZWxmIiwiZ2V0Rm9ybWF0dGVkRGF0ZSIsIkRhdGUiLCJwYWQiLCJnZXREYXRlIiwiZ2V0TW9udGgiLCJnZXRZZWFyIiwic3RyIiwicGFkVmFsdWUiLCJzbGljZSIsInJlc3RhcnRRdWl6IiwicXVpeiIsInN0YXJ0UXVpeiIsImNiIiwiaGFzUXVpelN0YXJ0ZWQiLCJoYXNRdWl6RW5kZWQiLCJkaXNwb3NlIiwiJHdpbmRvdyIsIm5ld1VzZXIiLCJyZWdpc3RlciIsImlzVmFsaWQiLCJ2YWxpZGF0ZUJlZm9yZVN1Ym1pdCIsInBhc3N3b3JkMiIsImVtYWlsIiwiZGVsZWdhdGVTdWJtaXQiLCJBcHBDb25maWciLCJjb2xvcnMiLCJ1c2VyT2JqIiwiY29sb3IiLCJ1c2VyQ29sb3JzIiwibmV3Q29sb3IiLCJ1cGRhdGVVc2VyIiwidXBkYXRlQmFzaWMiLCJkaXJlY3RpdmUiLCJzY29wZSIsInJlc3RyaWN0IiwibGluayIsImVsZW1lbnQiLCJhdHRycyIsImZpbHRlciIsIiRzY2UiLCJ0cnVzdEFzSHRtbCIsIiRmaWx0ZXIiLCJmcmFjdGlvblNpemUiLCJpc05hTiIsImZhY3RvcnkiLCJBdXRoVG9rZW5TcnYiLCJhZGRUb2tlbiIsInRva2VuIiwiZ2V0VG9rZW4iLCJoZWFkZXJzIiwicmVxdWVzdCIsInN0b3JlIiwic2Vzc2lvblN0b3JhZ2UiLCJrZXkiLCJnZXRJdGVtIiwic2V0VG9rZW4iLCJzZXRJdGVtIiwicmVtb3ZlSXRlbSIsIiRodHRwIiwiSW5kZXhlZERCU3J2IiwiY291bnRyaWVzQnlBbHBoYTMiLCJkYXRhYmFzZSIsImtleUNvdW50cmllcyIsImtleVZlcnNpb24iLCJpbmRleGVkREJBdmFpbGFibGUiLCJsb2FkQ291bnRyaWVzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjcmVhdGVEYXRhYmFzZSIsImdldEVtcHR5T2JqZWN0IiwiZ2V0SW50ZXJuYWxWZXJzaW9uIiwiZ2V0RXh0ZXJuYWxWZXJzaW9uIiwiZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5IiwibG9hZERhdGEiLCJvYmoiLCJ0b1VwcGVyQ2FzZSIsImMiLCJmaXJzdExldHRlciIsIm5hbWUiLCJnZXRDb3VudHJpZXNGcm9tQVBJIiwic3RyYXRlZ3kiLCJpbnRlcm5hbFZlcnNpb24iLCJleHRlcm5hbFZlcnNpb24iLCJwdXRJdGVtIiwiZ2V0Q291bnRyaWVzRnJvbURCIiwiX29iaiIsInJldHJpZXZlSXRlbSIsIml0ZW0iLCJnZXRWZXJzaW9uRnJvbUFQSSIsInZlcnNpb24iLCJnZXQiLCIkdGltZW91dCIsInNlbGVjdG9yIiwicXVlcnlTZWxlY3RvciIsImZvY3VzIiwia2V5UGF0aCIsImluZGV4ZWREQiIsIndlYmtpdEluZGV4ZWREQiIsIm1zSW5kZXhlZERCIiwiSURCS2V5UmFuZ2UiLCJ3ZWJraXRJREJLZXlSYW5nZSIsIklEQlRyYW5zYWN0aW9uIiwid2Via2l0SURCVHJhbnNhY3Rpb24iLCJSRUFEX1dSSVRFIiwiUkVBRF9PTkxZIiwiZGJOYW1lIiwic3RvcmVOYW1lIiwib3BlbiIsIm9udXBncmFkZW5lZWRlZCIsImUiLCJpZGIiLCJ0YXJnZXQiLCJyZXN1bHQiLCJjcmVhdGVPYmplY3RTdG9yZSIsIm9uc3VjY2VzcyIsIm9uZXJyb3IiLCJkcm9wRGF0YWJhc2UiLCJkZWxldGVEYXRhYmFzZSIsImFkZEl0ZW0iLCJ0cmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlIiwicmVxdWVzdEFkZCIsImFkZCIsInB1dCIsIml0ZW1OYW1lIiwicmFuZ2UiLCJvbmx5Iiwib3BlbkN1cnNvciIsImN1cnNvciIsInJldHJpZXZlSXRlbXMiLCJpdGVtcyIsImxvZ0luZm8iLCJhcHBseSIsImFyZ3VtZW50cyIsImxvZ0Vycm9yIiwiX2NvdW50cmllcyIsImNvdW50cmllc0xvYWRlZCIsImNyZWF0ZVF1aXoiLCJxdWl6VHlwZSIsImNyZWF0ZUNvdW50cnlRdWl6IiwiY291bnRyeVF1aXoiLCJmdWxsUG9pbnRzIiwiaGludE1heGltdW0iLCJoaW50Q29zdCIsImxhc3RRdWVzdGlvbkJvbnVzIiwicXVlc3Rpb25UeXBlcyIsInF1ZXN0aW9uVHlwZXNMZW5ndGgiLCJzZWxlY3RlZENvdW50cmllcyIsIm51bWJlck9mUXVlc3Rpb25zIiwiaSIsImNvdW50cnlPayIsInFjbnQiLCJxdWVzdGlvblR5cGUiLCJnZXRRdWVzdGlvblRleHQiLCJnZXRRdWVzdGlvbklucHV0IiwidW5pdCIsImdldFF1ZXN0aW9uVW5pdCIsImdldFF1ZXN0aW9uQW5zd2VyIiwiZ2V0Q2hlY2tBbnN3ZXJMYW1iZGEiLCJnZXRRdWVzdGlvbkhpbnRzIiwiYWxwaGEyQ29kZSIsInRvTG9jYWxlTG93ZXJDYXNlIiwiY2FwaXRhbCIsImFsdFNwZWxsaW5ncyIsImNvcnJlY3QiLCJwb3B1bGF0aW9uIiwiYXJlYSIsImJvbnVzIiwiZXJyb3JQZXJjZW50YWdlIiwiYWJzIiwiaGludHNQb3NzaWJsZSIsInB1dEhpZ2hzY29yZSIsInN1Y2Nlc3MiLCJnZXRVc2VySGlnaHNjb3JlIiwiZ2V0T3ZlcmFsbEhpZ2hzY29yZSIsInNlbGYiLCJnZXRVc2VyIiwicG9zdCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsVUFBQUMsUUFBQUMsT0FBQSxZQUNBLFlBQ0EsYUFDQSxjQ0NJLGdCREFKLFNBQUFDLEdBQ0FBLEVBQUFDLGFBQUFDLEtBQUEscUJBSUFMLFVBQUFNLFNBQUEsYUFDQUMsWUFBQSxFQUNBQyxhQUFBLEVBRUFDLHlCQUFBLEVBQ0FDLHNCQUNBQyxFQUFBLHFCQUNBQyxFQUFBLHFCQUNBQyxFQUFBLHdCQUNBQyxFQUFBLGtCQUNBQyxFQUFBLG1CQUdBQyx3QkFDQSxXQUNBLGNBQ0EsWUFDQSxnQkFDQSxRQUNBLGVBQ0EsYUFDQSxjQUNBLE9BQ0EsU0FDQSxhQUNBLGtCQUNBLE9BQ0EsV0FDQSxhQUNBLGVBQ0EsUUFDQSxVQUNBLFNBQ0EsV0FJQWhCLFNBQUFpQixXQUFBLFdBQUEsU0FBQSxTQUFBLFVBQUEsYUFBQSxVQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFKLEVBQUFLLEtBQ0FDLFFBQ0FDLE1BQUEsV0FDQUMsU0FBQSx1REFDQUMsT0FBQSxvQkFLQVAsRUFBQVEscUJBQ0FDLEtBQUEsU0FBQUMsR0FFQVosRUFBQVksS0FBQUEsRUFFQVosRUFBQWEsV0FBQSxlQUdBVixFQUFBVyxPQUNBSCxLQUFBLFNBQUFJLEdBQ0FmLEVBQUFhLFdBQUEsbUJBQUFFLEdBR0FYLEVBQUFZLGFBQUFELE9BYkFiLFNBZ0JBLFNBQUFlLE1BSUFqQixFQUFBa0IscUJBQUEsV0FDQSxNQUFBakIsR0FBQWtCLEdBQUEsU0FJQW5CLEVBQUFvQixJQUFBLFlBQUEsU0FBQUMs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QUFVLE1BQUFGLEVBQUFsSixhQUFBLEVBQUFrSixFQUFBaE0sT0FBQSxJQUVBaU8sRUFBQXdILEtBQUEsWUFBQWpLLEdBQ0E0SixRQUFBLFNBQUEzVixHQUVBaUgsRUFBQThFLEVBQUE3RSxTQUFBNkUsRUFBQTVFLFVBQ0E5SCxLQUFBLFNBQUFXLEdBQ0FpUCxFQUFBalAsS0FGQWlILFNBSUEsU0FBQXRILEdBQ0F1UCxFQUFBdlAsT0FHQTJHLE1BQUEsU0FBQTNHLEdBQ0F1UCxFQUFBdlAsUUFLQWtOLEVBQUEsU0FBQXZOLEdBQ0EsTUFBQSxJQUFBMFAsU0FBQSxTQUFBQyxFQUFBQyxHQUNBVixFQUFBa0UsSUFBQSxrQkFBQXBULEdBQ0FxVyxRQUFBLFNBQUEzVixHQUNBaVAsRUFBQWpQLEtBRUFzRyxNQUFBLFNBQUEzRyxHQUNBdVAsRUFBQXZQLE9BS0EsUUFDQW9XLFFBQUFBLEVBQ0EzVyxtQkFBQUEsRUFDQTZILE1BQUFBLEVBQ0FPLE9BQUFBLEVBQ0F3RSxTQUFBQSxFQUNBYSxZQUFBQSIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbWFnZWxsYW4gPSBhbmd1bGFyLm1vZHVsZShcIm1hZ2VsbGFuXCIsIFtcclxuICAgICd1aS5yb3V0ZXInLFxyXG4gICAgJ25nUHJvZ3Jlc3MnLFxyXG4gICAgJ25nQW5pbWF0ZSdcclxuXSwgZnVuY3Rpb24gY29uZmlnKCRodHRwUHJvdmlkZXIpIHtcclxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG59KTtcclxuXHJcbi8vIGRlZmluZSBhcHBsaWNhdGlvbiBjb25zdGFudHNcclxubWFnZWxsYW4uY29uc3RhbnQoXCJBcHBDb25maWdcIiwge1xyXG4gICAgXCJsb2cuaW5mb1wiOiB0cnVlLFxyXG4gICAgXCJsb2cuZXJyb3JcIjogdHJ1ZSxcclxuXHJcbiAgICBcInF1aXouY291bnRyeS5xdWVzdGlvbnNcIjogMyxcclxuICAgIFwicXVpei5jb3VudHJ5LnR5cGVzXCI6IHtcclxuICAgICAgICAxOiBcIkNBUElUQUxfT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDI6IFwiQ09VTlRSWV9PRl9DQVBJVEFMXCIsXHJcbiAgICAgICAgMzogXCJQT1BVTEFUSU9OX09GX0NPVU5UUllcIixcclxuICAgICAgICA0OiBcIkFSRUFfT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDU6IFwiRkxBR19PRl9DT1VOVFJZXCJcclxuICAgIH0sXHJcblxyXG4gICAgXCJzZXR0aW5ncy51c2VyLmNvbG9yc1wiOiBbXHJcbiAgICAgICAgJ3NvZnRfcmVkJyxcclxuICAgICAgICAndGh1bmRlcmJpcmQnLFxyXG4gICAgICAgICdvbGRfYnJpY2snLFxyXG4gICAgICAgICduZXdfeW9ya19waW5rJyxcclxuICAgICAgICAnc251ZmYnLFxyXG4gICAgICAgICdob25leV9mbG93ZXInLFxyXG4gICAgICAgICdzYW5fbWFyaW5vJyxcclxuICAgICAgICAnc2hha2VzcGVhcmUnLFxyXG4gICAgICAgICdtaW5nJyxcclxuICAgICAgICAnZ29zc2lwJyxcclxuICAgICAgICAnZXVjYWx5cHR1cycsXHJcbiAgICAgICAgJ21vdW50YWluX21lYWRvdycsXHJcbiAgICAgICAgJ2phZGUnLFxyXG4gICAgICAgICdjb25mZXR0aScsXHJcbiAgICAgICAgJ2NhbGlmb3JuaWEnLFxyXG4gICAgICAgICdidXJudF9vcmFuZ2UnLFxyXG4gICAgICAgICdqYWZmYScsXHJcbiAgICAgICAgJ2dhbGxlcnknLFxyXG4gICAgICAgICdlZHdhcmQnLFxyXG4gICAgICAgICdseW5jaCdcclxuICAgIF1cclxufSk7XHJcblxyXG5tYWdlbGxhbi5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgVXNlclNydiwgQ291bnRyeVNydiwgUXVpelNydikge1xyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGNvbmZpZyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS5hcHAgPSB7XHJcbiAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgIHRpdGxlOiBcIk1hZ2VsbGFuXCIsXHJcbiAgICAgICAgICAgIHN1YnRpdGxlOiBcIlRlc3QgeW91ciBrbm93bGVkZ2UgYWJvdXQgdGhlIGNvdW50cmllcyBvZiBvdXIgd29ybGRcIixcclxuICAgICAgICAgICAgYXV0aG9yOiBcIk1pY2hhZWwgU3RpZnRlclwiXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgaW5pdGlhbGl6YXRpb24gLS0tLS0tLS0tLS0tXHJcbiAgICBVc2VyU3J2LmdldFVzZXJGcm9tU3RvcmFnZSgpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICAgICAkc2NvcGUudXNlciA9IHVzZXI7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgndXNlci5sb2FkZWQnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAvLyB0aGUgb25seSBlcnJvciB0aGF0IGNhbiBvY2N1ciBpcyB0aGF0IHRoZXJlIGlzIG5vIHRva2VuIGluIHN0b3JhZ2UsIHdlIGRvIG5vdCBuZWVkIHRvIHJlYWN0IHRvIHRoYXRcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuaXNQcm9ncmVzc0JhclZpc2libGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gJHN0YXRlLmlzKCdxdWl6Jyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEV2ZW50IGhhbmRsaW5nIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ2luJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIHF1aXogcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygncXVpeicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ291dCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gcmVtb3ZlIHVzZXIgb2JqZWN0IGZyb20gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfSk7XHJcbn0pOyIsInZhciBtYWdlbGxhbiA9IGFuZ3VsYXIubW9kdWxlKFwibWFnZWxsYW5cIiwgW1xyXG4gICAgJ3VpLnJvdXRlcicsXHJcbiAgICAnbmdQcm9ncmVzcycsXHJcbiAgICAnbmdBbmltYXRlJ1xyXG5dLCBbXCIkaHR0cFByb3ZpZGVyXCIsIGZ1bmN0aW9uIGNvbmZpZygkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBdXRoSW50ZXJjZXB0b3InKTtcclxufV0pO1xyXG5cclxuLy8gZGVmaW5lIGFwcGxpY2F0aW9uIGNvbnN0YW50c1xyXG5tYWdlbGxhbi5jb25zdGFudChcIkFwcENvbmZpZ1wiLCB7XHJcbiAgICBcImxvZy5pbmZvXCI6IHRydWUsXHJcbiAgICBcImxvZy5lcnJvclwiOiB0cnVlLFxyXG5cclxuICAgIFwicXVpei5jb3VudHJ5LnF1ZXN0aW9uc1wiOiAzLFxyXG4gICAgXCJxdWl6LmNvdW50cnkudHlwZXNcIjoge1xyXG4gICAgICAgIDE6IFwiQ0FQSVRBTF9PRl9DT1VOVFJZXCIsXHJcbiAgICAgICAgMjogXCJDT1VOVFJZX09GX0NBUElUQUxcIixcclxuICAgICAgICAzOiBcIlBPUFVMQVRJT05fT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDQ6IFwiQVJFQV9PRl9DT1VOVFJZXCIsXHJcbiAgICAgICAgNTogXCJGTEFHX09GX0NPVU5UUllcIlxyXG4gICAgfSxcclxuXHJcbiAgICBcInNldHRpbmdzLnVzZXIuY29sb3JzXCI6IFtcclxuICAgICAgICAnc29mdF9yZWQnLFxyXG4gICAgICAgICd0aHVuZGVyYmlyZCcsXHJcbiAgICAgICAgJ29sZF9icmljaycsXHJcbiAgICAgICAgJ25ld195b3JrX3BpbmsnLFxyXG4gICAgICAgICdzbnVmZicsXHJcbiAgICAgICAgJ2hvbmV5X2Zsb3dlcicsXHJcbiAgICAgICAgJ3Nhbl9tYXJpbm8nLFxyXG4gICAgICAgICdzaGFrZXNwZWFyZScsXHJcbiAgICAgICAgJ21pbmcnLFxyXG4gICAgICAgICdnb3NzaXAnLFxyXG4gICAgICAgICdldWNhbHlwdHVzJyxcclxuICAgICAgICAnbW91bnRhaW5fbWVhZG93JyxcclxuICAgICAgICAnamFkZScsXHJcbiAgICAgICAgJ2NvbmZldHRpJyxcclxuICAgICAgICAnY2FsaWZvcm5pYScsXHJcbiAgICAgICAgJ2J1cm50X29yYW5nZScsXHJcbiAgICAgICAgJ2phZmZhJyxcclxuICAgICAgICAnZ2FsbGVyeScsXHJcbiAgICAgICAgJ2Vkd2FyZCcsXHJcbiAgICAgICAgJ2x5bmNoJ1xyXG4gICAgXVxyXG59KTtcclxuXHJcbm1hZ2VsbGFuLmNvbnRyb2xsZXIoXCJBcHBDdHJsXCIsIFtcIiRzY29wZVwiLCBcIiRzdGF0ZVwiLCBcIlVzZXJTcnZcIiwgXCJDb3VudHJ5U3J2XCIsIFwiUXVpelNydlwiLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgVXNlclNydiwgQ291bnRyeVNydiwgUXVpelNydikge1xyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGNvbmZpZyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS5hcHAgPSB7XHJcbiAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgIHRpdGxlOiBcIk1hZ2VsbGFuXCIsXHJcbiAgICAgICAgICAgIHN1YnRpdGxlOiBcIlRlc3QgeW91ciBrbm93bGVkZ2UgYWJvdXQgdGhlIGNvdW50cmllcyBvZiBvdXIgd29ybGRcIixcclxuICAgICAgICAgICAgYXV0aG9yOiBcIk1pY2hhZWwgU3RpZnRlclwiXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgaW5pdGlhbGl6YXRpb24gLS0tLS0tLS0tLS0tXHJcbiAgICBVc2VyU3J2LmdldFVzZXJGcm9tU3RvcmFnZSgpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICAgICAkc2NvcGUudXNlciA9IHVzZXI7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgndXNlci5sb2FkZWQnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAvLyB0aGUgb25seSBlcnJvciB0aGF0IGNhbiBvY2N1ciBpcyB0aGF0IHRoZXJlIGlzIG5vIHRva2VuIGluIHN0b3JhZ2UsIHdlIGRvIG5vdCBuZWVkIHRvIHJlYWN0IHRvIHRoYXRcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuaXNQcm9ncmVzc0JhclZpc2libGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gJHN0YXRlLmlzKCdxdWl6Jyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEV2ZW50IGhhbmRsaW5nIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ2luJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIHF1aXogcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygncXVpeicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ291dCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gcmVtb3ZlIHVzZXIgb2JqZWN0IGZyb20gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfSk7XHJcbn1dKTtcbi8vIG93biBjbGFzc2VzIGFuZCBmdW5jdGlvbnNcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVJWiAtLS0tLS0tLS0tXHJcbnZhciBRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBpbmRleCBvZiBjdXJyZW50IHF1ZXN0aW9uXHJcbiAgICB2YXIgY3VycmVudFF1ZXN0aW9uSWR4ID0gbnVsbDtcclxuXHJcbiAgICAvLyBhcnJheSBjb250YWluaW5nIGFsbCBxdWVzdGlvbnNcclxuICAgIHZhciBxdWVzdGlvbnMgPSBbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN0YXJ0cyB0aGUgcXVpei5cclxuICAgICAqL1xyXG4gICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIGNoZWNrIGlmIHF1aXogaGFzIHF1ZXN0aW9uc1xyXG4gICAgICAgIGlmIChxdWVzdGlvbnMubGVuZ3RoIDw9IDApXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHN0YXJ0IGEgcXVpeiB3aXRob3V0IHF1ZXN0aW9uc1wiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaXNBY3RpdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNTdGFydGVkKCkgJiYgIXRoaXMuaGFzRW5kZWQoKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbklkeCAhPT0gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhc1N0YXJ0ZWQoKSAmJiBjdXJyZW50UXVlc3Rpb25JZHggPj0gcXVlc3Rpb25zLmxlbmd0aDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5zdWJtaXR0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBuZXcgcXVlc3Rpb24gdG8gdGhlIHF1aXouXHJcbiAgICAgKiBUaGUgcGFyYW1ldGVyIG11c3QgYmUgYW4gcXVlc3Rpb24gb2JqZWN0LlxyXG4gICAgICogSWYgbm8gcXVlc3Rpb24gb2JqZWN0IGlzIHBhc3NlZCBvciBhbiBvYmplY3Qgd2l0aCBtaXNzaW5nIHByb3BlcnRpZXMsIGFuIGVycm9yIGlzIHRocm93bi5cclxuICAgICAqL1xyXG4gICAgdGhpcy5hZGRRdWVzdGlvbiA9IGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XHJcbiAgICAgICAgaWYgKHF1ZXN0aW9uID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiTm8gcXVlc3Rpb24gb2JqZWN0IHBhc3NlZFwiKTtcclxuXHJcbiAgICAgICAgdmFyIHZhbGlkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gYSBxdWVzdGlvbiBvYmplY3QgbXVzdCBjb250YWluIGFsbCB0aGVzZSBwcm9wZXJ0aWVzXHJcbiAgICAgICAgdmFyIG5lY2Vzc2FyeVByb3BlcnRpZXMgPSBbJ2NvbmZpZycsICdoaW50JywgJ3NvbHV0aW9uJywgJ2Fuc3dlcicsICdxdWVzdGlvbicsICdnZXRJbmZvJywgJ2luZm8nLCAncG9pbnRzJywgJ2Fuc3dlcmVkJywgJ2hpbnRzQWxsb3dlZCcsICdoaW50c1JlbWFpbmluZyddO1xyXG5cclxuICAgICAgICBuZWNlc3NhcnlQcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcGVydHkpIHtcclxuICAgICAgICAgICAgaWYgKCFxdWVzdGlvbi5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHtcclxuICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJRdWVzdGlvbiBtdXN0IGhhdmUgcHJvcGVydHkgJ1wiICsgcHJvcGVydHkgKyBcIidcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHZhbGlkKSB7XHJcbiAgICAgICAgICAgIHF1ZXN0aW9ucy5wdXNoKHF1ZXN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgbmV4dCBxdWVzdGlvbiBvZiB0aGUgcXVpei5cclxuICAgICAqIElmIHRoZSBxdWl6IGhhcyBlbmRlZCwgaXQgcmV0dXJucyBub3RoaW5nLlxyXG4gICAgICovXHJcbiAgICB0aGlzLm5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChjdXJyZW50UXVlc3Rpb25JZHggPT09IG51bGwpIHtcclxuICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSWR4ID0gMDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjdXJyZW50UXVlc3Rpb25JZHgrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmhhc0VuZGVkKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JZHhdO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmN1cnJlbnRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JZHhdO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldFRvdGFsUG9pbnRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5oYXNTdGFydGVkKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgdG90YWxQb2ludHMgPSAwO1xyXG5cclxuICAgICAgICBxdWVzdGlvbnMuZm9yRWFjaChmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgcG9pbnRzID0gcXVlc3Rpb24ucG9pbnRzKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocG9pbnRzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHRvdGFsUG9pbnRzICs9IHBvaW50cztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdG90YWxQb2ludHM7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRRdWVzdGlvbklkeCA9PT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIHJldHVybiBjdXJyZW50UXVlc3Rpb25JZHggKyAxO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldE51bWJlck9mUXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9ucy5sZW5ndGg7XHJcbiAgICB9O1xyXG59O1xyXG5cclxuLy8gLS0tLS0tLS0tLSBRVUVTVElPTiAtLS0tLS0tLS0tXHJcbnZhciBRdWVzdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgIC8vIFRleHQgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgdGV4dCA9IG51bGw7XHJcblxyXG4gICAgLy8gSW5mbyBvYmplY3QgZm9yIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGluZm8gPSBudWxsO1xyXG5cclxuICAgIC8vIEFuc3dlciBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBhbnN3ZXIgPSBudWxsO1xyXG5cclxuICAgIC8vIEhpbnRzIG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGhpbnRzID0gbnVsbDtcclxuICAgIHZhciBoaW50c1VzZWQgPSAwO1xyXG5cclxuICAgIC8vIExhbWJkYSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgdGhlIGFuc3dlciBzdGF0dXMgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgY2hlY2tBbnN3ZXIgPSBudWxsO1xyXG5cclxuICAgIC8vIFBvaW50cyBhd2FyZGVkIGZvciB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBwb2ludHMgPSBudWxsO1xyXG5cclxuICAgIC8vIEZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHF1ZXN0aW9uIGhhcyBhbHJlYWR5IGJlZW4gYW5zd2VyZWRcclxuICAgIHZhciBhbnN3ZXJlZCA9IGZhbHNlO1xyXG5cclxuICAgIHZhciBpbml0ID0gZnVuY3Rpb24ob3B0cykge1xyXG4gICAgICAgIHRleHQgPSBvcHRzLnRleHQ7XHJcbiAgICAgICAgaW5mbyA9IG9wdHMuaW5mbyB8fCB7fTtcclxuICAgICAgICBhbnN3ZXIgPSBvcHRzLmFuc3dlcjtcclxuICAgICAgICBjaGVja0Fuc3dlciA9IG9wdHMuY2hlY2tBbnN3ZXIgfHwgbnVsbDtcclxuXHJcbiAgICAgICAgaGludHMgPSBvcHRzLmhpbnRzIHx8IHtcclxuICAgICAgICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLCAgICAgLy8gaXMgYSBoaW50IGFsbG93ZWQ/XHJcbiAgICAgICAgICAgICAgICBtYXhpbXVtOiAwLCAgICAgICAgIC8vIG1heGltdW0gbnVtYmVyIG9mIGhpbnRzIGZvciB0aGlzIHF1ZXN0aW9uIChpcnJlbGV2YW50IGlmIGFsbG93ZWQgaXMgc2V0IHRvIGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgY29zdDogMCwgICAgICAgICAgICAvLyBudW1iZXIgb2YgcG9pbnRzIHN1YnRyYWN0ZWQgcGVyIHVzZWQgaGludCAoaXJyZWxldmFudCBpZiBhbGxvd2VkIGlzIHNldCB0byBmYWxzZSlcclxuICAgICAgICAgICAgICAgIGdpdmU6IG51bGwgICAgICAgICAgLy8gbGFtYmRhIGZ1bmN0aW9uIHRvIGdpdmUgYSBoaW50IGZvciBhIHF1ZXN0aW9uXHJcbiAgICAgICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgaW5pdChvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNvbmZpZyA9IGZ1bmN0aW9uKG9wdHMpIHtcclxuICAgICAgICBpbml0KG9wdHMpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHF1ZXN0aW9uIHRleHQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMucXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGV4dDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBxdWVzdGlvbiBpbmZvIG9iamVjdC5cclxuICAgICAqIEFjdHMgYXMgZ2V0dGVyICh3aXRoIG9ubHkgb25lIGFyZ3VtZW50KSBhbmQgc2V0dGVyICh3aXRoIHR3byBhcmd1bWVudHMpXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaW5mbyA9IGZ1bmN0aW9uKHByb3AsIHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgLy8gc2V0dGVyXHJcbiAgICAgICAgICAgIGluZm9bcHJvcF0gPSB2YWx1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBnZXR0ZXJcclxuICAgICAgICAgICAgcmV0dXJuIGluZm9bcHJvcF07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIGVudGlyZSBpbmZvIG9iamVjdC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5nZXRJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGluZm87XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgY29ycmVjdCBhbnN3ZXIgdG8gdGhlIHF1ZXN0aW9uIGFmdGVyIHRoZSBxdWVzdGlvbiBoYXMgYmVlbiBhbnN3ZXJlZC5cclxuICAgICAqIElmIHRoZSBxdWVzdGlvbiBoYXMgbm90IGJlZW4gYW5zd2VyZWQgeWV0LCBpdCByZXR1cm5zIG51bGwuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuc29sdXRpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoYW5zd2VyZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgYSBoaW50IGZvciB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKiBJZiBubyBoaW50cyBhcmUgYWxsb3dlZCwgb3IgdGhlIG1heGltdW0gbnVtYmVyIG9mIGhpbnRzIGhhdmUgYmVlbiB1c2VkLCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmhpbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoIWhpbnRzLmFsbG93ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaGludHMuYWxsb3dlZCAmJiAhaGludHMuZ2l2ZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIaW50cyBhbGxvd2VkIGJ1dCBubyBnaXZlIG1ldGhvZCBwYXNzZWRcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaGludHNVc2VkIDwgaGludHMubWF4aW11bSkge1xyXG4gICAgICAgICAgICBoaW50c1VzZWQrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBoaW50cy5naXZlKGhpbnRzVXNlZCwgYW5zd2VyKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJtaXRzIGFuIGFuc3dlciB0byB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKiBJZiB0aGUgcXVlc3Rpb24gaGFzIGFscmVhZHkgYmVlbiBhbnN3ZXJlZCBvciBubyBjaGVja0Fuc3dlciBsYW1iZGEgaGFzIGJlZW4gc2V0LCB0aGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYW5zd2VyID0gZnVuY3Rpb24oc3VibWl0dGVkQW5zd2VyKSB7XHJcbiAgICAgICAgaWYgKGFuc3dlcmVkIHx8IWNoZWNrQW5zd2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFuc3dlcmVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gY2hlY2tBbnN3ZXIgbWV0aG9kIHNob3VsZCByZXR1cm4gdGhlIHN0YXR1cyByZXN1bHRzXHJcbiAgICAgICAgcG9pbnRzID0gY2hlY2tBbnN3ZXIoYW5zd2VyLCBzdWJtaXR0ZWRBbnN3ZXIsIGhpbnRzVXNlZCwgaGludHMuY29zdCwgaW5mbyk7XHJcblxyXG4gICAgICAgIC8vIGVuc3VyZSB0aGF0IG5vIG5lZ2F0aXZlIHBvaW50cyBhcmUgYXdhcmRlZFxyXG4gICAgICAgIHBvaW50cyA9IE1hdGgubWF4KDAsIHBvaW50cyk7XHJcblxyXG4gICAgICAgIC8vIGVuc3VyZSB0aGF0IG9ubHkgaW50ZWdlciB2YWx1ZXMgYXJlIHNhdmVkXHJcbiAgICAgICAgcG9pbnRzID0gTWF0aC5mbG9vcihwb2ludHMpO1xyXG5cclxuICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnBvaW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICghYW5zd2VyZWQgfHwgcG9pbnRzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBzdGF0ZSBvZiB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gYW5zd2VyZWQ7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0cnVlIGlmIGhpbnRzIGFyZSBhbGxvd2VkIGZvciB0aGlzIHF1ZXN0aW9uLCBmYWxzZSBpZiBub3QuXHJcbiAgICAgKiBJZiBoaW50cyBoYXZlIG5vdCBiZWVuIGluaXRpYWxpemVkIHlldCwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50c0FsbG93ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoaGludHMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGhpbnRzLmFsbG93ZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgcmVtYWluaW5nIGhpbnRzLlxyXG4gICAgICogSWYgbm8gaGludHMgYXJlIGFsbG93ZWQgZm9yIHRoaXMgcXVlc3Rpb24sIG51bGwgaXMgcmV0dXJuZWQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaGludHNSZW1haW5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgYWxsb3dlZCA9IHRoaXMuaGludHNBbGxvd2VkKCk7XHJcblxyXG4gICAgICAgIGlmIChhbGxvd2VkID09PSBudWxsIHx8IGFsbG93ZWQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGhpbnRzLm1heGltdW0gLSBoaW50c1VzZWQ7XHJcbiAgICB9O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgYSByYW5kb20gaW50ZWdlciBiZXR3ZWVuIG1pbiAoaW5jbHVzaXZlKSBhbmQgbWF4IChpbmNsdXNpdmUpXHJcbiAqIFVzaW5nIE1hdGgucm91bmQoKSB3aWxsIGdpdmUgeW91IGEgbm9uLXVuaWZvcm0gZGlzdHJpYnV0aW9uIVxyXG4gKi9cclxudmFyIGdldFJhbmRvbUludCA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7XHJcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRoZSB0ZXh0IGJldHdlZW4gdHdvIGRlbGltaXRpbmcgdGV4dCBvY2N1cnJlbmNlc1xyXG4gKi9cclxudmFyIGdldFN0cmluZ0JldHdlZW4gPSBmdW5jdGlvbih0ZXh0LCBmaXJzdFN0cmluZywgc2Vjb25kU3RyaW5nKSB7XHJcbiAgICB2YXIgZmlyc3RQb3MgPSB0ZXh0LmluZGV4T2YoZmlyc3RTdHJpbmcpO1xyXG4gICAgdmFyIHNlY29uZFBvcyA9IHRleHQuaW5kZXhPZihzZWNvbmRTdHJpbmcpO1xyXG5cclxuICAgIGlmIChmaXJzdFBvcyA+PSAwICYmIHNlY29uZFBvcyA+PSAwICYmIHNlY29uZFBvcyA+IGZpcnN0UG9zKSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQuc3Vic3RyKGZpcnN0UG9zICsgMSwgc2Vjb25kUG9zIC0gZmlyc3RQb3MgLSAxKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxufTtcclxuXHJcbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuUXVlc3Rpb24gPSBRdWVzdGlvbjtcclxuICAgIG1vZHVsZS5leHBvcnRzLlF1aXogPSBRdWl6O1xyXG59XG5hbmd1bGFyLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbmZpZyhbXCIkbG9jYXRpb25Qcm92aWRlclwiLCBcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbiAgICAgICAgLy8gZW5hYmxlIEhUTUw1IHB1c2hzdGF0ZVxyXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2hvbWUnKTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hvbWUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvaG9tZS5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncXVpeicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9xdWl6JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3F1aXoucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2NvdW50cmllcycsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9jb3VudHJpZXMnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvY291bnRyaWVzLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdjb3VudHJpZXMuZGV0YWlsJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnLzphbHBoYTNDb2RlJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2NvdW50cmllcy1kZXRhaWwucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2xvZ2luLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9nb3V0JyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dvdXRDdHJsJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3JlZ2lzdGVyLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdzZXR0aW5ncycsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9zZXR0aW5ncycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9zZXR0aW5ncy5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnYWJvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvYWJvdXQnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvYWJvdXQucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hpZ2hzY29yZScsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9oaWdoc2NvcmUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvaGlnaHNjb3JlLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignQ291bnRyaWVzQ3RybCcsIFtcIiRzY29wZVwiLCBcIkNvdW50cnlTcnZcIiwgZnVuY3Rpb24oJHNjb3BlLCBDb3VudHJ5U3J2KSB7XHJcbiAgICAgICAgdmFyIGNvdW50cmllc0J5TGV0dGVyID0gbnVsbDtcclxuICAgICAgICB2YXIgY291bnRyeUtleXMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb3VudHJpZXNCeUxldHRlciA9IENvdW50cnlTcnYuZ2V0Q291bnRyaWVzQnlMZXR0ZXIoKTtcclxuICAgICAgICAgICAgY291bnRyeUtleXMgPSBPYmplY3Qua2V5cyhjb3VudHJpZXNCeUxldHRlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAoISRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJ5S2V5cyA9IGNvdW50cnlLZXlzO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJpZXNCeUxldHRlciA9IGNvdW50cmllc0J5TGV0dGVyO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyeUtleXMgPSBjb3VudHJ5S2V5cztcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJpZXNCeUxldHRlciA9IGNvdW50cmllc0J5TGV0dGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKENvdW50cnlTcnYuYXJlQ291bnRyaWVzTG9hZGVkKCkpIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignY291bnRyaWVzLmxvYWRlZCcsIGZ1bmN0aW9uKCkgIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0NvdW50cnlEZXRhaWxDdHJsJywgW1wiJHNjb3BlXCIsIFwiQ291bnRyeVNydlwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBmdW5jdGlvbigkc2NvcGUsIENvdW50cnlTcnYsICRzdGF0ZVBhcmFtcykge1xyXG4gICAgICAgIHZhciBhbHBoYTNDb2RlID0gJHN0YXRlUGFyYW1zLmFscGhhM0NvZGU7XHJcblxyXG4gICAgICAgIGlmIChDb3VudHJ5U3J2LmFyZUNvdW50cmllc0xvYWRlZCgpKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5jb3VudHJ5ID0gQ291bnRyeVNydi5nZXRDb3VudHJ5QnlBbHBoYTMoYWxwaGEzQ29kZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdjb3VudHJpZXMubG9hZGVkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhM0NvZGUpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyeUZyb21TZXJ2aWNlID0gZnVuY3Rpb24oYWxwaGEzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTMpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5nZXRDb3VudHJ5RnJvbVNlcnZpY2UgPSBnZXRDb3VudHJ5RnJvbVNlcnZpY2U7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignRHJvcGRvd25DdHJsJywgW1wiJHNjb3BlXCIsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG4gICAgICAgIHZhciB2aXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICRzY29wZS50b2dnbGVEcm9wZG93biA9IHRvZ2dsZURyb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5zaG93RHJvcGRvd24gPSBzaG93RHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmhpZGVEcm9wZG93biA9IGhpZGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuaXNEcm9wZG93blZpc2libGUgPSBpc0Ryb3Bkb3duVmlzaWJsZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmhhbmRsZUNsaWNrT3V0c2lkZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ0xJQ0tFRCBPVVRTSURFXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSAhdmlzaWJsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dEcm9wZG93bigpIHtcclxuICAgICAgICAgICAgdmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoaWRlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzRHJvcGRvd25WaXNpYmxlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmlzaWJsZTtcclxuICAgICAgICB9XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignSGlnaHNjb3JlQ3RybCcsIFtcIiRzY29wZVwiLCBcIlNjb3JlU3J2XCIsIFwiTG9nU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgU2NvcmVTcnYsIExvZ1Nydikge1xyXG4gICAgICAgICRzY29wZS5zY29yZUxpc3QgPSBbXTtcclxuXHJcbiAgICAgICAgU2NvcmVTcnYuZ2V0SGlnaHNjb3JlTGlzdCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zY29yZUxpc3QgPSBjcmVhdGVSYW5raW5nKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2NvcmVMaXN0ID0gY3JlYXRlUmFua2luZyhsaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgaXNNeXNlbGYgPSBmdW5jdGlvbihpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnVzZXIuX2lkID09PSBpZDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlUmFua2luZyA9IGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgdmFyIHJhbmsgPSAwO1xyXG5cclxuICAgICAgICAgICAgdmFyIHByZXZpb3VzU2NvcmUgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGVudHJ5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXByZXZpb3VzU2NvcmUgfHwgZW50cnkuc2NvcmUgIT09IHByZXZpb3VzU2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICByYW5rKys7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGVudHJ5LnJhbmsgPSByYW5rICsgJy4nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHByZXZpb3VzU2NvcmUgPSBlbnRyeS5zY29yZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbGlzdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuaXNNeXNlbGYgPSBpc015c2VsZjtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdIb21lQ3RybCcsIFtcIiRzY29wZVwiLCBcIkxvZ1NydlwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBmdW5jdGlvbigkc2NvcGUsIExvZ1NydiwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBjaGVjayBzdGF0ZSBwYXJhbXNcclxuICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLmFjdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgYWN0aW9uID0gJHN0YXRlUGFyYW1zLmFjdGlvbjtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdyZWdpc3Rlci5zdWNjZXNzZnVsJzpcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnR3JhdHVsYXRpb24hIERpZSBBbm1lbGR1bmcgd2FyIGVyZm9sZ3JlaWNoLiBIZXJ6bGljaCB3aWxsa29tbWVuIGJlaSBNYWdlbGxhbi4nXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTG9naW5DdHJsJywgW1wiJHNjb3BlXCIsIFwiVXNlclNydlwiLCBcIkZvY3VzU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICBVc2VyU3J2LmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dpbiBldmVudFxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ2luJywgcmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLnN0YXR1cyA9PT0gNDAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0ZhbHNjaGVyIEJlbnV0emVybmFtZSBvZGVyIFBhc3N3b3J0JztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdCZWltIEVpbmxvZ2dlbiBzY2hlaW50IGV0d2FzIHNjaGllZiBnZWdhbmdlbiB6dSBzZWluJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCcjdXNlcm5hbWUnKTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdMb2dvdXRDdHJsJywgW1wiJHNjb3BlXCIsIFwiVXNlclNydlwiLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTcnYpIHtcclxuICAgICAgICBVc2VyU3J2LmxvZ291dCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcGxpY2F0aW9uIGNvbnRyb2wgYWJvdXQgbG9nb3V0IGV2ZW50XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dvdXQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUXVpekRpcmVjdGl2ZUNvbnRyb2xsZXInLCBbXCIkc2NvcGVcIiwgXCJRdWl6U3J2XCIsIFwiTG9nU3J2XCIsIFwiRm9jdXNTcnZcIiwgXCJuZ1Byb2dyZXNzRmFjdG9yeVwiLCBmdW5jdGlvbigkc2NvcGUsIFF1aXpTcnYsIExvZ1NydiwgRm9jdXNTcnYsIG5nUHJvZ3Jlc3NGYWN0b3J5KSB7XHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uO1xyXG5cclxuICAgICAgICB2YXIgaW5pdEN0cmwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gUHJvZ3Jlc3MgYmFyIGluaXRpYWxpemF0aW9uXHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2JhciA9IG5nUHJvZ3Jlc3NGYWN0b3J5LmNyZWF0ZUluc3RhbmNlKCk7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRQYXJlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotcHJvZ3Jlc3MnKSk7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRBYnNvbHV0ZSgpO1xyXG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0Q29sb3IoXCIjMzM2ZTdiXCIpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmlzUmVzdWx0c1BhZ2VWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5hY2hpZXZlbWVudHMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gW107XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQgPSB7fTtcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gYWRkIG9wdGlvbnMgZm9yIG11bHRpcGxpZXIgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICRzY29wZS5tdWx0aXBsaWVyT3B0aW9ucyA9IFtcclxuICAgICAgICAgICAgICAgIHsgdmFsdWU6IDEsIGxhYmVsOiAnJyB9LFxyXG4gICAgICAgICAgICAgICAgeyB2YWx1ZTogMTAwMCwgbGFiZWw6ICdUc2QuJ30sXHJcbiAgICAgICAgICAgICAgICB7IHZhbHVlOiAxMDAwMDAwLCBsYWJlbDogJ01pby4nfVxyXG4gICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgcXVlc3Rpb24gPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVVaSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBnZXQgY3VycmVudCBxdWVzdGlvbiBmcm9tIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICBxdWVzdGlvbiA9IFF1aXpTcnYuZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBkZWxldGUgcHJldmlvdXMgaGludHNcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgaWYgKHF1ZXN0aW9uICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBtdWx0aXBsaWVycyBmb3IgcXVlc3Rpb25zIGNvbnRhaW5pbmcgbnVtYmVyc1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dCAmJiBxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQuaW5kZXhPZignbnVtYmVyJykgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXIuaGlnaCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IHsgdmFsdWU6IDEwMDAwMDAsIGxhYmVsOiAnTWlvLid9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXIubWVkaXVtJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyID0geyB2YWx1ZTogMTAwMCwgbGFiZWw6ICdUc2QuJ307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IHsgdmFsdWU6IDEsIGxhYmVsOiAnJyB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIHByb2dyZXNzIGJhclxyXG4gICAgICAgICAgICAgICAgdXBkYXRlUHJvZ3Jlc3NCYXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBmb2N1cyBhbnN3ZXIgaW5wdXRcclxuICAgICAgICAgICAgICAgIEZvY3VzU3J2KCcuYW5zd2VySW5wdXQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIHF1aXogaGFzIGVuZGVkLCBzZXQgcHJvZ3Jlc3MgYmFyIHRvIDBcclxuICAgICAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXQoMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVuZGVyUXVlc3Rpb25UZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXIoZ2V0UXVlc3Rpb24oKS5xdWVzdGlvbigpLCAncXVlc3Rpb24taGlnaGxpZ2h0JykgKyAnPyc7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uTWVkaWEgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFxdWVzdGlvbiB8fCAhcXVlc3Rpb24uZ2V0SW5mbygpLm1lZGlhKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uZ2V0SW5mbygpLm1lZGlhO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzaG93UmVzdWx0c1BhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmlzUmVzdWx0c1BhZ2VWaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGlkZVJlc3VsdHNQYWdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzUmVzdWx0c1BhZ2VWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc1Jlc3VsdHNQYWdlVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGludHNBdmFpbGFibGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1ZXN0aW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChxdWVzdGlvbi5oaW50c1JlbWFpbmluZygpID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5oaW50c1JlbWFpbmluZygpID4gMDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc3VibWl0QW5zd2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuYW5zd2VySW5wdXQuYW5zd2VyICYmICFxdWVzdGlvbi5hbnN3ZXJlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5zd2VyID0gU3RyaW5nKCRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGlmIGl0IGlzIGEgbnVtYmVyIGlucHV0LCByZXBsYWNlICcsJyB3aXRoICcuJ1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dCAmJiBxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQuaW5kZXhPZignbnVtYmVyJykgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBhbnN3ZXIgPSBhbnN3ZXIucmVwbGFjZSgnLCcsICcuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaWYgYSBtdWx0aXBsaWVyIGlzIGF2YWlsYWJsZSwgY2FsY3VsYXRlIGFuc3dlclxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5zd2VyICo9ICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKCdzdWJtaXR0aW5nIGFuc3dlcicsIGFuc3dlcik7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQucG9pbnRzID0gcXVlc3Rpb24uYW5zd2VyKGFuc3dlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGZvY3VzIHRvIG5leHQgcXVlc3Rpb24gYnV0dG9uXHJcbiAgICAgICAgICAgICAgICBGb2N1c1NydignI2J0bk5leHRRdWVzdGlvbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uQW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKSB8fCBxdWVzdGlvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uYW5zd2VyZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIFF1aXpTcnYubmV4dFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQuYW5zd2VyID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgIHVwZGF0ZVVpKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlcXVlc3RIaW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5oaW50ID0gcXVlc3Rpb24uaGludCgpO1xyXG5cclxuICAgICAgICAgICAgRm9jdXNTcnYoJy5hbnN3ZXJJbnB1dCcpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZW5kZXIgPSBmdW5jdGlvbih0ZXh0LCBjbGFzc05hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRleHRcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwiW1wiLCBcIjxzcGFuIGNsYXNzPSdcIiArIGNsYXNzTmFtZSArIFwiJz5cIilcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwiXVwiLCBcIjwvc3Bhbj5cIik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhbmRsZUtleVByZXNzID0gZnVuY3Rpb24oa2V5RXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGtleUV2ZW50LndoaWNoID09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJtaXRBbnN3ZXIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVQcm9ncmVzc0JhciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcHJvZ3Jlc3NQZXJjZW50ID0gZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCkgLyBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKSAqIDEwMDtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXQocHJvZ3Jlc3NQZXJjZW50KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgd2FzTGFzdFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKSA+PSBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcGFyc2VFdmVudHMgPSBmdW5jdGlvbihldmVudHMsIHBlcnNvbmFsQmVzdCwgb3ZlcmFsbEJlc3QpIHtcclxuICAgICAgICAgICAgdmFyIGFjaGlldmVtZW50cyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgdmFyIHNob3dCZXN0cyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ292ZXJhbGxfYmVzdCcpID49IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBlaW5lbiBuZXVlbiBhYnNvbHV0ZW4gUmVrb3JkIGdlc2NoYWZmdCEnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzaG93QmVzdHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGV2ZW50cy5pbmRleE9mKCdvdmVyYWxsX2Jlc3RfZXF1YWxpc2VkJykgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEdSBoYXN0IGRlbiBha3R1ZWxsZW4gYWJzb2x1dGVuIFJla29yZCBlaW5nZXN0ZWxsdCEnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzaG93QmVzdHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGV2ZW50cy5pbmRleE9mKCdwZXJzb25hbF9iZXN0JykgPj0gMCAmJiBldmVudHMuaW5kZXhPZignb3ZlcmFsbF9iZXN0JykgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZWluZW4gbmV1ZW4gcGVyc8O2bmxpY2hlbiBSZWtvcmQgZ2VzY2hhZmZ0ISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dCZXN0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ3BlcnNvbmFsX2Jlc3RfZXF1YWxpc2VkJykgPj0gMCAmJiBldmVudHMuaW5kZXhPZignb3ZlcmFsbF9iZXN0X2VxdWFsaXNlZCcpIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEdSBoYXN0IGdsZWljaCB2aWVsZSBQdW5rdGUgZ2VzY2hhZmZ0IHdpZSBiZWkgZGVpbmVtIHBlcnPDtm5saWNoZW4gUmVrb3JkISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dCZXN0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ25ld19kYWlseV9iZXN0JykgPj0gMCAmJiBhY2hpZXZlbWVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZWluZW4gbmV1ZW4gcGVyc8O2bmxpY2hlbiBUYWdlc3Jla29yZCBnZXNjaGFmZnQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hY2hpZXZlbWVudHMgPSBhY2hpZXZlbWVudHM7XHJcblxyXG4gICAgICAgICAgICBpZiAoc2hvd0Jlc3RzICYmIHBlcnNvbmFsQmVzdCAmJiBwZXJzb25hbEJlc3QuaWQgJiYgcGVyc29uYWxCZXN0LmRhdGUgJiYgcGVyc29uYWxCZXN0LnNjb3JlICYmIG92ZXJhbGxCZXN0ICYmIG92ZXJhbGxCZXN0LmlkICYmIG92ZXJhbGxCZXN0LmRhdGUgJiYgb3ZlcmFsbEJlc3Quc2NvcmUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiZXN0cyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIG92ZXJhbGxCZXN0LnR5cGUgPSAnb3ZlcmFsbCc7XHJcbiAgICAgICAgICAgICAgICBiZXN0cy5wdXNoKG92ZXJhbGxCZXN0KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocGVyc29uYWxCZXN0LmlkICE9PSBvdmVyYWxsQmVzdC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBlcnNvbmFsQmVzdC50eXBlID0gJ3BlcnNvbmFsJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYmVzdHMucHVzaChwZXJzb25hbEJlc3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5iZXN0cyA9IGJlc3RzO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjb250aW51ZUZpbmlzaGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHNob3dSZXN1bHRzUGFnZSgpO1xyXG5cclxuICAgICAgICAgICAgbmV4dFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBjb25jbHVkZSB0aGUgcXVpeiBhbmQgd3JpdGUgcmVzdWx0IHRvIGRhdGFiYXNlXHJcbiAgICAgICAgICAgIFF1aXpTcnYuY29uY2x1ZGUoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnNlRXZlbnRzKGRhdGEuZXZlbnRzIHx8IFtdLCBkYXRhLnBlcnNvbmFsQmVzdCwgZGF0YS5vdmVyYWxsQmVzdCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEJlc3RUZXh0ID0gZnVuY3Rpb24oYmVzdCkge1xyXG4gICAgICAgICAgICB2YXIgdGV4dDtcclxuXHJcbiAgICAgICAgICAgIGlmIChiZXN0LnR5cGUgPT09ICdwZXJzb25hbCcpIHtcclxuICAgICAgICAgICAgICAgIC8vIHBlcnNvbmFsIGJlc3RcclxuICAgICAgICAgICAgICAgIHRleHQgPSBcIkRlaW4gcGVyc8O2bmxpY2hlciBSZWtvcmQgbGllZ3QgYmVpIDxzcGFuIGNsYXNzPSdib2xkJz57UE9JTlRTfSBQdW5rdGVuPC9zcGFuPiwgYXVmZ2VzdGVsbHQgYW0ge0RBVEV9LlwiO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gb3ZlcmFsbCBiZXN0XHJcbiAgICAgICAgICAgICAgICB2YXIgZnJvbU15c2VsZiA9IGJlc3QuaWQgPT09ICRzY29wZS51c2VyLl9pZDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZnJvbU15c2VsZikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQgPSBcIkR1IGjDpGx0c3QgZGVuIGFic29sdXRlbiBSZWtvcmQgbWl0IDxzcGFuIGNsYXNzPSdib2xkJz57UE9JTlRTfSBQdW5rdGVuPC9zcGFuPiwgYXVmZ2VzdGVsbHQgYW0ge0RBVEV9LlwiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gXCI8c3BhbiBjbGFzcz0naGlnaGxpZ2h0Jz57VVNFUk5BTUV9PC9zcGFuPiBow6RsdCBkZW4gYWJzb2x1dGVuIFJla29yZCBtaXQgPHNwYW4gY2xhc3M9J2JvbGQnPntQT0lOVFN9IFB1bmt0ZW48L3NwYW4+LCBhdWZnZXN0ZWxsdCBhbSB7REFURX0uXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoJ3tQT0lOVFN9JywgYmVzdC5zY29yZSlcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7REFURX0nLCBnZXRGb3JtYXR0ZWREYXRlKGJlc3QuZGF0ZSkpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgne1VTRVJOQU1FfScsIGJlc3QudXNlcm5hbWUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRGb3JtYXR0ZWREYXRlID0gZnVuY3Rpb24oZGF0ZSkge1xyXG4gICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoZGF0ZSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcGFkKGRhdGUuZ2V0RGF0ZSgpLCAnMDAnKSArICcuJyArIHBhZChkYXRlLmdldE1vbnRoKCkgKyAxLCAnMDAnKSArICcuJyArIChkYXRlLmdldFllYXIoKSArIDE5MDApO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwYWQgPSBmdW5jdGlvbihzdHIsIHBhZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBTdHJpbmcocGFkVmFsdWUgKyBzdHIpLnNsaWNlKC1wYWRWYWx1ZS5sZW5ndGgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXN0YXJ0UXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBxdWl6ID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kZW1pdCgncXVpei5yZXN0YXJ0Jyk7XHJcblxyXG4gICAgICAgICAgICBpbml0Q3RybCgpO1xyXG5cclxuICAgICAgICAgICAgdXBkYXRlVWkoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdxdWl6LnN0YXJ0JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgaGlkZVJlc3VsdHNQYWdlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGluaXQgY29udHJvbGxlclxyXG4gICAgICAgIGluaXRDdHJsKCk7XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWxseSB1cGRhdGUgVUlcclxuICAgICAgICB1cGRhdGVVaSgpO1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb24gPSBnZXRRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyO1xyXG4gICAgICAgICRzY29wZS5yZW5kZXJRdWVzdGlvblRleHQgPSByZW5kZXJRdWVzdGlvblRleHQ7XHJcbiAgICAgICAgJHNjb3BlLnN1Ym1pdEFuc3dlciA9IHN1Ym1pdEFuc3dlcjtcclxuICAgICAgICAkc2NvcGUucXVlc3Rpb25BbnN3ZXJlZCA9IHF1ZXN0aW9uQW5zd2VyZWQ7XHJcbiAgICAgICAgJHNjb3BlLm5leHRRdWVzdGlvbiA9IG5leHRRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuaGFuZGxlS2V5UHJlc3MgPSBoYW5kbGVLZXlQcmVzcztcclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb25NZWRpYSA9IGdldFF1ZXN0aW9uTWVkaWE7XHJcbiAgICAgICAgJHNjb3BlLnJlcXVlc3RIaW50ID0gcmVxdWVzdEhpbnQ7XHJcbiAgICAgICAgJHNjb3BlLndhc0xhc3RRdWVzdGlvbiA9IHdhc0xhc3RRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuY29udGludWVGaW5pc2hlZCA9IGNvbnRpbnVlRmluaXNoZWQ7XHJcbiAgICAgICAgJHNjb3BlLmdldEJlc3RUZXh0ID0gZ2V0QmVzdFRleHQ7XHJcbiAgICAgICAgJHNjb3BlLnJlc3RhcnRRdWl6ID0gcmVzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmhpbnRzQXZhaWxhYmxlID0gaGludHNBdmFpbGFibGU7XHJcbiAgICB9XSk7XHJcblxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1F1aXpDdHJsJywgW1wiJHNjb3BlXCIsIFwiUXVpelNydlwiLCBcIkxvZ1NydlwiLCBmdW5jdGlvbigkc2NvcGUsIFF1aXpTcnYsIExvZ1Nydikge1xyXG5cclxuICAgICAgICB2YXIgc3RhcnRRdWl6ID0gZnVuY3Rpb24oY2IpIHtcclxuICAgICAgICAgICAgUXVpelNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYiAmJiB0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2IoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKFwiUXVpeiBzdGFydGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpelN0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuaGFzUXVpelN0YXJ0ZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpekVuZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2Lmhhc1F1aXpFbmRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXRUb3RhbFBvaW50cygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ3F1aXoucmVzdGFydCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIExvZ1Nydi5pbmZvKCdxdWl6IHJlc3RhcnQnKTtcclxuXHJcbiAgICAgICAgICAgIFF1aXpTcnYuZGlzcG9zZSgpO1xyXG5cclxuICAgICAgICAgICAgc3RhcnRRdWl6KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3F1aXouc3RhcnQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS5zdGFydFF1aXogPSBzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmlzUXVpelJ1bm5pbmcgPSBpc1F1aXpSdW5uaW5nO1xyXG4gICAgICAgICRzY29wZS5oYXNRdWl6U3RhcnRlZCA9IGhhc1F1aXpTdGFydGVkO1xyXG4gICAgICAgICRzY29wZS5oYXNRdWl6RW5kZWQgPSBoYXNRdWl6RW5kZWQ7XHJcbiAgICAgICAgJHNjb3BlLmdldFRvdGFsUG9pbnRzID0gZ2V0VG90YWxQb2ludHM7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUmVnaXN0ZXJDdHJsJywgW1wiJHNjb3BlXCIsIFwiTG9nU3J2XCIsIFwiRm9jdXNTcnZcIiwgXCJVc2VyU3J2XCIsIFwiJHN0YXRlXCIsIFwiJHdpbmRvd1wiLCBmdW5jdGlvbigkc2NvcGUsIExvZ1NydiwgRm9jdXNTcnYsIFVzZXJTcnYsICRzdGF0ZSwgJHdpbmRvdykge1xyXG4gICAgICAgIC8vIG5ldyB1c2VyIG9iamVjdFxyXG4gICAgICAgICRzY29wZS5uZXdVc2VyID0ge307XHJcblxyXG4gICAgICAgIC8vIG1lc3NhZ2Ugb2JqZWN0XHJcbiAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgcmVnaXN0ZXIgPSBmdW5jdGlvbiAoaXNWYWxpZCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzVmFsaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHZhbGlkYXRlQmVmb3JlU3VibWl0KCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIHBlcmZvcm0gYXBpIGNhbGxcclxuICAgICAgICAgICAgICAgIFVzZXJTcnYucmVnaXN0ZXIoJHNjb3BlLm5ld1VzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwIGNvbnRyb2xsZXIgYWJvdXQgbG9naW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ2luJywgcmVzcG9uc2UuZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gaG9tZSBwYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncmVnaXN0ZXIuc3VjY2Vzc2Z1bCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnQmVpIGRlciBBbm1lbGR1bmcgc2NoZWludCBldHdhcyBzY2hpZWYgZ2VnYW5nZW4genUgc2VpbidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlVGV4dDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZXJyLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1VzZXJuYW1lIGFscmVhZHkgZXhpc3RzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEZXIgQmVudXR6ZXJuYW1lIGV4aXN0aWVydCBiZXJlaXRzJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0JlaSBkZXIgQW5tZWxkdW5nIHNjaGVpbnQgZXR3YXMgc2NoaWVmIGdlZ2FuZ2VuIHp1IHNlaW4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbWVzc2FnZVRleHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB2YWxpZGF0ZUJlZm9yZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgdHdvIHBhc3N3b3JkcyBtYXRjaFxyXG4gICAgICAgICAgICB2YXIgcGFzc3dvcmQgPSAkc2NvcGUubmV3VXNlci5wYXNzd29yZDtcclxuICAgICAgICAgICAgdmFyIHBhc3N3b3JkMiA9ICRzY29wZS5uZXdVc2VyLnBhc3N3b3JkMjtcclxuXHJcbiAgICAgICAgICAgIGlmICghJHNjb3BlLm5ld1VzZXIudXNlcm5hbWUgfHwgISRzY29wZS5uZXdVc2VyLmVtYWlsIHx8ICFwYXNzd29yZCB8fCAhcGFzc3dvcmQyKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdBbGxlIEZlbGRlciBtw7xzc2VuIGF1c2dlZsO8bGx0IHNlaW4nXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhc3N3b3JkID09PSBcIlwiIHx8IHBhc3N3b3JkMiA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRGllIFBhc3N3w7ZydGVyIGvDtm5uZW4gbmljaHQgbGVlciBzZWluJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXNzd29yZCAhPT0gcGFzc3dvcmQyKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEaWUgUGFzc3fDtnJ0ZXIgc3RpbW1lbiBuaWNodCDDvGJlcmVpbidcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiAhJHNjb3BlLm1lc3NhZ2UgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRlbGVnYXRlU3VibWl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJlZ2lzdGVyKHRydWUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5kZWxlZ2F0ZVN1Ym1pdCA9IGRlbGVnYXRlU3VibWl0O1xyXG5cclxuICAgICAgICAkc2NvcGUucmVnaXN0ZXIgPSByZWdpc3RlcjtcclxuXHJcbiAgICAgICAgLy8gZm9jdXMgdXNlciBuYW1lIGZpZWxkXHJcbiAgICAgICAgRm9jdXNTcnYoJyN1c2VybmFtZScpO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1NldHRpbmdzQ3RybCcsIFtcIiRzY29wZVwiLCBcIkFwcENvbmZpZ1wiLCBcIkZvY3VzU3J2XCIsIFwiTG9nU3J2XCIsIFwiVXNlclNydlwiLCBmdW5jdGlvbigkc2NvcGUsIEFwcENvbmZpZywgRm9jdXNTcnYsIExvZ1NydiwgVXNlclNydikge1xyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIC8vIHVzZXIgY29sb3Vyc1xyXG4gICAgICAgICAgICB2YXIgY29sb3JzID0gQXBwQ29uZmlnWydzZXR0aW5ncy51c2VyLmNvbG9ycyddO1xyXG5cclxuICAgICAgICAgICAgLy8gdXNlciBvYmplY3RcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJPYmogPSB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogJHNjb3BlLnVzZXIudXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBlbWFpbDogJHNjb3BlLnVzZXIuZW1haWwsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjogJHNjb3BlLnVzZXIuY29sb3JcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS51c2VyQ29sb3JzID0gY29sb3JzO1xyXG5cclxuICAgICAgICAgICAgdmFyIHNldENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS51c2VyT2JqLmNvbG9yID0gbmV3Q29sb3I7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgdXBkYXRlVXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgVXNlclNydi51cGRhdGVCYXNpYygkc2NvcGUudXNlck9iaikudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHVzZXIgb2JqZWN0XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIudXNlcm5hbWUgPSAkc2NvcGUudXNlck9iai51c2VybmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXNlci5lbWFpbCA9ICRzY29wZS51c2VyT2JqLmVtYWlsO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmNvbG9yID0gJHNjb3BlLnVzZXJPYmouY29sb3I7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0VpbnN0ZWxsdW5nZW4gd3VyZGVuIGVyZm9sZ3JlaWNoIGdlc3BlaWNoZXJ0J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKCdVcGRhdGUgdXNlcicsIGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlVGV4dDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChlcnIubWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdVc2VybmFtZSBhbHJlYWR5IGV4aXN0cyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEZXIgQmVudXR6ZXJuYW1lIGlzdCBiZXJlaXRzIHZlcmdlYmVuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RpZSBFaW5zdGVsbHVuZ2VuIGtvbm50ZW4gbmljaHQgZ2VzcGVpY2hlcnQgd2VyZGVuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbWVzc2FnZVRleHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIGRlbGVnYXRlU3VibWl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVVc2VyKHRydWUpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnNldENvbG9yID0gc2V0Q29sb3I7XHJcbiAgICAgICAgICAgICRzY29wZS51cGRhdGVVc2VyID0gdXBkYXRlVXNlcjtcclxuICAgICAgICAgICAgJHNjb3BlLmRlbGVnYXRlU3VibWl0ID0gZGVsZWdhdGVTdWJtaXQ7XHJcblxyXG4gICAgICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgICAgICBGb2N1c1NydignI3VzZXJuYW1lJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKCRzY29wZS51c2VyKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIG90aGVyd2lzZSwgd2FpdCBmb3IgdXNlci5sb2FkZWQgZXZlbnRcclxuICAgICAgICAkc2NvcGUuJG9uKCd1c2VyLmxvYWRlZCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5kaXJlY3RpdmUoJ3F1aXonLCBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2J1aWxkL3ZpZXdzL3RlbXBsYXRlcy9xdWl6LWRpcmVjdGl2ZS50ZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgc2NvcGU6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdRdWl6RGlyZWN0aXZlQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSlcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5maWx0ZXIoJ3JlbmRlckh0bWwnLCBbXCIkc2NlXCIsIGZ1bmN0aW9uKCRzY2UpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbCh0ZXh0KTtcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZpbHRlcigndGV4dE9yTnVtYmVyJywgW1wiJGZpbHRlclwiLCBmdW5jdGlvbigkZmlsdGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0LCBmcmFjdGlvblNpemUpIHtcclxuICAgICAgICAgICAgZnJhY3Rpb25TaXplID0gZnJhY3Rpb25TaXplICE9PSB1bmRlZmluZWQgPyAwIDogZnJhY3Rpb25TaXplO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzTmFOKGlucHV0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ251bWJlcicpKGlucHV0LCBmcmFjdGlvblNpemUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIFtcIkF1dGhUb2tlblNydlwiLCBmdW5jdGlvbihBdXRoVG9rZW5TcnYpIHtcclxuICAgICAgICB2YXIgYWRkVG9rZW4gPSBmdW5jdGlvbihjb25maWcpIHtcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFRva2VuU3J2LmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snWC1BdXRoJ10gPSB0b2tlbjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0OiBhZGRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFRva2VuU3J2JywgW1wiJHdpbmRvd1wiLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZTtcclxuICAgICAgICB2YXIga2V5ID0gJ2F1dGgtdG9rZW4nO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0VG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnNldEl0ZW0oa2V5LCB0b2tlbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRUb2tlbjogZ2V0VG9rZW4sXHJcbiAgICAgICAgICAgIHNldFRva2VuOiBzZXRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQ291bnRyeVNydicsIFtcIiRodHRwXCIsIFwiSW5kZXhlZERCU3J2XCIsIFwiTG9nU3J2XCIsIGZ1bmN0aW9uKCRodHRwLCBJbmRleGVkREJTcnYsIExvZ1Nydikge1xyXG4gICAgICAgIC8vIENvdW50cmllcyBhcnJheVxyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgY291bnRyaWVzQnlBbHBoYTMgPSBudWxsO1xyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUxldHRlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIEluZGV4ZWREQlxyXG4gICAgICAgIHZhciBkYXRhYmFzZSA9ICdtYWdlbGxhbic7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJ2NvdW50cnlTdG9yZSc7XHJcbiAgICAgICAgdmFyIGtleUNvdW50cmllcyA9ICdjb3VudHJpZXMnO1xyXG4gICAgICAgIHZhciBrZXlWZXJzaW9uID0gJ3ZlcnNpb24nO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gSW5kZXhlZERCU3J2LmluZGV4ZWREQkF2YWlsYWJsZSgpO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZENvdW50cmllcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkQ291bnRyaWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGluZGV4ZWREQiBpcyBhdmFpbGFibGVcclxuICAgICAgICAgICAgaWYgKGluZGV4ZWREQkF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBkYXRhYmFzZSBleGlzdHNcclxuICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYuY3JlYXRlRGF0YWJhc2UoZGF0YWJhc2UsIHN0b3JlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFbXB0eU9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0SW50ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFeHRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGRldGVybWluZUxvYWRTdHJhdGVneSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obG9hZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzID0gb2JqWydjb3VudHJpZXMnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbyhcImxvYWRlZCBjb3VudHJpZXMgZnJvbVwiLCBvYmpbJ2xvYWRTdHJhdGVneSddLnRvVXBwZXJDYXNlKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZGl0aW9uYWxseSBtYXAgY291bnRyaWVzIGJ5IHZhcmlvdXMgcHJvcGVydGllc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlBbHBoYTMgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzLmZvckVhY2goZnVuY3Rpb24oYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ5IGFscGhhMyBjb2RlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlBbHBoYTNbY1snYWxwaGEzQ29kZSddXSA9IGM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ5IGxldHRlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaXJzdExldHRlciA9IGNbJ25hbWUnXS5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChmaXJzdExldHRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICfDhCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdExldHRlciA9ICdBJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnw5YnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RMZXR0ZXIgPSAnTyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ8OcJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TGV0dGVyID0gJ1UnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50cmllc0J5TGV0dGVyW2ZpcnN0TGV0dGVyXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyW2ZpcnN0TGV0dGVyXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXJbZmlyc3RMZXR0ZXJdLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTNDb2RlOiBjLmFscGhhM0NvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGMubmFtZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoXCJmYWlsZWQgdG8gbG9hZCBjb3VudHJpZXNcIiwgZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCwgd2UgYWx3YXlzIHRyeSB0byBkb3dubG9hZCBpdCBmcm9tIHRoZSBjb3VudHJ5IEFQSSBlbmRwb2ludFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldENvdW50cmllc0Zyb21BUEkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZXRlcm1pbmVMb2FkU3RyYXRlZ3kgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBpbnRlcm5hbFZlcnNpb24gPSBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl07XHJcbiAgICAgICAgICAgICAgICB2YXIgZXh0ZXJuYWxWZXJzaW9uID0gb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpbnRlcm5hbFZlcnNpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChleHRlcm5hbFZlcnNpb24gPiBpbnRlcm5hbFZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdkYic7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqWydsb2FkU3RyYXRlZ3knXSA9IHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvYWREYXRhID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneSA9IG9ialsnbG9hZFN0cmF0ZWd5J107XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChzdHJhdGVneSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FwaSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21BUEkoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gY291bnRyaWVzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBjb3VudHJpZXMgYW5kIHZlcnNpb24gbnVtYmVyIGluIGRhdGFiYXNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleUNvdW50cmllcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICBjb3VudHJpZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleVZlcnNpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RiJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q291bnRyaWVzRnJvbURCKG9iailcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKF9vYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF9vYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnVW5rbm93biBsb2FkIHN0cmF0ZWd5Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFbXB0eU9iamVjdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHt9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEludGVybmFsVmVyc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5VmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFeHRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldFZlcnNpb25Gcm9tQVBJKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl0gPSB2ZXJzaW9uO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21EQiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5Q291bnRyaWVzKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gaXRlbS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFZlcnNpb25Gcm9tQVBJID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9jb3VudHJpZXMvdmVyc2lvbicpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhLnZlcnNpb24gfHwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJ5QnlBbHBoYTMgPSBmdW5jdGlvbihhbHBoYTMpIHtcclxuICAgICAgICAgICAgaWYgKGNvdW50cmllc0J5QWxwaGEzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllc0J5QWxwaGEzW2FscGhhM107XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0J5TGV0dGVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChjb3VudHJpZXNCeUxldHRlciA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXNCeUxldHRlcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYXJlQ291bnRyaWVzTG9hZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXMgIT09IG51bGwgJiYgY291bnRyaWVzLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5pdDogaW5pdCxcclxuICAgICAgICAgICAgZ2V0Q291bnRyeUJ5QWxwaGEzOiBnZXRDb3VudHJ5QnlBbHBoYTMsXHJcbiAgICAgICAgICAgIGdldENvdW50cmllc0J5TGV0dGVyOiBnZXRDb3VudHJpZXNCeUxldHRlcixcclxuICAgICAgICAgICAgYXJlQ291bnRyaWVzTG9hZGVkOiBhcmVDb3VudHJpZXNMb2FkZWRcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0ZvY3VzU3J2JywgW1wiJHRpbWVvdXRcIiwgXCIkd2luZG93XCIsIGZ1bmN0aW9uKCR0aW1lb3V0LCAkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNlbGVjdG9yKSB7XHJcbiAgICAgICAgICAgIC8vIHRpbWVvdXQgbWFrZXMgc3VyZSB0aGF0IGlzIGludm9rZWQgYWZ0ZXIgYW55IG90aGVyIGV2ZW50IGhhcyBiZWVuIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgLy8gZS5nLiBjbGljayBldmVudHMgdGhhdCBuZWVkIHRvIHJ1biBiZWZvcmUgdGhlIGZvY3VzIG9yXHJcbiAgICAgICAgICAgIC8vIGlucHV0cyBlbGVtZW50cyB0aGF0IGFyZSBpbiBhIGRpc2FibGVkIHN0YXRlIGJ1dCBhcmUgZW5hYmxlZCB3aGVuIHRob3NlIGV2ZW50c1xyXG4gICAgICAgICAgICAvLyBhcmUgdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdJbmRleGVkREJTcnYnLCBbXCIkd2luZG93XCIsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcclxuICAgICAgICB2YXIga2V5UGF0aCA9ICduYW1lJztcclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQiA9ICR3aW5kb3cuaW5kZXhlZERCIHx8ICR3aW5kb3cud2Via2l0SW5kZXhlZERCIHx8ICR3aW5kb3cubXNJbmRleGVkREI7XHJcbiAgICAgICAgdmFyIElEQktleVJhbmdlID0gJHdpbmRvdy5JREJLZXlSYW5nZSB8fCAkd2luZG93LndlYmtpdElEQktleVJhbmdlO1xyXG5cclxuICAgICAgICB2YXIgSURCVHJhbnNhY3Rpb24gPSAkd2luZG93LklEQlRyYW5zYWN0aW9uIHx8ICR3aW5kb3cud2Via2l0SURCVHJhbnNhY3Rpb247XHJcblxyXG4gICAgICAgIGlmIChJREJUcmFuc2FjdGlvbikge1xyXG4gICAgICAgICAgICBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFID0gSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSB8fCAncmVhZHdyaXRlJztcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZID0gSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZIHx8ICdyZWFkb25seSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbmRleGVkREIgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZURhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGUgaXMgYW4gaW5zdGFuY2Ugb2YgSURCVmVyc2lvbkNoYW5nZUV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gaWRiLmNyZWF0ZU9iamVjdFN0b3JlKHN0b3JlTmFtZSwgeyBrZXlQYXRoOiBrZXlQYXRoIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGQsIHVwZGF0ZSwgZGVsZXRlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkcm9wRGF0YWJhc2UgPSBmdW5jdGlvbihkYk5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkcm9wIHN1Y2Nlc3NmdWxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBmYWlsZWRcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYWRkSXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0QWRkID0gc3RvcmUuYWRkKGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHB1dEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLnB1dChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gSURCS2V5UmFuZ2Uub25seShpdGVtTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLm9wZW5DdXJzb3IocmFuZ2UpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBjdXJzb3IudmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJldHJpZXZlSXRlbXMgPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNyZWF0ZURhdGFiYXNlOiBjcmVhdGVEYXRhYmFzZSxcclxuICAgICAgICAgICAgZHJvcERhdGFiYXNlOiBkcm9wRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGFkZEl0ZW06IGFkZEl0ZW0sXHJcbiAgICAgICAgICAgIHB1dEl0ZW06IHB1dEl0ZW0sXHJcbiAgICAgICAgICAgIHJldHJpZXZlSXRlbTogcmV0cmlldmVJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW1zOiByZXRyaWV2ZUl0ZW1zLFxyXG4gICAgICAgICAgICBpbmRleGVkREJBdmFpbGFibGU6IGluZGV4ZWREQkF2YWlsYWJsZVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnTG9nU3J2JywgW1wiQXBwQ29uZmlnXCIsIGZ1bmN0aW9uKEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBsb2dJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuaW5mb1wiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dFcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmVycm9yXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbmZvOiBsb2dJbmZvLFxyXG4gICAgICAgICAgICBlcnJvcjogbG9nRXJyb3JcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1F1aXpTcnYnLCBbXCJBcHBDb25maWdcIiwgXCJDb3VudHJ5U3J2XCIsIFwiU2NvcmVTcnZcIiwgXCJMb2dTcnZcIiwgZnVuY3Rpb24oQXBwQ29uZmlnLCBDb3VudHJ5U3J2LCBTY29yZVNydiwgTG9nU3J2KSB7XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcbiAgICAgICAgdmFyIGNvdW50cmllc0J5QWxwaGEzID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHF1aXogPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgc2V0Q291bnRyaWVzID0gZnVuY3Rpb24oX2NvdW50cmllcykge1xyXG4gICAgICAgICAgICBjb3VudHJpZXMgPSBfY291bnRyaWVzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjb3VudHJpZXNMb2FkZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllcyAhPT0gbnVsbCAmJiBjb3VudHJpZXMubGVuZ3RoID4gMDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNvdW50cmllc0xvYWRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkNvdW50cmllcyBoYXZlIG5vdCBiZWVuIGxvYWRlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBxdWl6ID0gY3JlYXRlUXVpeignY291bnRyeScpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUocXVpei5zdGFydCgpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRpc3Bvc2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcXVpeiA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNTdGFydGVkKCkgJiYgIXF1aXouaGFzRW5kZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpelN0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNTdGFydGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVpeiA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6Lmhhc0VuZGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZVF1aXogPSBmdW5jdGlvbihxdWl6VHlwZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHF1aXpUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjb3VudHJ5JzpcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNvdW50cnlRdWl6KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlQ291bnRyeVF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGNvdW50cnlRdWl6ID0gbmV3IFF1aXooKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBmdWxsUG9pbnRzID0gMTAwO1xyXG4gICAgICAgICAgICB2YXIgaGludE1heGltdW0gPSAzO1xyXG4gICAgICAgICAgICB2YXIgaGludENvc3QgPSAyNTtcclxuXHJcbiAgICAgICAgICAgIHZhciBsYXN0UXVlc3Rpb25Cb251cyA9IDIuNTtcclxuXHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGVzID0gQXBwQ29uZmlnWydxdWl6LmNvdW50cnkudHlwZXMnXTtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZXNMZW5ndGggPSBPYmplY3Qua2V5cyhxdWVzdGlvblR5cGVzKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAvLyBzZWxlY3QgY291bnRyaWVzIGZvciBxdWVzdGlvbnNcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkQ291bnRyaWVzID0gW107XHJcbiAgICAgICAgICAgIHZhciBudW1iZXJPZlF1ZXN0aW9ucyA9IEFwcENvbmZpZ1sncXVpei5jb3VudHJ5LnF1ZXN0aW9ucyddO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1iZXJPZlF1ZXN0aW9uczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRyeU9rID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKCFjb3VudHJ5T2spIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IGNvdW50cmllc1tnZXRSYW5kb21JbnQoMCwgY291bnRyaWVzLmxlbmd0aCAtIDEpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRyeU9rID0gc2VsZWN0ZWRDb3VudHJpZXMuaW5kZXhPZihjb3VudHJ5WydhbHBoYTNDb2RlJ10pIDwgMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDb3VudHJpZXMucHVzaChjb3VudHJ5WydhbHBoYTNDb2RlJ10pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBjcmVhdGUgcXVlc3Rpb25zIGZvciBxdWl6XHJcbiAgICAgICAgICAgIHZhciBxY250ID0gMDtcclxuICAgICAgICAgICAgc2VsZWN0ZWRDb3VudHJpZXMuZm9yRWFjaChmdW5jdGlvbihhbHBoYTMpIHtcclxuICAgICAgICAgICAgICAgIHFjbnQrKztcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uVHlwZXNbZ2V0UmFuZG9tSW50KDEsIHF1ZXN0aW9uVHlwZXNMZW5ndGgpXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGdldFF1ZXN0aW9uVGV4dChxdWVzdGlvblR5cGUsIGNvdW50cnkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogcXVlc3Rpb25UeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0OiBnZXRRdWVzdGlvbklucHV0KHF1ZXN0aW9uVHlwZSksXHJcbiAgICAgICAgICAgICAgICAgICAgdW5pdDogZ2V0UXVlc3Rpb25Vbml0KHF1ZXN0aW9uVHlwZSlcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5zd2VyID0gZ2V0UXVlc3Rpb25BbnN3ZXIocXVlc3Rpb25UeXBlLCBjb3VudHJ5KTtcclxuICAgICAgICAgICAgICAgIHZhciBjaGVja0Fuc3dlciA9IGdldENoZWNrQW5zd2VyTGFtYmRhKHF1ZXN0aW9uVHlwZSwgZnVsbFBvaW50cywgbGFzdFF1ZXN0aW9uQm9udXMpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhpbnRzID0gZ2V0UXVlc3Rpb25IaW50cyhxdWVzdGlvblR5cGUsIGhpbnRNYXhpbXVtLCBoaW50Q29zdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gdGhlIGxhc3QgcXVlc3Rpb24gaXMgdGhlIGJvbnVzIHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICBpZiAocWNudCA+PSBudW1iZXJPZlF1ZXN0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm9bJ2JvbnVzJ10gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGFkZCBpbmZvIGZvciBmbGFnIG9mIGNvdW50cnlcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdGTEFHX09GX0NPVU5UUlknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mby5tZWRpYSA9ICdmbGFnJztcclxuICAgICAgICAgICAgICAgICAgICBpbmZvLmFscGhhMkNvZGUgPSBjb3VudHJ5LmFscGhhMkNvZGUudG9Mb2NhbGVMb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5UXVpei5hZGRRdWVzdGlvbihuZXcgUXVlc3Rpb24oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5mbzogaW5mbyxcclxuICAgICAgICAgICAgICAgICAgICBhbnN3ZXI6IGFuc3dlcixcclxuICAgICAgICAgICAgICAgICAgICBjaGVja0Fuc3dlcjogY2hlY2tBbnN3ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgaGludHM6IGhpbnRzXHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cnlRdWl6O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblRleHQgPSBmdW5jdGlvbih0eXBlLCBjb3VudHJ5KSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgaGVpw590IGRpZSBIYXVwdHN0YWR0IHZvbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIltcIiArIGNvdW50cnkuY2FwaXRhbCArIFwiXSBpc3QgZGllIEhhdXB0c3RhZHQgdm9uIHdlbGNoZW0gTGFuZFwiXHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgdmllbGUgTWVuc2NoZW4gbGViZW4gaW4gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgZ3Jvw58gaXN0IGRpZSBGbMOkY2hlIHZvbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldlbGNoZXMgTGFuZCBoYXQgZGllc2UgRmxhZ2dlXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI/XCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbkFuc3dlciA9IGZ1bmN0aW9uKHR5cGUsIGNvdW50cnkpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhbHRTcGVsbGluZ3MgPSBjb3VudHJ5LmFsdFNwZWxsaW5ncyAhPT0gdW5kZWZpbmVkICYmIGNvdW50cnkuYWx0U3BlbGxpbmdzWydjYXBpdGFsJ10gIT09IHVuZGVmaW5lZCA/IGNvdW50cnkuYWx0U3BlbGxpbmdzWydjYXBpdGFsJ10gOiBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5jYXBpdGFsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbHRTcGVsbGluZ3M6IGFsdFNwZWxsaW5nc1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFsdFNwZWxsaW5ncyA9IGNvdW50cnkuYWx0U3BlbGxpbmdzICE9PSB1bmRlZmluZWQgJiYgY291bnRyeS5hbHRTcGVsbGluZ3NbJ25hbWUnXSAhPT0gdW5kZWZpbmVkID8gY291bnRyeS5hbHRTcGVsbGluZ3NbJ25hbWUnXSA6IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5Lm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsdFNwZWxsaW5nczogYWx0U3BlbGxpbmdzXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkucG9wdWxhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5LmFyZWFcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25JbnB1dCA9IGZ1bmN0aW9uKHR5cGUpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbnVtYmVyLmhpZ2gnO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdudW1iZXIubWVkaXVtJztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAndGV4dC5zdGFuZGFyZCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25Vbml0ID0gZnVuY3Rpb24odHlwZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdrbcKyJztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnRWlud29obmVyJztcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENoZWNrQW5zd2VyTGFtYmRhID0gZnVuY3Rpb24odHlwZSwgZnVsbFBvaW50cywgbGFzdFF1ZXN0aW9uQm9udXMpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBoaW50c1VzZWQsIGhpbnRDb3N0LCBpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3JyZWN0ID0gc3VibWl0dGVkQW5zd2VyID09PSBhbnN3ZXIuY29ycmVjdCB8fCAoYW5zd2VyLmFsdFNwZWxsaW5ncyAmJiBhbnN3ZXIuYWx0U3BlbGxpbmdzLmluZGV4T2Yoc3VibWl0dGVkQW5zd2VyKSA+PSAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludHMgPSBjb3JyZWN0ID8gZnVsbFBvaW50cyA6IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBoaW50cyBhcmUgYWxsb3dlZCBhbmQgaGF2ZSBiZWVuIHVzZWQsIHN1YnRyYWN0IHRoZSBwb2ludHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpbnRzVXNlZCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAtPSAoaGludHNVc2VkICogaGludENvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBib251cyBwb2ludHMgZm9yIGxhc3QgcXVlc3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8gIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzICo9IGxhc3RRdWVzdGlvbkJvbnVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBoaW50c1VzZWQsIGhpbnRDb3N0LCBpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBwZXJjZW50YWdlIGRpZmZlcmVuY2UgZnJvbSBjb3JyZWN0IGFuc3dlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JQZXJjZW50YWdlID0gTWF0aC5hYnMoc3VibWl0dGVkQW5zd2VyIC0gYW5zd2VyLmNvcnJlY3QpIC8gYW5zd2VyLmNvcnJlY3QgKiAxMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDkwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSA5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA4MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDcwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDE2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDQwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAyMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDI1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMzApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaGludHMgYXJlIGFsbG93ZWQgYW5kIGhhdmUgYmVlbiB1c2VkLCBzdWJ0cmFjdCB0aGUgcG9pbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaW50c1VzZWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgLT0gKGhpbnRzVXNlZCAqIGhpbnRDb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYm9udXMgcG9pbnRzIGZvciBsYXN0IHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAqPSBsYXN0UXVlc3Rpb25Cb251cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uSGludHMgPSBmdW5jdGlvbih0eXBlLCBoaW50c1Bvc3NpYmxlLCBoaW50Q29zdCkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhpbXVtOiBoaW50c1Bvc3NpYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3N0OiBoaW50Q29zdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2l2ZTogZnVuY3Rpb24oaGludHNVc2VkLCBhbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhbnN3ZXIuY29ycmVjdC5zdWJzdHIoMCwgaGludHNVc2VkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZDogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0TnVtYmVyT2ZRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5jdXJyZW50UXVlc3Rpb24oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHF1aXoubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFRvdGFsUG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0VG90YWxQb2ludHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENvbmNsdWRlcyB0aGUgcXVpeiBhbmQgcHV0cyB0aGUgc2NvcmUgdG8gdGhlIEFQSSBlbmRwb2ludC5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgY29uY2x1ZGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1aXogIT09IG51bGwgJiYgcXVpei5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHF1aXouc3VibWl0dGVkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnUXVpeiBoYXMgYWxyZWFkeSBiZWVuIHN1Ym1pdHRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcXVpei5zdWJtaXR0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBTY29yZVNydi5wdXRIaWdoc2NvcmUocXVpei5nZXRUb3RhbFBvaW50cygpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCgnTm8gcXVpeiBpcyBjdXJyZW50bHkgcnVubmluZycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBzZXRDb3VudHJpZXM6IHNldENvdW50cmllcyxcclxuICAgICAgICAgICAgaXNRdWl6UnVubmluZzogaXNRdWl6UnVubmluZyxcclxuICAgICAgICAgICAgaGFzUXVpelN0YXJ0ZWQ6IGhhc1F1aXpTdGFydGVkLFxyXG4gICAgICAgICAgICBoYXNRdWl6RW5kZWQ6IGhhc1F1aXpFbmRlZCxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyOiBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIsXHJcbiAgICAgICAgICAgIGdldE51bWJlck9mUXVpelF1ZXN0aW9uczogZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50UXVlc3Rpb246IGdldEN1cnJlbnRRdWVzdGlvbixcclxuICAgICAgICAgICAgbmV4dFF1ZXN0aW9uOiBuZXh0UXVlc3Rpb24sXHJcbiAgICAgICAgICAgIGdldFRvdGFsUG9pbnRzOiBnZXRUb3RhbFBvaW50cyxcclxuICAgICAgICAgICAgY29uY2x1ZGU6IGNvbmNsdWRlLFxyXG4gICAgICAgICAgICBkaXNwb3NlOiBkaXNwb3NlXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdTY29yZVNydicsIFtcIiRodHRwXCIsIGZ1bmN0aW9uKCRodHRwKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgZW50aXJlIGhpZ2hzY29yZSBsaXN0IGluIGFuIGFycmF5IGZyb20gdGhlIEFQSS5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgZ2V0SGlnaHNjb3JlTGlzdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvc2NvcmVzL2FsbCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgaGlnaHNjb3JlIG9iamVjdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIElmIHRoZSB1c2VyIGhhcyBubyByZXN1bHQgeWV0LCBhbiBlbXB0eSBvYmplY3QgaXMgcmV0dXJuZWQuXHJcbiAgICAgICAgICogUmV0dXJucyBhIHByb21pc2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGdldFVzZXJIaWdoc2NvcmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3Njb3Jlcy91c2VyJylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHNjb3JlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEZldGNoZXMgdGhlIGhpZ2hzY29yZSBvYmplY3QgZm9yIHRoZSBvdmVyYWxsIGhpZ2hzY29yZS5cclxuICAgICAgICAgKiBJZiB0aGVyZSBpcyBjdXJyZW50bHkgbm8gcmVzdWx0IHlldCwgYW4gZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkLlxyXG4gICAgICAgICAqIFJldHVybnMgYSBwcm9taXNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBnZXRPdmVyYWxsSGlnaHNjb3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9zY29yZXMvaGlnaCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oc2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzY29yZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBQdXRzIGEgaGlnaHNjb3JlIHJlc3VsdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIEBwYXJhbSBzY29yZSAgICAgTnVtYmVyIHdpdGggdGhlIGFjaGlldmVkIHNjb3JlLlxyXG4gICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBwdXRIaWdoc2NvcmUgPSBmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvc2NvcmVzJywgeyBzY29yZTogc2NvcmUgfSlcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRIaWdoc2NvcmVMaXN0OiBnZXRIaWdoc2NvcmVMaXN0LFxyXG4gICAgICAgICAgICBnZXRVc2VySGlnaHNjb3JlOiBnZXRVc2VySGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBnZXRPdmVyYWxsSGlnaHNjb3JlOiBnZXRPdmVyYWxsSGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBwdXRIaWdoc2NvcmU6IHB1dEhpZ2hzY29yZVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnVXNlclNydicsIFtcIiRodHRwXCIsIFwiQXV0aFRva2VuU3J2XCIsIFwiQXBwQ29uZmlnXCIsIGZ1bmN0aW9uKCRodHRwLCBBdXRoVG9rZW5TcnYsIEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VyJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXJGcm9tU3RvcmFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4odG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdG9rZW4sIHdlIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIHRva2VuIGluIHN0b3JhZ2VcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9uJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9rZW4gPSByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNhdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKHNlbGYudG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRVc2VyKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRva2VuIGxvY2FsbHlcclxuICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24obmV3VXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzZWxlY3QgYSByYW5kb20gY29sb3IgZm9yIHRoZSB1c2VyXHJcbiAgICAgICAgICAgICAgICB2YXIgY29sb3JzID0gQXBwQ29uZmlnWydzZXR0aW5ncy51c2VyLmNvbG9ycyddO1xyXG4gICAgICAgICAgICAgICAgbmV3VXNlci5jb2xvciA9IGNvbG9yc1tnZXRSYW5kb21JbnQoMCwgY29sb3JzLmxlbmd0aCAtIDEpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3VzZXInLCBuZXdVc2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW1tZWRpYXRlbHkgbG9nIHRoZSB1c2VyIGluXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luKG5ld1VzZXIudXNlcm5hbWUsIG5ld1VzZXIucGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pICA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZUJhc2ljID0gZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvdXNlci9iYXNpYycsIHVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRVc2VyOiBnZXRVc2VyLFxyXG4gICAgICAgICAgICBnZXRVc2VyRnJvbVN0b3JhZ2U6IGdldFVzZXJGcm9tU3RvcmFnZSxcclxuICAgICAgICAgICAgbG9naW46IGxvZ2luLFxyXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dCxcclxuICAgICAgICAgICAgcmVnaXN0ZXI6IHJlZ2lzdGVyLFxyXG4gICAgICAgICAgICB1cGRhdGVCYXNpYzogdXBkYXRlQmFzaWNcclxuICAgICAgICB9O1xyXG4gICAgfV0pOyIsIi8vIG93biBjbGFzc2VzIGFuZCBmdW5jdGlvbnNcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVJWiAtLS0tLS0tLS0tXHJcbnZhciBRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBpbmRleCBvZiBjdXJyZW50IHF1ZXN0aW9uXHJcbiAgICB2YXIgY3VycmVudFF1ZXN0aW9uSWR4ID0gbnVsbDtcclxuXHJcbiAgICAvLyBhcnJheSBjb250YWluaW5nIGFsbCBxdWVzdGlvbnNcclxuICAgIHZhciBxdWVzdGlvbnMgPSBbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN0YXJ0cyB0aGUgcXVpei5cclxuICAgICAqL1xyXG4gICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIGNoZWNrIGlmIHF1aXogaGFzIHF1ZXN0aW9uc1xyXG4gICAgICAgIGlmIChxdWVzdGlvbnMubGVuZ3RoIDw9IDApXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHN0YXJ0IGEgcXVpeiB3aXRob3V0IHF1ZXN0aW9uc1wiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaXNBY3RpdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNTdGFydGVkKCkgJiYgIXRoaXMuaGFzRW5kZWQoKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbklkeCAhPT0gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhc1N0YXJ0ZWQoKSAmJiBjdXJyZW50UXVlc3Rpb25JZHggPj0gcXVlc3Rpb25zLmxlbmd0aDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5zdWJtaXR0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBuZXcgcXVlc3Rpb24gdG8gdGhlIHF1aXouXHJcbiAgICAgKiBUaGUgcGFyYW1ldGVyIG11c3QgYmUgYW4gcXVlc3Rpb24gb2JqZWN0LlxyXG4gICAgICogSWYgbm8gcXVlc3Rpb24gb2JqZWN0IGlzIHBhc3NlZCBvciBhbiBvYmplY3Qgd2l0aCBtaXNzaW5nIHByb3BlcnRpZXMsIGFuIGVycm9yIGlzIHRocm93bi5cclxuICAgICAqL1xyXG4gICAgdGhpcy5hZGRRdWVzdGlvbiA9IGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XHJcbiAgICAgICAgaWYgKHF1ZXN0aW9uID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiTm8gcXVlc3Rpb24gb2JqZWN0IHBhc3NlZFwiKTtcclxuXHJcbiAgICAgICAgdmFyIHZhbGlkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gYSBxdWVzdGlvbiBvYmplY3QgbXVzdCBjb250YWluIGFsbCB0aGVzZSBwcm9wZXJ0aWVzXHJcbiAgICAgICAgdmFyIG5lY2Vzc2FyeVByb3BlcnRpZXMgPSBbJ2NvbmZpZycsICdoaW50JywgJ3NvbHV0aW9uJywgJ2Fuc3dlcicsICdxdWVzdGlvbicsICdnZXRJbmZvJywgJ2luZm8nLCAncG9pbnRzJywgJ2Fuc3dlcmVkJywgJ2hpbnRzQWxsb3dlZCcsICdoaW50c1JlbWFpbmluZyddO1xyXG5cclxuICAgICAgICBuZWNlc3NhcnlQcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcGVydHkpIHtcclxuICAgICAgICAgICAgaWYgKCFxdWVzdGlvbi5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHtcclxuICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJRdWVzdGlvbiBtdXN0IGhhdmUgcHJvcGVydHkgJ1wiICsgcHJvcGVydHkgKyBcIidcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHZhbGlkKSB7XHJcbiAgICAgICAgICAgIHF1ZXN0aW9ucy5wdXNoKHF1ZXN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgbmV4dCBxdWVzdGlvbiBvZiB0aGUgcXVpei5cclxuICAgICAqIElmIHRoZSBxdWl6IGhhcyBlbmRlZCwgaXQgcmV0dXJucyBub3RoaW5nLlxyXG4gICAgICovXHJcbiAgICB0aGlzLm5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChjdXJyZW50UXVlc3Rpb25JZHggPT09IG51bGwpIHtcclxuICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSWR4ID0gMDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjdXJyZW50UXVlc3Rpb25JZHgrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmhhc0VuZGVkKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JZHhdO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmN1cnJlbnRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JZHhdO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldFRvdGFsUG9pbnRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5oYXNTdGFydGVkKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgdG90YWxQb2ludHMgPSAwO1xyXG5cclxuICAgICAgICBxdWVzdGlvbnMuZm9yRWFjaChmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgcG9pbnRzID0gcXVlc3Rpb24ucG9pbnRzKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocG9pbnRzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHRvdGFsUG9pbnRzICs9IHBvaW50cztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdG90YWxQb2ludHM7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRRdWVzdGlvbklkeCA9PT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIHJldHVybiBjdXJyZW50UXVlc3Rpb25JZHggKyAxO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldE51bWJlck9mUXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9ucy5sZW5ndGg7XHJcbiAgICB9O1xyXG59O1xyXG5cclxuLy8gLS0tLS0tLS0tLSBRVUVTVElPTiAtLS0tLS0tLS0tXHJcbnZhciBRdWVzdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgIC8vIFRleHQgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgdGV4dCA9IG51bGw7XHJcblxyXG4gICAgLy8gSW5mbyBvYmplY3QgZm9yIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGluZm8gPSBudWxsO1xyXG5cclxuICAgIC8vIEFuc3dlciBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBhbnN3ZXIgPSBudWxsO1xyXG5cclxuICAgIC8vIEhpbnRzIG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGhpbnRzID0gbnVsbDtcclxuICAgIHZhciBoaW50c1VzZWQgPSAwO1xyXG5cclxuICAgIC8vIExhbWJkYSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgdGhlIGFuc3dlciBzdGF0dXMgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgY2hlY2tBbnN3ZXIgPSBudWxsO1xyXG5cclxuICAgIC8vIFBvaW50cyBhd2FyZGVkIGZvciB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBwb2ludHMgPSBudWxsO1xyXG5cclxuICAgIC8vIEZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHF1ZXN0aW9uIGhhcyBhbHJlYWR5IGJlZW4gYW5zd2VyZWRcclxuICAgIHZhciBhbnN3ZXJlZCA9IGZhbHNlO1xyXG5cclxuICAgIHZhciBpbml0ID0gZnVuY3Rpb24ob3B0cykge1xyXG4gICAgICAgIHRleHQgPSBvcHRzLnRleHQ7XHJcbiAgICAgICAgaW5mbyA9IG9wdHMuaW5mbyB8fCB7fTtcclxuICAgICAgICBhbnN3ZXIgPSBvcHRzLmFuc3dlcjtcclxuICAgICAgICBjaGVja0Fuc3dlciA9IG9wdHMuY2hlY2tBbnN3ZXIgfHwgbnVsbDtcclxuXHJcbiAgICAgICAgaGludHMgPSBvcHRzLmhpbnRzIHx8IHtcclxuICAgICAgICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLCAgICAgLy8gaXMgYSBoaW50IGFsbG93ZWQ/XHJcbiAgICAgICAgICAgICAgICBtYXhpbXVtOiAwLCAgICAgICAgIC8vIG1heGltdW0gbnVtYmVyIG9mIGhpbnRzIGZvciB0aGlzIHF1ZXN0aW9uIChpcnJlbGV2YW50IGlmIGFsbG93ZWQgaXMgc2V0IHRvIGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgY29zdDogMCwgICAgICAgICAgICAvLyBudW1iZXIgb2YgcG9pbnRzIHN1YnRyYWN0ZWQgcGVyIHVzZWQgaGludCAoaXJyZWxldmFudCBpZiBhbGxvd2VkIGlzIHNldCB0byBmYWxzZSlcclxuICAgICAgICAgICAgICAgIGdpdmU6IG51bGwgICAgICAgICAgLy8gbGFtYmRhIGZ1bmN0aW9uIHRvIGdpdmUgYSBoaW50IGZvciBhIHF1ZXN0aW9uXHJcbiAgICAgICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgaW5pdChvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNvbmZpZyA9IGZ1bmN0aW9uKG9wdHMpIHtcclxuICAgICAgICBpbml0KG9wdHMpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHF1ZXN0aW9uIHRleHQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMucXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGV4dDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBxdWVzdGlvbiBpbmZvIG9iamVjdC5cclxuICAgICAqIEFjdHMgYXMgZ2V0dGVyICh3aXRoIG9ubHkgb25lIGFyZ3VtZW50KSBhbmQgc2V0dGVyICh3aXRoIHR3byBhcmd1bWVudHMpXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaW5mbyA9IGZ1bmN0aW9uKHByb3AsIHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgLy8gc2V0dGVyXHJcbiAgICAgICAgICAgIGluZm9bcHJvcF0gPSB2YWx1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBnZXR0ZXJcclxuICAgICAgICAgICAgcmV0dXJuIGluZm9bcHJvcF07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIGVudGlyZSBpbmZvIG9iamVjdC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5nZXRJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGluZm87XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgY29ycmVjdCBhbnN3ZXIgdG8gdGhlIHF1ZXN0aW9uIGFmdGVyIHRoZSBxdWVzdGlvbiBoYXMgYmVlbiBhbnN3ZXJlZC5cclxuICAgICAqIElmIHRoZSBxdWVzdGlvbiBoYXMgbm90IGJlZW4gYW5zd2VyZWQgeWV0LCBpdCByZXR1cm5zIG51bGwuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuc29sdXRpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoYW5zd2VyZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgYSBoaW50IGZvciB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKiBJZiBubyBoaW50cyBhcmUgYWxsb3dlZCwgb3IgdGhlIG1heGltdW0gbnVtYmVyIG9mIGhpbnRzIGhhdmUgYmVlbiB1c2VkLCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmhpbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoIWhpbnRzLmFsbG93ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaGludHMuYWxsb3dlZCAmJiAhaGludHMuZ2l2ZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIaW50cyBhbGxvd2VkIGJ1dCBubyBnaXZlIG1ldGhvZCBwYXNzZWRcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaGludHNVc2VkIDwgaGludHMubWF4aW11bSkge1xyXG4gICAgICAgICAgICBoaW50c1VzZWQrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBoaW50cy5naXZlKGhpbnRzVXNlZCwgYW5zd2VyKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJtaXRzIGFuIGFuc3dlciB0byB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKiBJZiB0aGUgcXVlc3Rpb24gaGFzIGFscmVhZHkgYmVlbiBhbnN3ZXJlZCBvciBubyBjaGVja0Fuc3dlciBsYW1iZGEgaGFzIGJlZW4gc2V0LCB0aGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYW5zd2VyID0gZnVuY3Rpb24oc3VibWl0dGVkQW5zd2VyKSB7XHJcbiAgICAgICAgaWYgKGFuc3dlcmVkIHx8IWNoZWNrQW5zd2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFuc3dlcmVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gY2hlY2tBbnN3ZXIgbWV0aG9kIHNob3VsZCByZXR1cm4gdGhlIHN0YXR1cyByZXN1bHRzXHJcbiAgICAgICAgcG9pbnRzID0gY2hlY2tBbnN3ZXIoYW5zd2VyLCBzdWJtaXR0ZWRBbnN3ZXIsIGhpbnRzVXNlZCwgaGludHMuY29zdCwgaW5mbyk7XHJcblxyXG4gICAgICAgIC8vIGVuc3VyZSB0aGF0IG5vIG5lZ2F0aXZlIHBvaW50cyBhcmUgYXdhcmRlZFxyXG4gICAgICAgIHBvaW50cyA9IE1hdGgubWF4KDAsIHBvaW50cyk7XHJcblxyXG4gICAgICAgIC8vIGVuc3VyZSB0aGF0IG9ubHkgaW50ZWdlciB2YWx1ZXMgYXJlIHNhdmVkXHJcbiAgICAgICAgcG9pbnRzID0gTWF0aC5mbG9vcihwb2ludHMpO1xyXG5cclxuICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnBvaW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICghYW5zd2VyZWQgfHwgcG9pbnRzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBzdGF0ZSBvZiB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gYW5zd2VyZWQ7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0cnVlIGlmIGhpbnRzIGFyZSBhbGxvd2VkIGZvciB0aGlzIHF1ZXN0aW9uLCBmYWxzZSBpZiBub3QuXHJcbiAgICAgKiBJZiBoaW50cyBoYXZlIG5vdCBiZWVuIGluaXRpYWxpemVkIHlldCwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50c0FsbG93ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoaGludHMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGhpbnRzLmFsbG93ZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgcmVtYWluaW5nIGhpbnRzLlxyXG4gICAgICogSWYgbm8gaGludHMgYXJlIGFsbG93ZWQgZm9yIHRoaXMgcXVlc3Rpb24sIG51bGwgaXMgcmV0dXJuZWQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaGludHNSZW1haW5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgYWxsb3dlZCA9IHRoaXMuaGludHNBbGxvd2VkKCk7XHJcblxyXG4gICAgICAgIGlmIChhbGxvd2VkID09PSBudWxsIHx8IGFsbG93ZWQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGhpbnRzLm1heGltdW0gLSBoaW50c1VzZWQ7XHJcbiAgICB9O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgYSByYW5kb20gaW50ZWdlciBiZXR3ZWVuIG1pbiAoaW5jbHVzaXZlKSBhbmQgbWF4IChpbmNsdXNpdmUpXHJcbiAqIFVzaW5nIE1hdGgucm91bmQoKSB3aWxsIGdpdmUgeW91IGEgbm9uLXVuaWZvcm0gZGlzdHJpYnV0aW9uIVxyXG4gKi9cclxudmFyIGdldFJhbmRvbUludCA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7XHJcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRoZSB0ZXh0IGJldHdlZW4gdHdvIGRlbGltaXRpbmcgdGV4dCBvY2N1cnJlbmNlc1xyXG4gKi9cclxudmFyIGdldFN0cmluZ0JldHdlZW4gPSBmdW5jdGlvbih0ZXh0LCBmaXJzdFN0cmluZywgc2Vjb25kU3RyaW5nKSB7XHJcbiAgICB2YXIgZmlyc3RQb3MgPSB0ZXh0LmluZGV4T2YoZmlyc3RTdHJpbmcpO1xyXG4gICAgdmFyIHNlY29uZFBvcyA9IHRleHQuaW5kZXhPZihzZWNvbmRTdHJpbmcpO1xyXG5cclxuICAgIGlmIChmaXJzdFBvcyA+PSAwICYmIHNlY29uZFBvcyA+PSAwICYmIHNlY29uZFBvcyA+IGZpcnN0UG9zKSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQuc3Vic3RyKGZpcnN0UG9zICsgMSwgc2Vjb25kUG9zIC0gZmlyc3RQb3MgLSAxKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxufTtcclxuXHJcbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuUXVlc3Rpb24gPSBRdWVzdGlvbjtcclxuICAgIG1vZHVsZS5leHBvcnRzLlF1aXogPSBRdWl6O1xyXG59IiwiYW5ndWxhci5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb25maWcoZnVuY3Rpb24oJGxvY2F0aW9uUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgICAgICAvLyBlbmFibGUgSFRNTDUgcHVzaHN0YXRlXHJcbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG5cclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvaG9tZScpO1xyXG5cclxuICAgICAgICAkc3RhdGVQcm92aWRlclxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hvbWUnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvaG9tZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9ob21lLnBhcnRpYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IG51bGxcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdxdWl6Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3F1aXonLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvcXVpei5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnY291bnRyaWVzJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2NvdW50cmllcycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9jb3VudHJpZXMucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2NvdW50cmllcy5kZXRhaWwnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvOmFscGhhM0NvZGUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvY291bnRyaWVzLWRldGFpbC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvbG9naW4ucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ291dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9sb2dvdXQnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ291dEN0cmwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncmVnaXN0ZXInLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvcmVnaXN0ZXInLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvcmVnaXN0ZXIucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3NldHRpbmdzJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3NldHRpbmdzJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3NldHRpbmdzLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdhYm91dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hYm91dCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9hYm91dC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnaGlnaHNjb3JlJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hpZ2hzY29yZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9oaWdoc2NvcmUucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdDb3VudHJpZXNDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBDb3VudHJ5U3J2KSB7XHJcbiAgICAgICAgdmFyIGNvdW50cmllc0J5TGV0dGVyID0gbnVsbDtcclxuICAgICAgICB2YXIgY291bnRyeUtleXMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb3VudHJpZXNCeUxldHRlciA9IENvdW50cnlTcnYuZ2V0Q291bnRyaWVzQnlMZXR0ZXIoKTtcclxuICAgICAgICAgICAgY291bnRyeUtleXMgPSBPYmplY3Qua2V5cyhjb3VudHJpZXNCeUxldHRlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAoISRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJ5S2V5cyA9IGNvdW50cnlLZXlzO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJpZXNCeUxldHRlciA9IGNvdW50cmllc0J5TGV0dGVyO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyeUtleXMgPSBjb3VudHJ5S2V5cztcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJpZXNCeUxldHRlciA9IGNvdW50cmllc0J5TGV0dGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKENvdW50cnlTcnYuYXJlQ291bnRyaWVzTG9hZGVkKCkpIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignY291bnRyaWVzLmxvYWRlZCcsIGZ1bmN0aW9uKCkgIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0NvdW50cnlEZXRhaWxDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBDb3VudHJ5U3J2LCAkc3RhdGVQYXJhbXMpIHtcclxuICAgICAgICB2YXIgYWxwaGEzQ29kZSA9ICRzdGF0ZVBhcmFtcy5hbHBoYTNDb2RlO1xyXG5cclxuICAgICAgICBpZiAoQ291bnRyeVNydi5hcmVDb3VudHJpZXNMb2FkZWQoKSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhM0NvZGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignY291bnRyaWVzLmxvYWRlZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cnkgPSBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTNDb2RlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cnlGcm9tU2VydmljZSA9IGZ1bmN0aW9uKGFscGhhMykge1xyXG4gICAgICAgICAgICByZXR1cm4gQ291bnRyeVNydi5nZXRDb3VudHJ5QnlBbHBoYTMoYWxwaGEzKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0Q291bnRyeUZyb21TZXJ2aWNlID0gZ2V0Q291bnRyeUZyb21TZXJ2aWNlO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0Ryb3Bkb3duQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG4gICAgICAgIHZhciB2aXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICRzY29wZS50b2dnbGVEcm9wZG93biA9IHRvZ2dsZURyb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5zaG93RHJvcGRvd24gPSBzaG93RHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmhpZGVEcm9wZG93biA9IGhpZGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuaXNEcm9wZG93blZpc2libGUgPSBpc0Ryb3Bkb3duVmlzaWJsZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmhhbmRsZUNsaWNrT3V0c2lkZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ0xJQ0tFRCBPVVRTSURFXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSAhdmlzaWJsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dEcm9wZG93bigpIHtcclxuICAgICAgICAgICAgdmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoaWRlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzRHJvcGRvd25WaXNpYmxlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmlzaWJsZTtcclxuICAgICAgICB9XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignSGlnaHNjb3JlQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgU2NvcmVTcnYsIExvZ1Nydikge1xyXG4gICAgICAgICRzY29wZS5zY29yZUxpc3QgPSBbXTtcclxuXHJcbiAgICAgICAgU2NvcmVTcnYuZ2V0SGlnaHNjb3JlTGlzdCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zY29yZUxpc3QgPSBjcmVhdGVSYW5raW5nKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2NvcmVMaXN0ID0gY3JlYXRlUmFua2luZyhsaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgaXNNeXNlbGYgPSBmdW5jdGlvbihpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnVzZXIuX2lkID09PSBpZDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlUmFua2luZyA9IGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgdmFyIHJhbmsgPSAwO1xyXG5cclxuICAgICAgICAgICAgdmFyIHByZXZpb3VzU2NvcmUgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGVudHJ5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXByZXZpb3VzU2NvcmUgfHwgZW50cnkuc2NvcmUgIT09IHByZXZpb3VzU2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICByYW5rKys7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGVudHJ5LnJhbmsgPSByYW5rICsgJy4nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHByZXZpb3VzU2NvcmUgPSBlbnRyeS5zY29yZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbGlzdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuaXNNeXNlbGYgPSBpc015c2VsZjtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdIb21lQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgTG9nU3J2LCAkc3RhdGVQYXJhbXMpIHtcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGNoZWNrIHN0YXRlIHBhcmFtc1xyXG4gICAgICAgIGlmICgkc3RhdGVQYXJhbXMuYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpb24gPSAkc3RhdGVQYXJhbXMuYWN0aW9uO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChhY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3JlZ2lzdGVyLnN1Y2Nlc3NmdWwnOlxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdHcmF0dWxhdGlvbiEgRGllIEFubWVsZHVuZyB3YXIgZXJmb2xncmVpY2guIEhlcnpsaWNoIHdpbGxrb21tZW4gYmVpIE1hZ2VsbGFuLidcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTcnYsIEZvY3VzU3J2KSB7XHJcbiAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgVXNlclNydi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcGxpY2F0aW9uIGNvbnRyb2wgYWJvdXQgbG9naW4gZXZlbnRcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dpbicsIHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlVGV4dDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVyci5zdGF0dXMgPT09IDQwMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdGYWxzY2hlciBCZW51dHplcm5hbWUgb2RlciBQYXNzd29ydCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnQmVpbSBFaW5sb2dnZW4gc2NoZWludCBldHdhcyBzY2hpZWYgZ2VnYW5nZW4genUgc2Vpbic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbWVzc2FnZVRleHRcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gZm9jdXMgdXNlcm5hbWUgZmllbGRcclxuICAgICAgICBGb2N1c1NydignI3VzZXJuYW1lJyk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTG9nb3V0Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydikge1xyXG4gICAgICAgIFVzZXJTcnYubG9nb3V0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dvdXQgZXZlbnRcclxuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ291dCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6RGlyZWN0aXZlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2LCBGb2N1c1NydiwgbmdQcm9ncmVzc0ZhY3RvcnkpIHtcclxuICAgICAgICB2YXIgcXVlc3Rpb247XHJcblxyXG4gICAgICAgIHZhciBpbml0Q3RybCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBQcm9ncmVzcyBiYXIgaW5pdGlhbGl6YXRpb25cclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyID0gbmdQcm9ncmVzc0ZhY3RvcnkuY3JlYXRlSW5zdGFuY2UoKTtcclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldFBhcmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1wcm9ncmVzcycpKTtcclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldEFic29sdXRlKCk7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRDb2xvcihcIiMzMzZlN2JcIik7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmFjaGlldmVtZW50cyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUuYmVzdHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dCA9IHt9O1xyXG4gICAgICAgICAgICAkc2NvcGUuaGludCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAvLyBhZGQgb3B0aW9ucyBmb3IgbXVsdGlwbGllciBzZWxlY3Rpb25cclxuICAgICAgICAgICAgJHNjb3BlLm11bHRpcGxpZXJPcHRpb25zID0gW1xyXG4gICAgICAgICAgICAgICAgeyB2YWx1ZTogMSwgbGFiZWw6ICcnIH0sXHJcbiAgICAgICAgICAgICAgICB7IHZhbHVlOiAxMDAwLCBsYWJlbDogJ1RzZC4nfSxcclxuICAgICAgICAgICAgICAgIHsgdmFsdWU6IDEwMDAwMDAsIGxhYmVsOiAnTWlvLid9XHJcbiAgICAgICAgICAgIF07XHJcblxyXG4gICAgICAgICAgICBxdWVzdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZVVpID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIGdldCBjdXJyZW50IHF1ZXN0aW9uIGZyb20gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgIHF1ZXN0aW9uID0gUXVpelNydi5nZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGRlbGV0ZSBwcmV2aW91cyBoaW50c1xyXG4gICAgICAgICAgICAkc2NvcGUuaGludCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBpZiAocXVlc3Rpb24gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vIG11bHRpcGxpZXJzIGZvciBxdWVzdGlvbnMgY29udGFpbmluZyBudW1iZXJzXHJcbiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0ICYmIHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dC5pbmRleE9mKCdudW1iZXInKSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlci5oaWdoJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyID0geyB2YWx1ZTogMTAwMDAwMCwgbGFiZWw6ICdNaW8uJ307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlci5tZWRpdW0nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIgPSB7IHZhbHVlOiAxMDAwLCBsYWJlbDogJ1RzZC4nfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyID0geyB2YWx1ZTogMSwgbGFiZWw6ICcnIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgcHJvZ3Jlc3MgYmFyXHJcbiAgICAgICAgICAgICAgICB1cGRhdGVQcm9ncmVzc0JhcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGZvY3VzIGFuc3dlciBpbnB1dFxyXG4gICAgICAgICAgICAgICAgRm9jdXNTcnYoJy5hbnN3ZXJJbnB1dCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gcXVpeiBoYXMgZW5kZWQsIHNldCBwcm9ncmVzcyBiYXIgdG8gMFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldCgwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb247XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZW5kZXJRdWVzdGlvblRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlbmRlcihnZXRRdWVzdGlvbigpLnF1ZXN0aW9uKCksICdxdWVzdGlvbi1oaWdobGlnaHQnKSArICc/JztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25NZWRpYSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIXF1ZXN0aW9uIHx8ICFxdWVzdGlvbi5nZXRJbmZvKCkubWVkaWEpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5nZXRJbmZvKCkubWVkaWE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNob3dSZXN1bHRzUGFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoaWRlUmVzdWx0c1BhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzUmVzdWx0c1BhZ2VWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoaW50c0F2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVlc3Rpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmhpbnRzUmVtYWluaW5nKCkgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmhpbnRzUmVtYWluaW5nKCkgPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzdWJtaXRBbnN3ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIgJiYgIXF1ZXN0aW9uLmFuc3dlcmVkKCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhbnN3ZXIgPSBTdHJpbmcoJHNjb3BlLmFuc3dlcklucHV0LmFuc3dlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaWYgaXQgaXMgYSBudW1iZXIgaW5wdXQsIHJlcGxhY2UgJywnIHdpdGggJy4nXHJcbiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0ICYmIHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dC5pbmRleE9mKCdudW1iZXInKSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuc3dlciA9IGFuc3dlci5yZXBsYWNlKCcsJywgJy4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpZiBhIG11bHRpcGxpZXIgaXMgYXZhaWxhYmxlLCBjYWxjdWxhdGUgYW5zd2VyXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbnN3ZXIgKj0gJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgTG9nU3J2LmluZm8oJ3N1Ym1pdHRpbmcgYW5zd2VyJywgYW5zd2VyKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5wb2ludHMgPSBxdWVzdGlvbi5hbnN3ZXIoYW5zd2VyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgZm9jdXMgdG8gbmV4dCBxdWVzdGlvbiBidXR0b25cclxuICAgICAgICAgICAgICAgIEZvY3VzU3J2KCcjYnRuTmV4dFF1ZXN0aW9uJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25BbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIVF1aXpTcnYuaXNRdWl6UnVubmluZygpIHx8IHF1ZXN0aW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5hbnN3ZXJlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBuZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5uZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgdXBkYXRlVWkoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVxdWVzdEhpbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBxdWVzdGlvbi5oaW50KCk7XHJcblxyXG4gICAgICAgICAgICBGb2N1c1NydignLmFuc3dlcklucHV0Jyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uKHRleHQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dFxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJbXCIsIFwiPHNwYW4gY2xhc3M9J1wiICsgY2xhc3NOYW1lICsgXCInPlwiKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJdXCIsIFwiPC9zcGFuPlwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZGxlS2V5UHJlc3MgPSBmdW5jdGlvbihrZXlFdmVudCkge1xyXG4gICAgICAgICAgICBpZiAoa2V5RXZlbnQud2hpY2ggPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHN1Ym1pdEFuc3dlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZVByb2dyZXNzQmFyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBwcm9ncmVzc1BlcmNlbnQgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKSAvIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpICogMTAwO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldChwcm9ncmVzc1BlcmNlbnQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB3YXNMYXN0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpID49IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwYXJzZUV2ZW50cyA9IGZ1bmN0aW9uKGV2ZW50cywgcGVyc29uYWxCZXN0LCBvdmVyYWxsQmVzdCkge1xyXG4gICAgICAgICAgICB2YXIgYWNoaWV2ZW1lbnRzID0gW107XHJcblxyXG4gICAgICAgICAgICB2YXIgc2hvd0Jlc3RzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZignb3ZlcmFsbF9iZXN0JykgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEdSBoYXN0IGVpbmVuIG5ldWVuIGFic29sdXRlbiBSZWtvcmQgZ2VzY2hhZmZ0ISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dCZXN0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ292ZXJhbGxfYmVzdF9lcXVhbGlzZWQnKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZGVuIGFrdHVlbGxlbiBhYnNvbHV0ZW4gUmVrb3JkIGVpbmdlc3RlbGx0ISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dCZXN0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ3BlcnNvbmFsX2Jlc3QnKSA+PSAwICYmIGV2ZW50cy5pbmRleE9mKCdvdmVyYWxsX2Jlc3QnKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBlaW5lbiBuZXVlbiBwZXJzw7ZubGljaGVuIFJla29yZCBnZXNjaGFmZnQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0Jlc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZigncGVyc29uYWxfYmVzdF9lcXVhbGlzZWQnKSA+PSAwICYmIGV2ZW50cy5pbmRleE9mKCdvdmVyYWxsX2Jlc3RfZXF1YWxpc2VkJykgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZ2xlaWNoIHZpZWxlIFB1bmt0ZSBnZXNjaGFmZnQgd2llIGJlaSBkZWluZW0gcGVyc8O2bmxpY2hlbiBSZWtvcmQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0Jlc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZignbmV3X2RhaWx5X2Jlc3QnKSA+PSAwICYmIGFjaGlldmVtZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBlaW5lbiBuZXVlbiBwZXJzw7ZubGljaGVuIFRhZ2VzcmVrb3JkIGdlc2NoYWZmdCEnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmFjaGlldmVtZW50cyA9IGFjaGlldmVtZW50cztcclxuXHJcbiAgICAgICAgICAgIGlmIChzaG93QmVzdHMgJiYgcGVyc29uYWxCZXN0ICYmIHBlcnNvbmFsQmVzdC5pZCAmJiBwZXJzb25hbEJlc3QuZGF0ZSAmJiBwZXJzb25hbEJlc3Quc2NvcmUgJiYgb3ZlcmFsbEJlc3QgJiYgb3ZlcmFsbEJlc3QuaWQgJiYgb3ZlcmFsbEJlc3QuZGF0ZSAmJiBvdmVyYWxsQmVzdC5zY29yZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJlc3RzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgb3ZlcmFsbEJlc3QudHlwZSA9ICdvdmVyYWxsJztcclxuICAgICAgICAgICAgICAgIGJlc3RzLnB1c2gob3ZlcmFsbEJlc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwZXJzb25hbEJlc3QuaWQgIT09IG92ZXJhbGxCZXN0LmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGVyc29uYWxCZXN0LnR5cGUgPSAncGVyc29uYWwnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiZXN0cy5wdXNoKHBlcnNvbmFsQmVzdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gYmVzdHM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYmVzdHMgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNvbnRpbnVlRmluaXNoZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgc2hvd1Jlc3VsdHNQYWdlKCk7XHJcblxyXG4gICAgICAgICAgICBuZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbmNsdWRlIHRoZSBxdWl6IGFuZCB3cml0ZSByZXN1bHQgdG8gZGF0YWJhc2VcclxuICAgICAgICAgICAgUXVpelNydi5jb25jbHVkZSgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VFdmVudHMoZGF0YS5ldmVudHMgfHwgW10sIGRhdGEucGVyc29uYWxCZXN0LCBkYXRhLm92ZXJhbGxCZXN0KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QmVzdFRleHQgPSBmdW5jdGlvbihiZXN0KSB7XHJcbiAgICAgICAgICAgIHZhciB0ZXh0O1xyXG5cclxuICAgICAgICAgICAgaWYgKGJlc3QudHlwZSA9PT0gJ3BlcnNvbmFsJykge1xyXG4gICAgICAgICAgICAgICAgLy8gcGVyc29uYWwgYmVzdFxyXG4gICAgICAgICAgICAgICAgdGV4dCA9IFwiRGVpbiBwZXJzw7ZubGljaGVyIFJla29yZCBsaWVndCBiZWkgPHNwYW4gY2xhc3M9J2JvbGQnPntQT0lOVFN9IFB1bmt0ZW48L3NwYW4+LCBhdWZnZXN0ZWxsdCBhbSB7REFURX0uXCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBvdmVyYWxsIGJlc3RcclxuICAgICAgICAgICAgICAgIHZhciBmcm9tTXlzZWxmID0gYmVzdC5pZCA9PT0gJHNjb3BlLnVzZXIuX2lkO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChmcm9tTXlzZWxmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IFwiRHUgaMOkbHRzdCBkZW4gYWJzb2x1dGVuIFJla29yZCBtaXQgPHNwYW4gY2xhc3M9J2JvbGQnPntQT0lOVFN9IFB1bmt0ZW48L3NwYW4+LCBhdWZnZXN0ZWxsdCBhbSB7REFURX0uXCI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQgPSBcIjxzcGFuIGNsYXNzPSdoaWdobGlnaHQnPntVU0VSTkFNRX08L3NwYW4+IGjDpGx0IGRlbiBhYnNvbHV0ZW4gUmVrb3JkIG1pdCA8c3BhbiBjbGFzcz0nYm9sZCc+e1BPSU5UU30gUHVua3Rlbjwvc3Bhbj4sIGF1Zmdlc3RlbGx0IGFtIHtEQVRFfS5cIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgne1BPSU5UU30nLCBiZXN0LnNjb3JlKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoJ3tEQVRFfScsIGdldEZvcm1hdHRlZERhdGUoYmVzdC5kYXRlKSlcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7VVNFUk5BTUV9JywgYmVzdC51c2VybmFtZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEZvcm1hdHRlZERhdGUgPSBmdW5jdGlvbihkYXRlKSB7XHJcbiAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBwYWQoZGF0ZS5nZXREYXRlKCksICcwMCcpICsgJy4nICsgcGFkKGRhdGUuZ2V0TW9udGgoKSArIDEsICcwMCcpICsgJy4nICsgKGRhdGUuZ2V0WWVhcigpICsgMTkwMCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHBhZCA9IGZ1bmN0aW9uKHN0ciwgcGFkVmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhwYWRWYWx1ZSArIHN0cikuc2xpY2UoLXBhZFZhbHVlLmxlbmd0aCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlc3RhcnRRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHF1aXogPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdxdWl6LnJlc3RhcnQnKTtcclxuXHJcbiAgICAgICAgICAgIGluaXRDdHJsKCk7XHJcblxyXG4gICAgICAgICAgICB1cGRhdGVVaSgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ3F1aXouc3RhcnQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBoaWRlUmVzdWx0c1BhZ2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBjb250cm9sbGVyXHJcbiAgICAgICAgaW5pdEN0cmwoKTtcclxuXHJcbiAgICAgICAgLy8gaW5pdGlhbGx5IHVwZGF0ZSBVSVxyXG4gICAgICAgIHVwZGF0ZVVpKCk7XHJcblxyXG4gICAgICAgICRzY29wZS5nZXRRdWVzdGlvbiA9IGdldFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI7XHJcbiAgICAgICAgJHNjb3BlLnJlbmRlclF1ZXN0aW9uVGV4dCA9IHJlbmRlclF1ZXN0aW9uVGV4dDtcclxuICAgICAgICAkc2NvcGUuc3VibWl0QW5zd2VyID0gc3VibWl0QW5zd2VyO1xyXG4gICAgICAgICRzY29wZS5xdWVzdGlvbkFuc3dlcmVkID0gcXVlc3Rpb25BbnN3ZXJlZDtcclxuICAgICAgICAkc2NvcGUubmV4dFF1ZXN0aW9uID0gbmV4dFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5oYW5kbGVLZXlQcmVzcyA9IGhhbmRsZUtleVByZXNzO1xyXG4gICAgICAgICRzY29wZS5nZXRRdWVzdGlvbk1lZGlhID0gZ2V0UXVlc3Rpb25NZWRpYTtcclxuICAgICAgICAkc2NvcGUucmVxdWVzdEhpbnQgPSByZXF1ZXN0SGludDtcclxuICAgICAgICAkc2NvcGUud2FzTGFzdFF1ZXN0aW9uID0gd2FzTGFzdFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5jb250aW51ZUZpbmlzaGVkID0gY29udGludWVGaW5pc2hlZDtcclxuICAgICAgICAkc2NvcGUuZ2V0QmVzdFRleHQgPSBnZXRCZXN0VGV4dDtcclxuICAgICAgICAkc2NvcGUucmVzdGFydFF1aXogPSByZXN0YXJ0UXVpejtcclxuICAgICAgICAkc2NvcGUuaGludHNBdmFpbGFibGUgPSBoaW50c0F2YWlsYWJsZTtcclxuICAgIH0pO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUXVpekN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFF1aXpTcnYsIExvZ1Nydikge1xyXG5cclxuICAgICAgICB2YXIgc3RhcnRRdWl6ID0gZnVuY3Rpb24oY2IpIHtcclxuICAgICAgICAgICAgUXVpelNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYiAmJiB0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2IoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKFwiUXVpeiBzdGFydGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpelN0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuaGFzUXVpelN0YXJ0ZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpekVuZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2Lmhhc1F1aXpFbmRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXRUb3RhbFBvaW50cygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ3F1aXoucmVzdGFydCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIExvZ1Nydi5pbmZvKCdxdWl6IHJlc3RhcnQnKTtcclxuXHJcbiAgICAgICAgICAgIFF1aXpTcnYuZGlzcG9zZSgpO1xyXG5cclxuICAgICAgICAgICAgc3RhcnRRdWl6KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3F1aXouc3RhcnQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS5zdGFydFF1aXogPSBzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmlzUXVpelJ1bm5pbmcgPSBpc1F1aXpSdW5uaW5nO1xyXG4gICAgICAgICRzY29wZS5oYXNRdWl6U3RhcnRlZCA9IGhhc1F1aXpTdGFydGVkO1xyXG4gICAgICAgICRzY29wZS5oYXNRdWl6RW5kZWQgPSBoYXNRdWl6RW5kZWQ7XHJcbiAgICAgICAgJHNjb3BlLmdldFRvdGFsUG9pbnRzID0gZ2V0VG90YWxQb2ludHM7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUmVnaXN0ZXJDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBMb2dTcnYsIEZvY3VzU3J2LCBVc2VyU3J2LCAkc3RhdGUsICR3aW5kb3cpIHtcclxuICAgICAgICAvLyBuZXcgdXNlciBvYmplY3RcclxuICAgICAgICAkc2NvcGUubmV3VXNlciA9IHt9O1xyXG5cclxuICAgICAgICAvLyBtZXNzYWdlIG9iamVjdFxyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24gKGlzVmFsaWQpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh2YWxpZGF0ZUJlZm9yZVN1Ym1pdCgpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBwZXJmb3JtIGFwaSBjYWxsXHJcbiAgICAgICAgICAgICAgICBVc2VyU3J2LnJlZ2lzdGVyKCRzY29wZS5uZXdVc2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcCBjb250cm9sbGVyIGFib3V0IGxvZ2luXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dpbicsIHJlc3BvbnNlLmRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3JlZ2lzdGVyLnN1Y2Nlc3NmdWwnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0JlaSBkZXIgQW5tZWxkdW5nIHNjaGVpbnQgZXR3YXMgc2NoaWVmIGdlZ2FuZ2VuIHp1IHNlaW4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGVyci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdVc2VybmFtZSBhbHJlYWR5IGV4aXN0cyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnRGVyIEJlbnV0emVybmFtZSBleGlzdGllcnQgYmVyZWl0cyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdCZWkgZGVyIEFubWVsZHVuZyBzY2hlaW50IGV0d2FzIHNjaGllZiBnZWdhbmdlbiB6dSBzZWluJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbWVzc2FnZVRleHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdmFsaWRhdGVCZWZvcmVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHR3byBwYXNzd29yZHMgbWF0Y2hcclxuICAgICAgICAgICAgdmFyIHBhc3N3b3JkID0gJHNjb3BlLm5ld1VzZXIucGFzc3dvcmQ7XHJcbiAgICAgICAgICAgIHZhciBwYXNzd29yZDIgPSAkc2NvcGUubmV3VXNlci5wYXNzd29yZDI7XHJcblxyXG4gICAgICAgICAgICBpZiAoISRzY29wZS5uZXdVc2VyLnVzZXJuYW1lIHx8ICEkc2NvcGUubmV3VXNlci5lbWFpbCB8fCAhcGFzc3dvcmQgfHwgIXBhc3N3b3JkMikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnQWxsZSBGZWxkZXIgbcO8c3NlbiBhdXNnZWbDvGxsdCBzZWluJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXNzd29yZCA9PT0gXCJcIiB8fCBwYXNzd29yZDIgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0RpZSBQYXNzd8O2cnRlciBrw7ZubmVuIG5pY2h0IGxlZXIgc2VpbidcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFzc3dvcmQgIT09IHBhc3N3b3JkMikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRGllIFBhc3N3w7ZydGVyIHN0aW1tZW4gbmljaHQgw7xiZXJlaW4nXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gISRzY29wZS5tZXNzYWdlID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZWxlZ2F0ZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZWdpc3Rlcih0cnVlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZGVsZWdhdGVTdWJtaXQgPSBkZWxlZ2F0ZVN1Ym1pdDtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJlZ2lzdGVyID0gcmVnaXN0ZXI7XHJcblxyXG4gICAgICAgIC8vIGZvY3VzIHVzZXIgbmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCcjdXNlcm5hbWUnKTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdTZXR0aW5nc0N0cmwnLCBmdW5jdGlvbigkc2NvcGUsIEFwcENvbmZpZywgRm9jdXNTcnYsIExvZ1NydiwgVXNlclNydikge1xyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIC8vIHVzZXIgY29sb3Vyc1xyXG4gICAgICAgICAgICB2YXIgY29sb3JzID0gQXBwQ29uZmlnWydzZXR0aW5ncy51c2VyLmNvbG9ycyddO1xyXG5cclxuICAgICAgICAgICAgLy8gdXNlciBvYmplY3RcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJPYmogPSB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogJHNjb3BlLnVzZXIudXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBlbWFpbDogJHNjb3BlLnVzZXIuZW1haWwsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjogJHNjb3BlLnVzZXIuY29sb3JcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS51c2VyQ29sb3JzID0gY29sb3JzO1xyXG5cclxuICAgICAgICAgICAgdmFyIHNldENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS51c2VyT2JqLmNvbG9yID0gbmV3Q29sb3I7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgdXBkYXRlVXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgVXNlclNydi51cGRhdGVCYXNpYygkc2NvcGUudXNlck9iaikudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHVzZXIgb2JqZWN0XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIudXNlcm5hbWUgPSAkc2NvcGUudXNlck9iai51c2VybmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXNlci5lbWFpbCA9ICRzY29wZS51c2VyT2JqLmVtYWlsO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmNvbG9yID0gJHNjb3BlLnVzZXJPYmouY29sb3I7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0VpbnN0ZWxsdW5nZW4gd3VyZGVuIGVyZm9sZ3JlaWNoIGdlc3BlaWNoZXJ0J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKCdVcGRhdGUgdXNlcicsIGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlVGV4dDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChlcnIubWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdVc2VybmFtZSBhbHJlYWR5IGV4aXN0cyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEZXIgQmVudXR6ZXJuYW1lIGlzdCBiZXJlaXRzIHZlcmdlYmVuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RpZSBFaW5zdGVsbHVuZ2VuIGtvbm50ZW4gbmljaHQgZ2VzcGVpY2hlcnQgd2VyZGVuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbWVzc2FnZVRleHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIGRlbGVnYXRlU3VibWl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVVc2VyKHRydWUpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnNldENvbG9yID0gc2V0Q29sb3I7XHJcbiAgICAgICAgICAgICRzY29wZS51cGRhdGVVc2VyID0gdXBkYXRlVXNlcjtcclxuICAgICAgICAgICAgJHNjb3BlLmRlbGVnYXRlU3VibWl0ID0gZGVsZWdhdGVTdWJtaXQ7XHJcblxyXG4gICAgICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgICAgICBGb2N1c1NydignI3VzZXJuYW1lJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKCRzY29wZS51c2VyKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIG90aGVyd2lzZSwgd2FpdCBmb3IgdXNlci5sb2FkZWQgZXZlbnRcclxuICAgICAgICAkc2NvcGUuJG9uKCd1c2VyLmxvYWRlZCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5kaXJlY3RpdmUoJ3F1aXonLCBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2J1aWxkL3ZpZXdzL3RlbXBsYXRlcy9xdWl6LWRpcmVjdGl2ZS50ZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgc2NvcGU6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdRdWl6RGlyZWN0aXZlQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSkiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmlsdGVyKCdyZW5kZXJIdG1sJywgZnVuY3Rpb24oJHNjZSkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0ZXh0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKHRleHQpO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmlsdGVyKCd0ZXh0T3JOdW1iZXInLCBmdW5jdGlvbigkZmlsdGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0LCBmcmFjdGlvblNpemUpIHtcclxuICAgICAgICAgICAgZnJhY3Rpb25TaXplID0gZnJhY3Rpb25TaXplICE9PSB1bmRlZmluZWQgPyAwIDogZnJhY3Rpb25TaXplO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzTmFOKGlucHV0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ251bWJlcicpKGlucHV0LCBmcmFjdGlvblNpemUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIGZ1bmN0aW9uKEF1dGhUb2tlblNydikge1xyXG4gICAgICAgIHZhciBhZGRUb2tlbiA9IGZ1bmN0aW9uKGNvbmZpZykge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydYLUF1dGgnXSA9IHRva2VuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGFkZFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdBdXRoVG9rZW5TcnYnLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZTtcclxuICAgICAgICB2YXIga2V5ID0gJ2F1dGgtdG9rZW4nO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0VG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnNldEl0ZW0oa2V5LCB0b2tlbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRUb2tlbjogZ2V0VG9rZW4sXHJcbiAgICAgICAgICAgIHNldFRva2VuOiBzZXRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQ291bnRyeVNydicsIGZ1bmN0aW9uKCRodHRwLCBJbmRleGVkREJTcnYsIExvZ1Nydikge1xyXG4gICAgICAgIC8vIENvdW50cmllcyBhcnJheVxyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgY291bnRyaWVzQnlBbHBoYTMgPSBudWxsO1xyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUxldHRlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIEluZGV4ZWREQlxyXG4gICAgICAgIHZhciBkYXRhYmFzZSA9ICdtYWdlbGxhbic7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJ2NvdW50cnlTdG9yZSc7XHJcbiAgICAgICAgdmFyIGtleUNvdW50cmllcyA9ICdjb3VudHJpZXMnO1xyXG4gICAgICAgIHZhciBrZXlWZXJzaW9uID0gJ3ZlcnNpb24nO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gSW5kZXhlZERCU3J2LmluZGV4ZWREQkF2YWlsYWJsZSgpO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZENvdW50cmllcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkQ291bnRyaWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGluZGV4ZWREQiBpcyBhdmFpbGFibGVcclxuICAgICAgICAgICAgaWYgKGluZGV4ZWREQkF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBkYXRhYmFzZSBleGlzdHNcclxuICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYuY3JlYXRlRGF0YWJhc2UoZGF0YWJhc2UsIHN0b3JlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFbXB0eU9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0SW50ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFeHRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGRldGVybWluZUxvYWRTdHJhdGVneSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obG9hZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzID0gb2JqWydjb3VudHJpZXMnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbyhcImxvYWRlZCBjb3VudHJpZXMgZnJvbVwiLCBvYmpbJ2xvYWRTdHJhdGVneSddLnRvVXBwZXJDYXNlKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZGl0aW9uYWxseSBtYXAgY291bnRyaWVzIGJ5IHZhcmlvdXMgcHJvcGVydGllc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlBbHBoYTMgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzLmZvckVhY2goZnVuY3Rpb24oYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ5IGFscGhhMyBjb2RlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlBbHBoYTNbY1snYWxwaGEzQ29kZSddXSA9IGM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ5IGxldHRlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaXJzdExldHRlciA9IGNbJ25hbWUnXS5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChmaXJzdExldHRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICfDhCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdExldHRlciA9ICdBJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnw5YnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RMZXR0ZXIgPSAnTyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ8OcJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TGV0dGVyID0gJ1UnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50cmllc0J5TGV0dGVyW2ZpcnN0TGV0dGVyXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyW2ZpcnN0TGV0dGVyXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXJbZmlyc3RMZXR0ZXJdLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTNDb2RlOiBjLmFscGhhM0NvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGMubmFtZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoXCJmYWlsZWQgdG8gbG9hZCBjb3VudHJpZXNcIiwgZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCwgd2UgYWx3YXlzIHRyeSB0byBkb3dubG9hZCBpdCBmcm9tIHRoZSBjb3VudHJ5IEFQSSBlbmRwb2ludFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldENvdW50cmllc0Zyb21BUEkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZXRlcm1pbmVMb2FkU3RyYXRlZ3kgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBpbnRlcm5hbFZlcnNpb24gPSBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl07XHJcbiAgICAgICAgICAgICAgICB2YXIgZXh0ZXJuYWxWZXJzaW9uID0gb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpbnRlcm5hbFZlcnNpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChleHRlcm5hbFZlcnNpb24gPiBpbnRlcm5hbFZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdkYic7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqWydsb2FkU3RyYXRlZ3knXSA9IHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvYWREYXRhID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneSA9IG9ialsnbG9hZFN0cmF0ZWd5J107XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChzdHJhdGVneSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FwaSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21BUEkoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gY291bnRyaWVzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBjb3VudHJpZXMgYW5kIHZlcnNpb24gbnVtYmVyIGluIGRhdGFiYXNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleUNvdW50cmllcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICBjb3VudHJpZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleVZlcnNpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RiJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q291bnRyaWVzRnJvbURCKG9iailcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKF9vYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF9vYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnVW5rbm93biBsb2FkIHN0cmF0ZWd5Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFbXB0eU9iamVjdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHt9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEludGVybmFsVmVyc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5VmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFeHRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldFZlcnNpb25Gcm9tQVBJKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl0gPSB2ZXJzaW9uO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21EQiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5Q291bnRyaWVzKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gaXRlbS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFZlcnNpb25Gcm9tQVBJID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9jb3VudHJpZXMvdmVyc2lvbicpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhLnZlcnNpb24gfHwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJ5QnlBbHBoYTMgPSBmdW5jdGlvbihhbHBoYTMpIHtcclxuICAgICAgICAgICAgaWYgKGNvdW50cmllc0J5QWxwaGEzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllc0J5QWxwaGEzW2FscGhhM107XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0J5TGV0dGVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChjb3VudHJpZXNCeUxldHRlciA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXNCeUxldHRlcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYXJlQ291bnRyaWVzTG9hZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXMgIT09IG51bGwgJiYgY291bnRyaWVzLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5pdDogaW5pdCxcclxuICAgICAgICAgICAgZ2V0Q291bnRyeUJ5QWxwaGEzOiBnZXRDb3VudHJ5QnlBbHBoYTMsXHJcbiAgICAgICAgICAgIGdldENvdW50cmllc0J5TGV0dGVyOiBnZXRDb3VudHJpZXNCeUxldHRlcixcclxuICAgICAgICAgICAgYXJlQ291bnRyaWVzTG9hZGVkOiBhcmVDb3VudHJpZXNMb2FkZWRcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0ZvY3VzU3J2JywgZnVuY3Rpb24oJHRpbWVvdXQsICR3aW5kb3cpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2VsZWN0b3IpIHtcclxuICAgICAgICAgICAgLy8gdGltZW91dCBtYWtlcyBzdXJlIHRoYXQgaXMgaW52b2tlZCBhZnRlciBhbnkgb3RoZXIgZXZlbnQgaGFzIGJlZW4gdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAvLyBlLmcuIGNsaWNrIGV2ZW50cyB0aGF0IG5lZWQgdG8gcnVuIGJlZm9yZSB0aGUgZm9jdXMgb3JcclxuICAgICAgICAgICAgLy8gaW5wdXRzIGVsZW1lbnRzIHRoYXQgYXJlIGluIGEgZGlzYWJsZWQgc3RhdGUgYnV0IGFyZSBlbmFibGVkIHdoZW4gdGhvc2UgZXZlbnRzXHJcbiAgICAgICAgICAgIC8vIGFyZSB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkd2luZG93LmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0luZGV4ZWREQlNydicsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcclxuICAgICAgICB2YXIga2V5UGF0aCA9ICduYW1lJztcclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQiA9ICR3aW5kb3cuaW5kZXhlZERCIHx8ICR3aW5kb3cud2Via2l0SW5kZXhlZERCIHx8ICR3aW5kb3cubXNJbmRleGVkREI7XHJcbiAgICAgICAgdmFyIElEQktleVJhbmdlID0gJHdpbmRvdy5JREJLZXlSYW5nZSB8fCAkd2luZG93LndlYmtpdElEQktleVJhbmdlO1xyXG5cclxuICAgICAgICB2YXIgSURCVHJhbnNhY3Rpb24gPSAkd2luZG93LklEQlRyYW5zYWN0aW9uIHx8ICR3aW5kb3cud2Via2l0SURCVHJhbnNhY3Rpb247XHJcblxyXG4gICAgICAgIGlmIChJREJUcmFuc2FjdGlvbikge1xyXG4gICAgICAgICAgICBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFID0gSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSB8fCAncmVhZHdyaXRlJztcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZID0gSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZIHx8ICdyZWFkb25seSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbmRleGVkREIgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZURhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGUgaXMgYW4gaW5zdGFuY2Ugb2YgSURCVmVyc2lvbkNoYW5nZUV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gaWRiLmNyZWF0ZU9iamVjdFN0b3JlKHN0b3JlTmFtZSwgeyBrZXlQYXRoOiBrZXlQYXRoIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGQsIHVwZGF0ZSwgZGVsZXRlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkcm9wRGF0YWJhc2UgPSBmdW5jdGlvbihkYk5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkcm9wIHN1Y2Nlc3NmdWxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBmYWlsZWRcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYWRkSXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0QWRkID0gc3RvcmUuYWRkKGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHB1dEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLnB1dChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gSURCS2V5UmFuZ2Uub25seShpdGVtTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLm9wZW5DdXJzb3IocmFuZ2UpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBjdXJzb3IudmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJldHJpZXZlSXRlbXMgPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNyZWF0ZURhdGFiYXNlOiBjcmVhdGVEYXRhYmFzZSxcclxuICAgICAgICAgICAgZHJvcERhdGFiYXNlOiBkcm9wRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGFkZEl0ZW06IGFkZEl0ZW0sXHJcbiAgICAgICAgICAgIHB1dEl0ZW06IHB1dEl0ZW0sXHJcbiAgICAgICAgICAgIHJldHJpZXZlSXRlbTogcmV0cmlldmVJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW1zOiByZXRyaWV2ZUl0ZW1zLFxyXG4gICAgICAgICAgICBpbmRleGVkREJBdmFpbGFibGU6IGluZGV4ZWREQkF2YWlsYWJsZVxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnTG9nU3J2JywgZnVuY3Rpb24oQXBwQ29uZmlnKSB7XHJcbiAgICAgICAgdmFyIGxvZ0luZm8gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKEFwcENvbmZpZ1tcImxvZy5pbmZvXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ0Vycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuZXJyb3JcIl0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluZm86IGxvZ0luZm8sXHJcbiAgICAgICAgICAgIGVycm9yOiBsb2dFcnJvclxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnUXVpelNydicsIGZ1bmN0aW9uKEFwcENvbmZpZywgQ291bnRyeVNydiwgU2NvcmVTcnYsIExvZ1Nydikge1xyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUFscGhhMyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBxdWl6ID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHNldENvdW50cmllcyA9IGZ1bmN0aW9uKF9jb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgY291bnRyaWVzID0gX2NvdW50cmllcztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY291bnRyaWVzTG9hZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXMgIT09IG51bGwgJiYgY291bnRyaWVzLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb3VudHJpZXNMb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJDb3VudHJpZXMgaGF2ZSBub3QgYmVlbiBsb2FkZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcXVpeiA9IGNyZWF0ZVF1aXooJ2NvdW50cnknKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHF1aXouc3RhcnQoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkaXNwb3NlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHF1aXogPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouaGFzU3RhcnRlZCgpICYmICFxdWl6Lmhhc0VuZGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouaGFzU3RhcnRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoYXNRdWl6RW5kZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNFbmRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVRdWl6ID0gZnVuY3Rpb24ocXVpelR5cGUpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChxdWl6VHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY291bnRyeSc6XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVDb3VudHJ5UXVpeigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZUNvdW50cnlRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBjb3VudHJ5UXVpeiA9IG5ldyBRdWl6KCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZnVsbFBvaW50cyA9IDEwMDtcclxuICAgICAgICAgICAgdmFyIGhpbnRNYXhpbXVtID0gMztcclxuICAgICAgICAgICAgdmFyIGhpbnRDb3N0ID0gMjU7XHJcblxyXG4gICAgICAgICAgICB2YXIgbGFzdFF1ZXN0aW9uQm9udXMgPSAyLjU7XHJcblxyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25UeXBlcyA9IEFwcENvbmZpZ1sncXVpei5jb3VudHJ5LnR5cGVzJ107XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGVzTGVuZ3RoID0gT2JqZWN0LmtleXMocXVlc3Rpb25UeXBlcykubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgLy8gc2VsZWN0IGNvdW50cmllcyBmb3IgcXVlc3Rpb25zXHJcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZENvdW50cmllcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgbnVtYmVyT2ZRdWVzdGlvbnMgPSBBcHBDb25maWdbJ3F1aXouY291bnRyeS5xdWVzdGlvbnMnXTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtYmVyT2ZRdWVzdGlvbnM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnlPayA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlICghY291bnRyeU9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50cnkgPSBjb3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIGNvdW50cmllcy5sZW5ndGggLSAxKV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50cnlPayA9IHNlbGVjdGVkQ291bnRyaWVzLmluZGV4T2YoY291bnRyeVsnYWxwaGEzQ29kZSddKSA8IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ291bnRyaWVzLnB1c2goY291bnRyeVsnYWxwaGEzQ29kZSddKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gY3JlYXRlIHF1ZXN0aW9ucyBmb3IgcXVpelxyXG4gICAgICAgICAgICB2YXIgcWNudCA9IDA7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkQ291bnRyaWVzLmZvckVhY2goZnVuY3Rpb24oYWxwaGEzKSB7XHJcbiAgICAgICAgICAgICAgICBxY250Kys7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnkgPSBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTMpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGUgPSBxdWVzdGlvblR5cGVzW2dldFJhbmRvbUludCgxLCBxdWVzdGlvblR5cGVzTGVuZ3RoKV07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHRleHQgPSBnZXRRdWVzdGlvblRleHQocXVlc3Rpb25UeXBlLCBjb3VudHJ5KTtcclxuICAgICAgICAgICAgICAgIHZhciBpbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHF1ZXN0aW9uVHlwZSxcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dDogZ2V0UXVlc3Rpb25JbnB1dChxdWVzdGlvblR5cGUpLFxyXG4gICAgICAgICAgICAgICAgICAgIHVuaXQ6IGdldFF1ZXN0aW9uVW5pdChxdWVzdGlvblR5cGUpXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdmFyIGFuc3dlciA9IGdldFF1ZXN0aW9uQW5zd2VyKHF1ZXN0aW9uVHlwZSwgY291bnRyeSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tBbnN3ZXIgPSBnZXRDaGVja0Fuc3dlckxhbWJkYShxdWVzdGlvblR5cGUsIGZ1bGxQb2ludHMsIGxhc3RRdWVzdGlvbkJvbnVzKTtcclxuICAgICAgICAgICAgICAgIHZhciBoaW50cyA9IGdldFF1ZXN0aW9uSGludHMocXVlc3Rpb25UeXBlLCBoaW50TWF4aW11bSwgaGludENvc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHRoZSBsYXN0IHF1ZXN0aW9uIGlzIHRoZSBib251cyBxdWVzdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKHFjbnQgPj0gbnVtYmVyT2ZRdWVzdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmZvWydib251cyddID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBhZGQgaW5mbyBmb3IgZmxhZyBvZiBjb3VudHJ5XHJcbiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnRkxBR19PRl9DT1VOVFJZJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm8ubWVkaWEgPSAnZmxhZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mby5hbHBoYTJDb2RlID0gY291bnRyeS5hbHBoYTJDb2RlLnRvTG9jYWxlTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY291bnRyeVF1aXouYWRkUXVlc3Rpb24obmV3IFF1ZXN0aW9uKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgIGluZm86IGluZm8sXHJcbiAgICAgICAgICAgICAgICAgICAgYW5zd2VyOiBhbnN3ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tBbnN3ZXI6IGNoZWNrQW5zd2VyLFxyXG4gICAgICAgICAgICAgICAgICAgIGhpbnRzOiBoaW50c1xyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJ5UXVpejtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25UZXh0ID0gZnVuY3Rpb24odHlwZSwgY291bnRyeSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIGhlacOfdCBkaWUgSGF1cHRzdGFkdCB2b24gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJbXCIgKyBjb3VudHJ5LmNhcGl0YWwgKyBcIl0gaXN0IGRpZSBIYXVwdHN0YWR0IHZvbiB3ZWxjaGVtIExhbmRcIlxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIHZpZWxlIE1lbnNjaGVuIGxlYmVuIGluIFtcIiArIGNvdW50cnkubmFtZSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIGdyb8OfIGlzdCBkaWUgRmzDpGNoZSB2b24gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXZWxjaGVzIExhbmQgaGF0IGRpZXNlIEZsYWdnZVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25BbnN3ZXIgPSBmdW5jdGlvbih0eXBlLCBjb3VudHJ5KSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWx0U3BlbGxpbmdzID0gY291bnRyeS5hbHRTcGVsbGluZ3MgIT09IHVuZGVmaW5lZCAmJiBjb3VudHJ5LmFsdFNwZWxsaW5nc1snY2FwaXRhbCddICE9PSB1bmRlZmluZWQgPyBjb3VudHJ5LmFsdFNwZWxsaW5nc1snY2FwaXRhbCddIDogW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkuY2FwaXRhbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWx0U3BlbGxpbmdzOiBhbHRTcGVsbGluZ3NcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhbHRTcGVsbGluZ3MgPSBjb3VudHJ5LmFsdFNwZWxsaW5ncyAhPT0gdW5kZWZpbmVkICYmIGNvdW50cnkuYWx0U3BlbGxpbmdzWyduYW1lJ10gIT09IHVuZGVmaW5lZCA/IGNvdW50cnkuYWx0U3BlbGxpbmdzWyduYW1lJ10gOiBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbHRTcGVsbGluZ3M6IGFsdFNwZWxsaW5nc1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5LnBvcHVsYXRpb25cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5hcmVhXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uSW5wdXQgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ251bWJlci5oaWdoJztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbnVtYmVyLm1lZGl1bSc7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3RleHQuc3RhbmRhcmQnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uVW5pdCA9IGZ1bmN0aW9uKHR5cGUpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAna23Csic7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ0VpbndvaG5lcic7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDaGVja0Fuc3dlckxhbWJkYSA9IGZ1bmN0aW9uKHR5cGUsIGZ1bGxQb2ludHMsIGxhc3RRdWVzdGlvbkJvbnVzKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhbnN3ZXIsIHN1Ym1pdHRlZEFuc3dlciwgaGludHNVc2VkLCBoaW50Q29zdCwgaW5mbykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29ycmVjdCA9IHN1Ym1pdHRlZEFuc3dlciA9PT0gYW5zd2VyLmNvcnJlY3QgfHwgKGFuc3dlci5hbHRTcGVsbGluZ3MgJiYgYW5zd2VyLmFsdFNwZWxsaW5ncy5pbmRleE9mKHN1Ym1pdHRlZEFuc3dlcikgPj0gMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzID0gY29ycmVjdCA/IGZ1bGxQb2ludHMgOiAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaGludHMgYXJlIGFsbG93ZWQgYW5kIGhhdmUgYmVlbiB1c2VkLCBzdWJ0cmFjdCB0aGUgcG9pbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaW50c1VzZWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgLT0gKGhpbnRzVXNlZCAqIGhpbnRDb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYm9udXMgcG9pbnRzIGZvciBsYXN0IHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAqPSBsYXN0UXVlc3Rpb25Cb251cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhbnN3ZXIsIHN1Ym1pdHRlZEFuc3dlciwgaGludHNVc2VkLCBoaW50Q29zdCwgaW5mbykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjYWxjdWxhdGUgcGVyY2VudGFnZSBkaWZmZXJlbmNlIGZyb20gY29ycmVjdCBhbnN3ZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUGVyY2VudGFnZSA9IE1hdGguYWJzKHN1Ym1pdHRlZEFuc3dlciAtIGFuc3dlci5jb3JyZWN0KSAvIGFuc3dlci5jb3JyZWN0ICogMTAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50cztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSA2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA5MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gOSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gODA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDEyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA3MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDYwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxNikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDE4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA0MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMjApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAyNSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDMwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAxMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGhpbnRzIGFyZSBhbGxvd2VkIGFuZCBoYXZlIGJlZW4gdXNlZCwgc3VidHJhY3QgdGhlIHBvaW50c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGludHNVc2VkID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzIC09IChoaW50c1VzZWQgKiBoaW50Q29zdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJvbnVzIHBvaW50cyBmb3IgbGFzdCBxdWVzdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgKj0gbGFzdFF1ZXN0aW9uQm9udXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbkhpbnRzID0gZnVuY3Rpb24odHlwZSwgaGludHNQb3NzaWJsZSwgaGludENvc3QpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4aW11bTogaGludHNQb3NzaWJsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29zdDogaGludENvc3QsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdpdmU6IGZ1bmN0aW9uKGhpbnRzVXNlZCwgYW5zd2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW5zd2VyLmNvcnJlY3Quc3Vic3RyKDAsIGhpbnRzVXNlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1F1aXpSdW5uaW5nKCkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1F1aXpSdW5uaW5nKCkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmdldE51bWJlck9mUXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouY3VycmVudFF1ZXN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBxdWl6Lm5leHRRdWVzdGlvbigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVpeiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmdldFRvdGFsUG9pbnRzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDb25jbHVkZXMgdGhlIHF1aXogYW5kIHB1dHMgdGhlIHNjb3JlIHRvIHRoZSBBUEkgZW5kcG9pbnQuXHJcbiAgICAgICAgICogUmV0dXJucyBhIHByb21pc2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGNvbmNsdWRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChxdWl6ICE9PSBudWxsICYmIHF1aXouaGFzRW5kZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChxdWl6LnN1Ym1pdHRlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ1F1aXogaGFzIGFscmVhZHkgYmVlbiBzdWJtaXR0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHF1aXouc3VibWl0dGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgU2NvcmVTcnYucHV0SGlnaHNjb3JlKHF1aXouZ2V0VG90YWxQb2ludHMoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoJ05vIHF1aXogaXMgY3VycmVudGx5IHJ1bm5pbmcnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5pdDogaW5pdCxcclxuICAgICAgICAgICAgc2V0Q291bnRyaWVzOiBzZXRDb3VudHJpZXMsXHJcbiAgICAgICAgICAgIGlzUXVpelJ1bm5pbmc6IGlzUXVpelJ1bm5pbmcsXHJcbiAgICAgICAgICAgIGhhc1F1aXpTdGFydGVkOiBoYXNRdWl6U3RhcnRlZCxcclxuICAgICAgICAgICAgaGFzUXVpekVuZGVkOiBoYXNRdWl6RW5kZWQsXHJcbiAgICAgICAgICAgIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcjogZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyLFxyXG4gICAgICAgICAgICBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnM6IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uOiBnZXRDdXJyZW50UXVlc3Rpb24sXHJcbiAgICAgICAgICAgIG5leHRRdWVzdGlvbjogbmV4dFF1ZXN0aW9uLFxyXG4gICAgICAgICAgICBnZXRUb3RhbFBvaW50czogZ2V0VG90YWxQb2ludHMsXHJcbiAgICAgICAgICAgIGNvbmNsdWRlOiBjb25jbHVkZSxcclxuICAgICAgICAgICAgZGlzcG9zZTogZGlzcG9zZVxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnU2NvcmVTcnYnLCBmdW5jdGlvbigkaHR0cCkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEZldGNoZXMgdGhlIGVudGlyZSBoaWdoc2NvcmUgbGlzdCBpbiBhbiBhcnJheSBmcm9tIHRoZSBBUEkuXHJcbiAgICAgICAgICogUmV0dXJucyBhIHByb21pc2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGdldEhpZ2hzY29yZUxpc3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3Njb3Jlcy9hbGwnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShsaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEZldGNoZXMgdGhlIGhpZ2hzY29yZSBvYmplY3QgZm9yIHRoZSBsb2dnZWQgaW4gdXNlci5cclxuICAgICAgICAgKiBJZiB0aGUgdXNlciBoYXMgbm8gcmVzdWx0IHlldCwgYW4gZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkLlxyXG4gICAgICAgICAqIFJldHVybnMgYSBwcm9taXNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBnZXRVc2VySGlnaHNjb3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9zY29yZXMvdXNlcicpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oc2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzY29yZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBGZXRjaGVzIHRoZSBoaWdoc2NvcmUgb2JqZWN0IGZvciB0aGUgb3ZlcmFsbCBoaWdoc2NvcmUuXHJcbiAgICAgICAgICogSWYgdGhlcmUgaXMgY3VycmVudGx5IG5vIHJlc3VsdCB5ZXQsIGFuIGVtcHR5IG9iamVjdCBpcyByZXR1cm5lZC5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgZ2V0T3ZlcmFsbEhpZ2hzY29yZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvc2NvcmVzL2hpZ2gnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKHNjb3JlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc2NvcmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUHV0cyBhIGhpZ2hzY29yZSByZXN1bHQgZm9yIHRoZSBsb2dnZWQgaW4gdXNlci5cclxuICAgICAgICAgKiBAcGFyYW0gc2NvcmUgICAgIE51bWJlciB3aXRoIHRoZSBhY2hpZXZlZCBzY29yZS5cclxuICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgcHV0SGlnaHNjb3JlID0gZnVuY3Rpb24oc2NvcmUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucHV0KCcvYXBpL3Njb3JlcycsIHsgc2NvcmU6IHNjb3JlIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0SGlnaHNjb3JlTGlzdDogZ2V0SGlnaHNjb3JlTGlzdCxcclxuICAgICAgICAgICAgZ2V0VXNlckhpZ2hzY29yZTogZ2V0VXNlckhpZ2hzY29yZSxcclxuICAgICAgICAgICAgZ2V0T3ZlcmFsbEhpZ2hzY29yZTogZ2V0T3ZlcmFsbEhpZ2hzY29yZSxcclxuICAgICAgICAgICAgcHV0SGlnaHNjb3JlOiBwdXRIaWdoc2NvcmVcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1VzZXJTcnYnLCBmdW5jdGlvbigkaHR0cCwgQXV0aFRva2VuU3J2LCBBcHBDb25maWcpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBnZXRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcicpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRVc2VyRnJvbVN0b3JhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFRva2VuU3J2LmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKHRva2VuKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0VXNlcigpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHRva2VuLCB3ZSByZWplY3QgdGhlIHByb21pc2VcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJObyB0b2tlbiBpbiBzdG9yYWdlXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvc2Vzc2lvbicsIHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnRva2VuID0gcmVzcG9uc2UuZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzYXZlIHRva2VuIGxvY2FsbHlcclxuICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbihzZWxmLnRva2VuKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VXNlcigpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9nb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9rZW4gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSB0b2tlbiBsb2NhbGx5XHJcbiAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZWdpc3RlciA9IGZ1bmN0aW9uKG5ld1VzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgLy8gc2VsZWN0IGEgcmFuZG9tIGNvbG9yIGZvciB0aGUgdXNlclxyXG4gICAgICAgICAgICAgICAgdmFyIGNvbG9ycyA9IEFwcENvbmZpZ1snc2V0dGluZ3MudXNlci5jb2xvcnMnXTtcclxuICAgICAgICAgICAgICAgIG5ld1VzZXIuY29sb3IgPSBjb2xvcnNbZ2V0UmFuZG9tSW50KDAsIGNvbG9ycy5sZW5ndGggLSAxKV07XHJcblxyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS91c2VyJywgbmV3VXNlcilcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGltbWVkaWF0ZWx5IGxvZyB0aGUgdXNlciBpblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dpbihuZXdVc2VyLnVzZXJuYW1lLCBuZXdVc2VyLnBhc3N3b3JkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KSAgO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVCYXNpYyA9IGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucHV0KCcvYXBpL3VzZXIvYmFzaWMnLCB1c2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0VXNlcjogZ2V0VXNlcixcclxuICAgICAgICAgICAgZ2V0VXNlckZyb21TdG9yYWdlOiBnZXRVc2VyRnJvbVN0b3JhZ2UsXHJcbiAgICAgICAgICAgIGxvZ2luOiBsb2dpbixcclxuICAgICAgICAgICAgbG9nb3V0OiBsb2dvdXQsXHJcbiAgICAgICAgICAgIHJlZ2lzdGVyOiByZWdpc3RlcixcclxuICAgICAgICAgICAgdXBkYXRlQmFzaWM6IHVwZGF0ZUJhc2ljXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
