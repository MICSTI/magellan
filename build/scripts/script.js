var magellan=angular.module("magellan",["ui.router","ngProgress","ngAnimate"],["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]);magellan.constant("AppConfig",{"log.info":!0,"log.error":!0,"quiz.country.questions":3,"quiz.country.types":{1:"CAPITAL_OF_COUNTRY",2:"COUNTRY_OF_CAPITAL",3:"POPULATION_OF_COUNTRY",4:"AREA_OF_COUNTRY",5:"FLAG_OF_COUNTRY"},"settings.user.colors":["soft_red","thunderbird","old_brick","new_york_pink","snuff","honey_flower","san_marino","shakespeare","ming","gossip","eucalyptus","mountain_meadow","jade","confetti","california","burnt_orange","jaffa","gallery","edward","lynch"]}),magellan.controller("AppCtrl",["$rootScope","$scope","$state","AuthSrv","UserSrv","CountrySrv","QuizSrv",function(e,n,t,r,o,u,i){n.app={config:{title:"Magellan",subtitle:"Teste dein Wissen über die Länder unserer Erde",author:"Michael Stifter"}},r.getUser().then(function(e){n.user=e,n.$broadcast("user.loaded"),u.init().then(function(e){n.$broadcast("countries.loaded",e),i.setCountries(e)})})["catch"](function(e){n.user=null}),n.isProgressBarVisible=function(){return t.is("quiz")};var s=function(){t.go("home")};n.goToHome=s,e.$on("$stateChangeError",function(e,n,r,o,u,i){"Not authorized"===i&&t.go("home")}),n.$on("app.login",function(e,o){n.user=o,r.setUser(o),u.init().then(function(e){n.$broadcast("countries.loaded",e),i.setCountries(e)}),t.go("quiz")}),n.$on("app.logout",function(e,o){n.user=null,r.clearUser(),t.go("home")})}]);var Quiz=function(){var e=null,n=[];this.start=function(){if(n.length<=0)throw Error("Cannot start a quiz without questions");return this.nextQuestion()},this.isActive=function(){return this.hasStarted()&&!this.hasEnded()},this.hasStarted=function(){return null!==e},this.hasEnded=function(){return this.hasStarted()&&e>=n.length},this.submitted=!1,this.addQuestion=function(e){if(void 0===e)throw Error("No question object passed");var t=!0,r=["config","hint","solution","answer","question","getInfo","info","points","answered","hintsAllowed","hintsRemaining"];r.forEach(function(n){if(!e.hasOwnProperty(n))throw t=!1,new Error("Question must have property '"+n+"'")}),t&&n.push(e)},this.nextQuestion=function(){return null===e?e=0:e++,!this.hasEnded()&&n[e]},this.currentQuestion=function(){return this.isActive()?n[e]:null},this.getTotalPoints=function(){if(!this.hasStarted())return null;var e=0;return n.forEach(function(n){var t=n.points();void 0!==t&&(e+=t)}),e},this.getCurrentQuestionNumber=function(){return null===e?null:e+1},this.getNumberOfQuestions=function(){return n.length}},Question=function(e){var n=null,t=null,r=null,o=null,u=0,i=null,s=null,a=!1,l=function(e){n=e.text,t=e.info||{},r=e.answer,i=e.checkAnswer||null,o=e.hints||{allowed:!1,maximum:0,cost:0,give:null}};e&&l(e),this.config=function(e){l(e)},this.question=function(){return n},this.info=function(e,n){return void 0===n?t[e]:void(t[e]=n)},this.getInfo=function(){return t},this.solution=function(){return a?r:null},this.hint=function(){if(!o.allowed)return null;if(o.allowed&&!o.give)throw new Error("Hints allowed but no give method passed");return u<o.maximum&&u++,o.give(u,r)},this.answer=function(e){if(!a&&i)return a=!0,s=i(r,e,u,o.cost,t),s=Math.max(0,s),s=Math.floor(s)},this.points=function(){if(a&&null!==s)return s},this.answered=function(){return a},this.hintsAllowed=function(){return null!==o?o.allowed:null},this.hintsRemaining=function(){var e=this.hintsAllowed();return null===e||e===!1?null:o.maximum-u}},getRandomInt=function(e,n){return Math.floor(Math.random()*(n-e+1))+e},getStringBetween=function(e,n,t){var r=e.indexOf(n),o=e.indexOf(t);return r>=0&&o>=0&&o>r?e.substr(r+1,o-r-1):null};"undefined"!=typeof module&&module.exports&&(module.exports.Question=Question,module.exports.Quiz=Quiz),angular.module("magellan").config(["$locationProvider","$stateProvider","$urlRouterProvider",function(e,n,t){e.html5Mode(!0),t.otherwise("/home");var r=function(e,n,t){return e.getUser().then(function(e){return e})["catch"](function(e){return t.reject("Not authorized")})};r.$inject=["AuthSrv","LogSrv","$q"],n.state("home",{url:"/home",templateUrl:"/build/views/partials/home.partial.html",params:{action:null}}).state("quiz",{url:"/quiz",templateUrl:"/build/views/partials/quiz.partial.html",resolve:{auth:r}}).state("countries",{url:"/countries",templateUrl:"/build/views/partials/countries.partial.html",resolve:{auth:r}}).state("countries.detail",{url:"/:alpha3Code",templateUrl:"/build/views/partials/countries-detail.partial.html",resolve:{auth:r}}).state("login",{url:"/login",templateUrl:"/build/views/partials/login.partial.html"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}).state("register",{url:"/register",templateUrl:"/build/views/partials/register.partial.html"}).state("settings",{url:"/settings",templateUrl:"/build/views/partials/settings.partial.html",resolve:{auth:r}}).state("password",{url:"/password",templateUrl:"/build/views/partials/password.partial.html",resolve:{auth:r}}).state("about",{url:"/about",templateUrl:"/build/views/partials/about.partial.html"}).state("highscore",{url:"/highscore",templateUrl:"/build/views/partials/highscore.partial.html",resolve:{auth:r}}).state("faq",{url:"/faq",templateUrl:"/build/views/partials/faq.partial.html",resolve:{auth:r}}).state("countries-difficulty",{url:"/countries-difficulty",templateUrl:"/build/views/partials/country-difficulty.partial.html",resolve:{auth:r}})}]),angular.module("magellan").controller("CountriesCtrl",["$scope","CountrySrv",function(e,n){var t=null,r=null,o=function(){t=n.getCountriesByLetter(),r=Object.keys(t),e.$$phase?(e.countryKeys=r,e.countriesByLetter=t):e.$apply(function(){e.countryKeys=r,e.countriesByLetter=t})};n.areCountriesLoaded()&&o(),e.$on("countries.loaded",function(){o()})}]),angular.module("magellan").controller("CountryDetailCtrl",["$scope","CountrySrv","$stateParams",function(e,n,t){var r=t.alpha3Code;n.areCountriesLoaded()&&(e.country=n.getCountryByAlpha3(r)),e.$on("countries.loaded",function(){e.$apply(function(){e.country=n.getCountryByAlpha3(r)})});var o=function(e){return n.getCountryByAlpha3(e)};e.getCountryFromService=o}]),angular.module("magellan").controller("CountryDifficultyCtrl",["$scope","CountrySrv",function(e,n){var t=function(){var t=n.getCountries(),r={easy:[],medium:[],hard:[],unassigned:[]};t.sort(function(e,n){return n.population-e.population}).forEach(function(e){r[e.difficulty].push(e)}),e.$$phase?(e.difficulties=r,e.difficultyKeys=Object.keys(r)):e.$apply(function(){e.difficulties=r,e.difficultyKeys=Object.keys(r)})};n.areCountriesLoaded()&&t(),e.$on("countries.loaded",function(e,n){t()})}]),angular.module("magellan").controller("DropdownCtrl",["$scope",function(e){function n(){u=!u}function t(){u=!0}function r(){u=!1}function o(){return u}var u=!1;e.toggleDropdown=n,e.showDropdown=t,e.hideDropdown=r,e.isDropdownVisible=o,e.$on("click.outside",function(n,t){o()&&(e.$$phase?r():e.$apply(function(){r()}))})}]),angular.module("magellan").controller("HighscoreCtrl",["$scope","ScoreSrv","LogSrv",function(e,n,t){e.scoreList=[],n.getHighscoreList().then(function(n){e.$$phase?e.scoreList=o(n):e.$apply(function(){e.scoreList=o(n)})})["catch"](function(e){t.error(e)});var r=function(n){return e.user._id===n},o=function(e){var n=0,t=null;return e.forEach(function(e){t&&e.score===t||(n++,e.rank=n+"."),t=e.score}),e};e.isMyself=r}]),angular.module("magellan").controller("HomeCtrl",["$scope","LogSrv","$stateParams",function(e,n,t){if(e.message=null,t.action){var r=t.action;switch(r){case"register.successful":e.message={type:"success",text:"Gratulation! Die Anmeldung war erfolgreich. Herzlich willkommen bei Magellan."};break;default:e.message=null}}}]),angular.module("magellan").controller("LoginCtrl",["$scope","UserSrv","FocusSrv",function(e,n,t){e.message=null,e.login=function(t,r){n.login(t,r).then(function(n){e.message=null,e.$emit("app.login",n.data)})["catch"](function(n){console.error(n);var t;t=401===n.status?"Falscher Benutzername oder Passwort":"Beim Einloggen scheint etwas schief gegangen zu sein",e.message={type:"error",text:t}})},t("#username")}]),angular.module("magellan").controller("LogoutCtrl",["$scope","UserSrv",function(e,n){n.logout().then(function(){e.$emit("app.logout")})}]),angular.module("magellan").controller("PasswordCtrl",["$scope","UserSrv","LogSrv","FocusSrv",function(e,n,t,r){e.passObj={},e.message={};var o=function(){return e.passObj.old&&e.passObj["new"]&&e.passObj.confirmation?e.passObj["new"]!==e.passObj.confirmation?void i("error","Die Passwörter stimmen nicht überein"):void n.updatePassword({old:e.passObj.old,password:e.passObj["new"]}).then(function(e){i("success","Das neue Passwort wurde erfolgreich gespeichert")})["catch"](function(e){"Old password incorrect"===e.message?i("error","Das alte Passwort ist nicht korrekt"):i("error","Das neue Passwort konnte nicht gespeichert werden")}):void i("error","Alle Felder müssen ausgefüllt sein")},u=function(){o()},i=function(n,t){e.$$phase?e.message={type:n,text:t}:e.$apply(function(){e.message={type:n,text:t}})};r("#password-current"),e.updatePassword=o,e.delegateSubmit=u}]),angular.module("magellan").controller("QuizDirectiveController",["$scope","QuizSrv","LogSrv","FocusSrv","ngProgressFactory","$filter",function(e,n,t,r,o,u){var i,s=function(){e.progressbar=o.createInstance(),e.progressbar.setParent(document.getElementById("quiz-progress")),e.progressbar.setAbsolute(),e.progressbar.setColor("#336e7b"),e.isResultsPageVisible=!1,e.achievements=[],e.bests=[],e.answerInput={},e.hint=null,e.multiplierOptions=[{value:1,label:""},{value:1e3,label:"Tsd."},{value:1e6,label:"Mio."}],i=null},a=function(){if(i=n.getCurrentQuestion(),e.hint=null,null!==i){if(i.getInfo().input&&0===i.getInfo().input.indexOf("number"))switch(i.getInfo().input){case"number.high":e.answerInput.multiplier={value:1e6,label:"Mio."};break;case"number.medium":e.answerInput.multiplier={value:1e3,label:"Tsd."};break;default:e.answerInput.multiplier={value:1,label:""}}else e.answerInput.multiplier=null;A(),r(".answerInput")}else e.progressbar.set(0)},l=function(){return i},c=function(){return n.getCurrentQuestionNumber()},f=function(){return n.getNumberOfQuizQuestions()},d=function(){return y(l().question(),"question-highlight")+"?"},g=function(){return i&&i.getInfo().media?i.getInfo().media:null},p=function(){e.isResultsPageVisible=!0},h=function(){e.$$phase?e.isResultsPageVisible=!1:e.$apply(function(){e.isResultsPageVisible=!1})},m=function(){return null!==i&&(null!==i.hintsRemaining()&&i.hintsRemaining()>0)},v=function(){if(e.answerInput.answer&&!i.answered()){var n=String(e.answerInput.answer);i.getInfo().input&&0===i.getInfo().input.indexOf("number")&&(n=n.replace(",",".")),e.answerInput.multiplier&&(n*=e.answerInput.multiplier.value),e.answerInput.points=i.answer(n),r(S()?"#btnContinueFinished  ":"#btnNextQuestion")}},w=function(){return!(!n.isQuizRunning()||null===i)&&i.answered()},b=function(){n.nextQuestion(),e.answerInput.answer="",a()},O=function(){e.hint=i.hint(),r(".answerInput")},y=function(e,n){return e.replace("[","<span class='"+n+"'>").replace("]","</span>")},C=function(e){13==e.which&&v()},A=function(){var n=c()/f()*100;e.progressbar.set(n)},S=function(){return c()>=f()},_=function(n,t,r){var o=[],u=!0;if(n.indexOf("overall_best")>=0&&(o.push({text:"Du hast einen neuen absoluten Rekord geschafft!"}),u=!1),n.indexOf("overall_best_equalised")>=0&&(o.push({text:"Du hast den aktuellen absoluten Rekord eingestellt!"}),u=!1),n.indexOf("personal_best")>=0&&n.indexOf("overall_best")<0&&(o.push({text:"Du hast einen neuen persönlichen Rekord geschafft!"}),u=!1),n.indexOf("personal_best_equalised")>=0&&n.indexOf("overall_best_equalised")<0&&(o.push({text:"Du hast gleich viele Punkte geschafft wie bei deinem persönlichen Rekord!"}),u=!1),n.indexOf("new_daily_best")>=0&&0===o.length&&o.push({text:"Du hast einen neuen persönlichen Tagesrekord geschafft!"}),e.achievements=o,u&&t&&t.id&&t.date&&t.score&&r&&r.id&&r.date&&r.score){var i=[];r.type="overall",i.push(r),t.id!==r.id&&(t.type="personal",i.push(t)),e.bests=i}else e.bests=null},P=function(){p(),b(),n.conclude().then(function(e){_(e.events||[],e.personalBest,e.overallBest)})["catch"](function(e){t.error(e)})},T=function(n){var t;if("personal"===n.type)t="Dein persönlicher Rekord liegt bei <span class='bold'>{POINTS} Punkten</span>, aufgestellt am {DATE}.";else{var r=n.id===e.user._id;t=r?"Du hältst den absoluten Rekord mit <span class='bold'>{POINTS} Punkten</span>, aufgestellt am {DATE}.":"<span class='highlight'>{USERNAME}</span> hält den absoluten Rekord mit <span class='bold'>{POINTS} Punkten</span>, aufgestellt am {DATE}."}return t.replace("{POINTS}",u("number")(n.score)).replace("{DATE}",U(n.date)).replace("{USERNAME}",n.username)},U=function(e){return e=new Date(e),$(e.getDate(),"00")+"."+$(e.getMonth()+1,"00")+"."+(e.getYear()+1900)},$=function(e,n){return String(n+e).slice(-n.length)},R=function(){quiz=null,e.$emit("quiz.restart"),s(),a()},I=function(e,n){if(13==e.which)switch(n){case"next_question":b();break;case"continue_finished":P()}};e.$on("quiz.start",function(e,n){h()}),e.$on("$destroy",function(e,t){n.hasQuizStarted()&&n.hasQuizEnded()&&n.dispose()}),s(),a(),e.getQuestion=l,e.getCurrentQuestionNumber=c,e.renderQuestionText=d,e.submitAnswer=v,e.questionAnswered=w,e.nextQuestion=b,e.handleKeyPress=C,e.getQuestionMedia=g,e.requestHint=O,e.wasLastQuestion=S,e.continueFinished=P,e.getBestText=T,e.restartQuiz=R,e.hintsAvailable=m,e.enterListener=I}]),angular.module("magellan").controller("QuizCtrl",["$scope","QuizSrv","LogSrv",function(e,n,t){var r=function(e){n.init().then(function(){e&&"function"==typeof e&&e()})["catch"](function(e){t.error(e)})},o=function(){return n.isQuizRunning()},u=function(){return n.hasQuizStarted()},i=function(){return n.hasQuizEnded()},s=function(){return n.getTotalPoints()};e.$on("quiz.restart",function(t,o){n.dispose(),r(function(){e.$broadcast("quiz.start")})}),e.startQuiz=r,e.isQuizRunning=o,e.hasQuizStarted=u,e.hasQuizEnded=i,e.getTotalPoints=s}]),angular.module("magellan").controller("RegisterCtrl",["$scope","LogSrv","FocusSrv","UserSrv","$state","$window",function(e,n,t,r,o,u){e.newUser={},e.message=null;var i=function(t){return!!t&&void(s()&&r.register(e.newUser).then(function(n){200===n.status?(e.$emit("app.login",n.data),o.go("home",{action:"register.successful"})):e.message={type:"error",text:"Bei der Anmeldung scheint etwas schief gegangen zu sein"}})["catch"](function(t){n.error(t);var r;switch(t.message){case"Username already exists":r="Der Benutzername existiert bereits";break;default:r="Bei der Anmeldung scheint etwas schief gegangen zu sein"}e.$$phase?e.message={type:"error",text:r}:e.$apply(function(){e.message={type:"error",text:r}})}))},s=function(){e.message=null;var n=e.newUser.password,t=e.newUser.password2;return e.newUser.username&&e.newUser.email&&n&&t?""===n||""===t?e.message={type:"error",text:"Die Passwörter können nicht leer sein"}:n!==t&&(e.message={type:"error",text:"Die Passwörter stimmen nicht überein"}):e.message={type:"error",text:"Alle Felder müssen ausgefüllt sein"},!e.message},a=function(){i(!0)};e.delegateSubmit=a,e.register=i,t("#username")}]),angular.module("magellan").controller("SettingsCtrl",["$scope","AppConfig","FocusSrv","LogSrv","UserSrv",function(e,n,t,r,o){var u=function(){e.message=null;var u=n["settings.user.colors"];e.userObj={username:e.user.username,email:e.user.email,color:e.user.color},e.userColors=u;var i=function(n){e.userObj.color=n},s=function(){o.updateBasic(e.userObj).then(function(n){e.user.username=e.userObj.username,e.user.email=e.userObj.email,e.user.color=e.userObj.color,e.$apply(function(){e.message={type:"success",text:"Einstellungen wurden erfolgreich gespeichert"}})})["catch"](function(n){r.error("Update user",n);var t;switch(n.message){case"Username already exists":t="Der Benutzername ist bereits vergeben";break;default:t="Die Einstellungen konnten nicht gespeichert werden"}e.$apply(function(){e.message={type:"error",text:t}})})},a=function(){s(!0)};e.setColor=i,e.updateUser=s,e.delegateSubmit=a,t("#username")};e.user&&u(),e.$on("user.loaded",function(e,n){u()})}]),angular.module("magellan").directive("clickOutside",["$parse","$document","$rootScope",function(e,n,t){return{restrict:"A",link:function(e,r,o){function u(e){e.stopPropagation();var n=$(e.target).parents(),o=n.index($(r))!==-1,u=e.target===r[0],i=!o&&!u;i&&t.$broadcast("click.outside",e)}n.bind("click",u),r.bind("remove",function(){n.unbind("click",u)})}}}]),angular.module("magellan").directive("quiz",function(){return{templateUrl:"build/views/templates/quiz-directive.template.html",scope:!0,controller:"QuizDirectiveController",restrict:"E",link:function(e,n,t){}}}),angular.module("magellan").filter("renderHtml",["$sce",function(e){return function(n){return e.trustAsHtml(n)}}]),angular.module("magellan").filter("textOrNumber",["$filter",function(e){return function(n,t){return t=void 0!==t?0:t,isNaN(n)?n:e("number")(n,t)}}]),angular.module("magellan").factory("AuthInterceptor",["AuthTokenSrv",function(e){var n=function(n){var t=e.getToken();return t&&(n.headers=n.headers||{},n.headers["X-Auth"]=t),n};return{request:n}}]),angular.module("magellan").factory("AuthTokenSrv",["$window",function(e){var n=e.sessionStorage,t="auth-token",r=function(){return n.getItem(t)},o=function(e){e?n.setItem(t,e):n.removeItem(t)};return{getToken:r,setToken:o}}]),angular.module("magellan").factory("AuthSrv",["UserSrv",function(e){var n=null,t=function(){return new Promise(function(t,r){null!==n?t(n):e.getUserFromStorage().then(function(e){n=e,t(e)})["catch"](function(e){r("Not logged in")})})},r=function(e){n=e},o=function(){n=null};return{setUser:r,getUser:t,clearUser:o}}]),angular.module("magellan").factory("CountrySrv",["$http","IndexedDBSrv","LogSrv",function(e,n,t){var r=null,o=null,u=null,i="magellan",s="countryStore",a="countries",l="version",c=n.indexedDBAvailable(),f=function(){return d()},d=function(){return c?new Promise(function(e,a){n.createDatabase(i,s).then(h).then(m).then(v).then(g).then(p).then(function(n){r=n.countries,t.info("loaded countries from",n.loadStrategy.toUpperCase()),o={},u={},r.forEach(function(e){o[e.alpha3Code]=e;var n=e.name.substr(0,1).toUpperCase();switch(n){case"Ä":n="A";break;case"Ö":n="O";break;case"Ü":n="U"}void 0===u[n]&&(u[n]=[]),u[n].push({alpha3Code:e.alpha3Code,name:e.name})}),e(r)})["catch"](function(e){t.error("failed to load countries",e),a(e)})}):b()},g=function(e){return new Promise(function(n,t){var r,o=e.internalVersion,u=e.externalVersion;r=null===o?"api":u>o?"api":"db",e.loadStrategy=r,n(e)})},p=function(e){return new Promise(function(t,r){var o=e.loadStrategy;switch(o){case"api":b().then(function(r){e.countries=r,n.putItem(i,s,{name:a,value:r}),n.putItem(i,s,{name:l,value:e.externalVersion}),t(e)})["catch"](function(e){r(e)});break;case"db":w(e).then(function(e){t(e)})["catch"](function(e){r(e)});break;default:r("Unknown load strategy")}})},h=function(){return new Promise(function(e,n){e({})})},m=function(e){return new Promise(function(t,r){n.retrieveItem(i,s,l).then(function(n){e.internalVersion=n.value,t(e)})["catch"](function(n){e.internalVersion=null,t(e)})})},v=function(e){return O().then(function(n){return e.externalVersion=n,e})},w=function(e){return new Promise(function(t,r){n.retrieveItem(i,s,a).then(function(n){e.countries=n.value,t(e)})["catch"](function(e){t(null)})})},b=function(){return new Promise(function(n,t){e.get("/api/countries").then(function(e){n(e.data)})["catch"](function(e){t(e)})})},O=function(){return new Promise(function(n,t){e.get("/api/countries/version").then(function(e){n(e.data.version||0)})["catch"](function(e){n(0)})})},y=function(e){return null===o?null:o[e]},C=function(){return r},A=function(){return null===u?null:u},S=function(){return null!==r&&r.length>0};return{init:f,getCountries:C,getCountryByAlpha3:y,getCountriesByLetter:A,areCountriesLoaded:S}}]),angular.module("magellan").factory("FocusSrv",["$timeout","$window",function(e,n){return function(t){e(function(){var e=n.document.querySelector(t);e&&e.focus()})}}]),angular.module("magellan").factory("IndexedDBSrv",["$window",function(e){var n="name",t=e.indexedDB||e.webkitIndexedDB||e.msIndexedDB,r=e.IDBKeyRange||e.webkitIDBKeyRange,o=e.IDBTransaction||e.webkitIDBTransaction;o&&(o.READ_WRITE=o.READ_WRITE||"readwrite",o.READ_ONLY=o.READ_ONLY||"readonly");var u=function(){return!!t},i=function(e,r){return new Promise(function(o,u){var i=t.open(e);i.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore(r,{keyPath:n})},i.onsuccess=function(e){o(e)},i.onerror=function(e){u(e)}})},s=function(e){return new Promise(function(n,r){var o=t.deleteDatabase(e);o.onsuccess=function(e){n(e)},o.onerror=function(e){r(e)}})},a=function(e,n,r){return new Promise(function(u,i){var s=t.open(e);s.onsuccess=function(e){var t=e.target.result,s=t.transaction(n,o.READ_WRITE),a=s.objectStore(n),l=a.add(r);l.onsuccess=function(e){u(e)},l.onerror=function(e){i(e)}}})},l=function(e,n,r){return new Promise(function(u,i){var s=t.open(e);s.onsuccess=function(e){var t=e.target.result,s=t.transaction(n,o.READ_WRITE),a=s.objectStore(n),l=a.put(r);l.onsuccess=function(e){u(e)},l.onerror=function(e){i(e)}}})},c=function(e,n,u){return new Promise(function(i,s){var a=null,l=t.open(e);l.onsuccess=function(e){var t=e.target.result,s=t.transaction(n,o.READ_ONLY),l=s.objectStore(n),c=r.only(u);l.openCursor(c).onsuccess=function(e){var n=e.target.result;n?(a=n.value,n["continue"]()):i(a)}},l.onerror=function(e){s(e)}})},f=function(e,n){return new Promise(function(r,u){var i=[],s=t.open(e);s.onsuccess=function(e){var t=e.target.result,u=t.transaction(n,o.READ_ONLY),s=u.objectStore(n);s.openCursor().onsuccess=function(e){var n=e.target.result;n?(i.push(n.value),n["continue"]()):r(i)}},s.onerror=function(e){u(e)}})};return{createDatabase:i,dropDatabase:s,addItem:a,putItem:l,retrieveItem:c,retrieveItems:f,indexedDBAvailable:u}}]),angular.module("magellan").factory("LogSrv",["AppConfig",function(e){var n=function(){e["log.info"]&&console.log.apply(console,arguments)},t=function(){e["log.error"]&&console.error.apply(console,arguments)};return{info:n,error:t}}]),angular.module("magellan").factory("QuizSrv",["AppConfig","CountrySrv","ScoreSrv","LogSrv",function(e,n,t,r){var o=null,u=null,i=function(e){o=e},s=function(){return null!==o&&o.length>0},a=function(){return new Promise(function(e,n){s||n("Countries have not been loaded"),u=g("country"),e(u.start())})},l=function(){u=null},c=function(){return null!==u&&(u.hasStarted()&&!u.hasEnded())},f=function(){return null!==u&&u.hasStarted()},d=function(){return null!==u&&u.hasEnded()},g=function(e){switch(e){case"country":default:return p()}},p=function(){for(var t=new Quiz,r=100,u=3,i=25,s=2.5,a=e["quiz.country.types"],l=Object.keys(a).length,c=[],f=e["quiz.country.questions"],d=0;d<f;d++){for(var g=!1;!g;){var p=o[getRandomInt(0,o.length-1)];g=c.indexOf(p.alpha3Code)<0}c.push(p.alpha3Code)}var y=0;return c.forEach(function(e){y++;var o=n.getCountryByAlpha3(e),c=a[getRandomInt(1,l)],d=h(c,o),g={type:c,input:v(c),unit:w(c)},p=m(c,o),C=b(c,r,s),A=O(c,u,i);y>=f&&(g.bonus=!0),"FLAG_OF_COUNTRY"===c&&(g.media="flag",g.alpha2Code=o.alpha2Code.toLocaleLowerCase()),t.addQuestion(new Question({text:d,info:g,answer:p,checkAnswer:C,hints:A}))}),t},h=function(e,n){switch(e){case"CAPITAL_OF_COUNTRY":return"Wie heißt die Hauptstadt von ["+n.name+"]";case"COUNTRY_OF_CAPITAL":return"["+n.capital+"] ist die Hauptstadt von welchem Land";case"POPULATION_OF_COUNTRY":return"Wie viele Menschen leben in ["+n.name+"]";case"AREA_OF_COUNTRY":return"Wie groß ist die Fläche von ["+n.name+"]";case"FLAG_OF_COUNTRY":return"Welches Land hat diese Flagge";default:return"?"}},m=function(e,n){switch(e){case"CAPITAL_OF_COUNTRY":var t=void 0!==n.altSpellings&&void 0!==n.altSpellings.capital?n.altSpellings.capital:[];return{correct:n.capital,altSpellings:t};case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":var t=void 0!==n.altSpellings&&void 0!==n.altSpellings.name?n.altSpellings.name:[];return{correct:n.name,altSpellings:t};case"POPULATION_OF_COUNTRY":return{correct:n.population};case"AREA_OF_COUNTRY":return{correct:n.area};default:return"?"}},v=function(e){switch(e){case"POPULATION_OF_COUNTRY":return"number.high";case"AREA_OF_COUNTRY":return"number.medium";case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":default:return"text.standard"}},w=function(e){switch(e){case"AREA_OF_COUNTRY":return"km²";case"POPULATION_OF_COUNTRY":return"Einwohner";default:return null}},b=function(e,n,t){switch(e){case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":return function(e,r,o,u,i){var s=r===e.correct||e.altSpellings&&e.altSpellings.indexOf(r)>=0,a=s?n:0;return o>0&&(a-=o*u),void 0!==i&&void 0!==i.bonus&&i.bonus===!0&&(a*=t),a};case"POPULATION_OF_COUNTRY":case"AREA_OF_COUNTRY":return function(e,n,r,o,u){var i,s=Math.abs(n-e.correct)/e.correct*100;return i=s<=3?100:s<=6?90:s<=9?80:s<=12?70:s<=14?60:s<=16?50:s<=18?40:s<=20?30:s<=25?20:s<=30?10:0,r>0&&(i-=r*o),void 0!==u&&void 0!==u.bonus&&u.bonus===!0&&(i*=t),i};default:return"?"}},O=function(e,n,t){switch(e){case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":return{allowed:!0,maximum:n,cost:t,give:function(e,n){return n.correct.substr(0,e)}};case"POPULATION_OF_COUNTRY":case"AREA_OF_COUNTRY":return{allowed:!1};default:return"?"}},y=function(){return c()?u.getCurrentQuestionNumber():null},C=function(){return c()?u.getNumberOfQuestions():null},A=function(){return c()?u.currentQuestion():null},S=function(){c()&&u.nextQuestion()},_=function(){return null===u?null:u.getTotalPoints()},P=function(){return new Promise(function(e,n){null!==u&&u.hasEnded()?(u.submitted===!0&&n("Quiz has already been submitted"),u.submitted=!0,t.putHighscore(u.getTotalPoints()).then(function(n){e(n)})["catch"](function(e){n(e)})):n("No quiz is currently running")})};return{init:a,setCountries:i,isQuizRunning:c,hasQuizStarted:f,hasQuizEnded:d,getCurrentQuestionNumber:y,getNumberOfQuizQuestions:C,getCurrentQuestion:A,nextQuestion:S,getTotalPoints:_,conclude:P,dispose:l}}]),angular.module("magellan").factory("ScoreSrv",["$http",function(e){var n=function(){return new Promise(function(n,t){e.get("/api/scores/all").success(function(e){n(e)}).error(function(e){t(e)})})},t=function(){return new Promise(function(n,t){e.get("/api/scores/user").success(function(e){n(e)}).error(function(e){t(e)})})},r=function(){return new Promise(function(n,t){e.get("/api/scores/high").success(function(e){n(e)}).error(function(e){t(e)})})},o=function(n){return new Promise(function(t,r){e.put("/api/scores",{score:n}).success(function(e){t(e)}).error(function(e){r(e)})})};return{getHighscoreList:n,getUserHighscore:t,getOverallHighscore:r,putHighscore:o}}]),angular.module("magellan").factory("UserSrv",["$http","AuthTokenSrv","AppConfig",function(e,n,t){var r=this,o=function(){return e.get("/api/user")},u=function(){return new Promise(function(e,t){var r=n.getToken();r?(n.setToken(r),o().then(function(n){e(n.data)})["catch"](function(e){t(e)})):t("No token in storage")})},i=function(t,u){return e.post("/api/session",{username:t,password:u}).then(function(e){return r.token=e.data,n.setToken(r.token),o()})},s=function(){return new Promise(function(e,t){r.token=null,n.setToken(),e()})},a=function(n){return new Promise(function(r,o){var u=t["settings.user.colors"];n.color=u[getRandomInt(0,u.length-1)],e.post("/api/user",n).success(function(e){i(n.username,n.password).then(function(e){r(e)})["catch"](function(e){o(e)})}).error(function(e){o(e)})})},l=function(n){return new Promise(function(t,r){e.put("/api/user/basic",n).success(function(e){t(e)}).error(function(e){r(e)})})},c=function(n){return new Promise(function(t,r){e.put("/api/user/password",n).success(function(e){t(e)}).error(function(e){r(e)})})};return{getUser:o,getUserFromStorage:u,login:i,logout:s,register:a,updateBasic:l,updatePassword:c}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjcmlwdC5qcyIsIm1vZGVscy5qcyIsInJvdXRlcy5qcyIsImNvbnRyb2xsZXJzL2NvdW50cmllcy5jdHJsLmpzIiwiY29udHJvbGxlcnMvY291bnRyeS1kZXRhaWwuY3RybC5qcyIsImNvbnRyb2xsZXJzL2NvdW50cnktZGlmZmljdWx0eS5jdHJsLmpzIiwiY29udHJvbGxlcnMvZHJvcGRvd24uY3RybC5qcyIsImNvbnRyb2xsZXJzL2hpZ2hzY29yZS5jdHJsLmpzIiwiY29udHJvbGxlcnMvaG9tZS5jdHJsLmpzIiwiY29udHJvbGxlcnMvbG9naW4uY3RybC5qcyIsImNvbnRyb2xsZXJzL2xvZ291dC5jdHJsLmpzIiwiY29udHJvbGxlcnMvcGFzc3dvcmQuY3RybC5qcyIsImNvbnRyb2xsZXJzL3F1aXotZGlyZWN0aXZlLmN0cmwuanMiLCJjb250cm9sbGVycy9xdWl6LmN0cmwuanMiLCJjb250cm9sbGVycy9yZWdpc3Rlci5jdHJsLmpzIiwiY29udHJvbGxlcnMvc2V0dGluZ3MuY3RybC5qcyIsImRpcmVjdGl2ZXMvY2xpY2stb3V0c2lkZS5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL3F1aXouZGlyZWN0aXZlLmpzIiwiZmlsdGVycy9yZW5kZXJIdG1sLmZpbHRlci5qcyIsImZpbHRlcnMvdGV4dE9yTnVtYmVyLmpzIiwiaW50ZXJjZXB0b3JzL2F1dGguaW50ZXJjZXB0b3IuanMiLCJzZXJ2aWNlcy9hdXRoLXRva2VuLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9hdXRoLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9jb3VudHJ5LnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9mb2N1cy5zZXJ2aWNlLmpzIiwic2VydmljZXMvaW5kZXhlZC1kYi5zZXJ2aWNlLmpzIiwic2VydmljZXMvbG9nLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9xdWl6LnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9zY29yZS5zZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlci5zZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIm1hZ2VsbGFuIiwiYW5ndWxhciIsIm1vZHVsZSIsIiRodHRwUHJvdmlkZXIiLCJpbnRlcmNlcHRvcnMiLCJwdXNoIiwiY29uc3RhbnQiLCJsb2cuaW5mbyIsImxvZy5lcnJvciIsInF1aXouY291bnRyeS5xdWVzdGlvbnMiLCJxdWl6LmNvdW50cnkudHlwZXMiLCIxIiwiMiIsIjMiLCI0IiwiNSIsInNldHRpbmdzLnVzZXIuY29sb3JzIiwiY29udHJvbGxlciIsIiRyb290U2NvcGUiLCIkc2NvcGUiLCIkc3RhdGUiLCJBdXRoU3J2IiwiVXNlclNydiIsIkNvdW50cnlTcnYiLCJRdWl6U3J2IiwiYXBwIiwiY29uZmlnIiwidGl0bGUiLCJzdWJ0aXRsZSIsImF1dGhvciIsImdldFVzZXIiLCJ0aGVuIiwidXNlciIsIiRicm9hZGNhc3QiLCJpbml0IiwiY291bnRyaWVzIiwic2V0Q291bnRyaWVzIiwiZXJyIiwiaXNQcm9ncmVzc0JhclZpc2libGUiLCJpcyIsImdvVG9Ib21lIiwiZ28iLCIkb24iLCJldmVudCIsInRvU3RhdGUiLCJ0b1BhcmFtcyIsImZyb21TdGF0ZSIsImZyb21QYXJhbXMiLCJlcnJvciIsImRhdGEiLCJzZXRVc2VyIiwiY2xlYXJVc2VyIiwiUXVpeiIsImN1cnJlbnRRdWVzdGlvbklkeCIsInF1ZXN0aW9ucyIsInRoaXMiLCJzdGFydCIsImxlbmd0aCIsIkVycm9yIiwibmV4dFF1ZXN0aW9uIiwiaXNBY3RpdmUiLCJoYXNTdGFydGVkIiwiaGFzRW5kZWQiLCJzdWJtaXR0ZWQiLCJhZGRRdWVzdGlvbiIsInF1ZXN0aW9uIiwidW5kZWZpbmVkIiwidmFsaWQiLCJuZWNlc3NhcnlQcm9wZXJ0aWVzIiwiZm9yRWFjaCIsInByb3BlcnR5IiwiaGFzT3duUHJvcGVydHkiLCJjdXJyZW50UXVlc3Rpb24iLCJnZXRUb3RhbFBvaW50cyIsInRvdGFsUG9pbnRzIiwicG9pbnRzIiwiZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyIiwiZ2V0TnVtYmVyT2ZRdWVzdGlvbnMiLCJRdWVzdGlvbiIsIm9wdGlvbnMiLCJ0ZXh0IiwiaW5mbyIsImFuc3dlciIsImhpbnRzIiwiaGludHNVc2VkIiwiY2hlY2tBbnN3ZXIiLCJhbnN3ZXJlZCIsIm9wdHMiLCJhbGxvd2VkIiwibWF4aW11bSIsImNvc3QiLCJnaXZlIiwicHJvcCIsInZhbHVlIiwiZ2V0SW5mbyIsInNvbHV0aW9uIiwiaGludCIsInN1Ym1pdHRlZEFuc3dlciIsIk1hdGgiLCJtYXgiLCJmbG9vciIsImhpbnRzQWxsb3dlZCIsImhpbnRzUmVtYWluaW5nIiwiZ2V0UmFuZG9tSW50IiwibWluIiwicmFuZG9tIiwiZ2V0U3RyaW5nQmV0d2VlbiIsImZpcnN0U3RyaW5nIiwic2Vjb25kU3RyaW5nIiwiZmlyc3RQb3MiLCJpbmRleE9mIiwic2Vjb25kUG9zIiwic3Vic3RyIiwiZXhwb3J0cyIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJvdGhlcndpc2UiLCJhdXRob3JpemUiLCJMb2dTcnYiLCIkcSIsInJlamVjdCIsIiRpbmplY3QiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwicGFyYW1zIiwiYWN0aW9uIiwicmVzb2x2ZSIsImF1dGgiLCJjb3VudHJpZXNCeUxldHRlciIsImNvdW50cnlLZXlzIiwiZ2V0Q291bnRyaWVzQnlMZXR0ZXIiLCJPYmplY3QiLCJrZXlzIiwiJCRwaGFzZSIsIiRhcHBseSIsImFyZUNvdW50cmllc0xvYWRlZCIsIiRzdGF0ZVBhcmFtcyIsImFscGhhM0NvZGUiLCJjb3VudHJ5IiwiZ2V0Q291bnRyeUJ5QWxwaGEzIiwiZ2V0Q291bnRyeUZyb21TZXJ2aWNlIiwiYWxwaGEzIiwiZ2V0Q291bnRyaWVzIiwiZGlmZmljdWx0aWVzIiwiZWFzeSIsIm1lZGl1bSIsImhhcmQiLCJ1bmFzc2lnbmVkIiwic29ydCIsImEiLCJiIiwicG9wdWxhdGlvbiIsImMiLCJkaWZmaWN1bHR5IiwiZGlmZmljdWx0eUtleXMiLCJ0b2dnbGVEcm9wZG93biIsInZpc2libGUiLCJzaG93RHJvcGRvd24iLCJoaWRlRHJvcGRvd24iLCJpc0Ryb3Bkb3duVmlzaWJsZSIsIlNjb3JlU3J2Iiwic2NvcmVMaXN0IiwiZ2V0SGlnaHNjb3JlTGlzdCIsImxpc3QiLCJjcmVhdGVSYW5raW5nIiwiaXNNeXNlbGYiLCJpZCIsIl9pZCIsInJhbmsiLCJwcmV2aW91c1Njb3JlIiwiZW50cnkiLCJzY29yZSIsIm1lc3NhZ2UiLCJ0eXBlIiwiRm9jdXNTcnYiLCJsb2dpbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJyZXNwb25zZSIsIiRlbWl0IiwiY29uc29sZSIsIm1lc3NhZ2VUZXh0Iiwic3RhdHVzIiwibG9nb3V0IiwicGFzc09iaiIsInVwZGF0ZVBhc3N3b3JkIiwib2xkIiwiY29uZmlybWF0aW9uIiwic2V0TWVzc2FnZSIsImRlbGVnYXRlU3VibWl0IiwibmdQcm9ncmVzc0ZhY3RvcnkiLCIkZmlsdGVyIiwiaW5pdEN0cmwiLCJwcm9ncmVzc2JhciIsImNyZWF0ZUluc3RhbmNlIiwic2V0UGFyZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInNldEFic29sdXRlIiwic2V0Q29sb3IiLCJpc1Jlc3VsdHNQYWdlVmlzaWJsZSIsImFjaGlldmVtZW50cyIsImJlc3RzIiwiYW5zd2VySW5wdXQiLCJtdWx0aXBsaWVyT3B0aW9ucyIsImxhYmVsIiwidXBkYXRlVWkiLCJnZXRDdXJyZW50UXVlc3Rpb24iLCJpbnB1dCIsIm11bHRpcGxpZXIiLCJ1cGRhdGVQcm9ncmVzc0JhciIsInNldCIsImdldFF1ZXN0aW9uIiwiZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zIiwicmVuZGVyUXVlc3Rpb25UZXh0IiwicmVuZGVyIiwiZ2V0UXVlc3Rpb25NZWRpYSIsIm1lZGlhIiwic2hvd1Jlc3VsdHNQYWdlIiwiaGlkZVJlc3VsdHNQYWdlIiwiaGludHNBdmFpbGFibGUiLCJzdWJtaXRBbnN3ZXIiLCJTdHJpbmciLCJyZXBsYWNlIiwid2FzTGFzdFF1ZXN0aW9uIiwicXVlc3Rpb25BbnN3ZXJlZCIsImlzUXVpelJ1bm5pbmciLCJyZXF1ZXN0SGludCIsImNsYXNzTmFtZSIsImhhbmRsZUtleVByZXNzIiwia2V5RXZlbnQiLCJ3aGljaCIsInByb2dyZXNzUGVyY2VudCIsInBhcnNlRXZlbnRzIiwiZXZlbnRzIiwicGVyc29uYWxCZXN0Iiwib3ZlcmFsbEJlc3QiLCJzaG93QmVzdHMiLCJkYXRlIiwiY29udGludWVGaW5pc2hlZCIsImNvbmNsdWRlIiwiZ2V0QmVzdFRleHQiLCJiZXN0IiwiZnJvbU15c2VsZiIsImdldEZvcm1hdHRlZERhdGUiLCJEYXRlIiwicGFkIiwiZ2V0RGF0ZSIsImdldE1vbnRoIiwiZ2V0WWVhciIsInN0ciIsInBhZFZhbHVlIiwic2xpY2UiLCJyZXN0YXJ0UXVpeiIsInF1aXoiLCJlbnRlckxpc3RlbmVyIiwia2V5UHJlc3MiLCJmdW5jIiwiaGFzUXVpelN0YXJ0ZWQiLCJoYXNRdWl6RW5kZWQiLCJkaXNwb3NlIiwic3RhcnRRdWl6IiwiY2IiLCIkd2luZG93IiwibmV3VXNlciIsInJlZ2lzdGVyIiwiaXNWYWxpZCIsInZhbGlkYXRlQmVmb3JlU3VibWl0IiwicGFzc3dvcmQyIiwiZW1haWwiLCJBcHBDb25maWciLCJjb2xvcnMiLCJ1c2VyT2JqIiwiY29sb3IiLCJ1c2VyQ29sb3JzIiwibmV3Q29sb3IiLCJ1cGRhdGVVc2VyIiwidXBkYXRlQmFzaWMiLCJkaXJlY3RpdmUiLCIkcGFyc2UiLCIkZG9jdW1lbnQiLCJyZXN0cmljdCIsImxpbmsiLCJzY29wZSIsImVsZW1lbnQiLCJhdHRycyIsImNsaWNrT3V0c2lkZUhhbmRsZXIiLCJzdG9wUHJvcGFnYXRpb24iLCJ0YXJnZXRQYXJlbnRzIiwiJCIsInRhcmdldCIsInBhcmVudHMiLCJpbnNpZGUiLCJpbmRleCIsIm9uIiwib3V0c2lkZSIsImJpbmQiLCJ1bmJpbmQiLCJmaWx0ZXIiLCIkc2NlIiwidHJ1c3RBc0h0bWwiLCJmcmFjdGlvblNpemUiLCJpc05hTiIsImZhY3RvcnkiLCJBdXRoVG9rZW5TcnYiLCJhZGRUb2tlbiIsInRva2VuIiwiZ2V0VG9rZW4iLCJoZWFkZXJzIiwicmVxdWVzdCIsInN0b3JlIiwic2Vzc2lvblN0b3JhZ2UiLCJrZXkiLCJnZXRJdGVtIiwic2V0VG9rZW4iLCJzZXRJdGVtIiwicmVtb3ZlSXRlbSIsIlByb21pc2UiLCJnZXRVc2VyRnJvbVN0b3JhZ2UiLCJfdXNlciIsIiRodHRwIiwiSW5kZXhlZERCU3J2IiwiY291bnRyaWVzQnlBbHBoYTMiLCJkYXRhYmFzZSIsImtleUNvdW50cmllcyIsImtleVZlcnNpb24iLCJpbmRleGVkREJBdmFpbGFibGUiLCJsb2FkQ291bnRyaWVzIiwiY3JlYXRlRGF0YWJhc2UiLCJnZXRFbXB0eU9iamVjdCIsImdldEludGVybmFsVmVyc2lvbiIsImdldEV4dGVybmFsVmVyc2lvbiIsImRldGVybWluZUxvYWRTdHJhdGVneSIsImxvYWREYXRhIiwib2JqIiwidG9VcHBlckNhc2UiLCJmaXJzdExldHRlciIsIm5hbWUiLCJnZXRDb3VudHJpZXNGcm9tQVBJIiwic3RyYXRlZ3kiLCJpbnRlcm5hbFZlcnNpb24iLCJleHRlcm5hbFZlcnNpb24iLCJwdXRJdGVtIiwiZ2V0Q291bnRyaWVzRnJvbURCIiwiX29iaiIsInJldHJpZXZlSXRlbSIsIml0ZW0iLCJnZXRWZXJzaW9uRnJvbUFQSSIsInZlcnNpb24iLCJnZXQiLCIkdGltZW91dCIsInNlbGVjdG9yIiwicXVlcnlTZWxlY3RvciIsImZvY3VzIiwia2V5UGF0aCIsImluZGV4ZWREQiIsIndlYmtpdEluZGV4ZWREQiIsIm1zSW5kZXhlZERCIiwiSURCS2V5UmFuZ2UiLCJ3ZWJraXRJREJLZXlSYW5nZSIsIklEQlRyYW5zYWN0aW9uIiwid2Via2l0SURCVHJhbnNhY3Rpb24iLCJSRUFEX1dSSVRFIiwiUkVBRF9PTkxZIiwiZGJOYW1lIiwic3RvcmVOYW1lIiwib3BlbiIsIm9udXBncmFkZW5lZWRlZCIsImUiLCJpZGIiLCJyZXN1bHQiLCJjcmVhdGVPYmplY3RTdG9yZSIsIm9uc3VjY2VzcyIsIm9uZXJyb3IiLCJkcm9wRGF0YWJhc2UiLCJkZWxldGVEYXRhYmFzZSIsImFkZEl0ZW0iLCJ0cmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlIiwicmVxdWVzdEFkZCIsImFkZCIsInB1dCIsIml0ZW1OYW1lIiwicmFuZ2UiLCJvbmx5Iiwib3BlbkN1cnNvciIsImN1cnNvciIsInJldHJpZXZlSXRlbXMiLCJpdGVtcyIsImxvZ0luZm8iLCJsb2ciLCJhcHBseSIsImFyZ3VtZW50cyIsImxvZ0Vycm9yIiwiX2NvdW50cmllcyIsImNvdW50cmllc0xvYWRlZCIsImNyZWF0ZVF1aXoiLCJxdWl6VHlwZSIsImNyZWF0ZUNvdW50cnlRdWl6IiwiY291bnRyeVF1aXoiLCJmdWxsUG9pbnRzIiwiaGludE1heGltdW0iLCJoaW50Q29zdCIsImxhc3RRdWVzdGlvbkJvbnVzIiwicXVlc3Rpb25UeXBlcyIsInF1ZXN0aW9uVHlwZXNMZW5ndGgiLCJzZWxlY3RlZENvdW50cmllcyIsIm51bWJlck9mUXVlc3Rpb25zIiwiaSIsImNvdW50cnlPayIsInFjbnQiLCJxdWVzdGlvblR5cGUiLCJnZXRRdWVzdGlvblRleHQiLCJnZXRRdWVzdGlvbklucHV0IiwidW5pdCIsImdldFF1ZXN0aW9uVW5pdCIsImdldFF1ZXN0aW9uQW5zd2VyIiwiZ2V0Q2hlY2tBbnN3ZXJMYW1iZGEiLCJnZXRRdWVzdGlvbkhpbnRzIiwiYWxwaGEyQ29kZSIsInRvTG9jYWxlTG93ZXJDYXNlIiwiY2FwaXRhbCIsImFsdFNwZWxsaW5ncyIsImNvcnJlY3QiLCJhcmVhIiwiYm9udXMiLCJlcnJvclBlcmNlbnRhZ2UiLCJhYnMiLCJoaW50c1Bvc3NpYmxlIiwicHV0SGlnaHNjb3JlIiwic3VjY2VzcyIsImdldFVzZXJIaWdoc2NvcmUiLCJnZXRPdmVyYWxsSGlnaHNjb3JlIiwic2VsZiIsInBvc3QiLCJwYXNzIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxVQUFBQyxRQUFBQyxPQUFBLFlBQ0EsWUFDQSxhQUNBLGNDQ0ksZ0JEQUosU0FB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QUEsSUFBQWdTLFNBQUEsU0FBQS9MLEVBQUFQLEdBQ0F5TSxFQUFBNkQsSUFBQSxrQkFBQWhXLEdBQ0FpWixRQUFBLFNBQUFoWSxHQUNBZ0YsRUFBQWhGLEtBRUFELE1BQUEsU0FBQVgsR0FDQXFGLEVBQUFyRixRQUtBdUosRUFBQSxTQUFBMFAsR0FDQSxNQUFBLElBQUF0SCxTQUFBLFNBQUEvTCxFQUFBUCxHQUNBeU0sRUFBQTZELElBQUEscUJBQUFzRCxHQUNBTCxRQUFBLFNBQUFoWSxHQUNBZ0YsRUFBQWhGLEtBRUFELE1BQUEsU0FBQVgsR0FDQXFGLEVBQUFyRixPQUtBLFFBQ0FQLFFBQUFBLEVBQ0FtUyxtQkFBQUEsRUFDQS9JLE1BQUFBLEVBQ0FRLE9BQUFBLEVBQ0FrRixTQUFBQSxFQUNBWSxZQUFBQSxFQUNBNUYsZUFBQUEiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIG1hZ2VsbGFuID0gYW5ndWxhci5tb2R1bGUoXCJtYWdlbGxhblwiLCBbXHJcbiAgICAndWkucm91dGVyJyxcclxuICAgICduZ1Byb2dyZXNzJyxcclxuICAgICduZ0FuaW1hdGUnXHJcbl0sIGZ1bmN0aW9uIGNvbmZpZygkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBdXRoSW50ZXJjZXB0b3InKTtcclxufSk7XHJcblxyXG4vLyBkZWZpbmUgYXBwbGljYXRpb24gY29uc3RhbnRzXHJcbm1hZ2VsbGFuLmNvbnN0YW50KFwiQXBwQ29uZmlnXCIsIHtcclxuICAgIFwibG9nLmluZm9cIjogdHJ1ZSxcclxuICAgIFwibG9nLmVycm9yXCI6IHRydWUsXHJcblxyXG4gICAgXCJxdWl6LmNvdW50cnkucXVlc3Rpb25zXCI6IDMsXHJcbiAgICBcInF1aXouY291bnRyeS50eXBlc1wiOiB7XHJcbiAgICAgICAgMTogXCJDQVBJVEFMX09GX0NPVU5UUllcIixcclxuICAgICAgICAyOiBcIkNPVU5UUllfT0ZfQ0FQSVRBTFwiLFxyXG4gICAgICAgIDM6IFwiUE9QVUxBVElPTl9PRl9DT1VOVFJZXCIsXHJcbiAgICAgICAgNDogXCJBUkVBX09GX0NPVU5UUllcIixcclxuICAgICAgICA1OiBcIkZMQUdfT0ZfQ09VTlRSWVwiXHJcbiAgICB9LFxyXG5cclxuICAgIFwic2V0dGluZ3MudXNlci5jb2xvcnNcIjogW1xyXG4gICAgICAgICdzb2Z0X3JlZCcsXHJcbiAgICAgICAgJ3RodW5kZXJiaXJkJyxcclxuICAgICAgICAnb2xkX2JyaWNrJyxcclxuICAgICAgICAnbmV3X3lvcmtfcGluaycsXHJcbiAgICAgICAgJ3NudWZmJyxcclxuICAgICAgICAnaG9uZXlfZmxvd2VyJyxcclxuICAgICAgICAnc2FuX21hcmlubycsXHJcbiAgICAgICAgJ3NoYWtlc3BlYXJlJyxcclxuICAgICAgICAnbWluZycsXHJcbiAgICAgICAgJ2dvc3NpcCcsXHJcbiAgICAgICAgJ2V1Y2FseXB0dXMnLFxyXG4gICAgICAgICdtb3VudGFpbl9tZWFkb3cnLFxyXG4gICAgICAgICdqYWRlJyxcclxuICAgICAgICAnY29uZmV0dGknLFxyXG4gICAgICAgICdjYWxpZm9ybmlhJyxcclxuICAgICAgICAnYnVybnRfb3JhbmdlJyxcclxuICAgICAgICAnamFmZmEnLFxyXG4gICAgICAgICdnYWxsZXJ5JyxcclxuICAgICAgICAnZWR3YXJkJyxcclxuICAgICAgICAnbHluY2gnXHJcbiAgICBdXHJcbn0pO1xyXG5cclxubWFnZWxsYW4uY29udHJvbGxlcihcIkFwcEN0cmxcIiwgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkc3RhdGUsIEF1dGhTcnYsIFVzZXJTcnYsIENvdW50cnlTcnYsIFF1aXpTcnYpIHtcclxuICAgIC8vIC0tLS0tLS0tLS0tIEFwcCBjb25maWcgLS0tLS0tLS0tLS0tXHJcbiAgICAkc2NvcGUuYXBwID0ge1xyXG4gICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICB0aXRsZTogXCJNYWdlbGxhblwiLFxyXG4gICAgICAgICAgICBzdWJ0aXRsZTogXCJUZXN0ZSBkZWluIFdpc3NlbiDDvGJlciBkaWUgTMOkbmRlciB1bnNlcmVyIEVyZGVcIixcclxuICAgICAgICAgICAgYXV0aG9yOiBcIk1pY2hhZWwgU3RpZnRlclwiXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgaW5pdGlhbGl6YXRpb24gLS0tLS0tLS0tLS0tXHJcbiAgICBBdXRoU3J2LmdldFVzZXIoKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgLy8gc3RvcmUgdXNlciBvYmplY3QgaW4gc2NvcGVcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3VzZXIubG9hZGVkJyk7XHJcblxyXG4gICAgICAgICAgICAvLyBpbml0IGNvdW50cnkgc2VydmljZVxyXG4gICAgICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2NvdW50cmllcy5sb2FkZWQnLCBjb3VudHJpZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgIFF1aXpTcnYuc2V0Q291bnRyaWVzKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSBudWxsO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICRzY29wZS5pc1Byb2dyZXNzQmFyVmlzaWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiAkc3RhdGUuaXMoJ3F1aXonKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdvVG9Ib21lID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5nb1RvSG9tZSA9IGdvVG9Ib21lO1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEV2ZW50IGhhbmRsaW5nIC0tLS0tLS0tLS0tLVxyXG4gICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24oZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMsIGVycm9yKSB7XHJcbiAgICAgICAgaWYgKGVycm9yID09PSAnTm90IGF1dGhvcml6ZWQnKSB7XHJcbiAgICAgICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuJG9uKCdhcHAubG9naW4nLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHN0b3JlIHVzZXIgb2JqZWN0IGluIHNjb3BlXHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBkYXRhO1xyXG5cclxuICAgICAgICAvLyBhZGRpdGlvbmFsbHkgc2F2ZSBpdCBpbiBhdXRoIHNlcnZpY2VcclxuICAgICAgICBBdXRoU3J2LnNldFVzZXIoZGF0YSk7XHJcblxyXG4gICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgQ291bnRyeVNydi5pbml0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGNvdW50cmllcyBpbiBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgICAgIFF1aXpTcnYuc2V0Q291bnRyaWVzKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBnbyB0byBxdWl6IHBhZ2VcclxuICAgICAgICAkc3RhdGUuZ28oJ3F1aXonKTtcclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS4kb24oJ2FwcC5sb2dvdXQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHJlbW92ZSB1c2VyIG9iamVjdCBmcm9tIHNjb3BlXHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBhZGRpdGlvbmFsbHksIHJlbW92ZSBpdCBmcm9tIGF1dGggc2VydmljZVxyXG4gICAgICAgIEF1dGhTcnYuY2xlYXJVc2VyKCk7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfSk7XHJcbn0pOyIsInZhciBtYWdlbGxhbiA9IGFuZ3VsYXIubW9kdWxlKFwibWFnZWxsYW5cIiwgW1xyXG4gICAgJ3VpLnJvdXRlcicsXHJcbiAgICAnbmdQcm9ncmVzcycsXHJcbiAgICAnbmdBbmltYXRlJ1xyXG5dLCBbXCIkaHR0cFByb3ZpZGVyXCIsIGZ1bmN0aW9uIGNvbmZpZygkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBdXRoSW50ZXJjZXB0b3InKTtcclxufV0pO1xyXG5cclxuLy8gZGVmaW5lIGFwcGxpY2F0aW9uIGNvbnN0YW50c1xyXG5tYWdlbGxhbi5jb25zdGFudChcIkFwcENvbmZpZ1wiLCB7XHJcbiAgICBcImxvZy5pbmZvXCI6IHRydWUsXHJcbiAgICBcImxvZy5lcnJvclwiOiB0cnVlLFxyXG5cclxuICAgIFwicXVpei5jb3VudHJ5LnF1ZXN0aW9uc1wiOiAzLFxyXG4gICAgXCJxdWl6LmNvdW50cnkudHlwZXNcIjoge1xyXG4gICAgICAgIDE6IFwiQ0FQSVRBTF9PRl9DT1VOVFJZXCIsXHJcbiAgICAgICAgMjogXCJDT1VOVFJZX09GX0NBUElUQUxcIixcclxuICAgICAgICAzOiBcIlBPUFVMQVRJT05fT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDQ6IFwiQVJFQV9PRl9DT1VOVFJZXCIsXHJcbiAgICAgICAgNTogXCJGTEFHX09GX0NPVU5UUllcIlxyXG4gICAgfSxcclxuXHJcbiAgICBcInNldHRpbmdzLnVzZXIuY29sb3JzXCI6IFtcclxuICAgICAgICAnc29mdF9yZWQnLFxyXG4gICAgICAgICd0aHVuZGVyYmlyZCcsXHJcbiAgICAgICAgJ29sZF9icmljaycsXHJcbiAgICAgICAgJ25ld195b3JrX3BpbmsnLFxyXG4gICAgICAgICdzbnVmZicsXHJcbiAgICAgICAgJ2hvbmV5X2Zsb3dlcicsXHJcbiAgICAgICAgJ3Nhbl9tYXJpbm8nLFxyXG4gICAgICAgICdzaGFrZXNwZWFyZScsXHJcbiAgICAgICAgJ21pbmcnLFxyXG4gICAgICAgICdnb3NzaXAnLFxyXG4gICAgICAgICdldWNhbHlwdHVzJyxcclxuICAgICAgICAnbW91bnRhaW5fbWVhZG93JyxcclxuICAgICAgICAnamFkZScsXHJcbiAgICAgICAgJ2NvbmZldHRpJyxcclxuICAgICAgICAnY2FsaWZvcm5pYScsXHJcbiAgICAgICAgJ2J1cm50X29yYW5nZScsXHJcbiAgICAgICAgJ2phZmZhJyxcclxuICAgICAgICAnZ2FsbGVyeScsXHJcbiAgICAgICAgJ2Vkd2FyZCcsXHJcbiAgICAgICAgJ2x5bmNoJ1xyXG4gICAgXVxyXG59KTtcclxuXHJcbm1hZ2VsbGFuLmNvbnRyb2xsZXIoXCJBcHBDdHJsXCIsIFtcIiRyb290U2NvcGVcIiwgXCIkc2NvcGVcIiwgXCIkc3RhdGVcIiwgXCJBdXRoU3J2XCIsIFwiVXNlclNydlwiLCBcIkNvdW50cnlTcnZcIiwgXCJRdWl6U3J2XCIsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJHN0YXRlLCBBdXRoU3J2LCBVc2VyU3J2LCBDb3VudHJ5U3J2LCBRdWl6U3J2KSB7XHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgY29uZmlnIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLmFwcCA9IHtcclxuICAgICAgICBjb25maWc6IHtcclxuICAgICAgICAgICAgdGl0bGU6IFwiTWFnZWxsYW5cIixcclxuICAgICAgICAgICAgc3VidGl0bGU6IFwiVGVzdGUgZGVpbiBXaXNzZW4gw7xiZXIgZGllIEzDpG5kZXIgdW5zZXJlciBFcmRlXCIsXHJcbiAgICAgICAgICAgIGF1dGhvcjogXCJNaWNoYWVsIFN0aWZ0ZXJcIlxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGluaXRpYWxpemF0aW9uIC0tLS0tLS0tLS0tLVxyXG4gICAgQXV0aFNydi5nZXRVc2VyKClcclxuICAgICAgICAudGhlbihmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICAgIC8vIHN0b3JlIHVzZXIgb2JqZWN0IGluIHNjb3BlXHJcbiAgICAgICAgICAgICRzY29wZS51c2VyID0gdXNlcjtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCd1c2VyLmxvYWRlZCcpO1xyXG5cclxuICAgICAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICAgICAgQ291bnRyeVNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGNvdW50cmllcyBpbiBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICBRdWl6U3J2LnNldENvdW50cmllcyhjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICRzY29wZS51c2VyID0gbnVsbDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuaXNQcm9ncmVzc0JhclZpc2libGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gJHN0YXRlLmlzKCdxdWl6Jyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnb1RvSG9tZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfTtcclxuXHJcbiAgICAkc2NvcGUuZ29Ub0hvbWUgPSBnb1RvSG9tZTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBFdmVudCBoYW5kbGluZyAtLS0tLS0tLS0tLS1cclxuICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VFcnJvcicsIGZ1bmN0aW9uKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zLCBlcnJvcikge1xyXG4gICAgICAgIGlmIChlcnJvciA9PT0gJ05vdCBhdXRob3JpemVkJykge1xyXG4gICAgICAgICAgICAvLyBnbyB0byBob21lIHBhZ2VcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ2luJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcclxuXHJcbiAgICAgICAgLy8gYWRkaXRpb25hbGx5IHNhdmUgaXQgaW4gYXV0aCBzZXJ2aWNlXHJcbiAgICAgICAgQXV0aFNydi5zZXRVc2VyKGRhdGEpO1xyXG5cclxuICAgICAgICAvLyBpbml0IGNvdW50cnkgc2VydmljZVxyXG4gICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2NvdW50cmllcy5sb2FkZWQnLCBjb3VudHJpZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICBRdWl6U3J2LnNldENvdW50cmllcyhjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gZ28gdG8gcXVpeiBwYWdlXHJcbiAgICAgICAgJHN0YXRlLmdvKCdxdWl6Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuJG9uKCdhcHAubG9nb3V0JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyByZW1vdmUgdXNlciBvYmplY3QgZnJvbSBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gYWRkaXRpb25hbGx5LCByZW1vdmUgaXQgZnJvbSBhdXRoIHNlcnZpY2VcclxuICAgICAgICBBdXRoU3J2LmNsZWFyVXNlcigpO1xyXG5cclxuICAgICAgICAvLyBnbyB0byBob21lIHBhZ2VcclxuICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgIH0pO1xyXG59XSk7XG4vLyBvd24gY2xhc3NlcyBhbmQgZnVuY3Rpb25zXHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVSVogLS0tLS0tLS0tLVxyXG52YXIgUXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gaW5kZXggb2YgY3VycmVudCBxdWVzdGlvblxyXG4gICAgdmFyIGN1cnJlbnRRdWVzdGlvbklkeCA9IG51bGw7XHJcblxyXG4gICAgLy8gYXJyYXkgY29udGFpbmluZyBhbGwgcXVlc3Rpb25zXHJcbiAgICB2YXIgcXVlc3Rpb25zID0gW107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdGFydHMgdGhlIHF1aXouXHJcbiAgICAgKi9cclxuICAgIHRoaXMuc3RhcnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBjaGVjayBpZiBxdWl6IGhhcyBxdWVzdGlvbnNcclxuICAgICAgICBpZiAocXVlc3Rpb25zLmxlbmd0aCA8PSAwKVxyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIkNhbm5vdCBzdGFydCBhIHF1aXogd2l0aG91dCBxdWVzdGlvbnNcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLm5leHRRdWVzdGlvbigpO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmlzQWN0aXZlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzU3RhcnRlZCgpICYmICF0aGlzLmhhc0VuZGVkKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaGFzU3RhcnRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBjdXJyZW50UXVlc3Rpb25JZHggIT09IG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaGFzRW5kZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNTdGFydGVkKCkgJiYgY3VycmVudFF1ZXN0aW9uSWR4ID49IHF1ZXN0aW9ucy5sZW5ndGg7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuc3VibWl0dGVkID0gZmFsc2U7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IHF1ZXN0aW9uIHRvIHRoZSBxdWl6LlxyXG4gICAgICogVGhlIHBhcmFtZXRlciBtdXN0IGJlIGFuIHF1ZXN0aW9uIG9iamVjdC5cclxuICAgICAqIElmIG5vIHF1ZXN0aW9uIG9iamVjdCBpcyBwYXNzZWQgb3IgYW4gb2JqZWN0IHdpdGggbWlzc2luZyBwcm9wZXJ0aWVzLCBhbiBlcnJvciBpcyB0aHJvd24uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYWRkUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgIGlmIChxdWVzdGlvbiA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIk5vIHF1ZXN0aW9uIG9iamVjdCBwYXNzZWRcIik7XHJcblxyXG4gICAgICAgIHZhciB2YWxpZCA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGEgcXVlc3Rpb24gb2JqZWN0IG11c3QgY29udGFpbiBhbGwgdGhlc2UgcHJvcGVydGllc1xyXG4gICAgICAgIHZhciBuZWNlc3NhcnlQcm9wZXJ0aWVzID0gWydjb25maWcnLCAnaGludCcsICdzb2x1dGlvbicsICdhbnN3ZXInLCAncXVlc3Rpb24nLCAnZ2V0SW5mbycsICdpbmZvJywgJ3BvaW50cycsICdhbnN3ZXJlZCcsICdoaW50c0FsbG93ZWQnLCAnaGludHNSZW1haW5pbmcnXTtcclxuXHJcbiAgICAgICAgbmVjZXNzYXJ5UHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIGlmICghcXVlc3Rpb24uaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUXVlc3Rpb24gbXVzdCBoYXZlIHByb3BlcnR5ICdcIiArIHByb3BlcnR5ICsgXCInXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh2YWxpZCkge1xyXG4gICAgICAgICAgICBxdWVzdGlvbnMucHVzaChxdWVzdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG5leHQgcXVlc3Rpb24gb2YgdGhlIHF1aXouXHJcbiAgICAgKiBJZiB0aGUgcXVpeiBoYXMgZW5kZWQsIGl0IHJldHVybnMgbm90aGluZy5cclxuICAgICAqL1xyXG4gICAgdGhpcy5uZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uSWR4ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbklkeCA9IDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSWR4Kys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnNbY3VycmVudFF1ZXN0aW9uSWR4XTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5jdXJyZW50UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNBY3RpdmUoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnNbY3VycmVudFF1ZXN0aW9uSWR4XTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzU3RhcnRlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHRvdGFsUG9pbnRzID0gMDtcclxuXHJcbiAgICAgICAgcXVlc3Rpb25zLmZvckVhY2goZnVuY3Rpb24ocXVlc3Rpb24pIHtcclxuICAgICAgICAgICAgdmFyIHBvaW50cyA9IHF1ZXN0aW9uLnBvaW50cygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHBvaW50cyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0b3RhbFBvaW50cyArPSBwb2ludHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRvdGFsUG9pbnRzO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChjdXJyZW50UXVlc3Rpb25JZHggPT09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICByZXR1cm4gY3VycmVudFF1ZXN0aW9uSWR4ICsgMTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXROdW1iZXJPZlF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnMubGVuZ3RoO1xyXG4gICAgfTtcclxufTtcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVFU1RJT04gLS0tLS0tLS0tLVxyXG52YXIgUXVlc3Rpb24gPSBmdW5jdGlvbihvcHRpb25zKSB7XHJcbiAgICAvLyBUZXh0IG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIHRleHQgPSBudWxsO1xyXG5cclxuICAgIC8vIEluZm8gb2JqZWN0IGZvciB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBpbmZvID0gbnVsbDtcclxuXHJcbiAgICAvLyBBbnN3ZXIgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgYW5zd2VyID0gbnVsbDtcclxuXHJcbiAgICAvLyBIaW50cyBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBoaW50cyA9IG51bGw7XHJcbiAgICB2YXIgaGludHNVc2VkID0gMDtcclxuXHJcbiAgICAvLyBMYW1iZGEgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIHRoZSBhbnN3ZXIgc3RhdHVzIG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGNoZWNrQW5zd2VyID0gbnVsbDtcclxuXHJcbiAgICAvLyBQb2ludHMgYXdhcmRlZCBmb3IgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgcG9pbnRzID0gbnVsbDtcclxuXHJcbiAgICAvLyBGbGFnIGluZGljYXRpbmcgd2hldGhlciBxdWVzdGlvbiBoYXMgYWxyZWFkeSBiZWVuIGFuc3dlcmVkXHJcbiAgICB2YXIgYW5zd2VyZWQgPSBmYWxzZTtcclxuXHJcbiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKG9wdHMpIHtcclxuICAgICAgICB0ZXh0ID0gb3B0cy50ZXh0O1xyXG4gICAgICAgIGluZm8gPSBvcHRzLmluZm8gfHwge307XHJcbiAgICAgICAgYW5zd2VyID0gb3B0cy5hbnN3ZXI7XHJcbiAgICAgICAgY2hlY2tBbnN3ZXIgPSBvcHRzLmNoZWNrQW5zd2VyIHx8IG51bGw7XHJcblxyXG4gICAgICAgIGhpbnRzID0gb3B0cy5oaW50cyB8fCB7XHJcbiAgICAgICAgICAgICAgICBhbGxvd2VkOiBmYWxzZSwgICAgIC8vIGlzIGEgaGludCBhbGxvd2VkP1xyXG4gICAgICAgICAgICAgICAgbWF4aW11bTogMCwgICAgICAgICAvLyBtYXhpbXVtIG51bWJlciBvZiBoaW50cyBmb3IgdGhpcyBxdWVzdGlvbiAoaXJyZWxldmFudCBpZiBhbGxvd2VkIGlzIHNldCB0byBmYWxzZSlcclxuICAgICAgICAgICAgICAgIGNvc3Q6IDAsICAgICAgICAgICAgLy8gbnVtYmVyIG9mIHBvaW50cyBzdWJ0cmFjdGVkIHBlciB1c2VkIGhpbnQgKGlycmVsZXZhbnQgaWYgYWxsb3dlZCBpcyBzZXQgdG8gZmFsc2UpXHJcbiAgICAgICAgICAgICAgICBnaXZlOiBudWxsICAgICAgICAgIC8vIGxhbWJkYSBmdW5jdGlvbiB0byBnaXZlIGEgaGludCBmb3IgYSBxdWVzdGlvblxyXG4gICAgICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICAgIGluaXQob3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jb25maWcgPSBmdW5jdGlvbihvcHRzKSB7XHJcbiAgICAgICAgaW5pdChvcHRzKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBxdWVzdGlvbiB0ZXh0LlxyXG4gICAgICovXHJcbiAgICB0aGlzLnF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgcXVlc3Rpb24gaW5mbyBvYmplY3QuXHJcbiAgICAgKiBBY3RzIGFzIGdldHRlciAod2l0aCBvbmx5IG9uZSBhcmd1bWVudCkgYW5kIHNldHRlciAod2l0aCB0d28gYXJndW1lbnRzKVxyXG4gICAgICovXHJcbiAgICB0aGlzLmluZm8gPSBmdW5jdGlvbihwcm9wLCB2YWx1ZSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIC8vIHNldHRlclxyXG4gICAgICAgICAgICBpbmZvW3Byb3BdID0gdmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gZ2V0dGVyXHJcbiAgICAgICAgICAgIHJldHVybiBpbmZvW3Byb3BdO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBlbnRpcmUgaW5mbyBvYmplY3QuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuZ2V0SW5mbyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBpbmZvO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIGNvcnJlY3QgYW5zd2VyIHRvIHRoZSBxdWVzdGlvbiBhZnRlciB0aGUgcXVlc3Rpb24gaGFzIGJlZW4gYW5zd2VyZWQuXHJcbiAgICAgKiBJZiB0aGUgcXVlc3Rpb24gaGFzIG5vdCBiZWVuIGFuc3dlcmVkIHlldCwgaXQgcmV0dXJucyBudWxsLlxyXG4gICAgICovXHJcbiAgICB0aGlzLnNvbHV0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGFuc3dlcmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGEgaGludCBmb3IgdGhlIHF1ZXN0aW9uLlxyXG4gICAgICogSWYgbm8gaGludHMgYXJlIGFsbG93ZWQsIG9yIHRoZSBtYXhpbXVtIG51bWJlciBvZiBoaW50cyBoYXZlIGJlZW4gdXNlZCwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCFoaW50cy5hbGxvd2VkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGhpbnRzLmFsbG93ZWQgJiYgIWhpbnRzLmdpdmUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGludHMgYWxsb3dlZCBidXQgbm8gZ2l2ZSBtZXRob2QgcGFzc2VkXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGhpbnRzVXNlZCA8IGhpbnRzLm1heGltdW0pIHtcclxuICAgICAgICAgICAgaGludHNVc2VkKys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gaGludHMuZ2l2ZShoaW50c1VzZWQsIGFuc3dlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3VibWl0cyBhbiBhbnN3ZXIgdG8gdGhlIHF1ZXN0aW9uLlxyXG4gICAgICogSWYgdGhlIHF1ZXN0aW9uIGhhcyBhbHJlYWR5IGJlZW4gYW5zd2VyZWQgb3Igbm8gY2hlY2tBbnN3ZXIgbGFtYmRhIGhhcyBiZWVuIHNldCwgdGhpcyBtZXRob2QgZG9lcyBub3RoaW5nLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmFuc3dlciA9IGZ1bmN0aW9uKHN1Ym1pdHRlZEFuc3dlcikge1xyXG4gICAgICAgIGlmIChhbnN3ZXJlZCB8fCFjaGVja0Fuc3dlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhbnN3ZXJlZCA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGNoZWNrQW5zd2VyIG1ldGhvZCBzaG91bGQgcmV0dXJuIHRoZSBzdGF0dXMgcmVzdWx0c1xyXG4gICAgICAgIHBvaW50cyA9IGNoZWNrQW5zd2VyKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBoaW50c1VzZWQsIGhpbnRzLmNvc3QsIGluZm8pO1xyXG5cclxuICAgICAgICAvLyBlbnN1cmUgdGhhdCBubyBuZWdhdGl2ZSBwb2ludHMgYXJlIGF3YXJkZWRcclxuICAgICAgICBwb2ludHMgPSBNYXRoLm1heCgwLCBwb2ludHMpO1xyXG5cclxuICAgICAgICAvLyBlbnN1cmUgdGhhdCBvbmx5IGludGVnZXIgdmFsdWVzIGFyZSBzYXZlZFxyXG4gICAgICAgIHBvaW50cyA9IE1hdGguZmxvb3IocG9pbnRzKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5wb2ludHMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoIWFuc3dlcmVkIHx8IHBvaW50cyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgc3RhdGUgb2YgdGhlIHF1ZXN0aW9uLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGFuc3dlcmVkO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiBoaW50cyBhcmUgYWxsb3dlZCBmb3IgdGhpcyBxdWVzdGlvbiwgZmFsc2UgaWYgbm90LlxyXG4gICAgICogSWYgaGludHMgaGF2ZSBub3QgYmVlbiBpbml0aWFsaXplZCB5ZXQsIG51bGwgaXMgcmV0dXJuZWQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaGludHNBbGxvd2VkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGhpbnRzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBoaW50cy5hbGxvd2VkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHJlbWFpbmluZyBoaW50cy5cclxuICAgICAqIElmIG5vIGhpbnRzIGFyZSBhbGxvd2VkIGZvciB0aGlzIHF1ZXN0aW9uLCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmhpbnRzUmVtYWluaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGFsbG93ZWQgPSB0aGlzLmhpbnRzQWxsb3dlZCgpO1xyXG5cclxuICAgICAgICBpZiAoYWxsb3dlZCA9PT0gbnVsbCB8fCBhbGxvd2VkID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBoaW50cy5tYXhpbXVtIC0gaGludHNVc2VkO1xyXG4gICAgfTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gKGluY2x1c2l2ZSkgYW5kIG1heCAoaW5jbHVzaXZlKVxyXG4gKiBVc2luZyBNYXRoLnJvdW5kKCkgd2lsbCBnaXZlIHlvdSBhIG5vbi11bmlmb3JtIGRpc3RyaWJ1dGlvbiFcclxuICovXHJcbnZhciBnZXRSYW5kb21JbnQgPSBmdW5jdGlvbihtaW4sIG1heCkge1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyB0aGUgdGV4dCBiZXR3ZWVuIHR3byBkZWxpbWl0aW5nIHRleHQgb2NjdXJyZW5jZXNcclxuICovXHJcbnZhciBnZXRTdHJpbmdCZXR3ZWVuID0gZnVuY3Rpb24odGV4dCwgZmlyc3RTdHJpbmcsIHNlY29uZFN0cmluZykge1xyXG4gICAgdmFyIGZpcnN0UG9zID0gdGV4dC5pbmRleE9mKGZpcnN0U3RyaW5nKTtcclxuICAgIHZhciBzZWNvbmRQb3MgPSB0ZXh0LmluZGV4T2Yoc2Vjb25kU3RyaW5nKTtcclxuXHJcbiAgICBpZiAoZmlyc3RQb3MgPj0gMCAmJiBzZWNvbmRQb3MgPj0gMCAmJiBzZWNvbmRQb3MgPiBmaXJzdFBvcykge1xyXG4gICAgICAgIHJldHVybiB0ZXh0LnN1YnN0cihmaXJzdFBvcyArIDEsIHNlY29uZFBvcyAtIGZpcnN0UG9zIC0gMSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn07XHJcblxyXG5pZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcclxuICAgIG1vZHVsZS5leHBvcnRzLlF1ZXN0aW9uID0gUXVlc3Rpb247XHJcbiAgICBtb2R1bGUuZXhwb3J0cy5RdWl6ID0gUXVpejtcclxufVxuYW5ndWxhci5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb25maWcoW1wiJGxvY2F0aW9uUHJvdmlkZXJcIiwgXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAgICAgIC8vIGVuYWJsZSBIVE1MNSBwdXNoc3RhdGVcclxuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcblxyXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9ob21lJyk7XHJcblxyXG4gICAgICAgIHZhciBhdXRob3JpemUgPSBmdW5jdGlvbihBdXRoU3J2LCBMb2dTcnYsICRxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBBdXRoU3J2LmdldFVzZXIoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KCdOb3QgYXV0aG9yaXplZCcpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBhdXRob3JpemUuJGluamVjdCA9IFtcIkF1dGhTcnZcIiwgXCJMb2dTcnZcIiwgXCIkcVwiXTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hvbWUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvaG9tZS5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncXVpeicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9xdWl6JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3F1aXoucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdjb3VudHJpZXMnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvY291bnRyaWVzJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2NvdW50cmllcy5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2NvdW50cmllcy5kZXRhaWwnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvOmFscGhhM0NvZGUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvY291bnRyaWVzLWRldGFpbC5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2xvZ2luLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9nb3V0JyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dvdXRDdHJsJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3JlZ2lzdGVyLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdzZXR0aW5ncycsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9zZXR0aW5ncycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9zZXR0aW5ncy5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3Bhc3N3b3JkJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3Bhc3N3b3JkJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3Bhc3N3b3JkLnBhcnRpYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogYXV0aG9yaXplXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnYWJvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvYWJvdXQnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvYWJvdXQucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hpZ2hzY29yZScsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9oaWdoc2NvcmUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvaGlnaHNjb3JlLnBhcnRpYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogYXV0aG9yaXplXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnZmFxJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2ZhcScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9mYXEucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdjb3VudHJpZXMtZGlmZmljdWx0eScsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9jb3VudHJpZXMtZGlmZmljdWx0eScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9jb3VudHJ5LWRpZmZpY3VsdHkucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdDb3VudHJpZXNDdHJsJywgW1wiJHNjb3BlXCIsIFwiQ291bnRyeVNydlwiLCBmdW5jdGlvbigkc2NvcGUsIENvdW50cnlTcnYpIHtcclxuICAgICAgICB2YXIgY291bnRyaWVzQnlMZXR0ZXIgPSBudWxsO1xyXG4gICAgICAgIHZhciBjb3VudHJ5S2V5cyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyID0gQ291bnRyeVNydi5nZXRDb3VudHJpZXNCeUxldHRlcigpO1xyXG4gICAgICAgICAgICBjb3VudHJ5S2V5cyA9IE9iamVjdC5rZXlzKGNvdW50cmllc0J5TGV0dGVyKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghJHNjb3BlLiQkcGhhc2UpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cnlLZXlzID0gY291bnRyeUtleXM7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cmllc0J5TGV0dGVyID0gY291bnRyaWVzQnlMZXR0ZXI7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJ5S2V5cyA9IGNvdW50cnlLZXlzO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cmllc0J5TGV0dGVyID0gY291bnRyaWVzQnlMZXR0ZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoQ291bnRyeVNydi5hcmVDb3VudHJpZXNMb2FkZWQoKSkge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdjb3VudHJpZXMubG9hZGVkJywgZnVuY3Rpb24oKSAge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignQ291bnRyeURldGFpbEN0cmwnLCBbXCIkc2NvcGVcIiwgXCJDb3VudHJ5U3J2XCIsIFwiJHN0YXRlUGFyYW1zXCIsIGZ1bmN0aW9uKCRzY29wZSwgQ291bnRyeVNydiwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAgICAgdmFyIGFscGhhM0NvZGUgPSAkc3RhdGVQYXJhbXMuYWxwaGEzQ29kZTtcclxuXHJcbiAgICAgICAgaWYgKENvdW50cnlTcnYuYXJlQ291bnRyaWVzTG9hZGVkKCkpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmNvdW50cnkgPSBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTNDb2RlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ2NvdW50cmllcy5sb2FkZWQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJ5ID0gQ291bnRyeVNydi5nZXRDb3VudHJ5QnlBbHBoYTMoYWxwaGEzQ29kZSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJ5RnJvbVNlcnZpY2UgPSBmdW5jdGlvbihhbHBoYTMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhMyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmdldENvdW50cnlGcm9tU2VydmljZSA9IGdldENvdW50cnlGcm9tU2VydmljZTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdDb3VudHJ5RGlmZmljdWx0eUN0cmwnLCBbXCIkc2NvcGVcIiwgXCJDb3VudHJ5U3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgQ291bnRyeVNydikge1xyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBjb3VudHJpZXMgPSBDb3VudHJ5U3J2LmdldENvdW50cmllcygpO1xyXG4gICAgICAgICAgICB2YXIgZGlmZmljdWx0aWVzID0ge1xyXG4gICAgICAgICAgICAgICAgJ2Vhc3knOiBbXSxcclxuICAgICAgICAgICAgICAgICdtZWRpdW0nOiBbXSxcclxuICAgICAgICAgICAgICAgICdoYXJkJzogW10sXHJcbiAgICAgICAgICAgICAgICAndW5hc3NpZ25lZCc6IFtdXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvLyBkZXRlcm1pbmUgZGlmZmljdWx0eVxyXG4gICAgICAgICAgICBjb3VudHJpZXMuc29ydChmdW5jdGlvbihhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYi5wb3B1bGF0aW9uIC0gYS5wb3B1bGF0aW9uO1xyXG4gICAgICAgICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uKGMpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgZGlmZmljdWx0aWVzW2MuZGlmZmljdWx0eV0ucHVzaChjKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLiQkcGhhc2UpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kaWZmaWN1bHRpZXMgPSBkaWZmaWN1bHRpZXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGlmZmljdWx0eUtleXMgPSBPYmplY3Qua2V5cyhkaWZmaWN1bHRpZXMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlmZmljdWx0aWVzID0gZGlmZmljdWx0aWVzO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kaWZmaWN1bHR5S2V5cyA9IE9iamVjdC5rZXlzKGRpZmZpY3VsdGllcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmIChDb3VudHJ5U3J2LmFyZUNvdW50cmllc0xvYWRlZCgpKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ2NvdW50cmllcy5sb2FkZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignRHJvcGRvd25DdHJsJywgW1wiJHNjb3BlXCIsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG4gICAgICAgIHZhciB2aXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICRzY29wZS50b2dnbGVEcm9wZG93biA9IHRvZ2dsZURyb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5zaG93RHJvcGRvd24gPSBzaG93RHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmhpZGVEcm9wZG93biA9IGhpZGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuaXNEcm9wZG93blZpc2libGUgPSBpc0Ryb3Bkb3duVmlzaWJsZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignY2xpY2sub3V0c2lkZScsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChpc0Ryb3Bkb3duVmlzaWJsZSgpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLiQkcGhhc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBoaWRlRHJvcGRvd24oKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGlkZURyb3Bkb3duKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSAhdmlzaWJsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dEcm9wZG93bigpIHtcclxuICAgICAgICAgICAgdmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoaWRlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzRHJvcGRvd25WaXNpYmxlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmlzaWJsZTtcclxuICAgICAgICB9XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignSGlnaHNjb3JlQ3RybCcsIFtcIiRzY29wZVwiLCBcIlNjb3JlU3J2XCIsIFwiTG9nU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgU2NvcmVTcnYsIExvZ1Nydikge1xyXG4gICAgICAgICRzY29wZS5zY29yZUxpc3QgPSBbXTtcclxuXHJcbiAgICAgICAgU2NvcmVTcnYuZ2V0SGlnaHNjb3JlTGlzdCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zY29yZUxpc3QgPSBjcmVhdGVSYW5raW5nKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2NvcmVMaXN0ID0gY3JlYXRlUmFua2luZyhsaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgaXNNeXNlbGYgPSBmdW5jdGlvbihpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnVzZXIuX2lkID09PSBpZDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlUmFua2luZyA9IGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgdmFyIHJhbmsgPSAwO1xyXG5cclxuICAgICAgICAgICAgdmFyIHByZXZpb3VzU2NvcmUgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGVudHJ5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXByZXZpb3VzU2NvcmUgfHwgZW50cnkuc2NvcmUgIT09IHByZXZpb3VzU2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICByYW5rKys7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGVudHJ5LnJhbmsgPSByYW5rICsgJy4nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHByZXZpb3VzU2NvcmUgPSBlbnRyeS5zY29yZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbGlzdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuaXNNeXNlbGYgPSBpc015c2VsZjtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdIb21lQ3RybCcsIFtcIiRzY29wZVwiLCBcIkxvZ1NydlwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBmdW5jdGlvbigkc2NvcGUsIExvZ1NydiwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBjaGVjayBzdGF0ZSBwYXJhbXNcclxuICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLmFjdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgYWN0aW9uID0gJHN0YXRlUGFyYW1zLmFjdGlvbjtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdyZWdpc3Rlci5zdWNjZXNzZnVsJzpcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnR3JhdHVsYXRpb24hIERpZSBBbm1lbGR1bmcgd2FyIGVyZm9sZ3JlaWNoLiBIZXJ6bGljaCB3aWxsa29tbWVuIGJlaSBNYWdlbGxhbi4nXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTG9naW5DdHJsJywgW1wiJHNjb3BlXCIsIFwiVXNlclNydlwiLCBcIkZvY3VzU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICBVc2VyU3J2LmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dpbiBldmVudFxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ2luJywgcmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLnN0YXR1cyA9PT0gNDAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0ZhbHNjaGVyIEJlbnV0emVybmFtZSBvZGVyIFBhc3N3b3J0JztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdCZWltIEVpbmxvZ2dlbiBzY2hlaW50IGV0d2FzIHNjaGllZiBnZWdhbmdlbiB6dSBzZWluJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCcjdXNlcm5hbWUnKTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdMb2dvdXRDdHJsJywgW1wiJHNjb3BlXCIsIFwiVXNlclNydlwiLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTcnYpIHtcclxuICAgICAgICBVc2VyU3J2LmxvZ291dCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcGxpY2F0aW9uIGNvbnRyb2wgYWJvdXQgbG9nb3V0IGV2ZW50XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dvdXQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUGFzc3dvcmRDdHJsJywgW1wiJHNjb3BlXCIsIFwiVXNlclNydlwiLCBcIkxvZ1NydlwiLCBcIkZvY3VzU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgTG9nU3J2LCBGb2N1c1Nydikge1xyXG4gICAgICAgICRzY29wZS5wYXNzT2JqID0ge307XHJcbiAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7fTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZVBhc3N3b3JkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghJHNjb3BlLnBhc3NPYmoub2xkIHx8ICEkc2NvcGUucGFzc09iai5uZXcgfHwgISRzY29wZS5wYXNzT2JqLmNvbmZpcm1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnQWxsZSBGZWxkZXIgbcO8c3NlbiBhdXNnZWbDvGxsdCBzZWluJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnBhc3NPYmoubmV3ICE9PSAkc2NvcGUucGFzc09iai5jb25maXJtYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0RpZSBQYXNzd8O2cnRlciBzdGltbWVuIG5pY2h0IMO8YmVyZWluJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBVc2VyU3J2LnVwZGF0ZVBhc3N3b3JkKHtcclxuICAgICAgICAgICAgICAgIG9sZDogJHNjb3BlLnBhc3NPYmoub2xkLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICRzY29wZS5wYXNzT2JqLm5ld1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ3N1Y2Nlc3MnLCAnRGFzIG5ldWUgUGFzc3dvcnQgd3VyZGUgZXJmb2xncmVpY2ggZ2VzcGVpY2hlcnQnKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyLm1lc3NhZ2UgPT09IFwiT2xkIHBhc3N3b3JkIGluY29ycmVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnRGFzIGFsdGUgUGFzc3dvcnQgaXN0IG5pY2h0IGtvcnJla3QnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnRGFzIG5ldWUgUGFzc3dvcnQga29ubnRlIG5pY2h0IGdlc3BlaWNoZXJ0IHdlcmRlbicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGVsZWdhdGVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdXBkYXRlUGFzc3dvcmQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0TWVzc2FnZSA9IGZ1bmN0aW9uKHR5cGUsIHRleHQpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBGb2N1c1NydignI3Bhc3N3b3JkLWN1cnJlbnQnKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnVwZGF0ZVBhc3N3b3JkID0gdXBkYXRlUGFzc3dvcmQ7XHJcbiAgICAgICAgJHNjb3BlLmRlbGVnYXRlU3VibWl0ID0gZGVsZWdhdGVTdWJtaXQ7XHJcbiAgICB9XSk7XG5cclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1F1aXpEaXJlY3RpdmVDb250cm9sbGVyJywgW1wiJHNjb3BlXCIsIFwiUXVpelNydlwiLCBcIkxvZ1NydlwiLCBcIkZvY3VzU3J2XCIsIFwibmdQcm9ncmVzc0ZhY3RvcnlcIiwgXCIkZmlsdGVyXCIsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2LCBGb2N1c1NydiwgbmdQcm9ncmVzc0ZhY3RvcnksICRmaWx0ZXIpIHtcclxuICAgICAgICB2YXIgcXVlc3Rpb247XHJcblxyXG4gICAgICAgIHZhciBpbml0Q3RybCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBQcm9ncmVzcyBiYXIgaW5pdGlhbGl6YXRpb25cclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyID0gbmdQcm9ncmVzc0ZhY3RvcnkuY3JlYXRlSW5zdGFuY2UoKTtcclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldFBhcmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1wcm9ncmVzcycpKTtcclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldEFic29sdXRlKCk7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRDb2xvcihcIiMzMzZlN2JcIik7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmFjaGlldmVtZW50cyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUuYmVzdHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dCA9IHt9O1xyXG4gICAgICAgICAgICAkc2NvcGUuaGludCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAvLyBhZGQgb3B0aW9ucyBmb3IgbXVsdGlwbGllciBzZWxlY3Rpb25cclxuICAgICAgICAgICAgJHNjb3BlLm11bHRpcGxpZXJPcHRpb25zID0gW1xyXG4gICAgICAgICAgICAgICAgeyB2YWx1ZTogMSwgbGFiZWw6ICcnIH0sXHJcbiAgICAgICAgICAgICAgICB7IHZhbHVlOiAxMDAwLCBsYWJlbDogJ1RzZC4nfSxcclxuICAgICAgICAgICAgICAgIHsgdmFsdWU6IDEwMDAwMDAsIGxhYmVsOiAnTWlvLid9XHJcbiAgICAgICAgICAgIF07XHJcblxyXG4gICAgICAgICAgICBxdWVzdGlvbiA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZVVpID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIGdldCBjdXJyZW50IHF1ZXN0aW9uIGZyb20gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgIHF1ZXN0aW9uID0gUXVpelNydi5nZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGRlbGV0ZSBwcmV2aW91cyBoaW50c1xyXG4gICAgICAgICAgICAkc2NvcGUuaGludCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBpZiAocXVlc3Rpb24gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vIG11bHRpcGxpZXJzIGZvciBxdWVzdGlvbnMgY29udGFpbmluZyBudW1iZXJzXHJcbiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0ICYmIHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dC5pbmRleE9mKCdudW1iZXInKSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlci5oaWdoJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyID0geyB2YWx1ZTogMTAwMDAwMCwgbGFiZWw6ICdNaW8uJ307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlci5tZWRpdW0nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIgPSB7IHZhbHVlOiAxMDAwLCBsYWJlbDogJ1RzZC4nfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyID0geyB2YWx1ZTogMSwgbGFiZWw6ICcnIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgcHJvZ3Jlc3MgYmFyXHJcbiAgICAgICAgICAgICAgICB1cGRhdGVQcm9ncmVzc0JhcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGZvY3VzIGFuc3dlciBpbnB1dFxyXG4gICAgICAgICAgICAgICAgRm9jdXNTcnYoJy5hbnN3ZXJJbnB1dCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gcXVpeiBoYXMgZW5kZWQsIHNldCBwcm9ncmVzcyBiYXIgdG8gMFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldCgwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb247XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZW5kZXJRdWVzdGlvblRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlbmRlcihnZXRRdWVzdGlvbigpLnF1ZXN0aW9uKCksICdxdWVzdGlvbi1oaWdobGlnaHQnKSArICc/JztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25NZWRpYSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIXF1ZXN0aW9uIHx8ICFxdWVzdGlvbi5nZXRJbmZvKCkubWVkaWEpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5nZXRJbmZvKCkubWVkaWE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNob3dSZXN1bHRzUGFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoaWRlUmVzdWx0c1BhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzUmVzdWx0c1BhZ2VWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoaW50c0F2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVlc3Rpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmhpbnRzUmVtYWluaW5nKCkgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmhpbnRzUmVtYWluaW5nKCkgPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzdWJtaXRBbnN3ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIgJiYgIXF1ZXN0aW9uLmFuc3dlcmVkKCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhbnN3ZXIgPSBTdHJpbmcoJHNjb3BlLmFuc3dlcklucHV0LmFuc3dlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaWYgaXQgaXMgYSBudW1iZXIgaW5wdXQsIHJlcGxhY2UgJywnIHdpdGggJy4nXHJcbiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0ICYmIHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dC5pbmRleE9mKCdudW1iZXInKSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuc3dlciA9IGFuc3dlci5yZXBsYWNlKCcsJywgJy4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpZiBhIG11bHRpcGxpZXIgaXMgYXZhaWxhYmxlLCBjYWxjdWxhdGUgYW5zd2VyXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbnN3ZXIgKj0gJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0LnBvaW50cyA9IHF1ZXN0aW9uLmFuc3dlcihhbnN3ZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNldCBmb2N1c1xyXG4gICAgICAgICAgICAgICAgaWYgKCF3YXNMYXN0UXVlc3Rpb24oKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIEZvY3VzU3J2KCcjYnRuTmV4dFF1ZXN0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIEZvY3VzU3J2KCcjYnRuQ29udGludWVGaW5pc2hlZCAgJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25BbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIVF1aXpTcnYuaXNRdWl6UnVubmluZygpIHx8IHF1ZXN0aW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5hbnN3ZXJlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBuZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5uZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgdXBkYXRlVWkoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVxdWVzdEhpbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBxdWVzdGlvbi5oaW50KCk7XHJcblxyXG4gICAgICAgICAgICBGb2N1c1NydignLmFuc3dlcklucHV0Jyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uKHRleHQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dFxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJbXCIsIFwiPHNwYW4gY2xhc3M9J1wiICsgY2xhc3NOYW1lICsgXCInPlwiKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJdXCIsIFwiPC9zcGFuPlwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZGxlS2V5UHJlc3MgPSBmdW5jdGlvbihrZXlFdmVudCkge1xyXG4gICAgICAgICAgICBpZiAoa2V5RXZlbnQud2hpY2ggPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHN1Ym1pdEFuc3dlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZVByb2dyZXNzQmFyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBwcm9ncmVzc1BlcmNlbnQgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKSAvIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpICogMTAwO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldChwcm9ncmVzc1BlcmNlbnQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB3YXNMYXN0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpID49IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwYXJzZUV2ZW50cyA9IGZ1bmN0aW9uKGV2ZW50cywgcGVyc29uYWxCZXN0LCBvdmVyYWxsQmVzdCkge1xyXG4gICAgICAgICAgICB2YXIgYWNoaWV2ZW1lbnRzID0gW107XHJcblxyXG4gICAgICAgICAgICB2YXIgc2hvd0Jlc3RzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZignb3ZlcmFsbF9iZXN0JykgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEdSBoYXN0IGVpbmVuIG5ldWVuIGFic29sdXRlbiBSZWtvcmQgZ2VzY2hhZmZ0ISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dCZXN0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ292ZXJhbGxfYmVzdF9lcXVhbGlzZWQnKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZGVuIGFrdHVlbGxlbiBhYnNvbHV0ZW4gUmVrb3JkIGVpbmdlc3RlbGx0ISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dCZXN0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ3BlcnNvbmFsX2Jlc3QnKSA+PSAwICYmIGV2ZW50cy5pbmRleE9mKCdvdmVyYWxsX2Jlc3QnKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBlaW5lbiBuZXVlbiBwZXJzw7ZubGljaGVuIFJla29yZCBnZXNjaGFmZnQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0Jlc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZigncGVyc29uYWxfYmVzdF9lcXVhbGlzZWQnKSA+PSAwICYmIGV2ZW50cy5pbmRleE9mKCdvdmVyYWxsX2Jlc3RfZXF1YWxpc2VkJykgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZ2xlaWNoIHZpZWxlIFB1bmt0ZSBnZXNjaGFmZnQgd2llIGJlaSBkZWluZW0gcGVyc8O2bmxpY2hlbiBSZWtvcmQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0Jlc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZignbmV3X2RhaWx5X2Jlc3QnKSA+PSAwICYmIGFjaGlldmVtZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBlaW5lbiBuZXVlbiBwZXJzw7ZubGljaGVuIFRhZ2VzcmVrb3JkIGdlc2NoYWZmdCEnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmFjaGlldmVtZW50cyA9IGFjaGlldmVtZW50cztcclxuXHJcbiAgICAgICAgICAgIGlmIChzaG93QmVzdHMgJiYgcGVyc29uYWxCZXN0ICYmIHBlcnNvbmFsQmVzdC5pZCAmJiBwZXJzb25hbEJlc3QuZGF0ZSAmJiBwZXJzb25hbEJlc3Quc2NvcmUgJiYgb3ZlcmFsbEJlc3QgJiYgb3ZlcmFsbEJlc3QuaWQgJiYgb3ZlcmFsbEJlc3QuZGF0ZSAmJiBvdmVyYWxsQmVzdC5zY29yZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJlc3RzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgb3ZlcmFsbEJlc3QudHlwZSA9ICdvdmVyYWxsJztcclxuICAgICAgICAgICAgICAgIGJlc3RzLnB1c2gob3ZlcmFsbEJlc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwZXJzb25hbEJlc3QuaWQgIT09IG92ZXJhbGxCZXN0LmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGVyc29uYWxCZXN0LnR5cGUgPSAncGVyc29uYWwnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiZXN0cy5wdXNoKHBlcnNvbmFsQmVzdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gYmVzdHM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYmVzdHMgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNvbnRpbnVlRmluaXNoZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgc2hvd1Jlc3VsdHNQYWdlKCk7XHJcblxyXG4gICAgICAgICAgICBuZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbmNsdWRlIHRoZSBxdWl6IGFuZCB3cml0ZSByZXN1bHQgdG8gZGF0YWJhc2VcclxuICAgICAgICAgICAgUXVpelNydi5jb25jbHVkZSgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VFdmVudHMoZGF0YS5ldmVudHMgfHwgW10sIGRhdGEucGVyc29uYWxCZXN0LCBkYXRhLm92ZXJhbGxCZXN0KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QmVzdFRleHQgPSBmdW5jdGlvbihiZXN0KSB7XHJcbiAgICAgICAgICAgIHZhciB0ZXh0O1xyXG5cclxuICAgICAgICAgICAgaWYgKGJlc3QudHlwZSA9PT0gJ3BlcnNvbmFsJykge1xyXG4gICAgICAgICAgICAgICAgLy8gcGVyc29uYWwgYmVzdFxyXG4gICAgICAgICAgICAgICAgdGV4dCA9IFwiRGVpbiBwZXJzw7ZubGljaGVyIFJla29yZCBsaWVndCBiZWkgPHNwYW4gY2xhc3M9J2JvbGQnPntQT0lOVFN9IFB1bmt0ZW48L3NwYW4+LCBhdWZnZXN0ZWxsdCBhbSB7REFURX0uXCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBvdmVyYWxsIGJlc3RcclxuICAgICAgICAgICAgICAgIHZhciBmcm9tTXlzZWxmID0gYmVzdC5pZCA9PT0gJHNjb3BlLnVzZXIuX2lkO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChmcm9tTXlzZWxmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IFwiRHUgaMOkbHRzdCBkZW4gYWJzb2x1dGVuIFJla29yZCBtaXQgPHNwYW4gY2xhc3M9J2JvbGQnPntQT0lOVFN9IFB1bmt0ZW48L3NwYW4+LCBhdWZnZXN0ZWxsdCBhbSB7REFURX0uXCI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQgPSBcIjxzcGFuIGNsYXNzPSdoaWdobGlnaHQnPntVU0VSTkFNRX08L3NwYW4+IGjDpGx0IGRlbiBhYnNvbHV0ZW4gUmVrb3JkIG1pdCA8c3BhbiBjbGFzcz0nYm9sZCc+e1BPSU5UU30gUHVua3Rlbjwvc3Bhbj4sIGF1Zmdlc3RlbGx0IGFtIHtEQVRFfS5cIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgne1BPSU5UU30nLCAkZmlsdGVyKCdudW1iZXInKShiZXN0LnNjb3JlKSlcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7REFURX0nLCBnZXRGb3JtYXR0ZWREYXRlKGJlc3QuZGF0ZSkpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgne1VTRVJOQU1FfScsIGJlc3QudXNlcm5hbWUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRGb3JtYXR0ZWREYXRlID0gZnVuY3Rpb24oZGF0ZSkge1xyXG4gICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoZGF0ZSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcGFkKGRhdGUuZ2V0RGF0ZSgpLCAnMDAnKSArICcuJyArIHBhZChkYXRlLmdldE1vbnRoKCkgKyAxLCAnMDAnKSArICcuJyArIChkYXRlLmdldFllYXIoKSArIDE5MDApO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwYWQgPSBmdW5jdGlvbihzdHIsIHBhZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBTdHJpbmcocGFkVmFsdWUgKyBzdHIpLnNsaWNlKC1wYWRWYWx1ZS5sZW5ndGgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXN0YXJ0UXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBxdWl6ID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kZW1pdCgncXVpei5yZXN0YXJ0Jyk7XHJcblxyXG4gICAgICAgICAgICBpbml0Q3RybCgpO1xyXG5cclxuICAgICAgICAgICAgdXBkYXRlVWkoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZW50ZXJMaXN0ZW5lciA9IGZ1bmN0aW9uKGtleVByZXNzLCBmdW5jKSB7XHJcbiAgICAgICAgICAgIGlmIChrZXlQcmVzcy53aGljaCA9PSAxMykge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChmdW5jKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbmV4dF9xdWVzdGlvbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRRdWVzdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY29udGludWVfZmluaXNoZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZUZpbmlzaGVkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ3F1aXouc3RhcnQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBoaWRlUmVzdWx0c1BhZ2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICAvLyBjb250cm9sbGVyIGlzIGJlaW5nIGRlc3Ryb3llZCAoaS5lLiB1c2VyIGxlYXZlcyB0aGUgcGFnZSwgc28gd2UgdGVsbCB0aGUgcXVpeiBzZXJ2aWNlIHRvIGRpc3Bvc2Ugb2YgdGhlIHF1aXogb2JqZWN0XHJcbiAgICAgICAgICAgIGlmIChRdWl6U3J2Lmhhc1F1aXpTdGFydGVkKCkgJiYgUXVpelNydi5oYXNRdWl6RW5kZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgUXVpelNydi5kaXNwb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBjb250cm9sbGVyXHJcbiAgICAgICAgaW5pdEN0cmwoKTtcclxuXHJcbiAgICAgICAgLy8gaW5pdGlhbGx5IHVwZGF0ZSBVSVxyXG4gICAgICAgIHVwZGF0ZVVpKCk7XHJcblxyXG4gICAgICAgICRzY29wZS5nZXRRdWVzdGlvbiA9IGdldFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI7XHJcbiAgICAgICAgJHNjb3BlLnJlbmRlclF1ZXN0aW9uVGV4dCA9IHJlbmRlclF1ZXN0aW9uVGV4dDtcclxuICAgICAgICAkc2NvcGUuc3VibWl0QW5zd2VyID0gc3VibWl0QW5zd2VyO1xyXG4gICAgICAgICRzY29wZS5xdWVzdGlvbkFuc3dlcmVkID0gcXVlc3Rpb25BbnN3ZXJlZDtcclxuICAgICAgICAkc2NvcGUubmV4dFF1ZXN0aW9uID0gbmV4dFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5oYW5kbGVLZXlQcmVzcyA9IGhhbmRsZUtleVByZXNzO1xyXG4gICAgICAgICRzY29wZS5nZXRRdWVzdGlvbk1lZGlhID0gZ2V0UXVlc3Rpb25NZWRpYTtcclxuICAgICAgICAkc2NvcGUucmVxdWVzdEhpbnQgPSByZXF1ZXN0SGludDtcclxuICAgICAgICAkc2NvcGUud2FzTGFzdFF1ZXN0aW9uID0gd2FzTGFzdFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5jb250aW51ZUZpbmlzaGVkID0gY29udGludWVGaW5pc2hlZDtcclxuICAgICAgICAkc2NvcGUuZ2V0QmVzdFRleHQgPSBnZXRCZXN0VGV4dDtcclxuICAgICAgICAkc2NvcGUucmVzdGFydFF1aXogPSByZXN0YXJ0UXVpejtcclxuICAgICAgICAkc2NvcGUuaGludHNBdmFpbGFibGUgPSBoaW50c0F2YWlsYWJsZTtcclxuICAgICAgICAkc2NvcGUuZW50ZXJMaXN0ZW5lciA9IGVudGVyTGlzdGVuZXI7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUXVpekN0cmwnLCBbXCIkc2NvcGVcIiwgXCJRdWl6U3J2XCIsIFwiTG9nU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2KSB7XHJcblxyXG4gICAgICAgIHZhciBzdGFydFF1aXogPSBmdW5jdGlvbihjYikge1xyXG4gICAgICAgICAgICBRdWl6U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNiICYmIHR5cGVvZiBjYiA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaXNRdWl6UnVubmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5pc1F1aXpSdW5uaW5nKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2Lmhhc1F1aXpTdGFydGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5oYXNRdWl6RW5kZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG90YWxQb2ludHMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0VG90YWxQb2ludHMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdxdWl6LnJlc3RhcnQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBRdWl6U3J2LmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgICAgICAgIHN0YXJ0UXVpeihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdxdWl6LnN0YXJ0Jyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuc3RhcnRRdWl6ID0gc3RhcnRRdWl6O1xyXG4gICAgICAgICRzY29wZS5pc1F1aXpSdW5uaW5nID0gaXNRdWl6UnVubmluZztcclxuICAgICAgICAkc2NvcGUuaGFzUXVpelN0YXJ0ZWQgPSBoYXNRdWl6U3RhcnRlZDtcclxuICAgICAgICAkc2NvcGUuaGFzUXVpekVuZGVkID0gaGFzUXVpekVuZGVkO1xyXG4gICAgICAgICRzY29wZS5nZXRUb3RhbFBvaW50cyA9IGdldFRvdGFsUG9pbnRzO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ3RybCcsIFtcIiRzY29wZVwiLCBcIkxvZ1NydlwiLCBcIkZvY3VzU3J2XCIsIFwiVXNlclNydlwiLCBcIiRzdGF0ZVwiLCBcIiR3aW5kb3dcIiwgZnVuY3Rpb24oJHNjb3BlLCBMb2dTcnYsIEZvY3VzU3J2LCBVc2VyU3J2LCAkc3RhdGUsICR3aW5kb3cpIHtcclxuICAgICAgICAvLyBuZXcgdXNlciBvYmplY3RcclxuICAgICAgICAkc2NvcGUubmV3VXNlciA9IHt9O1xyXG5cclxuICAgICAgICAvLyBtZXNzYWdlIG9iamVjdFxyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24gKGlzVmFsaWQpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh2YWxpZGF0ZUJlZm9yZVN1Ym1pdCgpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBwZXJmb3JtIGFwaSBjYWxsXHJcbiAgICAgICAgICAgICAgICBVc2VyU3J2LnJlZ2lzdGVyKCRzY29wZS5uZXdVc2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcCBjb250cm9sbGVyIGFib3V0IGxvZ2luXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dpbicsIHJlc3BvbnNlLmRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3JlZ2lzdGVyLnN1Y2Nlc3NmdWwnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0JlaSBkZXIgQW5tZWxkdW5nIHNjaGVpbnQgZXR3YXMgc2NoaWVmIGdlZ2FuZ2VuIHp1IHNlaW4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGVyci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdVc2VybmFtZSBhbHJlYWR5IGV4aXN0cyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnRGVyIEJlbnV0emVybmFtZSBleGlzdGllcnQgYmVyZWl0cyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdCZWkgZGVyIEFubWVsZHVuZyBzY2hlaW50IGV0d2FzIHNjaGllZiBnZWdhbmdlbiB6dSBzZWluJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbWVzc2FnZVRleHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdmFsaWRhdGVCZWZvcmVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHR3byBwYXNzd29yZHMgbWF0Y2hcclxuICAgICAgICAgICAgdmFyIHBhc3N3b3JkID0gJHNjb3BlLm5ld1VzZXIucGFzc3dvcmQ7XHJcbiAgICAgICAgICAgIHZhciBwYXNzd29yZDIgPSAkc2NvcGUubmV3VXNlci5wYXNzd29yZDI7XHJcblxyXG4gICAgICAgICAgICBpZiAoISRzY29wZS5uZXdVc2VyLnVzZXJuYW1lIHx8ICEkc2NvcGUubmV3VXNlci5lbWFpbCB8fCAhcGFzc3dvcmQgfHwgIXBhc3N3b3JkMikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnQWxsZSBGZWxkZXIgbcO8c3NlbiBhdXNnZWbDvGxsdCBzZWluJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXNzd29yZCA9PT0gXCJcIiB8fCBwYXNzd29yZDIgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0RpZSBQYXNzd8O2cnRlciBrw7ZubmVuIG5pY2h0IGxlZXIgc2VpbidcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFzc3dvcmQgIT09IHBhc3N3b3JkMikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRGllIFBhc3N3w7ZydGVyIHN0aW1tZW4gbmljaHQgw7xiZXJlaW4nXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gISRzY29wZS5tZXNzYWdlID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZWxlZ2F0ZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZWdpc3Rlcih0cnVlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZGVsZWdhdGVTdWJtaXQgPSBkZWxlZ2F0ZVN1Ym1pdDtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJlZ2lzdGVyID0gcmVnaXN0ZXI7XHJcblxyXG4gICAgICAgIC8vIGZvY3VzIHVzZXIgbmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCcjdXNlcm5hbWUnKTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdTZXR0aW5nc0N0cmwnLCBbXCIkc2NvcGVcIiwgXCJBcHBDb25maWdcIiwgXCJGb2N1c1NydlwiLCBcIkxvZ1NydlwiLCBcIlVzZXJTcnZcIiwgZnVuY3Rpb24oJHNjb3BlLCBBcHBDb25maWcsIEZvY3VzU3J2LCBMb2dTcnYsIFVzZXJTcnYpIHtcclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAvLyB1c2VyIGNvbG91cnNcclxuICAgICAgICAgICAgdmFyIGNvbG9ycyA9IEFwcENvbmZpZ1snc2V0dGluZ3MudXNlci5jb2xvcnMnXTtcclxuXHJcbiAgICAgICAgICAgIC8vIHVzZXIgb2JqZWN0XHJcbiAgICAgICAgICAgICRzY29wZS51c2VyT2JqID0ge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6ICRzY29wZS51c2VyLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgZW1haWw6ICRzY29wZS51c2VyLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgY29sb3I6ICRzY29wZS51c2VyLmNvbG9yXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUudXNlckNvbG9ycyA9IGNvbG9ycztcclxuXHJcbiAgICAgICAgICAgIHZhciBzZXRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlck9iai5jb2xvciA9IG5ld0NvbG9yO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIHVwZGF0ZVVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIFVzZXJTcnYudXBkYXRlQmFzaWMoJHNjb3BlLnVzZXJPYmopLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSB1c2VyIG9iamVjdFxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLnVzZXJuYW1lID0gJHNjb3BlLnVzZXJPYmoudXNlcm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuZW1haWwgPSAkc2NvcGUudXNlck9iai5lbWFpbDtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXNlci5jb2xvciA9ICRzY29wZS51c2VyT2JqLmNvbG9yO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdFaW5zdGVsbHVuZ2VuIHd1cmRlbiBlcmZvbGdyZWljaCBnZXNwZWljaGVydCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcignVXBkYXRlIHVzZXInLCBlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZXJyLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnVXNlcm5hbWUgYWxyZWFkeSBleGlzdHMnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnRGVyIEJlbnV0emVybmFtZSBpc3QgYmVyZWl0cyB2ZXJnZWJlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEaWUgRWluc3RlbGx1bmdlbiBrb25udGVuIG5pY2h0IGdlc3BlaWNoZXJ0IHdlcmRlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBkZWxlZ2F0ZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlVXNlcih0cnVlKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zZXRDb2xvciA9IHNldENvbG9yO1xyXG4gICAgICAgICAgICAkc2NvcGUudXBkYXRlVXNlciA9IHVwZGF0ZVVzZXI7XHJcbiAgICAgICAgICAgICRzY29wZS5kZWxlZ2F0ZVN1Ym1pdCA9IGRlbGVnYXRlU3VibWl0O1xyXG5cclxuICAgICAgICAgICAgLy8gZm9jdXMgdXNlcm5hbWUgZmllbGRcclxuICAgICAgICAgICAgRm9jdXNTcnYoJyN1c2VybmFtZScpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICgkc2NvcGUudXNlcikge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBvdGhlcndpc2UsIHdhaXQgZm9yIHVzZXIubG9hZGVkIGV2ZW50XHJcbiAgICAgICAgJHNjb3BlLiRvbigndXNlci5sb2FkZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZGlyZWN0aXZlKCdjbGlja091dHNpZGUnLCBbXCIkcGFyc2VcIiwgXCIkZG9jdW1lbnRcIiwgXCIkcm9vdFNjb3BlXCIsIGZ1bmN0aW9uKCRwYXJzZSwgJGRvY3VtZW50LCAkcm9vdFNjb3BlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRkb2N1bWVudC5iaW5kKCdjbGljaycsIGNsaWNrT3V0c2lkZUhhbmRsZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgncmVtb3ZlJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGRvY3VtZW50LnVuYmluZCgnY2xpY2snLCBjbGlja091dHNpZGVIYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNsaWNrT3V0c2lkZUhhbmRsZXIoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldFBhcmVudHMgPSAkKGV2ZW50LnRhcmdldCkucGFyZW50cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbnNpZGUgPSB0YXJnZXRQYXJlbnRzLmluZGV4KCQoZWxlbWVudCkpICE9PSAtMTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb24gPSBldmVudC50YXJnZXQgPT09IGVsZW1lbnRbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG91dHNpZGUgPSAhaW5zaWRlICYmICFvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG91dHNpZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGljay5vdXRzaWRlJywgZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1dKVxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmRpcmVjdGl2ZSgncXVpeicsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYnVpbGQvdmlld3MvdGVtcGxhdGVzL3F1aXotZGlyZWN0aXZlLnRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICBzY29wZTogdHJ1ZSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1F1aXpEaXJlY3RpdmVDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KVxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZpbHRlcigncmVuZGVySHRtbCcsIFtcIiRzY2VcIiwgZnVuY3Rpb24oJHNjZSkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0ZXh0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKHRleHQpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmlsdGVyKCd0ZXh0T3JOdW1iZXInLCBbXCIkZmlsdGVyXCIsIGZ1bmN0aW9uKCRmaWx0ZXIpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIGZyYWN0aW9uU2l6ZSkge1xyXG4gICAgICAgICAgICBmcmFjdGlvblNpemUgPSBmcmFjdGlvblNpemUgIT09IHVuZGVmaW5lZCA/IDAgOiBmcmFjdGlvblNpemU7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNOYU4oaW5wdXQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5wdXQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGZpbHRlcignbnVtYmVyJykoaW5wdXQsIGZyYWN0aW9uU2l6ZSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgW1wiQXV0aFRva2VuU3J2XCIsIGZ1bmN0aW9uKEF1dGhUb2tlblNydikge1xyXG4gICAgICAgIHZhciBhZGRUb2tlbiA9IGZ1bmN0aW9uKGNvbmZpZykge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydYLUF1dGgnXSA9IHRva2VuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGFkZFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdBdXRoVG9rZW5TcnYnLCBbXCIkd2luZG93XCIsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcclxuICAgICAgICB2YXIgc3RvcmUgPSAkd2luZG93LnNlc3Npb25TdG9yYWdlO1xyXG4gICAgICAgIHZhciBrZXkgPSAnYXV0aC10b2tlbic7XHJcblxyXG4gICAgICAgIHZhciBnZXRUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0SXRlbShrZXkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZXRUb2tlbiA9IGZ1bmN0aW9uKHRva2VuKSB7XHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUuc2V0SXRlbShrZXksIHRva2VuKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFRva2VuOiBnZXRUb2tlbixcclxuICAgICAgICAgICAgc2V0VG9rZW46IHNldFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdBdXRoU3J2JywgW1wiVXNlclNydlwiLCBmdW5jdGlvbihVc2VyU3J2KSB7XHJcbiAgICAgICAgdmFyIHVzZXIgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodXNlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodXNlcik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIFVzZXJTcnYuZ2V0VXNlckZyb21TdG9yYWdlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oX3VzZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIgPSBfdXNlcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF91c2VyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdOb3QgbG9nZ2VkIGluJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0VXNlciA9IGZ1bmN0aW9uKF91c2VyKSB7XHJcbiAgICAgICAgICAgIHVzZXIgPSBfdXNlcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY2xlYXJVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHVzZXIgPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNldFVzZXI6IHNldFVzZXIsXHJcbiAgICAgICAgICAgIGdldFVzZXI6IGdldFVzZXIsXHJcbiAgICAgICAgICAgIGNsZWFyVXNlcjogY2xlYXJVc2VyXHJcbiAgICAgICAgfVxyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0NvdW50cnlTcnYnLCBbXCIkaHR0cFwiLCBcIkluZGV4ZWREQlNydlwiLCBcIkxvZ1NydlwiLCBmdW5jdGlvbigkaHR0cCwgSW5kZXhlZERCU3J2LCBMb2dTcnYpIHtcclxuICAgICAgICAvLyBDb3VudHJpZXMgYXJyYXlcclxuICAgICAgICB2YXIgY291bnRyaWVzID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGNvdW50cmllc0J5QWxwaGEzID0gbnVsbDtcclxuICAgICAgICB2YXIgY291bnRyaWVzQnlMZXR0ZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBJbmRleGVkREJcclxuICAgICAgICB2YXIgZGF0YWJhc2UgPSAnbWFnZWxsYW4nO1xyXG4gICAgICAgIHZhciBzdG9yZSA9ICdjb3VudHJ5U3RvcmUnO1xyXG4gICAgICAgIHZhciBrZXlDb3VudHJpZXMgPSAnY291bnRyaWVzJztcclxuICAgICAgICB2YXIga2V5VmVyc2lvbiA9ICd2ZXJzaW9uJztcclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IEluZGV4ZWREQlNydi5pbmRleGVkREJBdmFpbGFibGUoKTtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvYWRDb3VudHJpZXMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9hZENvdW50cmllcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBjaGVjayBpZiBpbmRleGVkREIgaXMgYXZhaWxhYmxlXHJcbiAgICAgICAgICAgIGlmIChpbmRleGVkREJBdmFpbGFibGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgZGF0YWJhc2UgZXhpc3RzXHJcbiAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LmNyZWF0ZURhdGFiYXNlKGRhdGFiYXNlLCBzdG9yZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0RW1wdHlPYmplY3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEludGVybmFsVmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0RXh0ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihkZXRlcm1pbmVMb2FkU3RyYXRlZ3kpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGxvYWREYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllcyA9IG9ialsnY291bnRyaWVzJ107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmluZm8oXCJsb2FkZWQgY291bnRyaWVzIGZyb21cIiwgb2JqWydsb2FkU3RyYXRlZ3knXS50b1VwcGVyQ2FzZSgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGRpdGlvbmFsbHkgbWFwIGNvdW50cmllcyBieSB2YXJpb3VzIHByb3BlcnRpZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5QWxwaGEzID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUxldHRlciA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllcy5mb3JFYWNoKGZ1bmN0aW9uKGMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBieSBhbHBoYTMgY29kZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5QWxwaGEzW2NbJ2FscGhhM0NvZGUnXV0gPSBjO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBieSBsZXR0ZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlyc3RMZXR0ZXIgPSBjWyduYW1lJ10uc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZmlyc3RMZXR0ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnw4QnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RMZXR0ZXIgPSAnQSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ8OWJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TGV0dGVyID0gJ08nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICfDnCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdExldHRlciA9ICdVJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudHJpZXNCeUxldHRlcltmaXJzdExldHRlcl0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUxldHRlcltmaXJzdExldHRlcl0gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyW2ZpcnN0TGV0dGVyXS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGEzQ29kZTogYy5hbHBoYTNDb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBjLm5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiZmFpbGVkIHRvIGxvYWQgY291bnRyaWVzXCIsIGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBub3QsIHdlIGFsd2F5cyB0cnkgdG8gZG93bmxvYWQgaXQgZnJvbSB0aGUgY291bnRyeSBBUEkgZW5kcG9pbnRcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRDb3VudHJpZXNGcm9tQVBJKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5ID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaW50ZXJuYWxWZXJzaW9uID0gb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGV4dGVybmFsVmVyc2lvbiA9IG9ialtcImV4dGVybmFsVmVyc2lvblwiXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaW50ZXJuYWxWZXJzaW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ZXJuYWxWZXJzaW9uID4gaW50ZXJuYWxWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnZGInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIG9ialsnbG9hZFN0cmF0ZWd5J10gPSBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkRGF0YSA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyYXRlZ3kgPSBvYmpbJ2xvYWRTdHJhdGVneSddO1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdhcGknOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDb3VudHJpZXNGcm9tQVBJKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGNvdW50cmllcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmUgY291bnRyaWVzIGFuZCB2ZXJzaW9uIG51bWJlciBpbiBkYXRhYmFzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlDb3VudHJpZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAgY291bnRyaWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlWZXJzaW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdkYic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21EQihvYmopXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihfb2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfb2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ1Vua25vd24gbG9hZCBzdHJhdGVneScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RW1wdHlPYmplY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7fSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRJbnRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleVZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBpdGVtLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0ZXJuYWxWZXJzaW9uID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRWZXJzaW9uRnJvbUFQSSgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbih2ZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdID0gdmVyc2lvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNGcm9tREIgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleUNvdW50cmllcylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21BUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdW50cmllcycpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRWZXJzaW9uRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzL3ZlcnNpb24nKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YS52ZXJzaW9uIHx8IDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyeUJ5QWxwaGEzID0gZnVuY3Rpb24oYWxwaGEzKSB7XHJcbiAgICAgICAgICAgIGlmIChjb3VudHJpZXNCeUFscGhhMyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXNCeUFscGhhM1thbHBoYTNdO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllcztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzQnlMZXR0ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKGNvdW50cmllc0J5TGV0dGVyID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllc0J5TGV0dGVyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBhcmVDb3VudHJpZXNMb2FkZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllcyAhPT0gbnVsbCAmJiBjb3VudHJpZXMubGVuZ3RoID4gMDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBnZXRDb3VudHJpZXM6IGdldENvdW50cmllcyxcclxuICAgICAgICAgICAgZ2V0Q291bnRyeUJ5QWxwaGEzOiBnZXRDb3VudHJ5QnlBbHBoYTMsXHJcbiAgICAgICAgICAgIGdldENvdW50cmllc0J5TGV0dGVyOiBnZXRDb3VudHJpZXNCeUxldHRlcixcclxuICAgICAgICAgICAgYXJlQ291bnRyaWVzTG9hZGVkOiBhcmVDb3VudHJpZXNMb2FkZWRcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0ZvY3VzU3J2JywgW1wiJHRpbWVvdXRcIiwgXCIkd2luZG93XCIsIGZ1bmN0aW9uKCR0aW1lb3V0LCAkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNlbGVjdG9yKSB7XHJcbiAgICAgICAgICAgIC8vIHRpbWVvdXQgbWFrZXMgc3VyZSB0aGF0IGlzIGludm9rZWQgYWZ0ZXIgYW55IG90aGVyIGV2ZW50IGhhcyBiZWVuIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgLy8gZS5nLiBjbGljayBldmVudHMgdGhhdCBuZWVkIHRvIHJ1biBiZWZvcmUgdGhlIGZvY3VzIG9yXHJcbiAgICAgICAgICAgIC8vIGlucHV0cyBlbGVtZW50cyB0aGF0IGFyZSBpbiBhIGRpc2FibGVkIHN0YXRlIGJ1dCBhcmUgZW5hYmxlZCB3aGVuIHRob3NlIGV2ZW50c1xyXG4gICAgICAgICAgICAvLyBhcmUgdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdJbmRleGVkREJTcnYnLCBbXCIkd2luZG93XCIsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcclxuICAgICAgICB2YXIga2V5UGF0aCA9ICduYW1lJztcclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQiA9ICR3aW5kb3cuaW5kZXhlZERCIHx8ICR3aW5kb3cud2Via2l0SW5kZXhlZERCIHx8ICR3aW5kb3cubXNJbmRleGVkREI7XHJcbiAgICAgICAgdmFyIElEQktleVJhbmdlID0gJHdpbmRvdy5JREJLZXlSYW5nZSB8fCAkd2luZG93LndlYmtpdElEQktleVJhbmdlO1xyXG5cclxuICAgICAgICB2YXIgSURCVHJhbnNhY3Rpb24gPSAkd2luZG93LklEQlRyYW5zYWN0aW9uIHx8ICR3aW5kb3cud2Via2l0SURCVHJhbnNhY3Rpb247XHJcblxyXG4gICAgICAgIGlmIChJREJUcmFuc2FjdGlvbikge1xyXG4gICAgICAgICAgICBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFID0gSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSB8fCAncmVhZHdyaXRlJztcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZID0gSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZIHx8ICdyZWFkb25seSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbmRleGVkREIgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZURhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGUgaXMgYW4gaW5zdGFuY2Ugb2YgSURCVmVyc2lvbkNoYW5nZUV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gaWRiLmNyZWF0ZU9iamVjdFN0b3JlKHN0b3JlTmFtZSwgeyBrZXlQYXRoOiBrZXlQYXRoIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGQsIHVwZGF0ZSwgZGVsZXRlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkcm9wRGF0YWJhc2UgPSBmdW5jdGlvbihkYk5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkcm9wIHN1Y2Nlc3NmdWxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBmYWlsZWRcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYWRkSXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0QWRkID0gc3RvcmUuYWRkKGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHB1dEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLnB1dChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gSURCS2V5UmFuZ2Uub25seShpdGVtTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLm9wZW5DdXJzb3IocmFuZ2UpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBjdXJzb3IudmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJldHJpZXZlSXRlbXMgPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNyZWF0ZURhdGFiYXNlOiBjcmVhdGVEYXRhYmFzZSxcclxuICAgICAgICAgICAgZHJvcERhdGFiYXNlOiBkcm9wRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGFkZEl0ZW06IGFkZEl0ZW0sXHJcbiAgICAgICAgICAgIHB1dEl0ZW06IHB1dEl0ZW0sXHJcbiAgICAgICAgICAgIHJldHJpZXZlSXRlbTogcmV0cmlldmVJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW1zOiByZXRyaWV2ZUl0ZW1zLFxyXG4gICAgICAgICAgICBpbmRleGVkREJBdmFpbGFibGU6IGluZGV4ZWREQkF2YWlsYWJsZVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnTG9nU3J2JywgW1wiQXBwQ29uZmlnXCIsIGZ1bmN0aW9uKEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBsb2dJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuaW5mb1wiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dFcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmVycm9yXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbmZvOiBsb2dJbmZvLFxyXG4gICAgICAgICAgICBlcnJvcjogbG9nRXJyb3JcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1F1aXpTcnYnLCBbXCJBcHBDb25maWdcIiwgXCJDb3VudHJ5U3J2XCIsIFwiU2NvcmVTcnZcIiwgXCJMb2dTcnZcIiwgZnVuY3Rpb24oQXBwQ29uZmlnLCBDb3VudHJ5U3J2LCBTY29yZVNydiwgTG9nU3J2KSB7XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcbiAgICAgICAgdmFyIGNvdW50cmllc0J5QWxwaGEzID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHF1aXogPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgc2V0Q291bnRyaWVzID0gZnVuY3Rpb24oX2NvdW50cmllcykge1xyXG4gICAgICAgICAgICBjb3VudHJpZXMgPSBfY291bnRyaWVzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjb3VudHJpZXNMb2FkZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllcyAhPT0gbnVsbCAmJiBjb3VudHJpZXMubGVuZ3RoID4gMDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNvdW50cmllc0xvYWRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkNvdW50cmllcyBoYXZlIG5vdCBiZWVuIGxvYWRlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBxdWl6ID0gY3JlYXRlUXVpeignY291bnRyeScpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUocXVpei5zdGFydCgpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRpc3Bvc2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcXVpeiA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNTdGFydGVkKCkgJiYgIXF1aXouaGFzRW5kZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpelN0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNTdGFydGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVpeiA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6Lmhhc0VuZGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZVF1aXogPSBmdW5jdGlvbihxdWl6VHlwZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHF1aXpUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjb3VudHJ5JzpcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNvdW50cnlRdWl6KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlQ291bnRyeVF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGNvdW50cnlRdWl6ID0gbmV3IFF1aXooKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBmdWxsUG9pbnRzID0gMTAwO1xyXG4gICAgICAgICAgICB2YXIgaGludE1heGltdW0gPSAzO1xyXG4gICAgICAgICAgICB2YXIgaGludENvc3QgPSAyNTtcclxuXHJcbiAgICAgICAgICAgIHZhciBsYXN0UXVlc3Rpb25Cb251cyA9IDIuNTtcclxuXHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGVzID0gQXBwQ29uZmlnWydxdWl6LmNvdW50cnkudHlwZXMnXTtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZXNMZW5ndGggPSBPYmplY3Qua2V5cyhxdWVzdGlvblR5cGVzKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAvLyBzZWxlY3QgY291bnRyaWVzIGZvciBxdWVzdGlvbnNcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkQ291bnRyaWVzID0gW107XHJcbiAgICAgICAgICAgIHZhciBudW1iZXJPZlF1ZXN0aW9ucyA9IEFwcENvbmZpZ1sncXVpei5jb3VudHJ5LnF1ZXN0aW9ucyddO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1iZXJPZlF1ZXN0aW9uczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRyeU9rID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKCFjb3VudHJ5T2spIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IGNvdW50cmllc1tnZXRSYW5kb21JbnQoMCwgY291bnRyaWVzLmxlbmd0aCAtIDEpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRyeU9rID0gc2VsZWN0ZWRDb3VudHJpZXMuaW5kZXhPZihjb3VudHJ5WydhbHBoYTNDb2RlJ10pIDwgMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDb3VudHJpZXMucHVzaChjb3VudHJ5WydhbHBoYTNDb2RlJ10pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBjcmVhdGUgcXVlc3Rpb25zIGZvciBxdWl6XHJcbiAgICAgICAgICAgIHZhciBxY250ID0gMDtcclxuICAgICAgICAgICAgc2VsZWN0ZWRDb3VudHJpZXMuZm9yRWFjaChmdW5jdGlvbihhbHBoYTMpIHtcclxuICAgICAgICAgICAgICAgIHFjbnQrKztcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uVHlwZXNbZ2V0UmFuZG9tSW50KDEsIHF1ZXN0aW9uVHlwZXNMZW5ndGgpXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGdldFF1ZXN0aW9uVGV4dChxdWVzdGlvblR5cGUsIGNvdW50cnkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogcXVlc3Rpb25UeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0OiBnZXRRdWVzdGlvbklucHV0KHF1ZXN0aW9uVHlwZSksXHJcbiAgICAgICAgICAgICAgICAgICAgdW5pdDogZ2V0UXVlc3Rpb25Vbml0KHF1ZXN0aW9uVHlwZSlcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5zd2VyID0gZ2V0UXVlc3Rpb25BbnN3ZXIocXVlc3Rpb25UeXBlLCBjb3VudHJ5KTtcclxuICAgICAgICAgICAgICAgIHZhciBjaGVja0Fuc3dlciA9IGdldENoZWNrQW5zd2VyTGFtYmRhKHF1ZXN0aW9uVHlwZSwgZnVsbFBvaW50cywgbGFzdFF1ZXN0aW9uQm9udXMpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhpbnRzID0gZ2V0UXVlc3Rpb25IaW50cyhxdWVzdGlvblR5cGUsIGhpbnRNYXhpbXVtLCBoaW50Q29zdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gdGhlIGxhc3QgcXVlc3Rpb24gaXMgdGhlIGJvbnVzIHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICBpZiAocWNudCA+PSBudW1iZXJPZlF1ZXN0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm9bJ2JvbnVzJ10gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGFkZCBpbmZvIGZvciBmbGFnIG9mIGNvdW50cnlcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdGTEFHX09GX0NPVU5UUlknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mby5tZWRpYSA9ICdmbGFnJztcclxuICAgICAgICAgICAgICAgICAgICBpbmZvLmFscGhhMkNvZGUgPSBjb3VudHJ5LmFscGhhMkNvZGUudG9Mb2NhbGVMb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5UXVpei5hZGRRdWVzdGlvbihuZXcgUXVlc3Rpb24oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5mbzogaW5mbyxcclxuICAgICAgICAgICAgICAgICAgICBhbnN3ZXI6IGFuc3dlcixcclxuICAgICAgICAgICAgICAgICAgICBjaGVja0Fuc3dlcjogY2hlY2tBbnN3ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgaGludHM6IGhpbnRzXHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cnlRdWl6O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblRleHQgPSBmdW5jdGlvbih0eXBlLCBjb3VudHJ5KSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgaGVpw590IGRpZSBIYXVwdHN0YWR0IHZvbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIltcIiArIGNvdW50cnkuY2FwaXRhbCArIFwiXSBpc3QgZGllIEhhdXB0c3RhZHQgdm9uIHdlbGNoZW0gTGFuZFwiXHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgdmllbGUgTWVuc2NoZW4gbGViZW4gaW4gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgZ3Jvw58gaXN0IGRpZSBGbMOkY2hlIHZvbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldlbGNoZXMgTGFuZCBoYXQgZGllc2UgRmxhZ2dlXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI/XCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbkFuc3dlciA9IGZ1bmN0aW9uKHR5cGUsIGNvdW50cnkpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhbHRTcGVsbGluZ3MgPSBjb3VudHJ5LmFsdFNwZWxsaW5ncyAhPT0gdW5kZWZpbmVkICYmIGNvdW50cnkuYWx0U3BlbGxpbmdzWydjYXBpdGFsJ10gIT09IHVuZGVmaW5lZCA/IGNvdW50cnkuYWx0U3BlbGxpbmdzWydjYXBpdGFsJ10gOiBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5jYXBpdGFsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbHRTcGVsbGluZ3M6IGFsdFNwZWxsaW5nc1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFsdFNwZWxsaW5ncyA9IGNvdW50cnkuYWx0U3BlbGxpbmdzICE9PSB1bmRlZmluZWQgJiYgY291bnRyeS5hbHRTcGVsbGluZ3NbJ25hbWUnXSAhPT0gdW5kZWZpbmVkID8gY291bnRyeS5hbHRTcGVsbGluZ3NbJ25hbWUnXSA6IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5Lm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsdFNwZWxsaW5nczogYWx0U3BlbGxpbmdzXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkucG9wdWxhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5LmFyZWFcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25JbnB1dCA9IGZ1bmN0aW9uKHR5cGUpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbnVtYmVyLmhpZ2gnO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdudW1iZXIubWVkaXVtJztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAndGV4dC5zdGFuZGFyZCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25Vbml0ID0gZnVuY3Rpb24odHlwZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdrbcKyJztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnRWlud29obmVyJztcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENoZWNrQW5zd2VyTGFtYmRhID0gZnVuY3Rpb24odHlwZSwgZnVsbFBvaW50cywgbGFzdFF1ZXN0aW9uQm9udXMpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBoaW50c1VzZWQsIGhpbnRDb3N0LCBpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3JyZWN0ID0gc3VibWl0dGVkQW5zd2VyID09PSBhbnN3ZXIuY29ycmVjdCB8fCAoYW5zd2VyLmFsdFNwZWxsaW5ncyAmJiBhbnN3ZXIuYWx0U3BlbGxpbmdzLmluZGV4T2Yoc3VibWl0dGVkQW5zd2VyKSA+PSAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludHMgPSBjb3JyZWN0ID8gZnVsbFBvaW50cyA6IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBoaW50cyBhcmUgYWxsb3dlZCBhbmQgaGF2ZSBiZWVuIHVzZWQsIHN1YnRyYWN0IHRoZSBwb2ludHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpbnRzVXNlZCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAtPSAoaGludHNVc2VkICogaGludENvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBib251cyBwb2ludHMgZm9yIGxhc3QgcXVlc3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8gIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzICo9IGxhc3RRdWVzdGlvbkJvbnVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBoaW50c1VzZWQsIGhpbnRDb3N0LCBpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBwZXJjZW50YWdlIGRpZmZlcmVuY2UgZnJvbSBjb3JyZWN0IGFuc3dlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JQZXJjZW50YWdlID0gTWF0aC5hYnMoc3VibWl0dGVkQW5zd2VyIC0gYW5zd2VyLmNvcnJlY3QpIC8gYW5zd2VyLmNvcnJlY3QgKiAxMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDkwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSA5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA4MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDcwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDE2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDQwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAyMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDI1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMzApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaGludHMgYXJlIGFsbG93ZWQgYW5kIGhhdmUgYmVlbiB1c2VkLCBzdWJ0cmFjdCB0aGUgcG9pbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaW50c1VzZWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgLT0gKGhpbnRzVXNlZCAqIGhpbnRDb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYm9udXMgcG9pbnRzIGZvciBsYXN0IHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAqPSBsYXN0UXVlc3Rpb25Cb251cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uSGludHMgPSBmdW5jdGlvbih0eXBlLCBoaW50c1Bvc3NpYmxlLCBoaW50Q29zdCkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhpbXVtOiBoaW50c1Bvc3NpYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3N0OiBoaW50Q29zdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2l2ZTogZnVuY3Rpb24oaGludHNVc2VkLCBhbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhbnN3ZXIuY29ycmVjdC5zdWJzdHIoMCwgaGludHNVc2VkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZDogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0TnVtYmVyT2ZRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5jdXJyZW50UXVlc3Rpb24oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHF1aXoubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFRvdGFsUG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0VG90YWxQb2ludHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENvbmNsdWRlcyB0aGUgcXVpeiBhbmQgcHV0cyB0aGUgc2NvcmUgdG8gdGhlIEFQSSBlbmRwb2ludC5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgY29uY2x1ZGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1aXogIT09IG51bGwgJiYgcXVpei5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHF1aXouc3VibWl0dGVkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnUXVpeiBoYXMgYWxyZWFkeSBiZWVuIHN1Ym1pdHRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcXVpei5zdWJtaXR0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBTY29yZVNydi5wdXRIaWdoc2NvcmUocXVpei5nZXRUb3RhbFBvaW50cygpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCgnTm8gcXVpeiBpcyBjdXJyZW50bHkgcnVubmluZycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBzZXRDb3VudHJpZXM6IHNldENvdW50cmllcyxcclxuICAgICAgICAgICAgaXNRdWl6UnVubmluZzogaXNRdWl6UnVubmluZyxcclxuICAgICAgICAgICAgaGFzUXVpelN0YXJ0ZWQ6IGhhc1F1aXpTdGFydGVkLFxyXG4gICAgICAgICAgICBoYXNRdWl6RW5kZWQ6IGhhc1F1aXpFbmRlZCxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyOiBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIsXHJcbiAgICAgICAgICAgIGdldE51bWJlck9mUXVpelF1ZXN0aW9uczogZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50UXVlc3Rpb246IGdldEN1cnJlbnRRdWVzdGlvbixcclxuICAgICAgICAgICAgbmV4dFF1ZXN0aW9uOiBuZXh0UXVlc3Rpb24sXHJcbiAgICAgICAgICAgIGdldFRvdGFsUG9pbnRzOiBnZXRUb3RhbFBvaW50cyxcclxuICAgICAgICAgICAgY29uY2x1ZGU6IGNvbmNsdWRlLFxyXG4gICAgICAgICAgICBkaXNwb3NlOiBkaXNwb3NlXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdTY29yZVNydicsIFtcIiRodHRwXCIsIGZ1bmN0aW9uKCRodHRwKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgZW50aXJlIGhpZ2hzY29yZSBsaXN0IGluIGFuIGFycmF5IGZyb20gdGhlIEFQSS5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgZ2V0SGlnaHNjb3JlTGlzdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvc2NvcmVzL2FsbCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgaGlnaHNjb3JlIG9iamVjdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIElmIHRoZSB1c2VyIGhhcyBubyByZXN1bHQgeWV0LCBhbiBlbXB0eSBvYmplY3QgaXMgcmV0dXJuZWQuXHJcbiAgICAgICAgICogUmV0dXJucyBhIHByb21pc2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGdldFVzZXJIaWdoc2NvcmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3Njb3Jlcy91c2VyJylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHNjb3JlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEZldGNoZXMgdGhlIGhpZ2hzY29yZSBvYmplY3QgZm9yIHRoZSBvdmVyYWxsIGhpZ2hzY29yZS5cclxuICAgICAgICAgKiBJZiB0aGVyZSBpcyBjdXJyZW50bHkgbm8gcmVzdWx0IHlldCwgYW4gZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkLlxyXG4gICAgICAgICAqIFJldHVybnMgYSBwcm9taXNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBnZXRPdmVyYWxsSGlnaHNjb3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9zY29yZXMvaGlnaCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oc2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzY29yZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBQdXRzIGEgaGlnaHNjb3JlIHJlc3VsdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIEBwYXJhbSBzY29yZSAgICAgTnVtYmVyIHdpdGggdGhlIGFjaGlldmVkIHNjb3JlLlxyXG4gICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBwdXRIaWdoc2NvcmUgPSBmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvc2NvcmVzJywgeyBzY29yZTogc2NvcmUgfSlcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRIaWdoc2NvcmVMaXN0OiBnZXRIaWdoc2NvcmVMaXN0LFxyXG4gICAgICAgICAgICBnZXRVc2VySGlnaHNjb3JlOiBnZXRVc2VySGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBnZXRPdmVyYWxsSGlnaHNjb3JlOiBnZXRPdmVyYWxsSGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBwdXRIaWdoc2NvcmU6IHB1dEhpZ2hzY29yZVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnVXNlclNydicsIFtcIiRodHRwXCIsIFwiQXV0aFRva2VuU3J2XCIsIFwiQXBwQ29uZmlnXCIsIGZ1bmN0aW9uKCRodHRwLCBBdXRoVG9rZW5TcnYsIEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VyJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXJGcm9tU3RvcmFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4odG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdG9rZW4sIHdlIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIHRva2VuIGluIHN0b3JhZ2VcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9uJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9rZW4gPSByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNhdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKHNlbGYudG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRVc2VyKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRva2VuIGxvY2FsbHlcclxuICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24obmV3VXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzZWxlY3QgYSByYW5kb20gY29sb3IgZm9yIHRoZSB1c2VyXHJcbiAgICAgICAgICAgICAgICB2YXIgY29sb3JzID0gQXBwQ29uZmlnWydzZXR0aW5ncy51c2VyLmNvbG9ycyddO1xyXG4gICAgICAgICAgICAgICAgbmV3VXNlci5jb2xvciA9IGNvbG9yc1tnZXRSYW5kb21JbnQoMCwgY29sb3JzLmxlbmd0aCAtIDEpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3VzZXInLCBuZXdVc2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW1tZWRpYXRlbHkgbG9nIHRoZSB1c2VyIGluXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luKG5ld1VzZXIudXNlcm5hbWUsIG5ld1VzZXIucGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pICA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZUJhc2ljID0gZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvdXNlci9iYXNpYycsIHVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlUGFzc3dvcmQgPSBmdW5jdGlvbihwYXNzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnB1dCgnL2FwaS91c2VyL3Bhc3N3b3JkJywgcGFzcylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRVc2VyOiBnZXRVc2VyLFxyXG4gICAgICAgICAgICBnZXRVc2VyRnJvbVN0b3JhZ2U6IGdldFVzZXJGcm9tU3RvcmFnZSxcclxuICAgICAgICAgICAgbG9naW46IGxvZ2luLFxyXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dCxcclxuICAgICAgICAgICAgcmVnaXN0ZXI6IHJlZ2lzdGVyLFxyXG4gICAgICAgICAgICB1cGRhdGVCYXNpYzogdXBkYXRlQmFzaWMsXHJcbiAgICAgICAgICAgIHVwZGF0ZVBhc3N3b3JkOiB1cGRhdGVQYXNzd29yZFxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7IiwiLy8gb3duIGNsYXNzZXMgYW5kIGZ1bmN0aW9uc1xyXG5cclxuLy8gLS0tLS0tLS0tLSBRVUlaIC0tLS0tLS0tLS1cclxudmFyIFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgIC8vIGluZGV4IG9mIGN1cnJlbnQgcXVlc3Rpb25cclxuICAgIHZhciBjdXJyZW50UXVlc3Rpb25JZHggPSBudWxsO1xyXG5cclxuICAgIC8vIGFycmF5IGNvbnRhaW5pbmcgYWxsIHF1ZXN0aW9uc1xyXG4gICAgdmFyIHF1ZXN0aW9ucyA9IFtdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3RhcnRzIHRoZSBxdWl6LlxyXG4gICAgICovXHJcbiAgICB0aGlzLnN0YXJ0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgLy8gY2hlY2sgaWYgcXVpeiBoYXMgcXVlc3Rpb25zXHJcbiAgICAgICAgaWYgKHF1ZXN0aW9ucy5sZW5ndGggPD0gMClcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJDYW5ub3Qgc3RhcnQgYSBxdWl6IHdpdGhvdXQgcXVlc3Rpb25zXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5uZXh0UXVlc3Rpb24oKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5pc0FjdGl2ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhc1N0YXJ0ZWQoKSAmJiAhdGhpcy5oYXNFbmRlZCgpO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmhhc1N0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gY3VycmVudFF1ZXN0aW9uSWR4ICE9PSBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmhhc0VuZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzU3RhcnRlZCgpICYmIGN1cnJlbnRRdWVzdGlvbklkeCA+PSBxdWVzdGlvbnMubGVuZ3RoO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnN1Ym1pdHRlZCA9IGZhbHNlO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIG5ldyBxdWVzdGlvbiB0byB0aGUgcXVpei5cclxuICAgICAqIFRoZSBwYXJhbWV0ZXIgbXVzdCBiZSBhbiBxdWVzdGlvbiBvYmplY3QuXHJcbiAgICAgKiBJZiBubyBxdWVzdGlvbiBvYmplY3QgaXMgcGFzc2VkIG9yIGFuIG9iamVjdCB3aXRoIG1pc3NpbmcgcHJvcGVydGllcywgYW4gZXJyb3IgaXMgdGhyb3duLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmFkZFF1ZXN0aW9uID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcclxuICAgICAgICBpZiAocXVlc3Rpb24gPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJObyBxdWVzdGlvbiBvYmplY3QgcGFzc2VkXCIpO1xyXG5cclxuICAgICAgICB2YXIgdmFsaWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAvLyBhIHF1ZXN0aW9uIG9iamVjdCBtdXN0IGNvbnRhaW4gYWxsIHRoZXNlIHByb3BlcnRpZXNcclxuICAgICAgICB2YXIgbmVjZXNzYXJ5UHJvcGVydGllcyA9IFsnY29uZmlnJywgJ2hpbnQnLCAnc29sdXRpb24nLCAnYW5zd2VyJywgJ3F1ZXN0aW9uJywgJ2dldEluZm8nLCAnaW5mbycsICdwb2ludHMnLCAnYW5zd2VyZWQnLCAnaGludHNBbGxvd2VkJywgJ2hpbnRzUmVtYWluaW5nJ107XHJcblxyXG4gICAgICAgIG5lY2Vzc2FyeVByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICBpZiAoIXF1ZXN0aW9uLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xyXG4gICAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlF1ZXN0aW9uIG11c3QgaGF2ZSBwcm9wZXJ0eSAnXCIgKyBwcm9wZXJ0eSArIFwiJ1wiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodmFsaWQpIHtcclxuICAgICAgICAgICAgcXVlc3Rpb25zLnB1c2gocXVlc3Rpb24pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBuZXh0IHF1ZXN0aW9uIG9mIHRoZSBxdWl6LlxyXG4gICAgICogSWYgdGhlIHF1aXogaGFzIGVuZGVkLCBpdCByZXR1cm5zIG5vdGhpbmcuXHJcbiAgICAgKi9cclxuICAgIHRoaXMubmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRRdWVzdGlvbklkeCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjdXJyZW50UXVlc3Rpb25JZHggPSAwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbklkeCsrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaGFzRW5kZWQoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbklkeF07XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuY3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzQWN0aXZlKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbklkeF07XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0VG90YWxQb2ludHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmhhc1N0YXJ0ZWQoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciB0b3RhbFBvaW50cyA9IDA7XHJcblxyXG4gICAgICAgIHF1ZXN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBwb2ludHMgPSBxdWVzdGlvbi5wb2ludHMoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwb2ludHMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdG90YWxQb2ludHMgKz0gcG9pbnRzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0b3RhbFBvaW50cztcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uSWR4ID09PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbklkeCArIDE7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0TnVtYmVyT2ZRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zLmxlbmd0aDtcclxuICAgIH07XHJcbn07XHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVRVNUSU9OIC0tLS0tLS0tLS1cclxudmFyIFF1ZXN0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG4gICAgLy8gVGV4dCBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciB0ZXh0ID0gbnVsbDtcclxuXHJcbiAgICAvLyBJbmZvIG9iamVjdCBmb3IgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgaW5mbyA9IG51bGw7XHJcblxyXG4gICAgLy8gQW5zd2VyIG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGFuc3dlciA9IG51bGw7XHJcblxyXG4gICAgLy8gSGludHMgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgaGludHMgPSBudWxsO1xyXG4gICAgdmFyIGhpbnRzVXNlZCA9IDA7XHJcblxyXG4gICAgLy8gTGFtYmRhIGZ1bmN0aW9uIHRvIGRldGVybWluZSB0aGUgYW5zd2VyIHN0YXR1cyBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBjaGVja0Fuc3dlciA9IG51bGw7XHJcblxyXG4gICAgLy8gUG9pbnRzIGF3YXJkZWQgZm9yIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIHBvaW50cyA9IG51bGw7XHJcblxyXG4gICAgLy8gRmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgcXVlc3Rpb24gaGFzIGFscmVhZHkgYmVlbiBhbnN3ZXJlZFxyXG4gICAgdmFyIGFuc3dlcmVkID0gZmFsc2U7XHJcblxyXG4gICAgdmFyIGluaXQgPSBmdW5jdGlvbihvcHRzKSB7XHJcbiAgICAgICAgdGV4dCA9IG9wdHMudGV4dDtcclxuICAgICAgICBpbmZvID0gb3B0cy5pbmZvIHx8IHt9O1xyXG4gICAgICAgIGFuc3dlciA9IG9wdHMuYW5zd2VyO1xyXG4gICAgICAgIGNoZWNrQW5zd2VyID0gb3B0cy5jaGVja0Fuc3dlciB8fCBudWxsO1xyXG5cclxuICAgICAgICBoaW50cyA9IG9wdHMuaGludHMgfHwge1xyXG4gICAgICAgICAgICAgICAgYWxsb3dlZDogZmFsc2UsICAgICAvLyBpcyBhIGhpbnQgYWxsb3dlZD9cclxuICAgICAgICAgICAgICAgIG1heGltdW06IDAsICAgICAgICAgLy8gbWF4aW11bSBudW1iZXIgb2YgaGludHMgZm9yIHRoaXMgcXVlc3Rpb24gKGlycmVsZXZhbnQgaWYgYWxsb3dlZCBpcyBzZXQgdG8gZmFsc2UpXHJcbiAgICAgICAgICAgICAgICBjb3N0OiAwLCAgICAgICAgICAgIC8vIG51bWJlciBvZiBwb2ludHMgc3VidHJhY3RlZCBwZXIgdXNlZCBoaW50IChpcnJlbGV2YW50IGlmIGFsbG93ZWQgaXMgc2V0IHRvIGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgZ2l2ZTogbnVsbCAgICAgICAgICAvLyBsYW1iZGEgZnVuY3Rpb24gdG8gZ2l2ZSBhIGhpbnQgZm9yIGEgcXVlc3Rpb25cclxuICAgICAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgICBpbml0KG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY29uZmlnID0gZnVuY3Rpb24ob3B0cykge1xyXG4gICAgICAgIGluaXQob3B0cyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgcXVlc3Rpb24gdGV4dC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5xdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0ZXh0O1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHF1ZXN0aW9uIGluZm8gb2JqZWN0LlxyXG4gICAgICogQWN0cyBhcyBnZXR0ZXIgKHdpdGggb25seSBvbmUgYXJndW1lbnQpIGFuZCBzZXR0ZXIgKHdpdGggdHdvIGFyZ3VtZW50cylcclxuICAgICAqL1xyXG4gICAgdGhpcy5pbmZvID0gZnVuY3Rpb24ocHJvcCwgdmFsdWUpIHtcclxuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAvLyBzZXR0ZXJcclxuICAgICAgICAgICAgaW5mb1twcm9wXSA9IHZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGdldHRlclxyXG4gICAgICAgICAgICByZXR1cm4gaW5mb1twcm9wXTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgZW50aXJlIGluZm8gb2JqZWN0LlxyXG4gICAgICovXHJcbiAgICB0aGlzLmdldEluZm8gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gaW5mbztcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBjb3JyZWN0IGFuc3dlciB0byB0aGUgcXVlc3Rpb24gYWZ0ZXIgdGhlIHF1ZXN0aW9uIGhhcyBiZWVuIGFuc3dlcmVkLlxyXG4gICAgICogSWYgdGhlIHF1ZXN0aW9uIGhhcyBub3QgYmVlbiBhbnN3ZXJlZCB5ZXQsIGl0IHJldHVybnMgbnVsbC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5zb2x1dGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChhbnN3ZXJlZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYW5zd2VyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIGhpbnQgZm9yIHRoZSBxdWVzdGlvbi5cclxuICAgICAqIElmIG5vIGhpbnRzIGFyZSBhbGxvd2VkLCBvciB0aGUgbWF4aW11bSBudW1iZXIgb2YgaGludHMgaGF2ZSBiZWVuIHVzZWQsIG51bGwgaXMgcmV0dXJuZWQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaGludCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICghaGludHMuYWxsb3dlZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChoaW50cy5hbGxvd2VkICYmICFoaW50cy5naXZlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhpbnRzIGFsbG93ZWQgYnV0IG5vIGdpdmUgbWV0aG9kIHBhc3NlZFwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChoaW50c1VzZWQgPCBoaW50cy5tYXhpbXVtKSB7XHJcbiAgICAgICAgICAgIGhpbnRzVXNlZCsrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGhpbnRzLmdpdmUoaGludHNVc2VkLCBhbnN3ZXIpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN1Ym1pdHMgYW4gYW5zd2VyIHRvIHRoZSBxdWVzdGlvbi5cclxuICAgICAqIElmIHRoZSBxdWVzdGlvbiBoYXMgYWxyZWFkeSBiZWVuIGFuc3dlcmVkIG9yIG5vIGNoZWNrQW5zd2VyIGxhbWJkYSBoYXMgYmVlbiBzZXQsIHRoaXMgbWV0aG9kIGRvZXMgbm90aGluZy5cclxuICAgICAqL1xyXG4gICAgdGhpcy5hbnN3ZXIgPSBmdW5jdGlvbihzdWJtaXR0ZWRBbnN3ZXIpIHtcclxuICAgICAgICBpZiAoYW5zd2VyZWQgfHwhY2hlY2tBbnN3ZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYW5zd2VyZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAvLyBjaGVja0Fuc3dlciBtZXRob2Qgc2hvdWxkIHJldHVybiB0aGUgc3RhdHVzIHJlc3VsdHNcclxuICAgICAgICBwb2ludHMgPSBjaGVja0Fuc3dlcihhbnN3ZXIsIHN1Ym1pdHRlZEFuc3dlciwgaGludHNVc2VkLCBoaW50cy5jb3N0LCBpbmZvKTtcclxuXHJcbiAgICAgICAgLy8gZW5zdXJlIHRoYXQgbm8gbmVnYXRpdmUgcG9pbnRzIGFyZSBhd2FyZGVkXHJcbiAgICAgICAgcG9pbnRzID0gTWF0aC5tYXgoMCwgcG9pbnRzKTtcclxuXHJcbiAgICAgICAgLy8gZW5zdXJlIHRoYXQgb25seSBpbnRlZ2VyIHZhbHVlcyBhcmUgc2F2ZWRcclxuICAgICAgICBwb2ludHMgPSBNYXRoLmZsb29yKHBvaW50cyk7XHJcblxyXG4gICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCFhbnN3ZXJlZCB8fCBwb2ludHMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHN0YXRlIG9mIHRoZSBxdWVzdGlvbi5cclxuICAgICAqL1xyXG4gICAgdGhpcy5hbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBhbnN3ZXJlZDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgaGludHMgYXJlIGFsbG93ZWQgZm9yIHRoaXMgcXVlc3Rpb24sIGZhbHNlIGlmIG5vdC5cclxuICAgICAqIElmIGhpbnRzIGhhdmUgbm90IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmhpbnRzQWxsb3dlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaGludHMuYWxsb3dlZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiByZW1haW5pbmcgaGludHMuXHJcbiAgICAgKiBJZiBubyBoaW50cyBhcmUgYWxsb3dlZCBmb3IgdGhpcyBxdWVzdGlvbiwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50c1JlbWFpbmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhbGxvd2VkID0gdGhpcy5oaW50c0FsbG93ZWQoKTtcclxuXHJcbiAgICAgICAgaWYgKGFsbG93ZWQgPT09IG51bGwgfHwgYWxsb3dlZCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gaGludHMubWF4aW11bSAtIGhpbnRzVXNlZDtcclxuICAgIH07XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyBhIHJhbmRvbSBpbnRlZ2VyIGJldHdlZW4gbWluIChpbmNsdXNpdmUpIGFuZCBtYXggKGluY2x1c2l2ZSlcclxuICogVXNpbmcgTWF0aC5yb3VuZCgpIHdpbGwgZ2l2ZSB5b3UgYSBub24tdW5pZm9ybSBkaXN0cmlidXRpb24hXHJcbiAqL1xyXG52YXIgZ2V0UmFuZG9tSW50ID0gZnVuY3Rpb24obWluLCBtYXgpIHtcclxuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgdGhlIHRleHQgYmV0d2VlbiB0d28gZGVsaW1pdGluZyB0ZXh0IG9jY3VycmVuY2VzXHJcbiAqL1xyXG52YXIgZ2V0U3RyaW5nQmV0d2VlbiA9IGZ1bmN0aW9uKHRleHQsIGZpcnN0U3RyaW5nLCBzZWNvbmRTdHJpbmcpIHtcclxuICAgIHZhciBmaXJzdFBvcyA9IHRleHQuaW5kZXhPZihmaXJzdFN0cmluZyk7XHJcbiAgICB2YXIgc2Vjb25kUG9zID0gdGV4dC5pbmRleE9mKHNlY29uZFN0cmluZyk7XHJcblxyXG4gICAgaWYgKGZpcnN0UG9zID49IDAgJiYgc2Vjb25kUG9zID49IDAgJiYgc2Vjb25kUG9zID4gZmlyc3RQb3MpIHtcclxuICAgICAgICByZXR1cm4gdGV4dC5zdWJzdHIoZmlyc3RQb3MgKyAxLCBzZWNvbmRQb3MgLSBmaXJzdFBvcyAtIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cy5RdWVzdGlvbiA9IFF1ZXN0aW9uO1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuUXVpeiA9IFF1aXo7XHJcbn0iLCJhbmd1bGFyLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAgICAgIC8vIGVuYWJsZSBIVE1MNSBwdXNoc3RhdGVcclxuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcblxyXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9ob21lJyk7XHJcblxyXG4gICAgICAgIHZhciBhdXRob3JpemUgPSBmdW5jdGlvbihBdXRoU3J2LCBMb2dTcnYsICRxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBBdXRoU3J2LmdldFVzZXIoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KCdOb3QgYXV0aG9yaXplZCcpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hvbWUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvaG9tZS5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncXVpeicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9xdWl6JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3F1aXoucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdjb3VudHJpZXMnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvY291bnRyaWVzJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2NvdW50cmllcy5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2NvdW50cmllcy5kZXRhaWwnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvOmFscGhhM0NvZGUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvY291bnRyaWVzLWRldGFpbC5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2xvZ2luLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9nb3V0JyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dvdXRDdHJsJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3JlZ2lzdGVyLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdzZXR0aW5ncycsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9zZXR0aW5ncycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9zZXR0aW5ncy5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3Bhc3N3b3JkJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3Bhc3N3b3JkJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3Bhc3N3b3JkLnBhcnRpYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogYXV0aG9yaXplXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnYWJvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvYWJvdXQnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvYWJvdXQucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hpZ2hzY29yZScsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9oaWdoc2NvcmUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvaGlnaHNjb3JlLnBhcnRpYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogYXV0aG9yaXplXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnZmFxJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2ZhcScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9mYXEucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdjb3VudHJpZXMtZGlmZmljdWx0eScsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9jb3VudHJpZXMtZGlmZmljdWx0eScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9jb3VudHJ5LWRpZmZpY3VsdHkucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdDb3VudHJpZXNDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBDb3VudHJ5U3J2KSB7XHJcbiAgICAgICAgdmFyIGNvdW50cmllc0J5TGV0dGVyID0gbnVsbDtcclxuICAgICAgICB2YXIgY291bnRyeUtleXMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjb3VudHJpZXNCeUxldHRlciA9IENvdW50cnlTcnYuZ2V0Q291bnRyaWVzQnlMZXR0ZXIoKTtcclxuICAgICAgICAgICAgY291bnRyeUtleXMgPSBPYmplY3Qua2V5cyhjb3VudHJpZXNCeUxldHRlcik7XHJcblxyXG4gICAgICAgICAgICBpZiAoISRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJ5S2V5cyA9IGNvdW50cnlLZXlzO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJpZXNCeUxldHRlciA9IGNvdW50cmllc0J5TGV0dGVyO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyeUtleXMgPSBjb3VudHJ5S2V5cztcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJpZXNCeUxldHRlciA9IGNvdW50cmllc0J5TGV0dGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKENvdW50cnlTcnYuYXJlQ291bnRyaWVzTG9hZGVkKCkpIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignY291bnRyaWVzLmxvYWRlZCcsIGZ1bmN0aW9uKCkgIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0NvdW50cnlEZXRhaWxDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBDb3VudHJ5U3J2LCAkc3RhdGVQYXJhbXMpIHtcclxuICAgICAgICB2YXIgYWxwaGEzQ29kZSA9ICRzdGF0ZVBhcmFtcy5hbHBoYTNDb2RlO1xyXG5cclxuICAgICAgICBpZiAoQ291bnRyeVNydi5hcmVDb3VudHJpZXNMb2FkZWQoKSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhM0NvZGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignY291bnRyaWVzLmxvYWRlZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cnkgPSBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTNDb2RlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cnlGcm9tU2VydmljZSA9IGZ1bmN0aW9uKGFscGhhMykge1xyXG4gICAgICAgICAgICByZXR1cm4gQ291bnRyeVNydi5nZXRDb3VudHJ5QnlBbHBoYTMoYWxwaGEzKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0Q291bnRyeUZyb21TZXJ2aWNlID0gZ2V0Q291bnRyeUZyb21TZXJ2aWNlO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0NvdW50cnlEaWZmaWN1bHR5Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgQ291bnRyeVNydikge1xyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBjb3VudHJpZXMgPSBDb3VudHJ5U3J2LmdldENvdW50cmllcygpO1xyXG4gICAgICAgICAgICB2YXIgZGlmZmljdWx0aWVzID0ge1xyXG4gICAgICAgICAgICAgICAgJ2Vhc3knOiBbXSxcclxuICAgICAgICAgICAgICAgICdtZWRpdW0nOiBbXSxcclxuICAgICAgICAgICAgICAgICdoYXJkJzogW10sXHJcbiAgICAgICAgICAgICAgICAndW5hc3NpZ25lZCc6IFtdXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvLyBkZXRlcm1pbmUgZGlmZmljdWx0eVxyXG4gICAgICAgICAgICBjb3VudHJpZXMuc29ydChmdW5jdGlvbihhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYi5wb3B1bGF0aW9uIC0gYS5wb3B1bGF0aW9uO1xyXG4gICAgICAgICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uKGMpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgZGlmZmljdWx0aWVzW2MuZGlmZmljdWx0eV0ucHVzaChjKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLiQkcGhhc2UpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kaWZmaWN1bHRpZXMgPSBkaWZmaWN1bHRpZXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGlmZmljdWx0eUtleXMgPSBPYmplY3Qua2V5cyhkaWZmaWN1bHRpZXMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlmZmljdWx0aWVzID0gZGlmZmljdWx0aWVzO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kaWZmaWN1bHR5S2V5cyA9IE9iamVjdC5rZXlzKGRpZmZpY3VsdGllcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmIChDb3VudHJ5U3J2LmFyZUNvdW50cmllc0xvYWRlZCgpKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ2NvdW50cmllcy5sb2FkZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignRHJvcGRvd25DdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7XHJcbiAgICAgICAgdmFyIHZpc2libGUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnRvZ2dsZURyb3Bkb3duID0gdG9nZ2xlRHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLnNob3dEcm9wZG93biA9IHNob3dEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuaGlkZURyb3Bkb3duID0gaGlkZURyb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5pc0Ryb3Bkb3duVmlzaWJsZSA9IGlzRHJvcGRvd25WaXNpYmxlO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdjbGljay5vdXRzaWRlJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGlzRHJvcGRvd25WaXNpYmxlKCkpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhpZGVEcm9wZG93bigpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRlRHJvcGRvd24oKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB0b2dnbGVEcm9wZG93bigpIHtcclxuICAgICAgICAgICAgdmlzaWJsZSA9ICF2aXNpYmxlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd0Ryb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhpZGVEcm9wZG93bigpIHtcclxuICAgICAgICAgICAgdmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNEcm9wZG93blZpc2libGUoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2aXNpYmxlO1xyXG4gICAgICAgIH1cclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdIaWdoc2NvcmVDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBTY29yZVNydiwgTG9nU3J2KSB7XHJcbiAgICAgICAgJHNjb3BlLnNjb3JlTGlzdCA9IFtdO1xyXG5cclxuICAgICAgICBTY29yZVNydi5nZXRIaWdoc2NvcmVMaXN0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNjb3JlTGlzdCA9IGNyZWF0ZVJhbmtpbmcobGlzdCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zY29yZUxpc3QgPSBjcmVhdGVSYW5raW5nKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBpc015c2VsZiA9IGZ1bmN0aW9uKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXNlci5faWQgPT09IGlkO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVSYW5raW5nID0gZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICB2YXIgcmFuayA9IDA7XHJcblxyXG4gICAgICAgICAgICB2YXIgcHJldmlvdXNTY29yZSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24oZW50cnkpIHtcclxuICAgICAgICAgICAgICAgIGlmICghcHJldmlvdXNTY29yZSB8fCBlbnRyeS5zY29yZSAhPT0gcHJldmlvdXNTY29yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJhbmsrKztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZW50cnkucmFuayA9IHJhbmsgKyAnLic7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcHJldmlvdXNTY29yZSA9IGVudHJ5LnNjb3JlO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBsaXN0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5pc015c2VsZiA9IGlzTXlzZWxmO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0hvbWVDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBMb2dTcnYsICRzdGF0ZVBhcmFtcykge1xyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gY2hlY2sgc3RhdGUgcGFyYW1zXHJcbiAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5hY3Rpb24pIHtcclxuICAgICAgICAgICAgdmFyIGFjdGlvbiA9ICRzdGF0ZVBhcmFtcy5hY3Rpb247XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKGFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAncmVnaXN0ZXIuc3VjY2Vzc2Z1bCc6XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0dyYXR1bGF0aW9uISBEaWUgQW5tZWxkdW5nIHdhciBlcmZvbGdyZWljaC4gSGVyemxpY2ggd2lsbGtvbW1lbiBiZWkgTWFnZWxsYW4uJ1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICBVc2VyU3J2LmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dpbiBldmVudFxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ2luJywgcmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLnN0YXR1cyA9PT0gNDAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0ZhbHNjaGVyIEJlbnV0emVybmFtZSBvZGVyIFBhc3N3b3J0JztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdCZWltIEVpbmxvZ2dlbiBzY2hlaW50IGV0d2FzIHNjaGllZiBnZWdhbmdlbiB6dSBzZWluJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCcjdXNlcm5hbWUnKTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdMb2dvdXRDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2KSB7XHJcbiAgICAgICAgVXNlclNydi5sb2dvdXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ291dCBldmVudFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9nb3V0Jyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1Bhc3N3b3JkQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgTG9nU3J2LCBGb2N1c1Nydikge1xyXG4gICAgICAgICRzY29wZS5wYXNzT2JqID0ge307XHJcbiAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7fTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZVBhc3N3b3JkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghJHNjb3BlLnBhc3NPYmoub2xkIHx8ICEkc2NvcGUucGFzc09iai5uZXcgfHwgISRzY29wZS5wYXNzT2JqLmNvbmZpcm1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnQWxsZSBGZWxkZXIgbcO8c3NlbiBhdXNnZWbDvGxsdCBzZWluJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnBhc3NPYmoubmV3ICE9PSAkc2NvcGUucGFzc09iai5jb25maXJtYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0RpZSBQYXNzd8O2cnRlciBzdGltbWVuIG5pY2h0IMO8YmVyZWluJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBVc2VyU3J2LnVwZGF0ZVBhc3N3b3JkKHtcclxuICAgICAgICAgICAgICAgIG9sZDogJHNjb3BlLnBhc3NPYmoub2xkLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICRzY29wZS5wYXNzT2JqLm5ld1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ3N1Y2Nlc3MnLCAnRGFzIG5ldWUgUGFzc3dvcnQgd3VyZGUgZXJmb2xncmVpY2ggZ2VzcGVpY2hlcnQnKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyLm1lc3NhZ2UgPT09IFwiT2xkIHBhc3N3b3JkIGluY29ycmVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnRGFzIGFsdGUgUGFzc3dvcnQgaXN0IG5pY2h0IGtvcnJla3QnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnRGFzIG5ldWUgUGFzc3dvcnQga29ubnRlIG5pY2h0IGdlc3BlaWNoZXJ0IHdlcmRlbicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGVsZWdhdGVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdXBkYXRlUGFzc3dvcmQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0TWVzc2FnZSA9IGZ1bmN0aW9uKHR5cGUsIHRleHQpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBGb2N1c1NydignI3Bhc3N3b3JkLWN1cnJlbnQnKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnVwZGF0ZVBhc3N3b3JkID0gdXBkYXRlUGFzc3dvcmQ7XHJcbiAgICAgICAgJHNjb3BlLmRlbGVnYXRlU3VibWl0ID0gZGVsZWdhdGVTdWJtaXQ7XHJcbiAgICB9KTsiLCJcclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1F1aXpEaXJlY3RpdmVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCBRdWl6U3J2LCBMb2dTcnYsIEZvY3VzU3J2LCBuZ1Byb2dyZXNzRmFjdG9yeSwgJGZpbHRlcikge1xyXG4gICAgICAgIHZhciBxdWVzdGlvbjtcclxuXHJcbiAgICAgICAgdmFyIGluaXRDdHJsID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIFByb2dyZXNzIGJhciBpbml0aWFsaXphdGlvblxyXG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIgPSBuZ1Byb2dyZXNzRmFjdG9yeS5jcmVhdGVJbnN0YW5jZSgpO1xyXG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0UGFyZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXByb2dyZXNzJykpO1xyXG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0QWJzb2x1dGUoKTtcclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldENvbG9yKFwiIzMzNmU3YlwiKTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5pc1Jlc3VsdHNQYWdlVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuYWNoaWV2ZW1lbnRzID0gW107XHJcbiAgICAgICAgICAgICRzY29wZS5iZXN0cyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0ID0ge307XHJcbiAgICAgICAgICAgICRzY29wZS5oaW50ID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIC8vIGFkZCBvcHRpb25zIGZvciBtdWx0aXBsaWVyIHNlbGVjdGlvblxyXG4gICAgICAgICAgICAkc2NvcGUubXVsdGlwbGllck9wdGlvbnMgPSBbXHJcbiAgICAgICAgICAgICAgICB7IHZhbHVlOiAxLCBsYWJlbDogJycgfSxcclxuICAgICAgICAgICAgICAgIHsgdmFsdWU6IDEwMDAsIGxhYmVsOiAnVHNkLid9LFxyXG4gICAgICAgICAgICAgICAgeyB2YWx1ZTogMTAwMDAwMCwgbGFiZWw6ICdNaW8uJ31cclxuICAgICAgICAgICAgXTtcclxuXHJcbiAgICAgICAgICAgIHF1ZXN0aW9uID0gbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlVWkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gZ2V0IGN1cnJlbnQgcXVlc3Rpb24gZnJvbSBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgcXVlc3Rpb24gPSBRdWl6U3J2LmdldEN1cnJlbnRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgLy8gZGVsZXRlIHByZXZpb3VzIGhpbnRzXHJcbiAgICAgICAgICAgICRzY29wZS5oaW50ID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGlmIChxdWVzdGlvbiAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgLy8gbXVsdGlwbGllcnMgZm9yIHF1ZXN0aW9ucyBjb250YWluaW5nIG51bWJlcnNcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQgJiYgcXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0LmluZGV4T2YoJ251bWJlcicpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyLmhpZ2gnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIgPSB7IHZhbHVlOiAxMDAwMDAwLCBsYWJlbDogJ01pby4nfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyLm1lZGl1bSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IHsgdmFsdWU6IDEwMDAsIGxhYmVsOiAnVHNkLid9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIgPSB7IHZhbHVlOiAxLCBsYWJlbDogJycgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBwcm9ncmVzcyBiYXJcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVByb2dyZXNzQmFyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gZm9jdXMgYW5zd2VyIGlucHV0XHJcbiAgICAgICAgICAgICAgICBGb2N1c1NydignLmFuc3dlcklucHV0Jyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBxdWl6IGhhcyBlbmRlZCwgc2V0IHByb2dyZXNzIGJhciB0byAwXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0KDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlbmRlclF1ZXN0aW9uVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyKGdldFF1ZXN0aW9uKCkucXVlc3Rpb24oKSwgJ3F1ZXN0aW9uLWhpZ2hsaWdodCcpICsgJz8nO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbk1lZGlhID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghcXVlc3Rpb24gfHwgIXF1ZXN0aW9uLmdldEluZm8oKS5tZWRpYSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmdldEluZm8oKS5tZWRpYTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2hvd1Jlc3VsdHNQYWdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5pc1Jlc3VsdHNQYWdlVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhpZGVSZXN1bHRzUGFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLiQkcGhhc2UpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pc1Jlc3VsdHNQYWdlVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhpbnRzQXZhaWxhYmxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWVzdGlvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocXVlc3Rpb24uaGludHNSZW1haW5pbmcoKSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uaGludHNSZW1haW5pbmcoKSA+IDA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHN1Ym1pdEFuc3dlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmFuc3dlcklucHV0LmFuc3dlciAmJiAhcXVlc3Rpb24uYW5zd2VyZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFuc3dlciA9IFN0cmluZygkc2NvcGUuYW5zd2VySW5wdXQuYW5zd2VyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpZiBpdCBpcyBhIG51bWJlciBpbnB1dCwgcmVwbGFjZSAnLCcgd2l0aCAnLidcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQgJiYgcXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0LmluZGV4T2YoJ251bWJlcicpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5zd2VyID0gYW5zd2VyLnJlcGxhY2UoJywnLCAnLicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGlmIGEgbXVsdGlwbGllciBpcyBhdmFpbGFibGUsIGNhbGN1bGF0ZSBhbnN3ZXJcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuc3dlciAqPSAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllci52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQucG9pbnRzID0gcXVlc3Rpb24uYW5zd2VyKGFuc3dlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGZvY3VzXHJcbiAgICAgICAgICAgICAgICBpZiAoIXdhc0xhc3RRdWVzdGlvbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRm9jdXNTcnYoJyNidG5OZXh0UXVlc3Rpb24nKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRm9jdXNTcnYoJyNidG5Db250aW51ZUZpbmlzaGVkICAnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbkFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghUXVpelNydi5pc1F1aXpSdW5uaW5nKCkgfHwgcXVlc3Rpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmFuc3dlcmVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBRdWl6U3J2Lm5leHRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0LmFuc3dlciA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICB1cGRhdGVVaSgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXF1ZXN0SGludCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuaGludCA9IHF1ZXN0aW9uLmhpbnQoKTtcclxuXHJcbiAgICAgICAgICAgIEZvY3VzU3J2KCcuYW5zd2VySW5wdXQnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVuZGVyID0gZnVuY3Rpb24odGV4dCwgY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIltcIiwgXCI8c3BhbiBjbGFzcz0nXCIgKyBjbGFzc05hbWUgKyBcIic+XCIpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIl1cIiwgXCI8L3NwYW4+XCIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoYW5kbGVLZXlQcmVzcyA9IGZ1bmN0aW9uKGtleUV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChrZXlFdmVudC53aGljaCA9PSAxMykge1xyXG4gICAgICAgICAgICAgICAgc3VibWl0QW5zd2VyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlUHJvZ3Jlc3NCYXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHByb2dyZXNzUGVyY2VudCA9IGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpIC8gZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCkgKiAxMDA7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0KHByb2dyZXNzUGVyY2VudCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHdhc0xhc3RRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCkgPj0gZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHBhcnNlRXZlbnRzID0gZnVuY3Rpb24oZXZlbnRzLCBwZXJzb25hbEJlc3QsIG92ZXJhbGxCZXN0KSB7XHJcbiAgICAgICAgICAgIHZhciBhY2hpZXZlbWVudHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzaG93QmVzdHMgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGV2ZW50cy5pbmRleE9mKCdvdmVyYWxsX2Jlc3QnKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZWluZW4gbmV1ZW4gYWJzb2x1dGVuIFJla29yZCBnZXNjaGFmZnQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0Jlc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZignb3ZlcmFsbF9iZXN0X2VxdWFsaXNlZCcpID49IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBkZW4gYWt0dWVsbGVuIGFic29sdXRlbiBSZWtvcmQgZWluZ2VzdGVsbHQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0Jlc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZigncGVyc29uYWxfYmVzdCcpID49IDAgJiYgZXZlbnRzLmluZGV4T2YoJ292ZXJhbGxfYmVzdCcpIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEdSBoYXN0IGVpbmVuIG5ldWVuIHBlcnPDtm5saWNoZW4gUmVrb3JkIGdlc2NoYWZmdCEnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzaG93QmVzdHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGV2ZW50cy5pbmRleE9mKCdwZXJzb25hbF9iZXN0X2VxdWFsaXNlZCcpID49IDAgJiYgZXZlbnRzLmluZGV4T2YoJ292ZXJhbGxfYmVzdF9lcXVhbGlzZWQnKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBnbGVpY2ggdmllbGUgUHVua3RlIGdlc2NoYWZmdCB3aWUgYmVpIGRlaW5lbSBwZXJzw7ZubGljaGVuIFJla29yZCEnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzaG93QmVzdHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGV2ZW50cy5pbmRleE9mKCduZXdfZGFpbHlfYmVzdCcpID49IDAgJiYgYWNoaWV2ZW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEdSBoYXN0IGVpbmVuIG5ldWVuIHBlcnPDtm5saWNoZW4gVGFnZXNyZWtvcmQgZ2VzY2hhZmZ0ISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYWNoaWV2ZW1lbnRzID0gYWNoaWV2ZW1lbnRzO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNob3dCZXN0cyAmJiBwZXJzb25hbEJlc3QgJiYgcGVyc29uYWxCZXN0LmlkICYmIHBlcnNvbmFsQmVzdC5kYXRlICYmIHBlcnNvbmFsQmVzdC5zY29yZSAmJiBvdmVyYWxsQmVzdCAmJiBvdmVyYWxsQmVzdC5pZCAmJiBvdmVyYWxsQmVzdC5kYXRlICYmIG92ZXJhbGxCZXN0LnNjb3JlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmVzdHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICBvdmVyYWxsQmVzdC50eXBlID0gJ292ZXJhbGwnO1xyXG4gICAgICAgICAgICAgICAgYmVzdHMucHVzaChvdmVyYWxsQmVzdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHBlcnNvbmFsQmVzdC5pZCAhPT0gb3ZlcmFsbEJlc3QuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBwZXJzb25hbEJlc3QudHlwZSA9ICdwZXJzb25hbCc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJlc3RzLnB1c2gocGVyc29uYWxCZXN0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYmVzdHMgPSBiZXN0cztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5iZXN0cyA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY29udGludWVGaW5pc2hlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBzaG93UmVzdWx0c1BhZ2UoKTtcclxuXHJcbiAgICAgICAgICAgIG5leHRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgLy8gY29uY2x1ZGUgdGhlIHF1aXogYW5kIHdyaXRlIHJlc3VsdCB0byBkYXRhYmFzZVxyXG4gICAgICAgICAgICBRdWl6U3J2LmNvbmNsdWRlKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJzZUV2ZW50cyhkYXRhLmV2ZW50cyB8fCBbXSwgZGF0YS5wZXJzb25hbEJlc3QsIGRhdGEub3ZlcmFsbEJlc3QpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRCZXN0VGV4dCA9IGZ1bmN0aW9uKGJlc3QpIHtcclxuICAgICAgICAgICAgdmFyIHRleHQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoYmVzdC50eXBlID09PSAncGVyc29uYWwnKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBwZXJzb25hbCBiZXN0XHJcbiAgICAgICAgICAgICAgICB0ZXh0ID0gXCJEZWluIHBlcnPDtm5saWNoZXIgUmVrb3JkIGxpZWd0IGJlaSA8c3BhbiBjbGFzcz0nYm9sZCc+e1BPSU5UU30gUHVua3Rlbjwvc3Bhbj4sIGF1Zmdlc3RlbGx0IGFtIHtEQVRFfS5cIjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIG92ZXJhbGwgYmVzdFxyXG4gICAgICAgICAgICAgICAgdmFyIGZyb21NeXNlbGYgPSBiZXN0LmlkID09PSAkc2NvcGUudXNlci5faWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGZyb21NeXNlbGYpIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gXCJEdSBow6RsdHN0IGRlbiBhYnNvbHV0ZW4gUmVrb3JkIG1pdCA8c3BhbiBjbGFzcz0nYm9sZCc+e1BPSU5UU30gUHVua3Rlbjwvc3Bhbj4sIGF1Zmdlc3RlbGx0IGFtIHtEQVRFfS5cIjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IFwiPHNwYW4gY2xhc3M9J2hpZ2hsaWdodCc+e1VTRVJOQU1FfTwvc3Bhbj4gaMOkbHQgZGVuIGFic29sdXRlbiBSZWtvcmQgbWl0IDxzcGFuIGNsYXNzPSdib2xkJz57UE9JTlRTfSBQdW5rdGVuPC9zcGFuPiwgYXVmZ2VzdGVsbHQgYW0ge0RBVEV9LlwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKCd7UE9JTlRTfScsICRmaWx0ZXIoJ251bWJlcicpKGJlc3Quc2NvcmUpKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoJ3tEQVRFfScsIGdldEZvcm1hdHRlZERhdGUoYmVzdC5kYXRlKSlcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7VVNFUk5BTUV9JywgYmVzdC51c2VybmFtZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEZvcm1hdHRlZERhdGUgPSBmdW5jdGlvbihkYXRlKSB7XHJcbiAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBwYWQoZGF0ZS5nZXREYXRlKCksICcwMCcpICsgJy4nICsgcGFkKGRhdGUuZ2V0TW9udGgoKSArIDEsICcwMCcpICsgJy4nICsgKGRhdGUuZ2V0WWVhcigpICsgMTkwMCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHBhZCA9IGZ1bmN0aW9uKHN0ciwgcGFkVmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhwYWRWYWx1ZSArIHN0cikuc2xpY2UoLXBhZFZhbHVlLmxlbmd0aCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlc3RhcnRRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHF1aXogPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdxdWl6LnJlc3RhcnQnKTtcclxuXHJcbiAgICAgICAgICAgIGluaXRDdHJsKCk7XHJcblxyXG4gICAgICAgICAgICB1cGRhdGVVaSgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBlbnRlckxpc3RlbmVyID0gZnVuY3Rpb24oa2V5UHJlc3MsIGZ1bmMpIHtcclxuICAgICAgICAgICAgaWYgKGtleVByZXNzLndoaWNoID09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGZ1bmMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICduZXh0X3F1ZXN0aW9uJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dFF1ZXN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdjb250aW51ZV9maW5pc2hlZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlRmluaXNoZWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbigncXVpei5zdGFydCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGhpZGVSZXN1bHRzUGFnZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXIgaXMgYmVpbmcgZGVzdHJveWVkIChpLmUuIHVzZXIgbGVhdmVzIHRoZSBwYWdlLCBzbyB3ZSB0ZWxsIHRoZSBxdWl6IHNlcnZpY2UgdG8gZGlzcG9zZSBvZiB0aGUgcXVpeiBvYmplY3RcclxuICAgICAgICAgICAgaWYgKFF1aXpTcnYuaGFzUXVpelN0YXJ0ZWQoKSAmJiBRdWl6U3J2Lmhhc1F1aXpFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICBRdWl6U3J2LmRpc3Bvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBpbml0IGNvbnRyb2xsZXJcclxuICAgICAgICBpbml0Q3RybCgpO1xyXG5cclxuICAgICAgICAvLyBpbml0aWFsbHkgdXBkYXRlIFVJXHJcbiAgICAgICAgdXBkYXRlVWkoKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmdldFF1ZXN0aW9uID0gZ2V0UXVlc3Rpb247XHJcbiAgICAgICAgJHNjb3BlLmdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcjtcclxuICAgICAgICAkc2NvcGUucmVuZGVyUXVlc3Rpb25UZXh0ID0gcmVuZGVyUXVlc3Rpb25UZXh0O1xyXG4gICAgICAgICRzY29wZS5zdWJtaXRBbnN3ZXIgPSBzdWJtaXRBbnN3ZXI7XHJcbiAgICAgICAgJHNjb3BlLnF1ZXN0aW9uQW5zd2VyZWQgPSBxdWVzdGlvbkFuc3dlcmVkO1xyXG4gICAgICAgICRzY29wZS5uZXh0UXVlc3Rpb24gPSBuZXh0UXVlc3Rpb247XHJcbiAgICAgICAgJHNjb3BlLmhhbmRsZUtleVByZXNzID0gaGFuZGxlS2V5UHJlc3M7XHJcbiAgICAgICAgJHNjb3BlLmdldFF1ZXN0aW9uTWVkaWEgPSBnZXRRdWVzdGlvbk1lZGlhO1xyXG4gICAgICAgICRzY29wZS5yZXF1ZXN0SGludCA9IHJlcXVlc3RIaW50O1xyXG4gICAgICAgICRzY29wZS53YXNMYXN0UXVlc3Rpb24gPSB3YXNMYXN0UXVlc3Rpb247XHJcbiAgICAgICAgJHNjb3BlLmNvbnRpbnVlRmluaXNoZWQgPSBjb250aW51ZUZpbmlzaGVkO1xyXG4gICAgICAgICRzY29wZS5nZXRCZXN0VGV4dCA9IGdldEJlc3RUZXh0O1xyXG4gICAgICAgICRzY29wZS5yZXN0YXJ0UXVpeiA9IHJlc3RhcnRRdWl6O1xyXG4gICAgICAgICRzY29wZS5oaW50c0F2YWlsYWJsZSA9IGhpbnRzQXZhaWxhYmxlO1xyXG4gICAgICAgICRzY29wZS5lbnRlckxpc3RlbmVyID0gZW50ZXJMaXN0ZW5lcjtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2KSB7XHJcblxyXG4gICAgICAgIHZhciBzdGFydFF1aXogPSBmdW5jdGlvbihjYikge1xyXG4gICAgICAgICAgICBRdWl6U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNiICYmIHR5cGVvZiBjYiA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaXNRdWl6UnVubmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5pc1F1aXpSdW5uaW5nKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2Lmhhc1F1aXpTdGFydGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5oYXNRdWl6RW5kZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG90YWxQb2ludHMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0VG90YWxQb2ludHMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdxdWl6LnJlc3RhcnQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBRdWl6U3J2LmRpc3Bvc2UoKTtcclxuXHJcbiAgICAgICAgICAgIHN0YXJ0UXVpeihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdxdWl6LnN0YXJ0Jyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkc2NvcGUuc3RhcnRRdWl6ID0gc3RhcnRRdWl6O1xyXG4gICAgICAgICRzY29wZS5pc1F1aXpSdW5uaW5nID0gaXNRdWl6UnVubmluZztcclxuICAgICAgICAkc2NvcGUuaGFzUXVpelN0YXJ0ZWQgPSBoYXNRdWl6U3RhcnRlZDtcclxuICAgICAgICAkc2NvcGUuaGFzUXVpekVuZGVkID0gaGFzUXVpekVuZGVkO1xyXG4gICAgICAgICRzY29wZS5nZXRUb3RhbFBvaW50cyA9IGdldFRvdGFsUG9pbnRzO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgTG9nU3J2LCBGb2N1c1NydiwgVXNlclNydiwgJHN0YXRlLCAkd2luZG93KSB7XHJcbiAgICAgICAgLy8gbmV3IHVzZXIgb2JqZWN0XHJcbiAgICAgICAgJHNjb3BlLm5ld1VzZXIgPSB7fTtcclxuXHJcbiAgICAgICAgLy8gbWVzc2FnZSBvYmplY3RcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciByZWdpc3RlciA9IGZ1bmN0aW9uIChpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNWYWxpZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodmFsaWRhdGVCZWZvcmVTdWJtaXQoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gcGVyZm9ybSBhcGkgY2FsbFxyXG4gICAgICAgICAgICAgICAgVXNlclNydi5yZWdpc3Rlcigkc2NvcGUubmV3VXNlcilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHAgY29udHJvbGxlciBhYm91dCBsb2dpblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdCB0byBob21lIHBhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdyZWdpc3Rlci5zdWNjZXNzZnVsJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdCZWkgZGVyIEFubWVsZHVuZyBzY2hlaW50IGV0d2FzIHNjaGllZiBnZWdhbmdlbiB6dSBzZWluJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChlcnIubWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnVXNlcm5hbWUgYWxyZWFkeSBleGlzdHMnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RlciBCZW51dHplcm5hbWUgZXhpc3RpZXJ0IGJlcmVpdHMnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnQmVpIGRlciBBbm1lbGR1bmcgc2NoZWludCBldHdhcyBzY2hpZWYgZ2VnYW5nZW4genUgc2Vpbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLiQkcGhhc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHZhbGlkYXRlQmVmb3JlU3VibWl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSB0d28gcGFzc3dvcmRzIG1hdGNoXHJcbiAgICAgICAgICAgIHZhciBwYXNzd29yZCA9ICRzY29wZS5uZXdVc2VyLnBhc3N3b3JkO1xyXG4gICAgICAgICAgICB2YXIgcGFzc3dvcmQyID0gJHNjb3BlLm5ld1VzZXIucGFzc3dvcmQyO1xyXG5cclxuICAgICAgICAgICAgaWYgKCEkc2NvcGUubmV3VXNlci51c2VybmFtZSB8fCAhJHNjb3BlLm5ld1VzZXIuZW1haWwgfHwgIXBhc3N3b3JkIHx8ICFwYXNzd29yZDIpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0FsbGUgRmVsZGVyIG3DvHNzZW4gYXVzZ2Vmw7xsbHQgc2VpbidcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFzc3dvcmQgPT09IFwiXCIgfHwgcGFzc3dvcmQyID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEaWUgUGFzc3fDtnJ0ZXIga8O2bm5lbiBuaWNodCBsZWVyIHNlaW4nXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhc3N3b3JkICE9PSBwYXNzd29yZDIpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0RpZSBQYXNzd8O2cnRlciBzdGltbWVuIG5pY2h0IMO8YmVyZWluJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuICEkc2NvcGUubWVzc2FnZSA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGVsZWdhdGVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmVnaXN0ZXIodHJ1ZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmRlbGVnYXRlU3VibWl0ID0gZGVsZWdhdGVTdWJtaXQ7XHJcblxyXG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IHJlZ2lzdGVyO1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VyIG5hbWUgZmllbGRcclxuICAgICAgICBGb2N1c1NydignI3VzZXJuYW1lJyk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignU2V0dGluZ3NDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBBcHBDb25maWcsIEZvY3VzU3J2LCBMb2dTcnYsIFVzZXJTcnYpIHtcclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAvLyB1c2VyIGNvbG91cnNcclxuICAgICAgICAgICAgdmFyIGNvbG9ycyA9IEFwcENvbmZpZ1snc2V0dGluZ3MudXNlci5jb2xvcnMnXTtcclxuXHJcbiAgICAgICAgICAgIC8vIHVzZXIgb2JqZWN0XHJcbiAgICAgICAgICAgICRzY29wZS51c2VyT2JqID0ge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6ICRzY29wZS51c2VyLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgZW1haWw6ICRzY29wZS51c2VyLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgY29sb3I6ICRzY29wZS51c2VyLmNvbG9yXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUudXNlckNvbG9ycyA9IGNvbG9ycztcclxuXHJcbiAgICAgICAgICAgIHZhciBzZXRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlck9iai5jb2xvciA9IG5ld0NvbG9yO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIHVwZGF0ZVVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIFVzZXJTcnYudXBkYXRlQmFzaWMoJHNjb3BlLnVzZXJPYmopLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSB1c2VyIG9iamVjdFxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLnVzZXJuYW1lID0gJHNjb3BlLnVzZXJPYmoudXNlcm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuZW1haWwgPSAkc2NvcGUudXNlck9iai5lbWFpbDtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXNlci5jb2xvciA9ICRzY29wZS51c2VyT2JqLmNvbG9yO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdFaW5zdGVsbHVuZ2VuIHd1cmRlbiBlcmZvbGdyZWljaCBnZXNwZWljaGVydCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcignVXBkYXRlIHVzZXInLCBlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZXJyLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnVXNlcm5hbWUgYWxyZWFkeSBleGlzdHMnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnRGVyIEJlbnV0emVybmFtZSBpc3QgYmVyZWl0cyB2ZXJnZWJlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEaWUgRWluc3RlbGx1bmdlbiBrb25udGVuIG5pY2h0IGdlc3BlaWNoZXJ0IHdlcmRlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBkZWxlZ2F0ZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlVXNlcih0cnVlKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zZXRDb2xvciA9IHNldENvbG9yO1xyXG4gICAgICAgICAgICAkc2NvcGUudXBkYXRlVXNlciA9IHVwZGF0ZVVzZXI7XHJcbiAgICAgICAgICAgICRzY29wZS5kZWxlZ2F0ZVN1Ym1pdCA9IGRlbGVnYXRlU3VibWl0O1xyXG5cclxuICAgICAgICAgICAgLy8gZm9jdXMgdXNlcm5hbWUgZmllbGRcclxuICAgICAgICAgICAgRm9jdXNTcnYoJyN1c2VybmFtZScpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICgkc2NvcGUudXNlcikge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBvdGhlcndpc2UsIHdhaXQgZm9yIHVzZXIubG9hZGVkIGV2ZW50XHJcbiAgICAgICAgJHNjb3BlLiRvbigndXNlci5sb2FkZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZGlyZWN0aXZlKCdjbGlja091dHNpZGUnLCBmdW5jdGlvbigkcGFyc2UsICRkb2N1bWVudCwgJHJvb3RTY29wZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkZG9jdW1lbnQuYmluZCgnY2xpY2snLCBjbGlja091dHNpZGVIYW5kbGVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmJpbmQoJ3JlbW92ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRkb2N1bWVudC51bmJpbmQoJ2NsaWNrJywgY2xpY2tPdXRzaWRlSGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjbGlja091dHNpZGVIYW5kbGVyKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXRQYXJlbnRzID0gJChldmVudC50YXJnZXQpLnBhcmVudHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5zaWRlID0gdGFyZ2V0UGFyZW50cy5pbmRleCgkKGVsZW1lbnQpKSAhPT0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uID0gZXZlbnQudGFyZ2V0ID09PSBlbGVtZW50WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvdXRzaWRlID0gIWluc2lkZSAmJiAhb247XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvdXRzaWRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpY2sub3V0c2lkZScsIGV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5kaXJlY3RpdmUoJ3F1aXonLCBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2J1aWxkL3ZpZXdzL3RlbXBsYXRlcy9xdWl6LWRpcmVjdGl2ZS50ZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgc2NvcGU6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdRdWl6RGlyZWN0aXZlQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSkiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmlsdGVyKCdyZW5kZXJIdG1sJywgZnVuY3Rpb24oJHNjZSkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0ZXh0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKHRleHQpO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmlsdGVyKCd0ZXh0T3JOdW1iZXInLCBmdW5jdGlvbigkZmlsdGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0LCBmcmFjdGlvblNpemUpIHtcclxuICAgICAgICAgICAgZnJhY3Rpb25TaXplID0gZnJhY3Rpb25TaXplICE9PSB1bmRlZmluZWQgPyAwIDogZnJhY3Rpb25TaXplO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzTmFOKGlucHV0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ251bWJlcicpKGlucHV0LCBmcmFjdGlvblNpemUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIGZ1bmN0aW9uKEF1dGhUb2tlblNydikge1xyXG4gICAgICAgIHZhciBhZGRUb2tlbiA9IGZ1bmN0aW9uKGNvbmZpZykge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydYLUF1dGgnXSA9IHRva2VuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGFkZFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdBdXRoVG9rZW5TcnYnLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZTtcclxuICAgICAgICB2YXIga2V5ID0gJ2F1dGgtdG9rZW4nO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0VG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnNldEl0ZW0oa2V5LCB0b2tlbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRUb2tlbjogZ2V0VG9rZW4sXHJcbiAgICAgICAgICAgIHNldFRva2VuOiBzZXRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFNydicsIGZ1bmN0aW9uKFVzZXJTcnYpIHtcclxuICAgICAgICB2YXIgdXNlciA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBnZXRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICh1c2VyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh1c2VyKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXNlclNydi5nZXRVc2VyRnJvbVN0b3JhZ2UoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihfdXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlciA9IF91c2VyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoX3VzZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ05vdCBsb2dnZWQgaW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZXRVc2VyID0gZnVuY3Rpb24oX3VzZXIpIHtcclxuICAgICAgICAgICAgdXNlciA9IF91c2VyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjbGVhclVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdXNlciA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2V0VXNlcjogc2V0VXNlcixcclxuICAgICAgICAgICAgZ2V0VXNlcjogZ2V0VXNlcixcclxuICAgICAgICAgICAgY2xlYXJVc2VyOiBjbGVhclVzZXJcclxuICAgICAgICB9XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQ291bnRyeVNydicsIGZ1bmN0aW9uKCRodHRwLCBJbmRleGVkREJTcnYsIExvZ1Nydikge1xyXG4gICAgICAgIC8vIENvdW50cmllcyBhcnJheVxyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgY291bnRyaWVzQnlBbHBoYTMgPSBudWxsO1xyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUxldHRlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIEluZGV4ZWREQlxyXG4gICAgICAgIHZhciBkYXRhYmFzZSA9ICdtYWdlbGxhbic7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJ2NvdW50cnlTdG9yZSc7XHJcbiAgICAgICAgdmFyIGtleUNvdW50cmllcyA9ICdjb3VudHJpZXMnO1xyXG4gICAgICAgIHZhciBrZXlWZXJzaW9uID0gJ3ZlcnNpb24nO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gSW5kZXhlZERCU3J2LmluZGV4ZWREQkF2YWlsYWJsZSgpO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZENvdW50cmllcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkQ291bnRyaWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGluZGV4ZWREQiBpcyBhdmFpbGFibGVcclxuICAgICAgICAgICAgaWYgKGluZGV4ZWREQkF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBkYXRhYmFzZSBleGlzdHNcclxuICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYuY3JlYXRlRGF0YWJhc2UoZGF0YWJhc2UsIHN0b3JlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFbXB0eU9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0SW50ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFeHRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGRldGVybWluZUxvYWRTdHJhdGVneSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obG9hZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzID0gb2JqWydjb3VudHJpZXMnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbyhcImxvYWRlZCBjb3VudHJpZXMgZnJvbVwiLCBvYmpbJ2xvYWRTdHJhdGVneSddLnRvVXBwZXJDYXNlKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZGl0aW9uYWxseSBtYXAgY291bnRyaWVzIGJ5IHZhcmlvdXMgcHJvcGVydGllc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlBbHBoYTMgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzLmZvckVhY2goZnVuY3Rpb24oYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ5IGFscGhhMyBjb2RlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlBbHBoYTNbY1snYWxwaGEzQ29kZSddXSA9IGM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ5IGxldHRlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaXJzdExldHRlciA9IGNbJ25hbWUnXS5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChmaXJzdExldHRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICfDhCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdExldHRlciA9ICdBJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnw5YnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RMZXR0ZXIgPSAnTyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ8OcJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TGV0dGVyID0gJ1UnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50cmllc0J5TGV0dGVyW2ZpcnN0TGV0dGVyXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyW2ZpcnN0TGV0dGVyXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXJbZmlyc3RMZXR0ZXJdLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTNDb2RlOiBjLmFscGhhM0NvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGMubmFtZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoXCJmYWlsZWQgdG8gbG9hZCBjb3VudHJpZXNcIiwgZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCwgd2UgYWx3YXlzIHRyeSB0byBkb3dubG9hZCBpdCBmcm9tIHRoZSBjb3VudHJ5IEFQSSBlbmRwb2ludFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldENvdW50cmllc0Zyb21BUEkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZXRlcm1pbmVMb2FkU3RyYXRlZ3kgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBpbnRlcm5hbFZlcnNpb24gPSBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl07XHJcbiAgICAgICAgICAgICAgICB2YXIgZXh0ZXJuYWxWZXJzaW9uID0gb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpbnRlcm5hbFZlcnNpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChleHRlcm5hbFZlcnNpb24gPiBpbnRlcm5hbFZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdkYic7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqWydsb2FkU3RyYXRlZ3knXSA9IHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvYWREYXRhID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneSA9IG9ialsnbG9hZFN0cmF0ZWd5J107XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChzdHJhdGVneSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FwaSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21BUEkoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gY291bnRyaWVzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBjb3VudHJpZXMgYW5kIHZlcnNpb24gbnVtYmVyIGluIGRhdGFiYXNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleUNvdW50cmllcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICBjb3VudHJpZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleVZlcnNpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RiJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q291bnRyaWVzRnJvbURCKG9iailcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKF9vYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF9vYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnVW5rbm93biBsb2FkIHN0cmF0ZWd5Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFbXB0eU9iamVjdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHt9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEludGVybmFsVmVyc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5VmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFeHRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldFZlcnNpb25Gcm9tQVBJKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl0gPSB2ZXJzaW9uO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21EQiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5Q291bnRyaWVzKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gaXRlbS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFZlcnNpb25Gcm9tQVBJID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9jb3VudHJpZXMvdmVyc2lvbicpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhLnZlcnNpb24gfHwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJ5QnlBbHBoYTMgPSBmdW5jdGlvbihhbHBoYTMpIHtcclxuICAgICAgICAgICAgaWYgKGNvdW50cmllc0J5QWxwaGEzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllc0J5QWxwaGEzW2FscGhhM107XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNCeUxldHRlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoY291bnRyaWVzQnlMZXR0ZXIgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzQnlMZXR0ZXI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFyZUNvdW50cmllc0xvYWRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzICE9PSBudWxsICYmIGNvdW50cmllcy5sZW5ndGggPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXQsXHJcbiAgICAgICAgICAgIGdldENvdW50cmllczogZ2V0Q291bnRyaWVzLFxyXG4gICAgICAgICAgICBnZXRDb3VudHJ5QnlBbHBoYTM6IGdldENvdW50cnlCeUFscGhhMyxcclxuICAgICAgICAgICAgZ2V0Q291bnRyaWVzQnlMZXR0ZXI6IGdldENvdW50cmllc0J5TGV0dGVyLFxyXG4gICAgICAgICAgICBhcmVDb3VudHJpZXNMb2FkZWQ6IGFyZUNvdW50cmllc0xvYWRlZFxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnRm9jdXNTcnYnLCBmdW5jdGlvbigkdGltZW91dCwgJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzZWxlY3Rvcikge1xyXG4gICAgICAgICAgICAvLyB0aW1lb3V0IG1ha2VzIHN1cmUgdGhhdCBpcyBpbnZva2VkIGFmdGVyIGFueSBvdGhlciBldmVudCBoYXMgYmVlbiB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgIC8vIGUuZy4gY2xpY2sgZXZlbnRzIHRoYXQgbmVlZCB0byBydW4gYmVmb3JlIHRoZSBmb2N1cyBvclxyXG4gICAgICAgICAgICAvLyBpbnB1dHMgZWxlbWVudHMgdGhhdCBhcmUgaW4gYSBkaXNhYmxlZCBzdGF0ZSBidXQgYXJlIGVuYWJsZWQgd2hlbiB0aG9zZSBldmVudHNcclxuICAgICAgICAgICAgLy8gYXJlIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICR3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnSW5kZXhlZERCU3J2JywgZnVuY3Rpb24oJHdpbmRvdykge1xyXG4gICAgICAgIHZhciBrZXlQYXRoID0gJ25hbWUnO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCID0gJHdpbmRvdy5pbmRleGVkREIgfHwgJHdpbmRvdy53ZWJraXRJbmRleGVkREIgfHwgJHdpbmRvdy5tc0luZGV4ZWREQjtcclxuICAgICAgICB2YXIgSURCS2V5UmFuZ2UgPSAkd2luZG93LklEQktleVJhbmdlIHx8ICR3aW5kb3cud2Via2l0SURCS2V5UmFuZ2U7XHJcblxyXG4gICAgICAgIHZhciBJREJUcmFuc2FjdGlvbiA9ICR3aW5kb3cuSURCVHJhbnNhY3Rpb24gfHwgJHdpbmRvdy53ZWJraXRJREJUcmFuc2FjdGlvbjtcclxuXHJcbiAgICAgICAgaWYgKElEQlRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgPSBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFIHx8ICdyZWFkd3JpdGUnO1xyXG4gICAgICAgICAgICBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkgPSBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkgfHwgJ3JlYWRvbmx5JztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREJBdmFpbGFibGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGluZGV4ZWREQiA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlRGF0YWJhc2UgPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZSBpcyBhbiBpbnN0YW5jZSBvZiBJREJWZXJzaW9uQ2hhbmdlRXZlbnRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSBpZGIuY3JlYXRlT2JqZWN0U3RvcmUoc3RvcmVOYW1lLCB7IGtleVBhdGg6IGtleVBhdGggfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCwgdXBkYXRlLCBkZWxldGVcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIGVycm9yXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRyb3BEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3Agc3VjY2Vzc2Z1bFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkcm9wIGZhaWxlZFxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBhZGRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5hZGQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcHV0SXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0QWRkID0gc3RvcmUucHV0KGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJldHJpZXZlSXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBJREJLZXlSYW5nZS5vbmx5KGl0ZW1OYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUub3BlbkN1cnNvcihyYW5nZSkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGN1cnNvci52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtcyA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUub3BlbkN1cnNvcigpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY3JlYXRlRGF0YWJhc2U6IGNyZWF0ZURhdGFiYXNlLFxyXG4gICAgICAgICAgICBkcm9wRGF0YWJhc2U6IGRyb3BEYXRhYmFzZSxcclxuICAgICAgICAgICAgYWRkSXRlbTogYWRkSXRlbSxcclxuICAgICAgICAgICAgcHV0SXRlbTogcHV0SXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtOiByZXRyaWV2ZUl0ZW0sXHJcbiAgICAgICAgICAgIHJldHJpZXZlSXRlbXM6IHJldHJpZXZlSXRlbXMsXHJcbiAgICAgICAgICAgIGluZGV4ZWREQkF2YWlsYWJsZTogaW5kZXhlZERCQXZhaWxhYmxlXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdMb2dTcnYnLCBmdW5jdGlvbihBcHBDb25maWcpIHtcclxuICAgICAgICB2YXIgbG9nSW5mbyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmluZm9cIl0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9nRXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKEFwcENvbmZpZ1tcImxvZy5lcnJvclwiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5mbzogbG9nSW5mbyxcclxuICAgICAgICAgICAgZXJyb3I6IGxvZ0Vycm9yXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdRdWl6U3J2JywgZnVuY3Rpb24oQXBwQ29uZmlnLCBDb3VudHJ5U3J2LCBTY29yZVNydiwgTG9nU3J2KSB7XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcbiAgICAgICAgdmFyIGNvdW50cmllc0J5QWxwaGEzID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHF1aXogPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgc2V0Q291bnRyaWVzID0gZnVuY3Rpb24oX2NvdW50cmllcykge1xyXG4gICAgICAgICAgICBjb3VudHJpZXMgPSBfY291bnRyaWVzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjb3VudHJpZXNMb2FkZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllcyAhPT0gbnVsbCAmJiBjb3VudHJpZXMubGVuZ3RoID4gMDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNvdW50cmllc0xvYWRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkNvdW50cmllcyBoYXZlIG5vdCBiZWVuIGxvYWRlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBxdWl6ID0gY3JlYXRlUXVpeignY291bnRyeScpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUocXVpei5zdGFydCgpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRpc3Bvc2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcXVpeiA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNTdGFydGVkKCkgJiYgIXF1aXouaGFzRW5kZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpelN0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNTdGFydGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVpeiA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6Lmhhc0VuZGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZVF1aXogPSBmdW5jdGlvbihxdWl6VHlwZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHF1aXpUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjb3VudHJ5JzpcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNvdW50cnlRdWl6KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlQ291bnRyeVF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGNvdW50cnlRdWl6ID0gbmV3IFF1aXooKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBmdWxsUG9pbnRzID0gMTAwO1xyXG4gICAgICAgICAgICB2YXIgaGludE1heGltdW0gPSAzO1xyXG4gICAgICAgICAgICB2YXIgaGludENvc3QgPSAyNTtcclxuXHJcbiAgICAgICAgICAgIHZhciBsYXN0UXVlc3Rpb25Cb251cyA9IDIuNTtcclxuXHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGVzID0gQXBwQ29uZmlnWydxdWl6LmNvdW50cnkudHlwZXMnXTtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZXNMZW5ndGggPSBPYmplY3Qua2V5cyhxdWVzdGlvblR5cGVzKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAvLyBzZWxlY3QgY291bnRyaWVzIGZvciBxdWVzdGlvbnNcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkQ291bnRyaWVzID0gW107XHJcbiAgICAgICAgICAgIHZhciBudW1iZXJPZlF1ZXN0aW9ucyA9IEFwcENvbmZpZ1sncXVpei5jb3VudHJ5LnF1ZXN0aW9ucyddO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1iZXJPZlF1ZXN0aW9uczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRyeU9rID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKCFjb3VudHJ5T2spIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IGNvdW50cmllc1tnZXRSYW5kb21JbnQoMCwgY291bnRyaWVzLmxlbmd0aCAtIDEpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRyeU9rID0gc2VsZWN0ZWRDb3VudHJpZXMuaW5kZXhPZihjb3VudHJ5WydhbHBoYTNDb2RlJ10pIDwgMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDb3VudHJpZXMucHVzaChjb3VudHJ5WydhbHBoYTNDb2RlJ10pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBjcmVhdGUgcXVlc3Rpb25zIGZvciBxdWl6XHJcbiAgICAgICAgICAgIHZhciBxY250ID0gMDtcclxuICAgICAgICAgICAgc2VsZWN0ZWRDb3VudHJpZXMuZm9yRWFjaChmdW5jdGlvbihhbHBoYTMpIHtcclxuICAgICAgICAgICAgICAgIHFjbnQrKztcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uVHlwZXNbZ2V0UmFuZG9tSW50KDEsIHF1ZXN0aW9uVHlwZXNMZW5ndGgpXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGdldFF1ZXN0aW9uVGV4dChxdWVzdGlvblR5cGUsIGNvdW50cnkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogcXVlc3Rpb25UeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0OiBnZXRRdWVzdGlvbklucHV0KHF1ZXN0aW9uVHlwZSksXHJcbiAgICAgICAgICAgICAgICAgICAgdW5pdDogZ2V0UXVlc3Rpb25Vbml0KHF1ZXN0aW9uVHlwZSlcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5zd2VyID0gZ2V0UXVlc3Rpb25BbnN3ZXIocXVlc3Rpb25UeXBlLCBjb3VudHJ5KTtcclxuICAgICAgICAgICAgICAgIHZhciBjaGVja0Fuc3dlciA9IGdldENoZWNrQW5zd2VyTGFtYmRhKHF1ZXN0aW9uVHlwZSwgZnVsbFBvaW50cywgbGFzdFF1ZXN0aW9uQm9udXMpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhpbnRzID0gZ2V0UXVlc3Rpb25IaW50cyhxdWVzdGlvblR5cGUsIGhpbnRNYXhpbXVtLCBoaW50Q29zdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gdGhlIGxhc3QgcXVlc3Rpb24gaXMgdGhlIGJvbnVzIHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICBpZiAocWNudCA+PSBudW1iZXJPZlF1ZXN0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm9bJ2JvbnVzJ10gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGFkZCBpbmZvIGZvciBmbGFnIG9mIGNvdW50cnlcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdGTEFHX09GX0NPVU5UUlknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mby5tZWRpYSA9ICdmbGFnJztcclxuICAgICAgICAgICAgICAgICAgICBpbmZvLmFscGhhMkNvZGUgPSBjb3VudHJ5LmFscGhhMkNvZGUudG9Mb2NhbGVMb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5UXVpei5hZGRRdWVzdGlvbihuZXcgUXVlc3Rpb24oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5mbzogaW5mbyxcclxuICAgICAgICAgICAgICAgICAgICBhbnN3ZXI6IGFuc3dlcixcclxuICAgICAgICAgICAgICAgICAgICBjaGVja0Fuc3dlcjogY2hlY2tBbnN3ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgaGludHM6IGhpbnRzXHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cnlRdWl6O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblRleHQgPSBmdW5jdGlvbih0eXBlLCBjb3VudHJ5KSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgaGVpw590IGRpZSBIYXVwdHN0YWR0IHZvbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIltcIiArIGNvdW50cnkuY2FwaXRhbCArIFwiXSBpc3QgZGllIEhhdXB0c3RhZHQgdm9uIHdlbGNoZW0gTGFuZFwiXHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgdmllbGUgTWVuc2NoZW4gbGViZW4gaW4gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgZ3Jvw58gaXN0IGRpZSBGbMOkY2hlIHZvbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldlbGNoZXMgTGFuZCBoYXQgZGllc2UgRmxhZ2dlXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI/XCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbkFuc3dlciA9IGZ1bmN0aW9uKHR5cGUsIGNvdW50cnkpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhbHRTcGVsbGluZ3MgPSBjb3VudHJ5LmFsdFNwZWxsaW5ncyAhPT0gdW5kZWZpbmVkICYmIGNvdW50cnkuYWx0U3BlbGxpbmdzWydjYXBpdGFsJ10gIT09IHVuZGVmaW5lZCA/IGNvdW50cnkuYWx0U3BlbGxpbmdzWydjYXBpdGFsJ10gOiBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5jYXBpdGFsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbHRTcGVsbGluZ3M6IGFsdFNwZWxsaW5nc1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFsdFNwZWxsaW5ncyA9IGNvdW50cnkuYWx0U3BlbGxpbmdzICE9PSB1bmRlZmluZWQgJiYgY291bnRyeS5hbHRTcGVsbGluZ3NbJ25hbWUnXSAhPT0gdW5kZWZpbmVkID8gY291bnRyeS5hbHRTcGVsbGluZ3NbJ25hbWUnXSA6IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5Lm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsdFNwZWxsaW5nczogYWx0U3BlbGxpbmdzXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkucG9wdWxhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5LmFyZWFcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25JbnB1dCA9IGZ1bmN0aW9uKHR5cGUpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbnVtYmVyLmhpZ2gnO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdudW1iZXIubWVkaXVtJztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAndGV4dC5zdGFuZGFyZCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25Vbml0ID0gZnVuY3Rpb24odHlwZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdrbcKyJztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnRWlud29obmVyJztcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENoZWNrQW5zd2VyTGFtYmRhID0gZnVuY3Rpb24odHlwZSwgZnVsbFBvaW50cywgbGFzdFF1ZXN0aW9uQm9udXMpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBoaW50c1VzZWQsIGhpbnRDb3N0LCBpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3JyZWN0ID0gc3VibWl0dGVkQW5zd2VyID09PSBhbnN3ZXIuY29ycmVjdCB8fCAoYW5zd2VyLmFsdFNwZWxsaW5ncyAmJiBhbnN3ZXIuYWx0U3BlbGxpbmdzLmluZGV4T2Yoc3VibWl0dGVkQW5zd2VyKSA+PSAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludHMgPSBjb3JyZWN0ID8gZnVsbFBvaW50cyA6IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBoaW50cyBhcmUgYWxsb3dlZCBhbmQgaGF2ZSBiZWVuIHVzZWQsIHN1YnRyYWN0IHRoZSBwb2ludHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpbnRzVXNlZCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAtPSAoaGludHNVc2VkICogaGludENvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBib251cyBwb2ludHMgZm9yIGxhc3QgcXVlc3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8gIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzICo9IGxhc3RRdWVzdGlvbkJvbnVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBoaW50c1VzZWQsIGhpbnRDb3N0LCBpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBwZXJjZW50YWdlIGRpZmZlcmVuY2UgZnJvbSBjb3JyZWN0IGFuc3dlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JQZXJjZW50YWdlID0gTWF0aC5hYnMoc3VibWl0dGVkQW5zd2VyIC0gYW5zd2VyLmNvcnJlY3QpIC8gYW5zd2VyLmNvcnJlY3QgKiAxMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDkwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSA5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA4MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDcwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDE2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDQwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAyMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDI1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMzApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaGludHMgYXJlIGFsbG93ZWQgYW5kIGhhdmUgYmVlbiB1c2VkLCBzdWJ0cmFjdCB0aGUgcG9pbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaW50c1VzZWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgLT0gKGhpbnRzVXNlZCAqIGhpbnRDb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYm9udXMgcG9pbnRzIGZvciBsYXN0IHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAqPSBsYXN0UXVlc3Rpb25Cb251cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uSGludHMgPSBmdW5jdGlvbih0eXBlLCBoaW50c1Bvc3NpYmxlLCBoaW50Q29zdCkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhpbXVtOiBoaW50c1Bvc3NpYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3N0OiBoaW50Q29zdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2l2ZTogZnVuY3Rpb24oaGludHNVc2VkLCBhbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhbnN3ZXIuY29ycmVjdC5zdWJzdHIoMCwgaGludHNVc2VkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZDogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0TnVtYmVyT2ZRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5jdXJyZW50UXVlc3Rpb24oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHF1aXoubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFRvdGFsUG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0VG90YWxQb2ludHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENvbmNsdWRlcyB0aGUgcXVpeiBhbmQgcHV0cyB0aGUgc2NvcmUgdG8gdGhlIEFQSSBlbmRwb2ludC5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgY29uY2x1ZGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1aXogIT09IG51bGwgJiYgcXVpei5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHF1aXouc3VibWl0dGVkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnUXVpeiBoYXMgYWxyZWFkeSBiZWVuIHN1Ym1pdHRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcXVpei5zdWJtaXR0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBTY29yZVNydi5wdXRIaWdoc2NvcmUocXVpei5nZXRUb3RhbFBvaW50cygpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCgnTm8gcXVpeiBpcyBjdXJyZW50bHkgcnVubmluZycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBzZXRDb3VudHJpZXM6IHNldENvdW50cmllcyxcclxuICAgICAgICAgICAgaXNRdWl6UnVubmluZzogaXNRdWl6UnVubmluZyxcclxuICAgICAgICAgICAgaGFzUXVpelN0YXJ0ZWQ6IGhhc1F1aXpTdGFydGVkLFxyXG4gICAgICAgICAgICBoYXNRdWl6RW5kZWQ6IGhhc1F1aXpFbmRlZCxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyOiBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIsXHJcbiAgICAgICAgICAgIGdldE51bWJlck9mUXVpelF1ZXN0aW9uczogZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50UXVlc3Rpb246IGdldEN1cnJlbnRRdWVzdGlvbixcclxuICAgICAgICAgICAgbmV4dFF1ZXN0aW9uOiBuZXh0UXVlc3Rpb24sXHJcbiAgICAgICAgICAgIGdldFRvdGFsUG9pbnRzOiBnZXRUb3RhbFBvaW50cyxcclxuICAgICAgICAgICAgY29uY2x1ZGU6IGNvbmNsdWRlLFxyXG4gICAgICAgICAgICBkaXNwb3NlOiBkaXNwb3NlXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdTY29yZVNydicsIGZ1bmN0aW9uKCRodHRwKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgZW50aXJlIGhpZ2hzY29yZSBsaXN0IGluIGFuIGFycmF5IGZyb20gdGhlIEFQSS5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgZ2V0SGlnaHNjb3JlTGlzdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvc2NvcmVzL2FsbCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgaGlnaHNjb3JlIG9iamVjdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIElmIHRoZSB1c2VyIGhhcyBubyByZXN1bHQgeWV0LCBhbiBlbXB0eSBvYmplY3QgaXMgcmV0dXJuZWQuXHJcbiAgICAgICAgICogUmV0dXJucyBhIHByb21pc2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGdldFVzZXJIaWdoc2NvcmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3Njb3Jlcy91c2VyJylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHNjb3JlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEZldGNoZXMgdGhlIGhpZ2hzY29yZSBvYmplY3QgZm9yIHRoZSBvdmVyYWxsIGhpZ2hzY29yZS5cclxuICAgICAgICAgKiBJZiB0aGVyZSBpcyBjdXJyZW50bHkgbm8gcmVzdWx0IHlldCwgYW4gZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkLlxyXG4gICAgICAgICAqIFJldHVybnMgYSBwcm9taXNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBnZXRPdmVyYWxsSGlnaHNjb3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9zY29yZXMvaGlnaCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oc2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzY29yZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBQdXRzIGEgaGlnaHNjb3JlIHJlc3VsdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIEBwYXJhbSBzY29yZSAgICAgTnVtYmVyIHdpdGggdGhlIGFjaGlldmVkIHNjb3JlLlxyXG4gICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBwdXRIaWdoc2NvcmUgPSBmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvc2NvcmVzJywgeyBzY29yZTogc2NvcmUgfSlcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRIaWdoc2NvcmVMaXN0OiBnZXRIaWdoc2NvcmVMaXN0LFxyXG4gICAgICAgICAgICBnZXRVc2VySGlnaHNjb3JlOiBnZXRVc2VySGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBnZXRPdmVyYWxsSGlnaHNjb3JlOiBnZXRPdmVyYWxsSGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBwdXRIaWdoc2NvcmU6IHB1dEhpZ2hzY29yZVxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnVXNlclNydicsIGZ1bmN0aW9uKCRodHRwLCBBdXRoVG9rZW5TcnYsIEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VyJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXJGcm9tU3RvcmFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4odG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdG9rZW4sIHdlIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIHRva2VuIGluIHN0b3JhZ2VcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9uJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9rZW4gPSByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNhdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKHNlbGYudG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRVc2VyKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRva2VuIGxvY2FsbHlcclxuICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24obmV3VXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzZWxlY3QgYSByYW5kb20gY29sb3IgZm9yIHRoZSB1c2VyXHJcbiAgICAgICAgICAgICAgICB2YXIgY29sb3JzID0gQXBwQ29uZmlnWydzZXR0aW5ncy51c2VyLmNvbG9ycyddO1xyXG4gICAgICAgICAgICAgICAgbmV3VXNlci5jb2xvciA9IGNvbG9yc1tnZXRSYW5kb21JbnQoMCwgY29sb3JzLmxlbmd0aCAtIDEpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3VzZXInLCBuZXdVc2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW1tZWRpYXRlbHkgbG9nIHRoZSB1c2VyIGluXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luKG5ld1VzZXIudXNlcm5hbWUsIG5ld1VzZXIucGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pICA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZUJhc2ljID0gZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvdXNlci9iYXNpYycsIHVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlUGFzc3dvcmQgPSBmdW5jdGlvbihwYXNzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnB1dCgnL2FwaS91c2VyL3Bhc3N3b3JkJywgcGFzcylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRVc2VyOiBnZXRVc2VyLFxyXG4gICAgICAgICAgICBnZXRVc2VyRnJvbVN0b3JhZ2U6IGdldFVzZXJGcm9tU3RvcmFnZSxcclxuICAgICAgICAgICAgbG9naW46IGxvZ2luLFxyXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dCxcclxuICAgICAgICAgICAgcmVnaXN0ZXI6IHJlZ2lzdGVyLFxyXG4gICAgICAgICAgICB1cGRhdGVCYXNpYzogdXBkYXRlQmFzaWMsXHJcbiAgICAgICAgICAgIHVwZGF0ZVBhc3N3b3JkOiB1cGRhdGVQYXNzd29yZFxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
