var magellan=angular.module("magellan",["ui.router","ngProgress","ngAnimate"],["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]);magellan.constant("AppConfig",{"log.info":!0,"log.error":!0,"quiz.country.questions":3,"quiz.country.types":{1:"CAPITAL_OF_COUNTRY",2:"COUNTRY_OF_CAPITAL",3:"POPULATION_OF_COUNTRY",4:"AREA_OF_COUNTRY",5:"FLAG_OF_COUNTRY"},"settings.user.colors":["soft_red","thunderbird","old_brick","new_york_pink","snuff","honey_flower","san_marino","shakespeare","ming","gossip","eucalyptus","mountain_meadow","jade","confetti","california","burnt_orange","jaffa","gallery","edward","lynch"]}),magellan.controller("AppCtrl",["$scope","$state","UserSrv","CountrySrv","QuizSrv",function(e,n,t,r,o){e.app={config:{title:"Magellan",subtitle:"Test your knowledge about the countries of our world",author:"Michael Stifter"}},t.getUserFromStorage().then(function(n){e.user=n,e.$broadcast("user.loaded"),r.init().then(function(n){e.$broadcast("countries.loaded",n),o.setCountries(n)})})["catch"](function(e){}),e.isProgressBarVisible=function(){return n.is("quiz")},e.$on("app.login",function(t,u){e.user=u,r.init().then(function(n){e.$broadcast("countries.loaded",n),o.setCountries(n)}),n.go("quiz")}),e.$on("app.logout",function(t,r){e.user=null,n.go("home")})}]);var Quiz=function(){var e=null,n=[];this.start=function(){if(n.length<=0)throw Error("Cannot start a quiz without questions");return this.nextQuestion()},this.isActive=function(){return this.hasStarted()&&!this.hasEnded()},this.hasStarted=function(){return null!==e},this.hasEnded=function(){return this.hasStarted()&&e>=n.length},this.addQuestion=function(e){if(void 0===e)throw Error("No question object passed");var t=!0,r=["config","hint","solution","answer","question","getInfo","info","points","answered","hintsAllowed","hintsRemaining"];r.forEach(function(n){if(!e.hasOwnProperty(n))throw t=!1,new Error("Question must have property '"+n+"'")}),t&&n.push(e)},this.nextQuestion=function(){return null===e?e=0:e++,!this.hasEnded()&&n[e]},this.currentQuestion=function(){return this.isActive()?n[e]:null},this.getTotalPoints=function(){if(!this.hasStarted())return null;var e=0;return n.forEach(function(n){var t=n.points();void 0!==t&&(e+=t)}),e},this.getCurrentQuestionNumber=function(){return null===e?null:e+1},this.getNumberOfQuestions=function(){return n.length}},Question=function(e){var n=null,t=null,r=null,o=null,u=0,i=null,a=null,s=!1,l=function(e){n=e.text,t=e.info||{},r=e.answer,i=e.checkAnswer||null,o=e.hints||{allowed:!1,maximum:0,cost:0,give:null}};e&&l(e),this.config=function(e){l(e)},this.question=function(){return n},this.info=function(e,n){return void 0===n?t[e]:void(t[e]=n)},this.getInfo=function(){return t},this.solution=function(){return s?r:null},this.hint=function(){if(!o.allowed||u>=o.maximum)return null;if(o.allowed&&!o.give)throw new Error("Hints allowed but no give method passed");return u++,o.give(u,r)},this.answer=function(e){if(!s&&i)return s=!0,a=i(r,e,u,o.cost,t),a=Math.max(0,a)},this.points=function(){if(s&&null!==a)return a},this.answered=function(){return s},this.hintsAllowed=function(){return null!==o?o.allowed:null},this.hintsRemaining=function(){var e=this.hintsAllowed();return null===e||e===!1?null:o.maximum-u}},getRandomInt=function(e,n){return Math.floor(Math.random()*(n-e+1))+e},getStringBetween=function(e,n,t){var r=e.indexOf(n),o=e.indexOf(t);return r>=0&&o>=0&&o>r?e.substr(r+1,o-r-1):null};"undefined"!=typeof module&&module.exports&&(module.exports.Question=Question,module.exports.Quiz=Quiz),angular.module("magellan").config(["$locationProvider","$stateProvider","$urlRouterProvider",function(e,n,t){e.html5Mode(!0),t.otherwise("/home"),n.state("home",{url:"/home",templateUrl:"/build/views/partials/home.partial.html",params:{action:null}}).state("quiz",{url:"/quiz",templateUrl:"/build/views/partials/quiz.partial.html"}).state("countries",{url:"/countries",templateUrl:"/build/views/partials/countries.partial.html"}).state("countries.detail",{url:"/:alpha3Code",templateUrl:"/build/views/partials/countries-detail.partial.html"}).state("login",{url:"/login",templateUrl:"/build/views/partials/login.partial.html"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}).state("register",{url:"/register",templateUrl:"/build/views/partials/register.partial.html"}).state("settings",{url:"/settings",templateUrl:"/build/views/partials/settings.partial.html"}).state("about",{url:"/about",templateUrl:"/build/views/partials/about.partial.html"})}]),angular.module("magellan").controller("CountriesCtrl",["$scope","CountrySrv",function(e,n){var t=null,r=null,o=function(){t=n.getCountriesByLetter(),r=Object.keys(t),e.$$phase?(e.countryKeys=r,e.countriesByLetter=t):e.$apply(function(){e.countryKeys=r,e.countriesByLetter=t})};n.areCountriesLoaded()&&o(),e.$on("countries.loaded",function(){o()})}]),angular.module("magellan").controller("CountryDetailCtrl",["$scope","CountrySrv","$stateParams",function(e,n,t){var r=t.alpha3Code;n.areCountriesLoaded()&&(e.country=n.getCountryByAlpha3(r)),e.$on("countries.loaded",function(){e.$apply(function(){e.country=n.getCountryByAlpha3(r)})});var o=function(e){return n.getCountryByAlpha3(e)};e.getCountryFromService=o}]),angular.module("magellan").controller("DropdownCtrl",["$scope",function(e){function n(){u=!u}function t(){u=!0}function r(){u=!1}function o(){return u}var u=!1;e.toggleDropdown=n,e.showDropdown=t,e.hideDropdown=r,e.isDropdownVisible=o,e.handleClickOutside=function(e){console.log("CLICKED OUTSIDE")}}]),angular.module("magellan").controller("HomeCtrl",["$scope","LogSrv","$stateParams",function(e,n,t){if(e.message=null,t.action){var r=t.action;switch(r){case"register.successful":e.message={type:"success",text:"Gratulation! Die Anmeldung war erfolgreich. Herzlich willkommen bei Magellan."};break;default:e.message=null}}}]),angular.module("magellan").controller("LoginCtrl",["$scope","UserSrv","FocusSrv",function(e,n,t){e.message=null,e.login=function(t,r){n.login(t,r).then(function(n){e.message=null,e.$emit("app.login",n.data)})["catch"](function(n){console.error(n);var t;t=401===n.status?"Falscher Benutzername oder Passwort":"Beim Einloggen scheint etwas schief gegangen zu sein",e.message={type:"error",text:t}})},t("#username")}]),angular.module("magellan").controller("LogoutCtrl",["$scope","UserSrv",function(e,n){n.logout().then(function(){e.$emit("app.logout")})}]),angular.module("magellan").controller("QuizDirectiveController",["$scope","QuizSrv","LogSrv","FocusSrv","ngProgressFactory",function(e,n,t,r,o){e.progressbar=o.createInstance(),e.progressbar.setParent(document.getElementById("quiz-progress")),e.progressbar.setAbsolute(),e.progressbar.setColor("#336e7b"),e.answerInput={},e.hint=null,e.multiplierOptions=[{value:1,label:""},{value:1e3,label:"Tsd."},{value:1e6,label:"Mio."}];var u=null,i=function(){if(u=n.getCurrentQuestion(),e.hint=null,null!==u){if(u.getInfo().input&&0===u.getInfo().input.indexOf("number"))switch(u.getInfo().input){case"number.high":e.answerInput.multiplier={value:1e6,label:"Mio."};break;case"number.medium":e.answerInput.multiplier={value:1e3,label:"Tsd."};break;default:e.answerInput.multiplier={value:1,label:""}}else e.answerInput.multiplier=null;w(),r(".answerInput")}else e.progressbar.set(0)},a=function(){return u},s=function(){return n.getCurrentQuestionNumber()},l=function(){return n.getNumberOfQuizQuestions()},c=function(){return h(a().question(),"question-highlight")+"?"},f=function(){return u&&u.getInfo().media?u.getInfo().media:null},g=function(){if(e.answerInput.answer){var n=e.answerInput.answer;u.getInfo().input&&0===u.getInfo().input.indexOf("number")&&(n=n.replace(",",".")),e.answerInput.multiplier&&(n*=e.answerInput.multiplier.value),t.info("submitting answer",n),e.answerInput.points=u.answer(n),r("#btnNextQuestion")}},d=function(){return!(!n.isQuizRunning()||null===u)&&u.answered()},m=function(){n.nextQuestion(),e.answerInput.answer="",i()},p=function(){e.hint=u.hint(),r(".answerInput")},h=function(e,n){return e.replace("[","<span class='"+n+"'>").replace("]","</span>")},v=function(e){13==e.which&&g()},w=function(){var n=s()/l()*100;e.progressbar.set(n)},C=function(){return s()>=l()},O=function(){m()};i(),e.getQuestion=a,e.getCurrentQuestionNumber=s,e.renderQuestionText=c,e.submitAnswer=g,e.questionAnswered=d,e.nextQuestion=m,e.handleKeyPress=v,e.getQuestionMedia=f,e.requestHint=p,e.wasLastQuestion=C,e.continueFinished=O}]),angular.module("magellan").controller("QuizCtrl",["$scope","QuizSrv","LogSrv",function(e,n,t){var r=function(){n.init().then(function(){t.info("Quiz started")})["catch"](function(e){t.error(e)})},o=function(){return n.isQuizRunning()},u=function(){return n.hasQuizStarted()},i=function(){return n.hasQuizEnded()},a=function(){return n.getTotalPoints()};e.startQuiz=r,e.isQuizRunning=o,e.hasQuizStarted=u,e.hasQuizEnded=i,e.getTotalPoints=a}]),angular.module("magellan").controller("RegisterCtrl",["$scope","LogSrv","FocusSrv","UserSrv","$state","$window",function(e,n,t,r,o,u){e.newUser={},e.message=null;var i=function(t){return!!t&&void(a()&&r.register(e.newUser).then(function(n){200===n.status?(e.$emit("app.login",n.data),o.go("home",{action:"register.successful"})):e.message={type:"error",text:"Bei der Anmeldung scheint etwas schief gegangen zu sein"}})["catch"](function(t){n.error(t);var r;switch(t.message){case"Username already exists":r="Der Benutzername existiert bereits";break;default:r="Bei der Anmeldung scheint etwas schief gegangen zu sein"}e.$$phase?e.message={type:"error",text:r}:e.$apply(function(){e.message={type:"error",text:r}})}))},a=function(){e.message=null;var n=e.newUser.password,t=e.newUser.password2;return e.newUser.username&&e.newUser.email&&n&&t?""===n||""===t?e.message={type:"error",text:"Die Passwörter können nicht leer sein"}:n!==t&&(e.message={type:"error",text:"Die Passwörter stimmen nicht überein"}):e.message={type:"error",text:"Alle Felder müssen ausgefüllt sein"},!e.message},s=function(){i(!0)};e.delegateSubmit=s,e.register=i,t("#username")}]),angular.module("magellan").controller("SettingsCtrl",["$scope","AppConfig","FocusSrv","LogSrv","UserSrv",function(e,n,t,r,o){var u=function(){e.message=null;var u=n["settings.user.colors"];e.userObj={username:e.user.username,email:e.user.email,color:e.user.color},e.userColors=u;var i=function(n){e.userObj.color=n},a=function(){o.updateBasic(e.userObj).then(function(n){e.user.username=e.userObj.username,e.user.email=e.userObj.email,e.user.color=e.userObj.color,e.$apply(function(){e.message={type:"success",text:"Einstellungen wurden erfolgreich gespeichert"}})})["catch"](function(n){r.error("Update user",n);var t;switch(n.message){case"Username already exists":t="Der Benutzername ist bereits vergeben";break;default:t="Die Einstellungen konnten nicht gespeichert werden"}e.$apply(function(){e.message={type:"error",text:t}})})},s=function(){a(!0)};e.setColor=i,e.updateUser=a,e.delegateSubmit=s,t("#username")};e.user&&u(),e.$on("user.loaded",function(e,n){u()})}]),angular.module("magellan").directive("quiz",function(){return{templateUrl:"build/views/templates/quiz-directive.template.html",scope:!0,controller:"QuizDirectiveController",restrict:"E",link:function(e,n,t){}}}),angular.module("magellan").filter("renderHtml",["$sce",function(e){return function(n){return e.trustAsHtml(n)}}]),angular.module("magellan").factory("AuthInterceptor",["AuthTokenSrv",function(e){var n=function(n){var t=e.getToken();return t&&(n.headers=n.headers||{},n.headers["X-Auth"]=t),n};return{request:n}}]),angular.module("magellan").factory("AuthTokenSrv",["$window",function(e){var n=e.sessionStorage,t="auth-token",r=function(){return n.getItem(t)},o=function(e){e?n.setItem(t,e):n.removeItem(t)};return{getToken:r,setToken:o}}]),angular.module("magellan").factory("CountrySrv",["$http","IndexedDBSrv","LogSrv",function(e,n,t){var r=null,o=null,u=null,i="magellan",a="countryStore",s="countries",l="version",c=n.indexedDBAvailable(),f=function(){return g()},g=function(){return c?new Promise(function(e,s){n.createDatabase(i,a).then(p).then(h).then(v).then(d).then(m).then(function(n){r=n.countries,t.info("loaded countries from",n.loadStrategy.toUpperCase()),o={},u={},r.forEach(function(e){o[e.alpha3Code]=e;var n=e.name.substr(0,1).toUpperCase();switch(n){case"Ä":n="A";break;case"Ö":n="O";break;case"Ü":n="U"}void 0===u[n]&&(u[n]=[]),u[n].push({alpha3Code:e.alpha3Code,name:e.name})}),e(r)})["catch"](function(e){t.error("failed to load countries",e),s(e)})}):C()},d=function(e){return new Promise(function(n,t){var r,o=e.internalVersion,u=e.externalVersion;r=null===o?"api":u>o?"api":"db",e.loadStrategy=r,n(e)})},m=function(e){return new Promise(function(t,r){var o=e.loadStrategy;switch(o){case"api":C().then(function(r){e.countries=r,n.putItem(i,a,{name:s,value:r}),n.putItem(i,a,{name:l,value:e.externalVersion}),t(e)})["catch"](function(e){r(e)});break;case"db":w(e).then(function(e){t(e)})["catch"](function(e){r(e)});break;default:r("Unknown load strategy")}})},p=function(){return new Promise(function(e,n){e({})})},h=function(e){return new Promise(function(t,r){n.retrieveItem(i,a,l).then(function(n){e.internalVersion=n.value,t(e)})["catch"](function(n){e.internalVersion=null,t(e)})})},v=function(e){return O().then(function(n){return e.externalVersion=n,e})},w=function(e){return new Promise(function(t,r){n.retrieveItem(i,a,s).then(function(n){e.countries=n.value,t(e)})["catch"](function(e){t(null)})})},C=function(){return new Promise(function(n,t){e.get("/api/countries").then(function(e){n(e.data)})["catch"](function(e){t(e)})})},O=function(){return new Promise(function(n,t){e.get("/api/countries/version").then(function(e){n(e.data.version||0)})["catch"](function(e){n(0)})})},b=function(e){return null===o?null:o[e]},A=function(){return null===u?null:u},y=function(){return null!==r&&r.length>0};return{init:f,getCountryByAlpha3:b,getCountriesByLetter:A,areCountriesLoaded:y}}]),angular.module("magellan").factory("FocusSrv",["$timeout","$window",function(e,n){return function(t){e(function(){var e=n.document.querySelector(t);e&&e.focus()})}}]),angular.module("magellan").factory("IndexedDBSrv",["$window",function(e){var n="name",t=e.indexedDB||e.webkitIndexedDB||e.msIndexedDB,r=e.IDBKeyRange||e.webkitIDBKeyRange,o=e.IDBTransaction||e.webkitIDBTransaction;o&&(o.READ_WRITE=o.READ_WRITE||"readwrite",o.READ_ONLY=o.READ_ONLY||"readonly");var u=function(){return!!t},i=function(e,r){return new Promise(function(o,u){var i=t.open(e);i.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore(r,{keyPath:n})},i.onsuccess=function(e){o(e)},i.onerror=function(e){u(e)}})},a=function(e){return new Promise(function(n,r){var o=t.deleteDatabase(e);o.onsuccess=function(e){n(e)},o.onerror=function(e){r(e)}})},s=function(e,n,r){return new Promise(function(u,i){var a=t.open(e);a.onsuccess=function(e){var t=e.target.result,a=t.transaction(n,o.READ_WRITE),s=a.objectStore(n),l=s.add(r);l.onsuccess=function(e){u(e)},l.onerror=function(e){i(e)}}})},l=function(e,n,r){return new Promise(function(u,i){var a=t.open(e);a.onsuccess=function(e){var t=e.target.result,a=t.transaction(n,o.READ_WRITE),s=a.objectStore(n),l=s.put(r);l.onsuccess=function(e){u(e)},l.onerror=function(e){i(e)}}})},c=function(e,n,u){return new Promise(function(i,a){var s=null,l=t.open(e);l.onsuccess=function(e){var t=e.target.result,a=t.transaction(n,o.READ_ONLY),l=a.objectStore(n),c=r.only(u);l.openCursor(c).onsuccess=function(e){var n=e.target.result;n?(s=n.value,n["continue"]()):i(s)}},l.onerror=function(e){a(e)}})},f=function(e,n){return new Promise(function(r,u){var i=[],a=t.open(e);a.onsuccess=function(e){var t=e.target.result,u=t.transaction(n,o.READ_ONLY),a=u.objectStore(n);a.openCursor().onsuccess=function(e){var n=e.target.result;n?(i.push(n.value),n["continue"]()):r(i)}},a.onerror=function(e){u(e)}})};return{createDatabase:i,dropDatabase:a,addItem:s,putItem:l,retrieveItem:c,retrieveItems:f,indexedDBAvailable:u}}]),angular.module("magellan").factory("LogSrv",["AppConfig",function(e){var n=function(){e["log.info"]&&console.log.apply(console,arguments)},t=function(){e["log.error"]&&console.error.apply(console,arguments)};return{info:n,error:t}}]),angular.module("magellan").factory("QuizSrv",["AppConfig","CountrySrv","LogSrv",function(e,n,t){var r=null,o=null,u=function(e){r=e},i=function(){return null!==r&&r.length>0},a=function(){return new Promise(function(e,n){i||n("Countries have not been loaded"),o=f("country"),e(o.start())})},s=function(){return null!==o&&(o.hasStarted()&&!o.hasEnded())},l=function(){return null!==o&&o.hasStarted()},c=function(){return null!==o&&o.hasEnded()},f=function(e){switch(e){case"country":default:return g()}},g=function(){for(var t=new Quiz,o=100,u=3,i=25,a=2.5,s=e["quiz.country.types"],l=Object.keys(s).length,c=[],f=e["quiz.country.questions"],g=0;g<f;g++){for(var C=!1;!C;){var O=r[getRandomInt(0,r.length-1)];C=c.indexOf(O.alpha3Code)<0}c.push(O.alpha3Code)}var b=0;return c.forEach(function(e){b++;var r=n.getCountryByAlpha3(e),c=s[getRandomInt(1,l)],g=d(c,r),C={type:c,input:p(c),unit:h(c)},O=m(c,r),A=v(c,o,a),y=w(c,u,i);b>=f&&(C.bonus=!0),"FLAG_OF_COUNTRY"===c&&(C.media="flag",C.alpha2Code=r.alpha2Code.toLocaleLowerCase()),t.addQuestion(new Question({text:g,info:C,answer:O,checkAnswer:A,hints:y}))}),t},d=function(e,n){switch(e){case"CAPITAL_OF_COUNTRY":return"Wie heißt die Hauptstadt von ["+n.name+"]";case"COUNTRY_OF_CAPITAL":return"["+n.capital+"] ist die Hauptstadt von welchem Land";case"POPULATION_OF_COUNTRY":return"Wie viele Menschen leben in ["+n.name+"]";case"AREA_OF_COUNTRY":return"Wie groß ist die Fläche von ["+n.name+"]";case"FLAG_OF_COUNTRY":return"Welches Land hat diese Flagge";default:return"?"}},m=function(e,n){switch(e){case"CAPITAL_OF_COUNTRY":var t=void 0!==n.altSpellings&&void 0!==n.altSpellings.capital?n.altSpellings.capital:[];return{correct:n.capital,altSpellings:t};case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":var t=void 0!==n.altSpellings&&void 0!==n.altSpellings.name?n.altSpellings.name:[];return{correct:n.name,altSpellings:t};case"POPULATION_OF_COUNTRY":return{correct:n.population};case"AREA_OF_COUNTRY":return{correct:n.area};default:return"?"}},p=function(e){switch(e){case"POPULATION_OF_COUNTRY":return"number.high";case"AREA_OF_COUNTRY":return"number.medium";case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":default:return"text.standard"}},h=function(e){switch(e){case"AREA_OF_COUNTRY":return"km²";case"POPULATION_OF_COUNTRY":return"Einwohner";default:return null}},v=function(e,n,t){switch(e){case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":return function(e,r,o,u,i){var a=r===e.correct||e.altSpellings&&e.altSpellings.indexOf(r)>=0,s=a?n:0;return o>0&&(s-=o*u),void 0!==i&&void 0!==i.bonus&&i.bonus===!0&&(s*=t),s};case"POPULATION_OF_COUNTRY":case"AREA_OF_COUNTRY":return function(e,n,r,o,u){var i,a=Math.abs(n-e.correct)/e.correct*100;return i=a<=3?100:a<=6?90:a<=9?80:a<=12?70:a<=14?60:a<=16?50:a<=18?40:a<=20?30:a<=25?20:a<=30?10:0,r>0&&(i-=r*o),void 0!==u&&void 0!==u.bonus&&u.bonus===!0&&(i*=t),i};default:return"?"}},w=function(e,n,t){switch(e){case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":return{allowed:!0,maximum:n,cost:t,give:function(e,n){return n.correct.substr(0,e)}};case"POPULATION_OF_COUNTRY":case"AREA_OF_COUNTRY":return{allowed:!1};default:return"?"}},C=function(){return s()?o.getCurrentQuestionNumber():null},O=function(){return s()?o.getNumberOfQuestions():null},b=function(){return s()?o.currentQuestion():null},A=function(){s()&&o.nextQuestion()},y=function(){return null===o?null:o.getTotalPoints()};return{init:a,setCountries:u,isQuizRunning:s,hasQuizStarted:l,hasQuizEnded:c,getCurrentQuestionNumber:C,getNumberOfQuizQuestions:O,getCurrentQuestion:b,nextQuestion:A,getTotalPoints:y}}]),angular.module("magellan").factory("ScoreSrv",["$http",function(e){var n=function(){return new Promise(function(n,t){e.get("/api/scores/all").success(function(e){n(e)}).error(function(e){t(e)})})},t=function(){return new Promise(function(n,t){e.get("/api/scores/user").success(function(e){n(e)}).error(function(e){t(e)})})},r=function(){return new Promise(function(n,t){e.get("/api/scores/high").success(function(e){n(e)}).error(function(e){t(e)})})},o=function(n){return new Promise(function(n,t){e.put("/api/scores").success(function(e){n(e)}).error(function(e){t(e)})})};return{getHighscoreList:n,getUserHighscore:t,getOverallHighscore:r,putHighscore:o}}]),angular.module("magellan").factory("UserSrv",["$http","AuthTokenSrv","AppConfig",function(e,n,t){var r=this,o=function(){return e.get("/api/user")},u=function(){return new Promise(function(e,t){var r=n.getToken();r?(n.setToken(r),o().then(function(n){e(n.data)})["catch"](function(e){t(e)})):t("No token in storage")})},i=function(t,u){return e.post("/api/session",{username:t,password:u}).then(function(e){return r.token=e.data,n.setToken(r.token),o()})},a=function(){return new Promise(function(e,t){r.token=null,n.setToken(),e()})},s=function(n){return new Promise(function(r,o){var u=t["settings.user.colors"];n.color=u[getRandomInt(0,u.length-1)],e.post("/api/user",n).success(function(e){i(n.username,n.password).then(function(e){r(e)})["catch"](function(e){o(e)})}).error(function(e){o(e)})})},l=function(n){return new Promise(function(t,r){e.put("/api/user/basic",n).success(function(e){t(e)}).error(function(e){r(e)})})};return{getUser:o,getUserFromStorage:u,login:i,logout:a,register:s,updateBasic:l}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjcmlwdC5qcyIsIm1vZGVscy5qcyIsInJvdXRlcy5qcyIsImNvbnRyb2xsZXJzL2NvdW50cmllcy5jdHJsLmpzIiwiY29udHJvbGxlcnMvY291bnRyeS1kZXRhaWwuY3RybC5qcyIsImNvbnRyb2xsZXJzL2Ryb3Bkb3duLmN0cmwuanMiLCJjb250cm9sbGVycy9ob21lLmN0cmwuanMiLCJjb250cm9sbGVycy9sb2dpbi5jdHJsLmpzIiwiY29udHJvbGxlcnMvbG9nb3V0LmN0cmwuanMiLCJjb250cm9sbGVycy9xdWl6LWRpcmVjdGl2ZS5jdHJsLmpzIiwiY29udHJvbGxlcnMvcXVpei5jdHJsLmpzIiwiY29udHJvbGxlcnMvcmVnaXN0ZXIuY3RybC5qcyIsImNvbnRyb2xsZXJzL3NldHRpbmdzLmN0cmwuanMiLCJkaXJlY3RpdmVzL3F1aXouZGlyZWN0aXZlLmpzIiwiZmlsdGVycy9yZW5kZXJIdG1sLmZpbHRlci5qcyIsImludGVyY2VwdG9ycy9hdXRoLmludGVyY2VwdG9yLmpzIiwic2VydmljZXMvYXV0aC10b2tlbi5zZXJ2aWNlLmpzIiwic2VydmljZXMvY291bnRyeS5zZXJ2aWNlLmpzIiwic2VydmljZXMvZm9jdXMuc2VydmljZS5qcyIsInNlcnZpY2VzL2luZGV4ZWQtZGIuc2VydmljZS5qcyIsInNlcnZpY2VzL2xvZy5zZXJ2aWNlLmpzIiwic2VydmljZXMvcXVpei5zZXJ2aWNlLmpzIiwic2VydmljZXMvc2NvcmUuc2VydmljZS5qcyIsInNlcnZpY2VzL3VzZXIuc2VydmljZS5qcyJdLCJuYW1lcyI6WyJtYWdlbGxhbiIsImFuZ3VsYXIiLCJtb2R1bGUiLCIkaHR0cFByb3ZpZGVyIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsImNvbnN0YW50IiwibG9nLmluZm8iLCJsb2cuZXJyb3IiLCJxdWl6LmNvdW50cnkucXVlc3Rpb25zIiwicXVpei5jb3VudHJ5LnR5cGVzIiwiMSIsIjIiLCIzIiwiNCIsIjUiLCJzZXR0aW5ncy51c2VyLmNvbG9ycyIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkc3RhdGUiLCJVc2VyU3J2IiwiQ291bnRyeVNydiIsIlF1aXpTcnYiLCJhcHAiLCJjb25maWciLCJ0aXRsZSIsInN1YnRpdGxlIiwiYXV0aG9yIiwiZ2V0VXNlckZyb21TdG9yYWdlIiwidGhlbiIsInVzZXIiLCIkYnJvYWRjYXN0IiwiaW5pdCIsImNvdW50cmllcyIsInNldENvdW50cmllcyIsImVyciIsImlzUHJvZ3Jlc3NCYXJWaXNpYmxlIiwiaXMiLCIkb24iLCJldmVudCIsImRhdGEiLCJnbyIsIlF1aXoiLCJjdXJyZW50UXVlc3Rpb25JZHgiLCJxdWVzdGlvbnMiLCJ0aGlzIiwic3RhcnQiLCJsZW5ndGgiLCJFcnJvciIsIm5leHRRdWVzdGlvbiIsImlzQWN0aXZlIiwiaGFzU3RhcnRlZCIsImhhc0VuZGVkIiwiYWRkUXVlc3Rpb24iLCJxdWVzdGlvbiIsInVuZGVmaW5lZCIsInZhbGlkIiwibmVjZXNzYXJ5UHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wZXJ0eSIsImhhc093blByb3BlcnR5IiwiY3VycmVudFF1ZXN0aW9uIiwiZ2V0VG90YWxQb2ludHMiLCJ0b3RhbFBvaW50cyIsInBvaW50cyIsImdldEN1cnJlbnRRdWVzdGlvbk51bWJlciIsImdldE51bWJlck9mUXVlc3Rpb25zIiwiUXVlc3Rpb24iLCJvcHRpb25zIiwidGV4dCIsImluZm8iLCJhbnN3ZXIiLCJoaW50cyIsImhpbnRzVXNlZCIsImNoZWNrQW5zd2VyIiwiYW5zd2VyZWQiLCJvcHRzIiwiYWxsb3dlZCIsIm1heGltdW0iLCJjb3N0IiwiZ2l2ZSIsInByb3AiLCJ2YWx1ZSIsImdldEluZm8iLCJzb2x1dGlvbiIsImhpbnQiLCJzdWJtaXR0ZWRBbnN3ZXIiLCJNYXRoIiwibWF4IiwiaGludHNBbGxvd2VkIiwiaGludHNSZW1haW5pbmciLCJnZXRSYW5kb21JbnQiLCJtaW4iLCJmbG9vciIsInJhbmRvbSIsImdldFN0cmluZ0JldHdlZW4iLCJmaXJzdFN0cmluZyIsInNlY29uZFN0cmluZyIsImZpcnN0UG9zIiwiaW5kZXhPZiIsInNlY29uZFBvcyIsInN1YnN0ciIsImV4cG9ydHMiLCIkbG9jYXRpb25Qcm92aWRlciIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwiaHRtbDVNb2RlIiwib3RoZXJ3aXNlIiwic3RhdGUiLCJ1cmwiLCJ0ZW1wbGF0ZVVybCIsInBhcmFtcyIsImFjdGlvbiIsImNvdW50cmllc0J5TGV0dGVyIiwiY291bnRyeUtleXMiLCJnZXRDb3VudHJpZXNCeUxldHRlciIsIk9iamVjdCIsImtleXMiLCIkJHBoYXNlIiwiJGFwcGx5IiwiYXJlQ291bnRyaWVzTG9hZGVkIiwiJHN0YXRlUGFyYW1zIiwiYWxwaGEzQ29kZSIsImNvdW50cnkiLCJnZXRDb3VudHJ5QnlBbHBoYTMiLCJnZXRDb3VudHJ5RnJvbVNlcnZpY2UiLCJhbHBoYTMiLCJ0b2dnbGVEcm9wZG93biIsInZpc2libGUiLCJzaG93RHJvcGRvd24iLCJoaWRlRHJvcGRvd24iLCJpc0Ryb3Bkb3duVmlzaWJsZSIsImhhbmRsZUNsaWNrT3V0c2lkZSIsImNvbnNvbGUiLCJsb2ciLCJMb2dTcnYiLCJtZXNzYWdlIiwidHlwZSIsIkZvY3VzU3J2IiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwicmVzcG9uc2UiLCIkZW1pdCIsImVycm9yIiwibWVzc2FnZVRleHQiLCJzdGF0dXMiLCJsb2dvdXQiLCJuZ1Byb2dyZXNzRmFjdG9yeSIsInByb2dyZXNzYmFyIiwiY3JlYXRlSW5zdGFuY2UiLCJzZXRQYXJlbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic2V0QWJzb2x1dGUiLCJzZXRDb2xvciIsImFuc3dlcklucHV0IiwibXVsdGlwbGllck9wdGlvbnMiLCJsYWJlbCIsInVwZGF0ZVVpIiwiZ2V0Q3VycmVudFF1ZXN0aW9uIiwiaW5wdXQiLCJtdWx0aXBsaWVyIiwidXBkYXRlUHJvZ3Jlc3NCYXIiLCJzZXQiLCJnZXRRdWVzdGlvbiIsImdldE51bWJlck9mUXVpelF1ZXN0aW9ucyIsInJlbmRlclF1ZXN0aW9uVGV4dCIsInJlbmRlciIsImdldFF1ZXN0aW9uTWVkaWEiLCJtZWRpYSIsInN1Ym1pdEFuc3dlciIsInJlcGxhY2UiLCJxdWVzdGlvbkFuc3dlcmVkIiwiaXNRdWl6UnVubmluZyIsInJlcXVlc3RIaW50IiwiY2xhc3NOYW1lIiwiaGFuZGxlS2V5UHJlc3MiLCJrZXlFdmVudCIsIndoaWNoIiwicHJvZ3Jlc3NQZXJjZW50Iiwid2FzTGFzdFF1ZXN0aW9uIiwiY29udGludWVGaW5pc2hlZCIsInN0YXJ0UXVpeiIsImhhc1F1aXpTdGFydGVkIiwiaGFzUXVpekVuZGVkIiwiJHdpbmRvdyIsIm5ld1VzZXIiLCJyZWdpc3RlciIsImlzVmFsaWQiLCJ2YWxpZGF0ZUJlZm9yZVN1Ym1pdCIsInBhc3N3b3JkMiIsImVtYWlsIiwiZGVsZWdhdGVTdWJtaXQiLCJBcHBDb25maWciLCJjb2xvcnMiLCJ1c2VyT2JqIiwiY29sb3IiLCJ1c2VyQ29sb3JzIiwibmV3Q29sb3IiLCJ1cGRhdGVVc2VyIiwidXBkYXRlQmFzaWMiLCJkaXJlY3RpdmUiLCJzY29wZSIsInJlc3RyaWN0IiwibGluayIsImVsZW1lbnQiLCJhdHRycyIsImZpbHRlciIsIiRzY2UiLCJ0cnVzdEFzSHRtbCIsImZhY3RvcnkiLCJBdXRoVG9rZW5TcnYiLCJhZGRUb2tlbiIsInRva2VuIiwiZ2V0VG9rZW4iLCJoZWFkZXJzIiwicmVxdWVzdCIsInN0b3JlIiwic2Vzc2lvblN0b3JhZ2UiLCJrZXkiLCJnZXRJdGVtIiwic2V0VG9rZW4iLCJzZXRJdGVtIiwicmVtb3ZlSXRlbSIsIiRodHRwIiwiSW5kZXhlZERCU3J2IiwiY291bnRyaWVzQnlBbHBoYTMiLCJkYXRhYmFzZSIsImtleUNvdW50cmllcyIsImtleVZlcnNpb24iLCJpbmRleGVkREJBdmFpbGFibGUiLCJsb2FkQ291bnRyaWVzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjcmVhdGVEYXRhYmFzZSIsImdldEVtcHR5T2JqZWN0IiwiZ2V0SW50ZXJuYWxWZXJzaW9uIiwiZ2V0RXh0ZXJuYWxWZXJzaW9uIiwiZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5IiwibG9hZERhdGEiLCJvYmoiLCJ0b1VwcGVyQ2FzZSIsImMiLCJmaXJzdExldHRlciIsIm5hbWUiLCJnZXRDb3VudHJpZXNGcm9tQVBJIiwic3RyYXRlZ3kiLCJpbnRlcm5hbFZlcnNpb24iLCJleHRlcm5hbFZlcnNpb24iLCJwdXRJdGVtIiwiZ2V0Q291bnRyaWVzRnJvbURCIiwiX29iaiIsInJldHJpZXZlSXRlbSIsIml0ZW0iLCJnZXRWZXJzaW9uRnJvbUFQSSIsInZlcnNpb24iLCJnZXQiLCIkdGltZW91dCIsInNlbGVjdG9yIiwicXVlcnlTZWxlY3RvciIsImZvY3VzIiwia2V5UGF0aCIsImluZGV4ZWREQiIsIndlYmtpdEluZGV4ZWREQiIsIm1zSW5kZXhlZERCIiwiSURCS2V5UmFuZ2UiLCJ3ZWJraXRJREJLZXlSYW5nZSIsIklEQlRyYW5zYWN0aW9uIiwid2Via2l0SURCVHJhbnNhY3Rpb24iLCJSRUFEX1dSSVRFIiwiUkVBRF9PTkxZIiwiZGJOYW1lIiwic3RvcmVOYW1lIiwib3BlbiIsIm9udXBncmFkZW5lZWRlZCIsImUiLCJpZGIiLCJ0YXJnZXQiLCJyZXN1bHQiLCJjcmVhdGVPYmplY3RTdG9yZSIsIm9uc3VjY2VzcyIsIm9uZXJyb3IiLCJkcm9wRGF0YWJhc2UiLCJkZWxldGVEYXRhYmFzZSIsImFkZEl0ZW0iLCJ0cmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlIiwicmVxdWVzdEFkZCIsImFkZCIsInB1dCIsIml0ZW1OYW1lIiwicmFuZ2UiLCJvbmx5Iiwib3BlbkN1cnNvciIsImN1cnNvciIsInJldHJpZXZlSXRlbXMiLCJpdGVtcyIsImxvZ0luZm8iLCJhcHBseSIsImFyZ3VtZW50cyIsImxvZ0Vycm9yIiwicXVpeiIsIl9jb3VudHJpZXMiLCJjb3VudHJpZXNMb2FkZWQiLCJjcmVhdGVRdWl6IiwicXVpelR5cGUiLCJjcmVhdGVDb3VudHJ5UXVpeiIsImNvdW50cnlRdWl6IiwiZnVsbFBvaW50cyIsImhpbnRNYXhpbXVtIiwiaGludENvc3QiLCJsYXN0UXVlc3Rpb25Cb251cyIsInF1ZXN0aW9uVHlwZXMiLCJxdWVzdGlvblR5cGVzTGVuZ3RoIiwic2VsZWN0ZWRDb3VudHJpZXMiLCJudW1iZXJPZlF1ZXN0aW9ucyIsImkiLCJjb3VudHJ5T2siLCJxY250IiwicXVlc3Rpb25UeXBlIiwiZ2V0UXVlc3Rpb25UZXh0IiwiZ2V0UXVlc3Rpb25JbnB1dCIsInVuaXQiLCJnZXRRdWVzdGlvblVuaXQiLCJnZXRRdWVzdGlvbkFuc3dlciIsImdldENoZWNrQW5zd2VyTGFtYmRhIiwiZ2V0UXVlc3Rpb25IaW50cyIsImFscGhhMkNvZGUiLCJ0b0xvY2FsZUxvd2VyQ2FzZSIsImNhcGl0YWwiLCJhbHRTcGVsbGluZ3MiLCJjb3JyZWN0IiwicG9wdWxhdGlvbiIsImFyZWEiLCJib251cyIsImVycm9yUGVyY2VudGFnZSIsImFicyIsImhpbnRzUG9zc2libGUiLCJnZXRIaWdoc2NvcmVMaXN0Iiwic3VjY2VzcyIsImxpc3QiLCJnZXRVc2VySGlnaHNjb3JlIiwic2NvcmUiLCJnZXRPdmVyYWxsSGlnaHNjb3JlIiwicHV0SGlnaHNjb3JlIiwic2VsZiIsImdldFVzZXIiLCJwb3N0Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxVQUFBQyxRQUFBQyxPQUFBLFlBQ0EsWUFDQSxhQUNBLGNDQ0ksZ0JEQUosU0FBQUMsR0FDQUEsRUFBQUMsYUFBQUMsS0FBQSxxQkFJQUwsVUFBQU0sU0FBQSxhQUNBQyxZQUFBLEVBQ0FDLGFBQUEsRUFFQUMseUJBQUEsRUFDQUMsc0JBQ0FDLEVBQUEscUJBQ0FDLEVBQUEscUJBQ0FDLEVBQUEsd0JBQ0FDLEVBQUEsa0JBQ0FDLEVBQUEsbUJBR0FDLHdCQUNBLFdBQ0EsY0FDQSxZQUNBLGdCQUNBLFFBQ0EsZUFDQSxhQUNBLGNBQ0EsT0FDQSxTQUNBLGFBQ0Esa0JBQ0EsT0FDQSxXQUNBLGFBQ0EsZUFDQSxRQUNBLFVBQ0EsU0FDQSxXQUlBaEIs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RSxFQUFBdEcsS0FHQTRLLEVBQUFVLFNBQUE2SCxFQUFBckksT0FFQXNJLE9BSUF6TSxFQUFBLFdBQ0EsTUFBQSxJQUFBc0YsU0FBQSxTQUFBQyxFQUFBQyxHQUNBZ0gsRUFBQXJJLE1BQUEsS0FHQUYsRUFBQVUsV0FFQVksT0FJQTlDLEVBQUEsU0FBQUQsR0FDQSxNQUFBLElBQUE4QyxTQUFBLFNBQUFDLEVBQUFDLEdBRUEsR0FBQXhDLEdBQUFELEVBQUEsdUJBQ0FQLEdBQUFVLE1BQUFGLEVBQUF4RyxhQUFBLEVBQUF3RyxFQUFBcEosT0FBQSxJQUVBa0wsRUFBQTRILEtBQUEsWUFBQWxLLEdBQ0EwSixRQUFBLFNBQUE3UyxHQUVBbUcsRUFBQWdELEVBQUEvQyxTQUFBK0MsRUFBQTlDLFVBQ0FoSCxLQUFBLFNBQUFXLEdBQ0FrTSxFQUFBbE0sS0FGQW1HLFNBSUEsU0FBQXhHLEdBQ0F3TSxFQUFBeE0sT0FHQTZHLE1BQUEsU0FBQTdHLEdBQ0F3TSxFQUFBeE0sUUFLQXNLLEVBQUEsU0FBQTNLLEdBQ0EsTUFBQSxJQUFBMk0sU0FBQSxTQUFBQyxFQUFBQyxHQUNBVixFQUFBa0UsSUFBQSxrQkFBQXJRLEdBQ0F1VCxRQUFBLFNBQUE3UyxHQUNBa00sRUFBQWxNLEtBRUF3RyxNQUFBLFNBQUE3RyxHQUNBd00sRUFBQXhNLE9BS0EsUUFDQXlULFFBQUFBLEVBQ0FoVSxtQkFBQUEsRUFDQStHLE1BQUFBLEVBQ0FRLE9BQUFBLEVBQ0F5QyxTQUFBQSxFQUNBYSxZQUFBQSIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbWFnZWxsYW4gPSBhbmd1bGFyLm1vZHVsZShcIm1hZ2VsbGFuXCIsIFtcclxuICAgICd1aS5yb3V0ZXInLFxyXG4gICAgJ25nUHJvZ3Jlc3MnLFxyXG4gICAgJ25nQW5pbWF0ZSdcclxuXSwgZnVuY3Rpb24gY29uZmlnKCRodHRwUHJvdmlkZXIpIHtcclxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG59KTtcclxuXHJcbi8vIGRlZmluZSBhcHBsaWNhdGlvbiBjb25zdGFudHNcclxubWFnZWxsYW4uY29uc3RhbnQoXCJBcHBDb25maWdcIiwge1xyXG4gICAgXCJsb2cuaW5mb1wiOiB0cnVlLFxyXG4gICAgXCJsb2cuZXJyb3JcIjogdHJ1ZSxcclxuXHJcbiAgICBcInF1aXouY291bnRyeS5xdWVzdGlvbnNcIjogMyxcclxuICAgIFwicXVpei5jb3VudHJ5LnR5cGVzXCI6IHtcclxuICAgICAgICAxOiBcIkNBUElUQUxfT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDI6IFwiQ09VTlRSWV9PRl9DQVBJVEFMXCIsXHJcbiAgICAgICAgMzogXCJQT1BVTEFUSU9OX09GX0NPVU5UUllcIixcclxuICAgICAgICA0OiBcIkFSRUFfT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDU6IFwiRkxBR19PRl9DT1VOVFJZXCJcclxuICAgIH0sXHJcblxyXG4gICAgXCJzZXR0aW5ncy51c2VyLmNvbG9yc1wiOiBbXHJcbiAgICAgICAgJ3NvZnRfcmVkJyxcclxuICAgICAgICAndGh1bmRlcmJpcmQnLFxyXG4gICAgICAgICdvbGRfYnJpY2snLFxyXG4gICAgICAgICduZXdfeW9ya19waW5rJyxcclxuICAgICAgICAnc251ZmYnLFxyXG4gICAgICAgICdob25leV9mbG93ZXInLFxyXG4gICAgICAgICdzYW5fbWFyaW5vJyxcclxuICAgICAgICAnc2hha2VzcGVhcmUnLFxyXG4gICAgICAgICdtaW5nJyxcclxuICAgICAgICAnZ29zc2lwJyxcclxuICAgICAgICAnZXVjYWx5cHR1cycsXHJcbiAgICAgICAgJ21vdW50YWluX21lYWRvdycsXHJcbiAgICAgICAgJ2phZGUnLFxyXG4gICAgICAgICdjb25mZXR0aScsXHJcbiAgICAgICAgJ2NhbGlmb3JuaWEnLFxyXG4gICAgICAgICdidXJudF9vcmFuZ2UnLFxyXG4gICAgICAgICdqYWZmYScsXHJcbiAgICAgICAgJ2dhbGxlcnknLFxyXG4gICAgICAgICdlZHdhcmQnLFxyXG4gICAgICAgICdseW5jaCdcclxuICAgIF1cclxufSk7XHJcblxyXG5tYWdlbGxhbi5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgVXNlclNydiwgQ291bnRyeVNydiwgUXVpelNydikge1xyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGNvbmZpZyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS5hcHAgPSB7XHJcbiAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgIHRpdGxlOiBcIk1hZ2VsbGFuXCIsXHJcbiAgICAgICAgICAgIHN1YnRpdGxlOiBcIlRlc3QgeW91ciBrbm93bGVkZ2UgYWJvdXQgdGhlIGNvdW50cmllcyBvZiBvdXIgd29ybGRcIixcclxuICAgICAgICAgICAgYXV0aG9yOiBcIk1pY2hhZWwgU3RpZnRlclwiXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgaW5pdGlhbGl6YXRpb24gLS0tLS0tLS0tLS0tXHJcbiAgICBVc2VyU3J2LmdldFVzZXJGcm9tU3RvcmFnZSgpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICAgICAkc2NvcGUudXNlciA9IHVzZXI7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgndXNlci5sb2FkZWQnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAvLyB0aGUgb25seSBlcnJvciB0aGF0IGNhbiBvY2N1ciBpcyB0aGF0IHRoZXJlIGlzIG5vIHRva2VuIGluIHN0b3JhZ2UsIHdlIGRvIG5vdCBuZWVkIHRvIHJlYWN0IHRvIHRoYXRcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuaXNQcm9ncmVzc0JhclZpc2libGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gJHN0YXRlLmlzKCdxdWl6Jyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEV2ZW50IGhhbmRsaW5nIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ2luJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIHF1aXogcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygncXVpeicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ291dCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gcmVtb3ZlIHVzZXIgb2JqZWN0IGZyb20gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfSk7XHJcbn0pOyIsInZhciBtYWdlbGxhbiA9IGFuZ3VsYXIubW9kdWxlKFwibWFnZWxsYW5cIiwgW1xyXG4gICAgJ3VpLnJvdXRlcicsXHJcbiAgICAnbmdQcm9ncmVzcycsXHJcbiAgICAnbmdBbmltYXRlJ1xyXG5dLCBbXCIkaHR0cFByb3ZpZGVyXCIsIGZ1bmN0aW9uIGNvbmZpZygkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBdXRoSW50ZXJjZXB0b3InKTtcclxufV0pO1xyXG5cclxuLy8gZGVmaW5lIGFwcGxpY2F0aW9uIGNvbnN0YW50c1xyXG5tYWdlbGxhbi5jb25zdGFudChcIkFwcENvbmZpZ1wiLCB7XHJcbiAgICBcImxvZy5pbmZvXCI6IHRydWUsXHJcbiAgICBcImxvZy5lcnJvclwiOiB0cnVlLFxyXG5cclxuICAgIFwicXVpei5jb3VudHJ5LnF1ZXN0aW9uc1wiOiAzLFxyXG4gICAgXCJxdWl6LmNvdW50cnkudHlwZXNcIjoge1xyXG4gICAgICAgIDE6IFwiQ0FQSVRBTF9PRl9DT1VOVFJZXCIsXHJcbiAgICAgICAgMjogXCJDT1VOVFJZX09GX0NBUElUQUxcIixcclxuICAgICAgICAzOiBcIlBPUFVMQVRJT05fT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDQ6IFwiQVJFQV9PRl9DT1VOVFJZXCIsXHJcbiAgICAgICAgNTogXCJGTEFHX09GX0NPVU5UUllcIlxyXG4gICAgfSxcclxuXHJcbiAgICBcInNldHRpbmdzLnVzZXIuY29sb3JzXCI6IFtcclxuICAgICAgICAnc29mdF9yZWQnLFxyXG4gICAgICAgICd0aHVuZGVyYmlyZCcsXHJcbiAgICAgICAgJ29sZF9icmljaycsXHJcbiAgICAgICAgJ25ld195b3JrX3BpbmsnLFxyXG4gICAgICAgICdzbnVmZicsXHJcbiAgICAgICAgJ2hvbmV5X2Zsb3dlcicsXHJcbiAgICAgICAgJ3Nhbl9tYXJpbm8nLFxyXG4gICAgICAgICdzaGFrZXNwZWFyZScsXHJcbiAgICAgICAgJ21pbmcnLFxyXG4gICAgICAgICdnb3NzaXAnLFxyXG4gICAgICAgICdldWNhbHlwdHVzJyxcclxuICAgICAgICAnbW91bnRhaW5fbWVhZG93JyxcclxuICAgICAgICAnamFkZScsXHJcbiAgICAgICAgJ2NvbmZldHRpJyxcclxuICAgICAgICAnY2FsaWZvcm5pYScsXHJcbiAgICAgICAgJ2J1cm50X29yYW5nZScsXHJcbiAgICAgICAgJ2phZmZhJyxcclxuICAgICAgICAnZ2FsbGVyeScsXHJcbiAgICAgICAgJ2Vkd2FyZCcsXHJcbiAgICAgICAgJ2x5bmNoJ1xyXG4gICAgXVxyXG59KTtcclxuXHJcbm1hZ2VsbGFuLmNvbnRyb2xsZXIoXCJBcHBDdHJsXCIsIFtcIiRzY29wZVwiLCBcIiRzdGF0ZVwiLCBcIlVzZXJTcnZcIiwgXCJDb3VudHJ5U3J2XCIsIFwiUXVpelNydlwiLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgVXNlclNydiwgQ291bnRyeVNydiwgUXVpelNydikge1xyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGNvbmZpZyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS5hcHAgPSB7XHJcbiAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgIHRpdGxlOiBcIk1hZ2VsbGFuXCIsXHJcbiAgICAgICAgICAgIHN1YnRpdGxlOiBcIlRlc3QgeW91ciBrbm93bGVkZ2UgYWJvdXQgdGhlIGNvdW50cmllcyBvZiBvdXIgd29ybGRcIixcclxuICAgICAgICAgICAgYXV0aG9yOiBcIk1pY2hhZWwgU3RpZnRlclwiXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgaW5pdGlhbGl6YXRpb24gLS0tLS0tLS0tLS0tXHJcbiAgICBVc2VyU3J2LmdldFVzZXJGcm9tU3RvcmFnZSgpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICAgICAkc2NvcGUudXNlciA9IHVzZXI7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgndXNlci5sb2FkZWQnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAvLyB0aGUgb25seSBlcnJvciB0aGF0IGNhbiBvY2N1ciBpcyB0aGF0IHRoZXJlIGlzIG5vIHRva2VuIGluIHN0b3JhZ2UsIHdlIGRvIG5vdCBuZWVkIHRvIHJlYWN0IHRvIHRoYXRcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuaXNQcm9ncmVzc0JhclZpc2libGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gJHN0YXRlLmlzKCdxdWl6Jyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEV2ZW50IGhhbmRsaW5nIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ2luJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIHF1aXogcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygncXVpeicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ291dCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gcmVtb3ZlIHVzZXIgb2JqZWN0IGZyb20gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfSk7XHJcbn1dKTtcbi8vIG93biBjbGFzc2VzIGFuZCBmdW5jdGlvbnNcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVJWiAtLS0tLS0tLS0tXHJcbnZhciBRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBpbmRleCBvZiBjdXJyZW50IHF1ZXN0aW9uXHJcbiAgICB2YXIgY3VycmVudFF1ZXN0aW9uSWR4ID0gbnVsbDtcclxuXHJcbiAgICAvLyBhcnJheSBjb250YWluaW5nIGFsbCBxdWVzdGlvbnNcclxuICAgIHZhciBxdWVzdGlvbnMgPSBbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN0YXJ0cyB0aGUgcXVpei5cclxuICAgICAqL1xyXG4gICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIGNoZWNrIGlmIHF1aXogaGFzIHF1ZXN0aW9uc1xyXG4gICAgICAgIGlmIChxdWVzdGlvbnMubGVuZ3RoIDw9IDApXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHN0YXJ0IGEgcXVpeiB3aXRob3V0IHF1ZXN0aW9uc1wiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaXNBY3RpdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNTdGFydGVkKCkgJiYgIXRoaXMuaGFzRW5kZWQoKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbklkeCAhPT0gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhc1N0YXJ0ZWQoKSAmJiBjdXJyZW50UXVlc3Rpb25JZHggPj0gcXVlc3Rpb25zLmxlbmd0aDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IHF1ZXN0aW9uIHRvIHRoZSBxdWl6LlxyXG4gICAgICogVGhlIHBhcmFtZXRlciBtdXN0IGJlIGFuIHF1ZXN0aW9uIG9iamVjdC5cclxuICAgICAqIElmIG5vIHF1ZXN0aW9uIG9iamVjdCBpcyBwYXNzZWQgb3IgYW4gb2JqZWN0IHdpdGggbWlzc2luZyBwcm9wZXJ0aWVzLCBhbiBlcnJvciBpcyB0aHJvd24uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYWRkUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgIGlmIChxdWVzdGlvbiA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIk5vIHF1ZXN0aW9uIG9iamVjdCBwYXNzZWRcIik7XHJcblxyXG4gICAgICAgIHZhciB2YWxpZCA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGEgcXVlc3Rpb24gb2JqZWN0IG11c3QgY29udGFpbiBhbGwgdGhlc2UgcHJvcGVydGllc1xyXG4gICAgICAgIHZhciBuZWNlc3NhcnlQcm9wZXJ0aWVzID0gWydjb25maWcnLCAnaGludCcsICdzb2x1dGlvbicsICdhbnN3ZXInLCAncXVlc3Rpb24nLCAnZ2V0SW5mbycsICdpbmZvJywgJ3BvaW50cycsICdhbnN3ZXJlZCcsICdoaW50c0FsbG93ZWQnLCAnaGludHNSZW1haW5pbmcnXTtcclxuXHJcbiAgICAgICAgbmVjZXNzYXJ5UHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIGlmICghcXVlc3Rpb24uaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUXVlc3Rpb24gbXVzdCBoYXZlIHByb3BlcnR5ICdcIiArIHByb3BlcnR5ICsgXCInXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh2YWxpZCkge1xyXG4gICAgICAgICAgICBxdWVzdGlvbnMucHVzaChxdWVzdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG5leHQgcXVlc3Rpb24gb2YgdGhlIHF1aXouXHJcbiAgICAgKiBJZiB0aGUgcXVpeiBoYXMgZW5kZWQsIGl0IHJldHVybnMgbm90aGluZy5cclxuICAgICAqL1xyXG4gICAgdGhpcy5uZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uSWR4ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbklkeCA9IDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSWR4Kys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnNbY3VycmVudFF1ZXN0aW9uSWR4XTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5jdXJyZW50UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNBY3RpdmUoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnNbY3VycmVudFF1ZXN0aW9uSWR4XTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzU3RhcnRlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHRvdGFsUG9pbnRzID0gMDtcclxuXHJcbiAgICAgICAgcXVlc3Rpb25zLmZvckVhY2goZnVuY3Rpb24ocXVlc3Rpb24pIHtcclxuICAgICAgICAgICAgdmFyIHBvaW50cyA9IHF1ZXN0aW9uLnBvaW50cygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHBvaW50cyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0b3RhbFBvaW50cyArPSBwb2ludHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRvdGFsUG9pbnRzO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChjdXJyZW50UXVlc3Rpb25JZHggPT09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICByZXR1cm4gY3VycmVudFF1ZXN0aW9uSWR4ICsgMTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXROdW1iZXJPZlF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnMubGVuZ3RoO1xyXG4gICAgfTtcclxufTtcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVFU1RJT04gLS0tLS0tLS0tLVxyXG52YXIgUXVlc3Rpb24gPSBmdW5jdGlvbihvcHRpb25zKSB7XHJcbiAgICAvLyBUZXh0IG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIHRleHQgPSBudWxsO1xyXG5cclxuICAgIC8vIEluZm8gb2JqZWN0IGZvciB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBpbmZvID0gbnVsbDtcclxuXHJcbiAgICAvLyBBbnN3ZXIgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgYW5zd2VyID0gbnVsbDtcclxuXHJcbiAgICAvLyBIaW50cyBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBoaW50cyA9IG51bGw7XHJcbiAgICB2YXIgaGludHNVc2VkID0gMDtcclxuXHJcbiAgICAvLyBMYW1iZGEgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIHRoZSBhbnN3ZXIgc3RhdHVzIG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGNoZWNrQW5zd2VyID0gbnVsbDtcclxuXHJcbiAgICAvLyBQb2ludHMgYXdhcmRlZCBmb3IgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgcG9pbnRzID0gbnVsbDtcclxuXHJcbiAgICAvLyBGbGFnIGluZGljYXRpbmcgd2hldGhlciBxdWVzdGlvbiBoYXMgYWxyZWFkeSBiZWVuIGFuc3dlcmVkXHJcbiAgICB2YXIgYW5zd2VyZWQgPSBmYWxzZTtcclxuXHJcbiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKG9wdHMpIHtcclxuICAgICAgICB0ZXh0ID0gb3B0cy50ZXh0O1xyXG4gICAgICAgIGluZm8gPSBvcHRzLmluZm8gfHwge307XHJcbiAgICAgICAgYW5zd2VyID0gb3B0cy5hbnN3ZXI7XHJcbiAgICAgICAgY2hlY2tBbnN3ZXIgPSBvcHRzLmNoZWNrQW5zd2VyIHx8IG51bGw7XHJcblxyXG4gICAgICAgIGhpbnRzID0gb3B0cy5oaW50cyB8fCB7XHJcbiAgICAgICAgICAgICAgICBhbGxvd2VkOiBmYWxzZSwgICAgIC8vIGlzIGEgaGludCBhbGxvd2VkP1xyXG4gICAgICAgICAgICAgICAgbWF4aW11bTogMCwgICAgICAgICAvLyBtYXhpbXVtIG51bWJlciBvZiBoaW50cyBmb3IgdGhpcyBxdWVzdGlvbiAoaXJyZWxldmFudCBpZiBhbGxvd2VkIGlzIHNldCB0byBmYWxzZSlcclxuICAgICAgICAgICAgICAgIGNvc3Q6IDAsICAgICAgICAgICAgLy8gbnVtYmVyIG9mIHBvaW50cyBzdWJ0cmFjdGVkIHBlciB1c2VkIGhpbnQgKGlycmVsZXZhbnQgaWYgYWxsb3dlZCBpcyBzZXQgdG8gZmFsc2UpXHJcbiAgICAgICAgICAgICAgICBnaXZlOiBudWxsICAgICAgICAgIC8vIGxhbWJkYSBmdW5jdGlvbiB0byBnaXZlIGEgaGludCBmb3IgYSBxdWVzdGlvblxyXG4gICAgICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICAgIGluaXQob3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jb25maWcgPSBmdW5jdGlvbihvcHRzKSB7XHJcbiAgICAgICAgaW5pdChvcHRzKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBxdWVzdGlvbiB0ZXh0LlxyXG4gICAgICovXHJcbiAgICB0aGlzLnF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgcXVlc3Rpb24gaW5mbyBvYmplY3QuXHJcbiAgICAgKiBBY3RzIGFzIGdldHRlciAod2l0aCBvbmx5IG9uZSBhcmd1bWVudCkgYW5kIHNldHRlciAod2l0aCB0d28gYXJndW1lbnRzKVxyXG4gICAgICovXHJcbiAgICB0aGlzLmluZm8gPSBmdW5jdGlvbihwcm9wLCB2YWx1ZSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIC8vIHNldHRlclxyXG4gICAgICAgICAgICBpbmZvW3Byb3BdID0gdmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gZ2V0dGVyXHJcbiAgICAgICAgICAgIHJldHVybiBpbmZvW3Byb3BdO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBlbnRpcmUgaW5mbyBvYmplY3QuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuZ2V0SW5mbyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBpbmZvO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIGNvcnJlY3QgYW5zd2VyIHRvIHRoZSBxdWVzdGlvbiBhZnRlciB0aGUgcXVlc3Rpb24gaGFzIGJlZW4gYW5zd2VyZWQuXHJcbiAgICAgKiBJZiB0aGUgcXVlc3Rpb24gaGFzIG5vdCBiZWVuIGFuc3dlcmVkIHlldCwgaXQgcmV0dXJucyBudWxsLlxyXG4gICAgICovXHJcbiAgICB0aGlzLnNvbHV0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGFuc3dlcmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGEgaGludCBmb3IgdGhlIHF1ZXN0aW9uLlxyXG4gICAgICogSWYgbm8gaGludHMgYXJlIGFsbG93ZWQsIG9yIHRoZSBtYXhpbXVtIG51bWJlciBvZiBoaW50cyBoYXZlIGJlZW4gdXNlZCwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCFoaW50cy5hbGxvd2VkIHx8IGhpbnRzVXNlZCA+PSBoaW50cy5tYXhpbXVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGhpbnRzLmFsbG93ZWQgJiYgIWhpbnRzLmdpdmUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGludHMgYWxsb3dlZCBidXQgbm8gZ2l2ZSBtZXRob2QgcGFzc2VkXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaGludHNVc2VkKys7XHJcblxyXG4gICAgICAgIHJldHVybiBoaW50cy5naXZlKGhpbnRzVXNlZCwgYW5zd2VyKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJtaXRzIGFuIGFuc3dlciB0byB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKiBJZiB0aGUgcXVlc3Rpb24gaGFzIGFscmVhZHkgYmVlbiBhbnN3ZXJlZCBvciBubyBjaGVja0Fuc3dlciBsYW1iZGEgaGFzIGJlZW4gc2V0LCB0aGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYW5zd2VyID0gZnVuY3Rpb24oc3VibWl0dGVkQW5zd2VyKSB7XHJcbiAgICAgICAgaWYgKGFuc3dlcmVkIHx8IWNoZWNrQW5zd2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFuc3dlcmVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gY2hlY2tBbnN3ZXIgbWV0aG9kIHNob3VsZCByZXR1cm4gdGhlIHN0YXR1cyByZXN1bHRzXHJcbiAgICAgICAgcG9pbnRzID0gY2hlY2tBbnN3ZXIoYW5zd2VyLCBzdWJtaXR0ZWRBbnN3ZXIsIGhpbnRzVXNlZCwgaGludHMuY29zdCwgaW5mbyk7XHJcblxyXG4gICAgICAgIC8vIGVuc3VyZSB0aGF0IG5vIG5lZ2F0aXZlIHBvaW50cyBhcmUgYXdhcmRlZFxyXG4gICAgICAgIHBvaW50cyA9IE1hdGgubWF4KDAsIHBvaW50cyk7XHJcblxyXG4gICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCFhbnN3ZXJlZCB8fCBwb2ludHMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHN0YXRlIG9mIHRoZSBxdWVzdGlvbi5cclxuICAgICAqL1xyXG4gICAgdGhpcy5hbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBhbnN3ZXJlZDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgaGludHMgYXJlIGFsbG93ZWQgZm9yIHRoaXMgcXVlc3Rpb24sIGZhbHNlIGlmIG5vdC5cclxuICAgICAqIElmIGhpbnRzIGhhdmUgbm90IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmhpbnRzQWxsb3dlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaGludHMuYWxsb3dlZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiByZW1haW5pbmcgaGludHMuXHJcbiAgICAgKiBJZiBubyBoaW50cyBhcmUgYWxsb3dlZCBmb3IgdGhpcyBxdWVzdGlvbiwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50c1JlbWFpbmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhbGxvd2VkID0gdGhpcy5oaW50c0FsbG93ZWQoKTtcclxuXHJcbiAgICAgICAgaWYgKGFsbG93ZWQgPT09IG51bGwgfHwgYWxsb3dlZCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gaGludHMubWF4aW11bSAtIGhpbnRzVXNlZDtcclxuICAgIH07XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyBhIHJhbmRvbSBpbnRlZ2VyIGJldHdlZW4gbWluIChpbmNsdXNpdmUpIGFuZCBtYXggKGluY2x1c2l2ZSlcclxuICogVXNpbmcgTWF0aC5yb3VuZCgpIHdpbGwgZ2l2ZSB5b3UgYSBub24tdW5pZm9ybSBkaXN0cmlidXRpb24hXHJcbiAqL1xyXG52YXIgZ2V0UmFuZG9tSW50ID0gZnVuY3Rpb24obWluLCBtYXgpIHtcclxuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgdGhlIHRleHQgYmV0d2VlbiB0d28gZGVsaW1pdGluZyB0ZXh0IG9jY3VycmVuY2VzXHJcbiAqL1xyXG52YXIgZ2V0U3RyaW5nQmV0d2VlbiA9IGZ1bmN0aW9uKHRleHQsIGZpcnN0U3RyaW5nLCBzZWNvbmRTdHJpbmcpIHtcclxuICAgIHZhciBmaXJzdFBvcyA9IHRleHQuaW5kZXhPZihmaXJzdFN0cmluZyk7XHJcbiAgICB2YXIgc2Vjb25kUG9zID0gdGV4dC5pbmRleE9mKHNlY29uZFN0cmluZyk7XHJcblxyXG4gICAgaWYgKGZpcnN0UG9zID49IDAgJiYgc2Vjb25kUG9zID49IDAgJiYgc2Vjb25kUG9zID4gZmlyc3RQb3MpIHtcclxuICAgICAgICByZXR1cm4gdGV4dC5zdWJzdHIoZmlyc3RQb3MgKyAxLCBzZWNvbmRQb3MgLSBmaXJzdFBvcyAtIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cy5RdWVzdGlvbiA9IFF1ZXN0aW9uO1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuUXVpeiA9IFF1aXo7XHJcbn1cbmFuZ3VsYXIubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29uZmlnKFtcIiRsb2NhdGlvblByb3ZpZGVyXCIsIFwiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgZnVuY3Rpb24oJGxvY2F0aW9uUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgICAgICAvLyBlbmFibGUgSFRNTDUgcHVzaHN0YXRlXHJcbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG5cclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvaG9tZScpO1xyXG5cclxuICAgICAgICAkc3RhdGVQcm92aWRlclxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hvbWUnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvaG9tZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9ob21lLnBhcnRpYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IG51bGxcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdxdWl6Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3F1aXonLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvcXVpei5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnY291bnRyaWVzJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2NvdW50cmllcycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9jb3VudHJpZXMucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2NvdW50cmllcy5kZXRhaWwnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvOmFscGhhM0NvZGUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvY291bnRyaWVzLWRldGFpbC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvbG9naW4ucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ291dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9sb2dvdXQnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ291dEN0cmwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncmVnaXN0ZXInLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvcmVnaXN0ZXInLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvcmVnaXN0ZXIucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3NldHRpbmdzJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3NldHRpbmdzJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3NldHRpbmdzLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdhYm91dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hYm91dCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9hYm91dC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0NvdW50cmllc0N0cmwnLCBbXCIkc2NvcGVcIiwgXCJDb3VudHJ5U3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgQ291bnRyeVNydikge1xyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUxldHRlciA9IG51bGw7XHJcbiAgICAgICAgdmFyIGNvdW50cnlLZXlzID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXIgPSBDb3VudHJ5U3J2LmdldENvdW50cmllc0J5TGV0dGVyKCk7XHJcbiAgICAgICAgICAgIGNvdW50cnlLZXlzID0gT2JqZWN0LmtleXMoY291bnRyaWVzQnlMZXR0ZXIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCEkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyeUtleXMgPSBjb3VudHJ5S2V5cztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyaWVzQnlMZXR0ZXIgPSBjb3VudHJpZXNCeUxldHRlcjtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cnlLZXlzID0gY291bnRyeUtleXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyaWVzQnlMZXR0ZXIgPSBjb3VudHJpZXNCeUxldHRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmIChDb3VudHJ5U3J2LmFyZUNvdW50cmllc0xvYWRlZCgpKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ2NvdW50cmllcy5sb2FkZWQnLCBmdW5jdGlvbigpICB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdDb3VudHJ5RGV0YWlsQ3RybCcsIFtcIiRzY29wZVwiLCBcIkNvdW50cnlTcnZcIiwgXCIkc3RhdGVQYXJhbXNcIiwgZnVuY3Rpb24oJHNjb3BlLCBDb3VudHJ5U3J2LCAkc3RhdGVQYXJhbXMpIHtcclxuICAgICAgICB2YXIgYWxwaGEzQ29kZSA9ICRzdGF0ZVBhcmFtcy5hbHBoYTNDb2RlO1xyXG5cclxuICAgICAgICBpZiAoQ291bnRyeVNydi5hcmVDb3VudHJpZXNMb2FkZWQoKSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhM0NvZGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignY291bnRyaWVzLmxvYWRlZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cnkgPSBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTNDb2RlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cnlGcm9tU2VydmljZSA9IGZ1bmN0aW9uKGFscGhhMykge1xyXG4gICAgICAgICAgICByZXR1cm4gQ291bnRyeVNydi5nZXRDb3VudHJ5QnlBbHBoYTMoYWxwaGEzKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0Q291bnRyeUZyb21TZXJ2aWNlID0gZ2V0Q291bnRyeUZyb21TZXJ2aWNlO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0Ryb3Bkb3duQ3RybCcsIFtcIiRzY29wZVwiLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkc2NvcGUudG9nZ2xlRHJvcGRvd24gPSB0b2dnbGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuc2hvd0Ryb3Bkb3duID0gc2hvd0Ryb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5oaWRlRHJvcGRvd24gPSBoaWRlRHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmlzRHJvcGRvd25WaXNpYmxlID0gaXNEcm9wZG93blZpc2libGU7XHJcblxyXG4gICAgICAgICRzY29wZS5oYW5kbGVDbGlja091dHNpZGUgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNMSUNLRUQgT1VUU0lERVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gIXZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93RHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGlkZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0Ryb3Bkb3duVmlzaWJsZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZpc2libGU7XHJcbiAgICAgICAgfVxyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0hvbWVDdHJsJywgW1wiJHNjb3BlXCIsIFwiTG9nU3J2XCIsIFwiJHN0YXRlUGFyYW1zXCIsIGZ1bmN0aW9uKCRzY29wZSwgTG9nU3J2LCAkc3RhdGVQYXJhbXMpIHtcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGNoZWNrIHN0YXRlIHBhcmFtc1xyXG4gICAgICAgIGlmICgkc3RhdGVQYXJhbXMuYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpb24gPSAkc3RhdGVQYXJhbXMuYWN0aW9uO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChhY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3JlZ2lzdGVyLnN1Y2Nlc3NmdWwnOlxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdHcmF0dWxhdGlvbiEgRGllIEFubWVsZHVuZyB3YXIgZXJmb2xncmVpY2guIEhlcnpsaWNoIHdpbGxrb21tZW4gYmVpIE1hZ2VsbGFuLidcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBbXCIkc2NvcGVcIiwgXCJVc2VyU3J2XCIsIFwiRm9jdXNTcnZcIiwgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2LCBGb2N1c1Nydikge1xyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIFVzZXJTcnYubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ2luIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIuc3RhdHVzID09PSA0MDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnRmFsc2NoZXIgQmVudXR6ZXJuYW1lIG9kZXIgUGFzc3dvcnQnO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0JlaW0gRWlubG9nZ2VuIHNjaGVpbnQgZXR3YXMgc2NoaWVmIGdlZ2FuZ2VuIHp1IHNlaW4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGZvY3VzIHVzZXJuYW1lIGZpZWxkXHJcbiAgICAgICAgRm9jdXNTcnYoJyN1c2VybmFtZScpO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ291dEN0cmwnLCBbXCIkc2NvcGVcIiwgXCJVc2VyU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydikge1xyXG4gICAgICAgIFVzZXJTcnYubG9nb3V0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dvdXQgZXZlbnRcclxuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ291dCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6RGlyZWN0aXZlQ29udHJvbGxlcicsIFtcIiRzY29wZVwiLCBcIlF1aXpTcnZcIiwgXCJMb2dTcnZcIiwgXCJGb2N1c1NydlwiLCBcIm5nUHJvZ3Jlc3NGYWN0b3J5XCIsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2LCBGb2N1c1NydiwgbmdQcm9ncmVzc0ZhY3RvcnkpIHtcclxuICAgICAgICAvLyBQcm9ncmVzcyBiYXIgaW5pdGlhbGl6YXRpb25cclxuICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIgPSBuZ1Byb2dyZXNzRmFjdG9yeS5jcmVhdGVJbnN0YW5jZSgpO1xyXG4gICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRQYXJlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotcHJvZ3Jlc3MnKSk7XHJcbiAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldEFic29sdXRlKCk7XHJcbiAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldENvbG9yKFwiIzMzNmU3YlwiKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0ID0ge307XHJcbiAgICAgICAgJHNjb3BlLmhpbnQgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBhZGQgb3B0aW9ucyBmb3IgbXVsdGlwbGllciBzZWxlY3Rpb25cclxuICAgICAgICAkc2NvcGUubXVsdGlwbGllck9wdGlvbnMgPSBbXHJcbiAgICAgICAgICAgIHsgdmFsdWU6IDEsIGxhYmVsOiAnJyB9LFxyXG4gICAgICAgICAgICB7IHZhbHVlOiAxMDAwLCBsYWJlbDogJ1RzZC4nfSxcclxuICAgICAgICAgICAgeyB2YWx1ZTogMTAwMDAwMCwgbGFiZWw6ICdNaW8uJ31cclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb24gPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlVWkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gZ2V0IGN1cnJlbnQgcXVlc3Rpb24gZnJvbSBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgcXVlc3Rpb24gPSBRdWl6U3J2LmdldEN1cnJlbnRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgLy8gZGVsZXRlIHByZXZpb3VzIGhpbnRzXHJcbiAgICAgICAgICAgICRzY29wZS5oaW50ID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGlmIChxdWVzdGlvbiAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgLy8gbXVsdGlwbGllcnMgZm9yIHF1ZXN0aW9ucyBjb250YWluaW5nIG51bWJlcnNcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQgJiYgcXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0LmluZGV4T2YoJ251bWJlcicpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyLmhpZ2gnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIgPSB7IHZhbHVlOiAxMDAwMDAwLCBsYWJlbDogJ01pby4nfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyLm1lZGl1bSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IHsgdmFsdWU6IDEwMDAsIGxhYmVsOiAnVHNkLid9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIgPSB7IHZhbHVlOiAxLCBsYWJlbDogJycgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0Lm11bHRpcGxpZXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBwcm9ncmVzcyBiYXJcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVByb2dyZXNzQmFyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gZm9jdXMgYW5zd2VyIGlucHV0XHJcbiAgICAgICAgICAgICAgICBGb2N1c1NydignLmFuc3dlcklucHV0Jyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBxdWl6IGhhcyBlbmRlZCwgc2V0IHByb2dyZXNzIGJhciB0byAwXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0KDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlbmRlclF1ZXN0aW9uVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyKGdldFF1ZXN0aW9uKCkucXVlc3Rpb24oKSwgJ3F1ZXN0aW9uLWhpZ2hsaWdodCcpICsgJz8nO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbk1lZGlhID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghcXVlc3Rpb24gfHwgIXF1ZXN0aW9uLmdldEluZm8oKS5tZWRpYSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmdldEluZm8oKS5tZWRpYTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc3VibWl0QW5zd2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuYW5zd2VySW5wdXQuYW5zd2VyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5zd2VyID0gJHNjb3BlLmFuc3dlcklucHV0LmFuc3dlcjtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpZiBpdCBpcyBhIG51bWJlciBpbnB1dCwgcmVwbGFjZSAnLCcgd2l0aCAnLidcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQgJiYgcXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0LmluZGV4T2YoJ251bWJlcicpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5zd2VyID0gYW5zd2VyLnJlcGxhY2UoJywnLCAnLicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGlmIGEgbXVsdGlwbGllciBpcyBhdmFpbGFibGUsIGNhbGN1bGF0ZSBhbnN3ZXJcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuc3dlciAqPSAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllci52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbygnc3VibWl0dGluZyBhbnN3ZXInLCBhbnN3ZXIpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0LnBvaW50cyA9IHF1ZXN0aW9uLmFuc3dlcihhbnN3ZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNldCBmb2N1cyB0byBuZXh0IHF1ZXN0aW9uIGJ1dHRvblxyXG4gICAgICAgICAgICAgICAgRm9jdXNTcnYoJyNidG5OZXh0UXVlc3Rpb24nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbkFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghUXVpelNydi5pc1F1aXpSdW5uaW5nKCkgfHwgcXVlc3Rpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmFuc3dlcmVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBRdWl6U3J2Lm5leHRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmFuc3dlcklucHV0LmFuc3dlciA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICB1cGRhdGVVaSgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXF1ZXN0SGludCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuaGludCA9IHF1ZXN0aW9uLmhpbnQoKTtcclxuXHJcbiAgICAgICAgICAgIEZvY3VzU3J2KCcuYW5zd2VySW5wdXQnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVuZGVyID0gZnVuY3Rpb24odGV4dCwgY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIltcIiwgXCI8c3BhbiBjbGFzcz0nXCIgKyBjbGFzc05hbWUgKyBcIic+XCIpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIl1cIiwgXCI8L3NwYW4+XCIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoYW5kbGVLZXlQcmVzcyA9IGZ1bmN0aW9uKGtleUV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChrZXlFdmVudC53aGljaCA9PSAxMykge1xyXG4gICAgICAgICAgICAgICAgc3VibWl0QW5zd2VyKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlUHJvZ3Jlc3NCYXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHByb2dyZXNzUGVyY2VudCA9IGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpIC8gZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCkgKiAxMDA7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0KHByb2dyZXNzUGVyY2VudCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHdhc0xhc3RRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCkgPj0gZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNvbnRpbnVlRmluaXNoZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgbmV4dFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBUT0RPIHdyaXRlIHJlc3VsdCB0byBEQlxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWxseSB1cGRhdGUgVUlcclxuICAgICAgICB1cGRhdGVVaSgpO1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb24gPSBnZXRRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyO1xyXG4gICAgICAgICRzY29wZS5yZW5kZXJRdWVzdGlvblRleHQgPSByZW5kZXJRdWVzdGlvblRleHQ7XHJcbiAgICAgICAgJHNjb3BlLnN1Ym1pdEFuc3dlciA9IHN1Ym1pdEFuc3dlcjtcclxuICAgICAgICAkc2NvcGUucXVlc3Rpb25BbnN3ZXJlZCA9IHF1ZXN0aW9uQW5zd2VyZWQ7XHJcbiAgICAgICAgJHNjb3BlLm5leHRRdWVzdGlvbiA9IG5leHRRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuaGFuZGxlS2V5UHJlc3MgPSBoYW5kbGVLZXlQcmVzcztcclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb25NZWRpYSA9IGdldFF1ZXN0aW9uTWVkaWE7XHJcbiAgICAgICAgJHNjb3BlLnJlcXVlc3RIaW50ID0gcmVxdWVzdEhpbnQ7XHJcbiAgICAgICAgJHNjb3BlLndhc0xhc3RRdWVzdGlvbiA9IHdhc0xhc3RRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuY29udGludWVGaW5pc2hlZCA9IGNvbnRpbnVlRmluaXNoZWQ7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUXVpekN0cmwnLCBbXCIkc2NvcGVcIiwgXCJRdWl6U3J2XCIsIFwiTG9nU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2KSB7XHJcblxyXG4gICAgICAgIHZhciBzdGFydFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKFwiUXVpeiBzdGFydGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpelN0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuaGFzUXVpelN0YXJ0ZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpekVuZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2Lmhhc1F1aXpFbmRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXRUb3RhbFBvaW50cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLnN0YXJ0UXVpeiA9IHN0YXJ0UXVpejtcclxuICAgICAgICAkc2NvcGUuaXNRdWl6UnVubmluZyA9IGlzUXVpelJ1bm5pbmc7XHJcbiAgICAgICAgJHNjb3BlLmhhc1F1aXpTdGFydGVkID0gaGFzUXVpelN0YXJ0ZWQ7XHJcbiAgICAgICAgJHNjb3BlLmhhc1F1aXpFbmRlZCA9IGhhc1F1aXpFbmRlZDtcclxuICAgICAgICAkc2NvcGUuZ2V0VG90YWxQb2ludHMgPSBnZXRUb3RhbFBvaW50cztcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdSZWdpc3RlckN0cmwnLCBbXCIkc2NvcGVcIiwgXCJMb2dTcnZcIiwgXCJGb2N1c1NydlwiLCBcIlVzZXJTcnZcIiwgXCIkc3RhdGVcIiwgXCIkd2luZG93XCIsIGZ1bmN0aW9uKCRzY29wZSwgTG9nU3J2LCBGb2N1c1NydiwgVXNlclNydiwgJHN0YXRlLCAkd2luZG93KSB7XHJcbiAgICAgICAgLy8gbmV3IHVzZXIgb2JqZWN0XHJcbiAgICAgICAgJHNjb3BlLm5ld1VzZXIgPSB7fTtcclxuXHJcbiAgICAgICAgLy8gbWVzc2FnZSBvYmplY3RcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciByZWdpc3RlciA9IGZ1bmN0aW9uIChpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNWYWxpZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodmFsaWRhdGVCZWZvcmVTdWJtaXQoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gcGVyZm9ybSBhcGkgY2FsbFxyXG4gICAgICAgICAgICAgICAgVXNlclNydi5yZWdpc3Rlcigkc2NvcGUubmV3VXNlcilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHAgY29udHJvbGxlciBhYm91dCBsb2dpblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdCB0byBob21lIHBhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdyZWdpc3Rlci5zdWNjZXNzZnVsJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdCZWkgZGVyIEFubWVsZHVuZyBzY2hlaW50IGV0d2FzIHNjaGllZiBnZWdhbmdlbiB6dSBzZWluJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChlcnIubWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnVXNlcm5hbWUgYWxyZWFkeSBleGlzdHMnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RlciBCZW51dHplcm5hbWUgZXhpc3RpZXJ0IGJlcmVpdHMnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnQmVpIGRlciBBbm1lbGR1bmcgc2NoZWludCBldHdhcyBzY2hpZWYgZ2VnYW5nZW4genUgc2Vpbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLiQkcGhhc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHZhbGlkYXRlQmVmb3JlU3VibWl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSB0d28gcGFzc3dvcmRzIG1hdGNoXHJcbiAgICAgICAgICAgIHZhciBwYXNzd29yZCA9ICRzY29wZS5uZXdVc2VyLnBhc3N3b3JkO1xyXG4gICAgICAgICAgICB2YXIgcGFzc3dvcmQyID0gJHNjb3BlLm5ld1VzZXIucGFzc3dvcmQyO1xyXG5cclxuICAgICAgICAgICAgaWYgKCEkc2NvcGUubmV3VXNlci51c2VybmFtZSB8fCAhJHNjb3BlLm5ld1VzZXIuZW1haWwgfHwgIXBhc3N3b3JkIHx8ICFwYXNzd29yZDIpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0FsbGUgRmVsZGVyIG3DvHNzZW4gYXVzZ2Vmw7xsbHQgc2VpbidcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFzc3dvcmQgPT09IFwiXCIgfHwgcGFzc3dvcmQyID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEaWUgUGFzc3fDtnJ0ZXIga8O2bm5lbiBuaWNodCBsZWVyIHNlaW4nXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhc3N3b3JkICE9PSBwYXNzd29yZDIpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0RpZSBQYXNzd8O2cnRlciBzdGltbWVuIG5pY2h0IMO8YmVyZWluJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuICEkc2NvcGUubWVzc2FnZSA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGVsZWdhdGVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmVnaXN0ZXIodHJ1ZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmRlbGVnYXRlU3VibWl0ID0gZGVsZWdhdGVTdWJtaXQ7XHJcblxyXG4gICAgICAgICRzY29wZS5yZWdpc3RlciA9IHJlZ2lzdGVyO1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VyIG5hbWUgZmllbGRcclxuICAgICAgICBGb2N1c1NydignI3VzZXJuYW1lJyk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignU2V0dGluZ3NDdHJsJywgW1wiJHNjb3BlXCIsIFwiQXBwQ29uZmlnXCIsIFwiRm9jdXNTcnZcIiwgXCJMb2dTcnZcIiwgXCJVc2VyU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgQXBwQ29uZmlnLCBGb2N1c1NydiwgTG9nU3J2LCBVc2VyU3J2KSB7XHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gdXNlciBjb2xvdXJzXHJcbiAgICAgICAgICAgIHZhciBjb2xvcnMgPSBBcHBDb25maWdbJ3NldHRpbmdzLnVzZXIuY29sb3JzJ107XHJcblxyXG4gICAgICAgICAgICAvLyB1c2VyIG9iamVjdFxyXG4gICAgICAgICAgICAkc2NvcGUudXNlck9iaiA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAkc2NvcGUudXNlci51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIGVtYWlsOiAkc2NvcGUudXNlci5lbWFpbCxcclxuICAgICAgICAgICAgICAgIGNvbG9yOiAkc2NvcGUudXNlci5jb2xvclxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJDb2xvcnMgPSBjb2xvcnM7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2V0Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJPYmouY29sb3IgPSBuZXdDb2xvcjtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciB1cGRhdGVVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBVc2VyU3J2LnVwZGF0ZUJhc2ljKCRzY29wZS51c2VyT2JqKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgdXNlciBvYmplY3RcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXNlci51c2VybmFtZSA9ICRzY29wZS51c2VyT2JqLnVzZXJuYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmVtYWlsID0gJHNjb3BlLnVzZXJPYmouZW1haWw7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuY29sb3IgPSAkc2NvcGUudXNlck9iai5jb2xvcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRWluc3RlbGx1bmdlbiB3dXJkZW4gZXJmb2xncmVpY2ggZ2VzcGVpY2hlcnQnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoJ1VwZGF0ZSB1c2VyJywgZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGVyci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1VzZXJuYW1lIGFscmVhZHkgZXhpc3RzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RlciBCZW51dHplcm5hbWUgaXN0IGJlcmVpdHMgdmVyZ2ViZW4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnRGllIEVpbnN0ZWxsdW5nZW4ga29ubnRlbiBuaWNodCBnZXNwZWljaGVydCB3ZXJkZW4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgZGVsZWdhdGVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVVzZXIodHJ1ZSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2V0Q29sb3IgPSBzZXRDb2xvcjtcclxuICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZVVzZXIgPSB1cGRhdGVVc2VyO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGVsZWdhdGVTdWJtaXQgPSBkZWxlZ2F0ZVN1Ym1pdDtcclxuXHJcbiAgICAgICAgICAgIC8vIGZvY3VzIHVzZXJuYW1lIGZpZWxkXHJcbiAgICAgICAgICAgIEZvY3VzU3J2KCcjdXNlcm5hbWUnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoJHNjb3BlLnVzZXIpIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gb3RoZXJ3aXNlLCB3YWl0IGZvciB1c2VyLmxvYWRlZCBldmVudFxyXG4gICAgICAgICRzY29wZS4kb24oJ3VzZXIubG9hZGVkJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmRpcmVjdGl2ZSgncXVpeicsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYnVpbGQvdmlld3MvdGVtcGxhdGVzL3F1aXotZGlyZWN0aXZlLnRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICBzY29wZTogdHJ1ZSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1F1aXpEaXJlY3RpdmVDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KVxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZpbHRlcigncmVuZGVySHRtbCcsIFtcIiRzY2VcIiwgZnVuY3Rpb24oJHNjZSkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0ZXh0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKHRleHQpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgW1wiQXV0aFRva2VuU3J2XCIsIGZ1bmN0aW9uKEF1dGhUb2tlblNydikge1xyXG4gICAgICAgIHZhciBhZGRUb2tlbiA9IGZ1bmN0aW9uKGNvbmZpZykge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydYLUF1dGgnXSA9IHRva2VuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGFkZFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdBdXRoVG9rZW5TcnYnLCBbXCIkd2luZG93XCIsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcclxuICAgICAgICB2YXIgc3RvcmUgPSAkd2luZG93LnNlc3Npb25TdG9yYWdlO1xyXG4gICAgICAgIHZhciBrZXkgPSAnYXV0aC10b2tlbic7XHJcblxyXG4gICAgICAgIHZhciBnZXRUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0SXRlbShrZXkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZXRUb2tlbiA9IGZ1bmN0aW9uKHRva2VuKSB7XHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUuc2V0SXRlbShrZXksIHRva2VuKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFRva2VuOiBnZXRUb2tlbixcclxuICAgICAgICAgICAgc2V0VG9rZW46IHNldFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdDb3VudHJ5U3J2JywgW1wiJGh0dHBcIiwgXCJJbmRleGVkREJTcnZcIiwgXCJMb2dTcnZcIiwgZnVuY3Rpb24oJGh0dHAsIEluZGV4ZWREQlNydiwgTG9nU3J2KSB7XHJcbiAgICAgICAgLy8gQ291bnRyaWVzIGFycmF5XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUFscGhhMyA9IG51bGw7XHJcbiAgICAgICAgdmFyIGNvdW50cmllc0J5TGV0dGVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gSW5kZXhlZERCXHJcbiAgICAgICAgdmFyIGRhdGFiYXNlID0gJ21hZ2VsbGFuJztcclxuICAgICAgICB2YXIgc3RvcmUgPSAnY291bnRyeVN0b3JlJztcclxuICAgICAgICB2YXIga2V5Q291bnRyaWVzID0gJ2NvdW50cmllcyc7XHJcbiAgICAgICAgdmFyIGtleVZlcnNpb24gPSAndmVyc2lvbic7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREJBdmFpbGFibGUgPSBJbmRleGVkREJTcnYuaW5kZXhlZERCQXZhaWxhYmxlKCk7XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2FkQ291bnRyaWVzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvYWRDb3VudHJpZXMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgaW5kZXhlZERCIGlzIGF2YWlsYWJsZVxyXG4gICAgICAgICAgICBpZiAoaW5kZXhlZERCQXZhaWxhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGRhdGFiYXNlIGV4aXN0c1xyXG4gICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5jcmVhdGVEYXRhYmFzZShkYXRhYmFzZSwgc3RvcmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEVtcHR5T2JqZWN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRJbnRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEV4dGVybmFsVmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihsb2FkRGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXMgPSBvYmpbJ2NvdW50cmllcyddO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKFwibG9hZGVkIGNvdW50cmllcyBmcm9tXCIsIG9ialsnbG9hZFN0cmF0ZWd5J10udG9VcHBlckNhc2UoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkaXRpb25hbGx5IG1hcCBjb3VudHJpZXMgYnkgdmFyaW91cyBwcm9wZXJ0aWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUFscGhhMyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXIgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXMuZm9yRWFjaChmdW5jdGlvbihjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnkgYWxwaGEzIGNvZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUFscGhhM1tjWydhbHBoYTNDb2RlJ11dID0gYztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnkgbGV0dGVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpcnN0TGV0dGVyID0gY1snbmFtZSddLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGZpcnN0TGV0dGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ8OEJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TGV0dGVyID0gJ0EnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICfDlic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdExldHRlciA9ICdPJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnw5wnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RMZXR0ZXIgPSAnVSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnRyaWVzQnlMZXR0ZXJbZmlyc3RMZXR0ZXJdID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXJbZmlyc3RMZXR0ZXJdID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUxldHRlcltmaXJzdExldHRlcl0ucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhM0NvZGU6IGMuYWxwaGEzQ29kZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogYy5uYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihcImZhaWxlZCB0byBsb2FkIGNvdW50cmllc1wiLCBlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgbm90LCB3ZSBhbHdheXMgdHJ5IHRvIGRvd25sb2FkIGl0IGZyb20gdGhlIGNvdW50cnkgQVBJIGVuZHBvaW50XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q291bnRyaWVzRnJvbUFQSSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRldGVybWluZUxvYWRTdHJhdGVneSA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyYXRlZ3k7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGludGVybmFsVmVyc2lvbiA9IG9ialtcImludGVybmFsVmVyc2lvblwiXTtcclxuICAgICAgICAgICAgICAgIHZhciBleHRlcm5hbFZlcnNpb24gPSBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGludGVybmFsVmVyc2lvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2FwaSc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV4dGVybmFsVmVyc2lvbiA+IGludGVybmFsVmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2FwaSc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2RiJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBvYmpbJ2xvYWRTdHJhdGVneSddID0gc3RyYXRlZ3k7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9hZERhdGEgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0cmF0ZWd5ID0gb2JqWydsb2FkU3RyYXRlZ3knXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXBpJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q291bnRyaWVzRnJvbUFQSSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJjb3VudHJpZXNcIl0gPSBjb3VudHJpZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0b3JlIGNvdW50cmllcyBhbmQgdmVyc2lvbiBudW1iZXIgaW4gZGF0YWJhc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucHV0SXRlbShkYXRhYmFzZSwgc3RvcmUsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToga2V5Q291bnRyaWVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogIGNvdW50cmllc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucHV0SXRlbShkYXRhYmFzZSwgc3RvcmUsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToga2V5VmVyc2lvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9ialtcImV4dGVybmFsVmVyc2lvblwiXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGInOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDb3VudHJpZXNGcm9tREIob2JqKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oX29iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoX29iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdVbmtub3duIGxvYWQgc3RyYXRlZ3knKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEVtcHR5T2JqZWN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoe30pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0SW50ZXJuYWxWZXJzaW9uID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5yZXRyaWV2ZUl0ZW0oZGF0YWJhc2UsIHN0b3JlLCBrZXlWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdID0gaXRlbS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEV4dGVybmFsVmVyc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0VmVyc2lvbkZyb21BUEkoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialtcImV4dGVybmFsVmVyc2lvblwiXSA9IHZlcnNpb247XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzRnJvbURCID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5yZXRyaWV2ZUl0ZW0oZGF0YWJhc2UsIHN0b3JlLCBrZXlDb3VudHJpZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJjb3VudHJpZXNcIl0gPSBpdGVtLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNGcm9tQVBJID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9jb3VudHJpZXMnKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VmVyc2lvbkZyb21BUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdW50cmllcy92ZXJzaW9uJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEudmVyc2lvbiB8fCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cnlCeUFscGhhMyA9IGZ1bmN0aW9uKGFscGhhMykge1xyXG4gICAgICAgICAgICBpZiAoY291bnRyaWVzQnlBbHBoYTMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzQnlBbHBoYTNbYWxwaGEzXTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzQnlMZXR0ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKGNvdW50cmllc0J5TGV0dGVyID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllc0J5TGV0dGVyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBhcmVDb3VudHJpZXNMb2FkZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllcyAhPT0gbnVsbCAmJiBjb3VudHJpZXMubGVuZ3RoID4gMDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBnZXRDb3VudHJ5QnlBbHBoYTM6IGdldENvdW50cnlCeUFscGhhMyxcclxuICAgICAgICAgICAgZ2V0Q291bnRyaWVzQnlMZXR0ZXI6IGdldENvdW50cmllc0J5TGV0dGVyLFxyXG4gICAgICAgICAgICBhcmVDb3VudHJpZXNMb2FkZWQ6IGFyZUNvdW50cmllc0xvYWRlZFxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnRm9jdXNTcnYnLCBbXCIkdGltZW91dFwiLCBcIiR3aW5kb3dcIiwgZnVuY3Rpb24oJHRpbWVvdXQsICR3aW5kb3cpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2VsZWN0b3IpIHtcclxuICAgICAgICAgICAgLy8gdGltZW91dCBtYWtlcyBzdXJlIHRoYXQgaXMgaW52b2tlZCBhZnRlciBhbnkgb3RoZXIgZXZlbnQgaGFzIGJlZW4gdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAvLyBlLmcuIGNsaWNrIGV2ZW50cyB0aGF0IG5lZWQgdG8gcnVuIGJlZm9yZSB0aGUgZm9jdXMgb3JcclxuICAgICAgICAgICAgLy8gaW5wdXRzIGVsZW1lbnRzIHRoYXQgYXJlIGluIGEgZGlzYWJsZWQgc3RhdGUgYnV0IGFyZSBlbmFibGVkIHdoZW4gdGhvc2UgZXZlbnRzXHJcbiAgICAgICAgICAgIC8vIGFyZSB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkd2luZG93LmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0luZGV4ZWREQlNydicsIFtcIiR3aW5kb3dcIiwgZnVuY3Rpb24oJHdpbmRvdykge1xyXG4gICAgICAgIHZhciBrZXlQYXRoID0gJ25hbWUnO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCID0gJHdpbmRvdy5pbmRleGVkREIgfHwgJHdpbmRvdy53ZWJraXRJbmRleGVkREIgfHwgJHdpbmRvdy5tc0luZGV4ZWREQjtcclxuICAgICAgICB2YXIgSURCS2V5UmFuZ2UgPSAkd2luZG93LklEQktleVJhbmdlIHx8ICR3aW5kb3cud2Via2l0SURCS2V5UmFuZ2U7XHJcblxyXG4gICAgICAgIHZhciBJREJUcmFuc2FjdGlvbiA9ICR3aW5kb3cuSURCVHJhbnNhY3Rpb24gfHwgJHdpbmRvdy53ZWJraXRJREJUcmFuc2FjdGlvbjtcclxuXHJcbiAgICAgICAgaWYgKElEQlRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgPSBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFIHx8ICdyZWFkd3JpdGUnO1xyXG4gICAgICAgICAgICBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkgPSBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkgfHwgJ3JlYWRvbmx5JztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREJBdmFpbGFibGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGluZGV4ZWREQiA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlRGF0YWJhc2UgPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZSBpcyBhbiBpbnN0YW5jZSBvZiBJREJWZXJzaW9uQ2hhbmdlRXZlbnRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSBpZGIuY3JlYXRlT2JqZWN0U3RvcmUoc3RvcmVOYW1lLCB7IGtleVBhdGg6IGtleVBhdGggfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCwgdXBkYXRlLCBkZWxldGVcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIGVycm9yXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRyb3BEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3Agc3VjY2Vzc2Z1bFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkcm9wIGZhaWxlZFxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBhZGRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5hZGQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcHV0SXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0QWRkID0gc3RvcmUucHV0KGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJldHJpZXZlSXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBJREJLZXlSYW5nZS5vbmx5KGl0ZW1OYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUub3BlbkN1cnNvcihyYW5nZSkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGN1cnNvci52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtcyA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUub3BlbkN1cnNvcigpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY3JlYXRlRGF0YWJhc2U6IGNyZWF0ZURhdGFiYXNlLFxyXG4gICAgICAgICAgICBkcm9wRGF0YWJhc2U6IGRyb3BEYXRhYmFzZSxcclxuICAgICAgICAgICAgYWRkSXRlbTogYWRkSXRlbSxcclxuICAgICAgICAgICAgcHV0SXRlbTogcHV0SXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtOiByZXRyaWV2ZUl0ZW0sXHJcbiAgICAgICAgICAgIHJldHJpZXZlSXRlbXM6IHJldHJpZXZlSXRlbXMsXHJcbiAgICAgICAgICAgIGluZGV4ZWREQkF2YWlsYWJsZTogaW5kZXhlZERCQXZhaWxhYmxlXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdMb2dTcnYnLCBbXCJBcHBDb25maWdcIiwgZnVuY3Rpb24oQXBwQ29uZmlnKSB7XHJcbiAgICAgICAgdmFyIGxvZ0luZm8gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKEFwcENvbmZpZ1tcImxvZy5pbmZvXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ0Vycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuZXJyb3JcIl0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluZm86IGxvZ0luZm8sXHJcbiAgICAgICAgICAgIGVycm9yOiBsb2dFcnJvclxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnUXVpelNydicsIFtcIkFwcENvbmZpZ1wiLCBcIkNvdW50cnlTcnZcIiwgXCJMb2dTcnZcIiwgZnVuY3Rpb24oQXBwQ29uZmlnLCBDb3VudHJ5U3J2LCBMb2dTcnYpIHtcclxuICAgICAgICB2YXIgY291bnRyaWVzID0gbnVsbDtcclxuICAgICAgICB2YXIgY291bnRyaWVzQnlBbHBoYTMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgcXVpeiA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBzZXRDb3VudHJpZXMgPSBmdW5jdGlvbihfY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgIGNvdW50cmllcyA9IF9jb3VudHJpZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNvdW50cmllc0xvYWRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzICE9PSBudWxsICYmIGNvdW50cmllcy5sZW5ndGggPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY291bnRyaWVzTG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiQ291bnRyaWVzIGhhdmUgbm90IGJlZW4gbG9hZGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHF1aXogPSBjcmVhdGVRdWl6KCdjb3VudHJ5Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShxdWl6LnN0YXJ0KCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaXNRdWl6UnVubmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVpeiA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6Lmhhc1N0YXJ0ZWQoKSAmJiAhcXVpei5oYXNFbmRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoYXNRdWl6U3RhcnRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVpeiA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6Lmhhc1N0YXJ0ZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpekVuZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouaGFzRW5kZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlUXVpeiA9IGZ1bmN0aW9uKHF1aXpUeXBlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAocXVpelR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NvdW50cnknOlxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlQ291bnRyeVF1aXooKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVDb3VudHJ5UXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgY291bnRyeVF1aXogPSBuZXcgUXVpeigpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGZ1bGxQb2ludHMgPSAxMDA7XHJcbiAgICAgICAgICAgIHZhciBoaW50TWF4aW11bSA9IDM7XHJcbiAgICAgICAgICAgIHZhciBoaW50Q29zdCA9IDI1O1xyXG5cclxuICAgICAgICAgICAgdmFyIGxhc3RRdWVzdGlvbkJvbnVzID0gMi41O1xyXG5cclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZXMgPSBBcHBDb25maWdbJ3F1aXouY291bnRyeS50eXBlcyddO1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25UeXBlc0xlbmd0aCA9IE9iamVjdC5rZXlzKHF1ZXN0aW9uVHlwZXMpLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIC8vIHNlbGVjdCBjb3VudHJpZXMgZm9yIHF1ZXN0aW9uc1xyXG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRDb3VudHJpZXMgPSBbXTtcclxuICAgICAgICAgICAgdmFyIG51bWJlck9mUXVlc3Rpb25zID0gQXBwQ29uZmlnWydxdWl6LmNvdW50cnkucXVlc3Rpb25zJ107XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bWJlck9mUXVlc3Rpb25zOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb3VudHJ5T2sgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoIWNvdW50cnlPaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb3VudHJ5ID0gY291bnRyaWVzW2dldFJhbmRvbUludCgwLCBjb3VudHJpZXMubGVuZ3RoIC0gMSldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb3VudHJ5T2sgPSBzZWxlY3RlZENvdW50cmllcy5pbmRleE9mKGNvdW50cnlbJ2FscGhhM0NvZGUnXSkgPCAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENvdW50cmllcy5wdXNoKGNvdW50cnlbJ2FscGhhM0NvZGUnXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBxdWVzdGlvbnMgZm9yIHF1aXpcclxuICAgICAgICAgICAgdmFyIHFjbnQgPSAwO1xyXG4gICAgICAgICAgICBzZWxlY3RlZENvdW50cmllcy5mb3JFYWNoKGZ1bmN0aW9uKGFscGhhMykge1xyXG4gICAgICAgICAgICAgICAgcWNudCsrO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjb3VudHJ5ID0gQ291bnRyeVNydi5nZXRDb3VudHJ5QnlBbHBoYTMoYWxwaGEzKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcXVlc3Rpb25UeXBlID0gcXVlc3Rpb25UeXBlc1tnZXRSYW5kb21JbnQoMSwgcXVlc3Rpb25UeXBlc0xlbmd0aCldO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gZ2V0UXVlc3Rpb25UZXh0KHF1ZXN0aW9uVHlwZSwgY291bnRyeSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBxdWVzdGlvblR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IGdldFF1ZXN0aW9uSW5wdXQocXVlc3Rpb25UeXBlKSxcclxuICAgICAgICAgICAgICAgICAgICB1bml0OiBnZXRRdWVzdGlvblVuaXQocXVlc3Rpb25UeXBlKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHZhciBhbnN3ZXIgPSBnZXRRdWVzdGlvbkFuc3dlcihxdWVzdGlvblR5cGUsIGNvdW50cnkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoZWNrQW5zd2VyID0gZ2V0Q2hlY2tBbnN3ZXJMYW1iZGEocXVlc3Rpb25UeXBlLCBmdWxsUG9pbnRzLCBsYXN0UXVlc3Rpb25Cb251cyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGludHMgPSBnZXRRdWVzdGlvbkhpbnRzKHF1ZXN0aW9uVHlwZSwgaGludE1heGltdW0sIGhpbnRDb3N0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyB0aGUgbGFzdCBxdWVzdGlvbiBpcyB0aGUgYm9udXMgcXVlc3Rpb25cclxuICAgICAgICAgICAgICAgIGlmIChxY250ID49IG51bWJlck9mUXVlc3Rpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mb1snYm9udXMnXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gYWRkIGluZm8gZm9yIGZsYWcgb2YgY291bnRyeVxyXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ0ZMQUdfT0ZfQ09VTlRSWScpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmZvLm1lZGlhID0gJ2ZsYWcnO1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm8uYWxwaGEyQ29kZSA9IGNvdW50cnkuYWxwaGEyQ29kZS50b0xvY2FsZUxvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvdW50cnlRdWl6LmFkZFF1ZXN0aW9uKG5ldyBRdWVzdGlvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dCxcclxuICAgICAgICAgICAgICAgICAgICBpbmZvOiBpbmZvLFxyXG4gICAgICAgICAgICAgICAgICAgIGFuc3dlcjogYW5zd2VyLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrQW5zd2VyOiBjaGVja0Fuc3dlcixcclxuICAgICAgICAgICAgICAgICAgICBoaW50czogaGludHNcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyeVF1aXo7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uVGV4dCA9IGZ1bmN0aW9uKHR5cGUsIGNvdW50cnkpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldpZSBoZWnDn3QgZGllIEhhdXB0c3RhZHQgdm9uIFtcIiArIGNvdW50cnkubmFtZSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiW1wiICsgY291bnRyeS5jYXBpdGFsICsgXCJdIGlzdCBkaWUgSGF1cHRzdGFkdCB2b24gd2VsY2hlbSBMYW5kXCJcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldpZSB2aWVsZSBNZW5zY2hlbiBsZWJlbiBpbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldpZSBncm/DnyBpc3QgZGllIEZsw6RjaGUgdm9uIFtcIiArIGNvdW50cnkubmFtZSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2VsY2hlcyBMYW5kIGhhdCBkaWVzZSBGbGFnZ2VcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uQW5zd2VyID0gZnVuY3Rpb24odHlwZSwgY291bnRyeSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFsdFNwZWxsaW5ncyA9IGNvdW50cnkuYWx0U3BlbGxpbmdzICE9PSB1bmRlZmluZWQgJiYgY291bnRyeS5hbHRTcGVsbGluZ3NbJ2NhcGl0YWwnXSAhPT0gdW5kZWZpbmVkID8gY291bnRyeS5hbHRTcGVsbGluZ3NbJ2NhcGl0YWwnXSA6IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5LmNhcGl0YWwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsdFNwZWxsaW5nczogYWx0U3BlbGxpbmdzXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWx0U3BlbGxpbmdzID0gY291bnRyeS5hbHRTcGVsbGluZ3MgIT09IHVuZGVmaW5lZCAmJiBjb3VudHJ5LmFsdFNwZWxsaW5nc1snbmFtZSddICE9PSB1bmRlZmluZWQgPyBjb3VudHJ5LmFsdFNwZWxsaW5nc1snbmFtZSddIDogW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWx0U3BlbGxpbmdzOiBhbHRTcGVsbGluZ3NcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5wb3B1bGF0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkuYXJlYVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI/XCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbklucHV0ID0gZnVuY3Rpb24odHlwZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdudW1iZXIuaGlnaCc7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ251bWJlci5tZWRpdW0nO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd0ZXh0LnN0YW5kYXJkJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblVuaXQgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2ttwrInO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdFaW53b2huZXInO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q2hlY2tBbnN3ZXJMYW1iZGEgPSBmdW5jdGlvbih0eXBlLCBmdWxsUG9pbnRzLCBsYXN0UXVlc3Rpb25Cb251cykge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYW5zd2VyLCBzdWJtaXR0ZWRBbnN3ZXIsIGhpbnRzVXNlZCwgaGludENvc3QsIGluZm8pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvcnJlY3QgPSBzdWJtaXR0ZWRBbnN3ZXIgPT09IGFuc3dlci5jb3JyZWN0IHx8IChhbnN3ZXIuYWx0U3BlbGxpbmdzICYmIGFuc3dlci5hbHRTcGVsbGluZ3MuaW5kZXhPZihzdWJtaXR0ZWRBbnN3ZXIpID49IDApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50cyA9IGNvcnJlY3QgPyBmdWxsUG9pbnRzIDogMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGhpbnRzIGFyZSBhbGxvd2VkIGFuZCBoYXZlIGJlZW4gdXNlZCwgc3VidHJhY3QgdGhlIHBvaW50c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGludHNVc2VkID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzIC09IChoaW50c1VzZWQgKiBoaW50Q29zdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJvbnVzIHBvaW50cyBmb3IgbGFzdCBxdWVzdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgKj0gbGFzdFF1ZXN0aW9uQm9udXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYW5zd2VyLCBzdWJtaXR0ZWRBbnN3ZXIsIGhpbnRzVXNlZCwgaGludENvc3QsIGluZm8pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FsY3VsYXRlIHBlcmNlbnRhZ2UgZGlmZmVyZW5jZSBmcm9tIGNvcnJlY3QgYW5zd2VyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclBlcmNlbnRhZ2UgPSBNYXRoLmFicyhzdWJtaXR0ZWRBbnN3ZXIgLSBhbnN3ZXIuY29ycmVjdCkgLyBhbnN3ZXIuY29ycmVjdCAqIDEwMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gNikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gOTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDgwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDE0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA2MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDUwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxOCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDIwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAzMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMjUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDIwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAzMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBoaW50cyBhcmUgYWxsb3dlZCBhbmQgaGF2ZSBiZWVuIHVzZWQsIHN1YnRyYWN0IHRoZSBwb2ludHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpbnRzVXNlZCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAtPSAoaGludHNVc2VkICogaGludENvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBib251cyBwb2ludHMgZm9yIGxhc3QgcXVlc3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8gIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzICo9IGxhc3RRdWVzdGlvbkJvbnVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI/XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25IaW50cyA9IGZ1bmN0aW9uKHR5cGUsIGhpbnRzUG9zc2libGUsIGhpbnRDb3N0KSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heGltdW06IGhpbnRzUG9zc2libGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvc3Q6IGhpbnRDb3N0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnaXZlOiBmdW5jdGlvbihoaW50c1VzZWQsIGFuc3dlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFuc3dlci5jb3JyZWN0LnN1YnN0cigwLCBoaW50c1VzZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI/XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5nZXROdW1iZXJPZlF1ZXN0aW9ucygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1F1aXpSdW5uaW5nKCkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmN1cnJlbnRRdWVzdGlvbigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBuZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1F1aXpSdW5uaW5nKCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcXVpei5uZXh0UXVlc3Rpb24oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG90YWxQb2ludHMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5nZXRUb3RhbFBvaW50cygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXQsXHJcbiAgICAgICAgICAgIHNldENvdW50cmllczogc2V0Q291bnRyaWVzLFxyXG4gICAgICAgICAgICBpc1F1aXpSdW5uaW5nOiBpc1F1aXpSdW5uaW5nLFxyXG4gICAgICAgICAgICBoYXNRdWl6U3RhcnRlZDogaGFzUXVpelN0YXJ0ZWQsXHJcbiAgICAgICAgICAgIGhhc1F1aXpFbmRlZDogaGFzUXVpekVuZGVkLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI6IGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcixcclxuICAgICAgICAgICAgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zOiBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMsXHJcbiAgICAgICAgICAgIGdldEN1cnJlbnRRdWVzdGlvbjogZ2V0Q3VycmVudFF1ZXN0aW9uLFxyXG4gICAgICAgICAgICBuZXh0UXVlc3Rpb246IG5leHRRdWVzdGlvbixcclxuICAgICAgICAgICAgZ2V0VG90YWxQb2ludHM6IGdldFRvdGFsUG9pbnRzXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdTY29yZVNydicsIFtcIiRodHRwXCIsIGZ1bmN0aW9uKCRodHRwKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgZW50aXJlIGhpZ2hzY29yZSBsaXN0IGluIGFuIGFycmF5IGZyb20gdGhlIEFQSS5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgZ2V0SGlnaHNjb3JlTGlzdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvc2NvcmVzL2FsbCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgaGlnaHNjb3JlIG9iamVjdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIElmIHRoZSB1c2VyIGhhcyBubyByZXN1bHQgeWV0LCBhbiBlbXB0eSBvYmplY3QgaXMgcmV0dXJuZWQuXHJcbiAgICAgICAgICogUmV0dXJucyBhIHByb21pc2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGdldFVzZXJIaWdoc2NvcmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3Njb3Jlcy91c2VyJylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHNjb3JlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEZldGNoZXMgdGhlIGhpZ2hzY29yZSBvYmplY3QgZm9yIHRoZSBvdmVyYWxsIGhpZ2hzY29yZS5cclxuICAgICAgICAgKiBJZiB0aGVyZSBpcyBjdXJyZW50bHkgbm8gcmVzdWx0IHlldCwgYW4gZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkLlxyXG4gICAgICAgICAqIFJldHVybnMgYSBwcm9taXNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBnZXRPdmVyYWxsSGlnaHNjb3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9zY29yZXMvaGlnaCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oc2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzY29yZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBQdXRzIGEgaGlnaHNjb3JlIHJlc3VsdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIEBwYXJhbSBzY29yZSAgICAgTnVtYmVyIHdpdGggdGhlIGFjaGlldmVkIHNjb3JlLlxyXG4gICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBwdXRIaWdoc2NvcmUgPSBmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvc2NvcmVzJylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRIaWdoc2NvcmVMaXN0OiBnZXRIaWdoc2NvcmVMaXN0LFxyXG4gICAgICAgICAgICBnZXRVc2VySGlnaHNjb3JlOiBnZXRVc2VySGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBnZXRPdmVyYWxsSGlnaHNjb3JlOiBnZXRPdmVyYWxsSGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBwdXRIaWdoc2NvcmU6IHB1dEhpZ2hzY29yZVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnVXNlclNydicsIFtcIiRodHRwXCIsIFwiQXV0aFRva2VuU3J2XCIsIFwiQXBwQ29uZmlnXCIsIGZ1bmN0aW9uKCRodHRwLCBBdXRoVG9rZW5TcnYsIEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VyJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXJGcm9tU3RvcmFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4odG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdG9rZW4sIHdlIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIHRva2VuIGluIHN0b3JhZ2VcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9uJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9rZW4gPSByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNhdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKHNlbGYudG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRVc2VyKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRva2VuIGxvY2FsbHlcclxuICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24obmV3VXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzZWxlY3QgYSByYW5kb20gY29sb3IgZm9yIHRoZSB1c2VyXHJcbiAgICAgICAgICAgICAgICB2YXIgY29sb3JzID0gQXBwQ29uZmlnWydzZXR0aW5ncy51c2VyLmNvbG9ycyddO1xyXG4gICAgICAgICAgICAgICAgbmV3VXNlci5jb2xvciA9IGNvbG9yc1tnZXRSYW5kb21JbnQoMCwgY29sb3JzLmxlbmd0aCAtIDEpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3VzZXInLCBuZXdVc2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW1tZWRpYXRlbHkgbG9nIHRoZSB1c2VyIGluXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luKG5ld1VzZXIudXNlcm5hbWUsIG5ld1VzZXIucGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pICA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZUJhc2ljID0gZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvdXNlci9iYXNpYycsIHVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRVc2VyOiBnZXRVc2VyLFxyXG4gICAgICAgICAgICBnZXRVc2VyRnJvbVN0b3JhZ2U6IGdldFVzZXJGcm9tU3RvcmFnZSxcclxuICAgICAgICAgICAgbG9naW46IGxvZ2luLFxyXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dCxcclxuICAgICAgICAgICAgcmVnaXN0ZXI6IHJlZ2lzdGVyLFxyXG4gICAgICAgICAgICB1cGRhdGVCYXNpYzogdXBkYXRlQmFzaWNcclxuICAgICAgICB9O1xyXG4gICAgfV0pOyIsIi8vIG93biBjbGFzc2VzIGFuZCBmdW5jdGlvbnNcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVJWiAtLS0tLS0tLS0tXHJcbnZhciBRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBpbmRleCBvZiBjdXJyZW50IHF1ZXN0aW9uXHJcbiAgICB2YXIgY3VycmVudFF1ZXN0aW9uSWR4ID0gbnVsbDtcclxuXHJcbiAgICAvLyBhcnJheSBjb250YWluaW5nIGFsbCBxdWVzdGlvbnNcclxuICAgIHZhciBxdWVzdGlvbnMgPSBbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN0YXJ0cyB0aGUgcXVpei5cclxuICAgICAqL1xyXG4gICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIGNoZWNrIGlmIHF1aXogaGFzIHF1ZXN0aW9uc1xyXG4gICAgICAgIGlmIChxdWVzdGlvbnMubGVuZ3RoIDw9IDApXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHN0YXJ0IGEgcXVpeiB3aXRob3V0IHF1ZXN0aW9uc1wiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaXNBY3RpdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNTdGFydGVkKCkgJiYgIXRoaXMuaGFzRW5kZWQoKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbklkeCAhPT0gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhc1N0YXJ0ZWQoKSAmJiBjdXJyZW50UXVlc3Rpb25JZHggPj0gcXVlc3Rpb25zLmxlbmd0aDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IHF1ZXN0aW9uIHRvIHRoZSBxdWl6LlxyXG4gICAgICogVGhlIHBhcmFtZXRlciBtdXN0IGJlIGFuIHF1ZXN0aW9uIG9iamVjdC5cclxuICAgICAqIElmIG5vIHF1ZXN0aW9uIG9iamVjdCBpcyBwYXNzZWQgb3IgYW4gb2JqZWN0IHdpdGggbWlzc2luZyBwcm9wZXJ0aWVzLCBhbiBlcnJvciBpcyB0aHJvd24uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYWRkUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgIGlmIChxdWVzdGlvbiA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIk5vIHF1ZXN0aW9uIG9iamVjdCBwYXNzZWRcIik7XHJcblxyXG4gICAgICAgIHZhciB2YWxpZCA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGEgcXVlc3Rpb24gb2JqZWN0IG11c3QgY29udGFpbiBhbGwgdGhlc2UgcHJvcGVydGllc1xyXG4gICAgICAgIHZhciBuZWNlc3NhcnlQcm9wZXJ0aWVzID0gWydjb25maWcnLCAnaGludCcsICdzb2x1dGlvbicsICdhbnN3ZXInLCAncXVlc3Rpb24nLCAnZ2V0SW5mbycsICdpbmZvJywgJ3BvaW50cycsICdhbnN3ZXJlZCcsICdoaW50c0FsbG93ZWQnLCAnaGludHNSZW1haW5pbmcnXTtcclxuXHJcbiAgICAgICAgbmVjZXNzYXJ5UHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIGlmICghcXVlc3Rpb24uaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUXVlc3Rpb24gbXVzdCBoYXZlIHByb3BlcnR5ICdcIiArIHByb3BlcnR5ICsgXCInXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh2YWxpZCkge1xyXG4gICAgICAgICAgICBxdWVzdGlvbnMucHVzaChxdWVzdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG5leHQgcXVlc3Rpb24gb2YgdGhlIHF1aXouXHJcbiAgICAgKiBJZiB0aGUgcXVpeiBoYXMgZW5kZWQsIGl0IHJldHVybnMgbm90aGluZy5cclxuICAgICAqL1xyXG4gICAgdGhpcy5uZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uSWR4ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbklkeCA9IDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSWR4Kys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnNbY3VycmVudFF1ZXN0aW9uSWR4XTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5jdXJyZW50UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNBY3RpdmUoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnNbY3VycmVudFF1ZXN0aW9uSWR4XTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzU3RhcnRlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHRvdGFsUG9pbnRzID0gMDtcclxuXHJcbiAgICAgICAgcXVlc3Rpb25zLmZvckVhY2goZnVuY3Rpb24ocXVlc3Rpb24pIHtcclxuICAgICAgICAgICAgdmFyIHBvaW50cyA9IHF1ZXN0aW9uLnBvaW50cygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHBvaW50cyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0b3RhbFBvaW50cyArPSBwb2ludHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRvdGFsUG9pbnRzO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChjdXJyZW50UXVlc3Rpb25JZHggPT09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICByZXR1cm4gY3VycmVudFF1ZXN0aW9uSWR4ICsgMTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXROdW1iZXJPZlF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnMubGVuZ3RoO1xyXG4gICAgfTtcclxufTtcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVFU1RJT04gLS0tLS0tLS0tLVxyXG52YXIgUXVlc3Rpb24gPSBmdW5jdGlvbihvcHRpb25zKSB7XHJcbiAgICAvLyBUZXh0IG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIHRleHQgPSBudWxsO1xyXG5cclxuICAgIC8vIEluZm8gb2JqZWN0IGZvciB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBpbmZvID0gbnVsbDtcclxuXHJcbiAgICAvLyBBbnN3ZXIgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgYW5zd2VyID0gbnVsbDtcclxuXHJcbiAgICAvLyBIaW50cyBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBoaW50cyA9IG51bGw7XHJcbiAgICB2YXIgaGludHNVc2VkID0gMDtcclxuXHJcbiAgICAvLyBMYW1iZGEgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIHRoZSBhbnN3ZXIgc3RhdHVzIG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGNoZWNrQW5zd2VyID0gbnVsbDtcclxuXHJcbiAgICAvLyBQb2ludHMgYXdhcmRlZCBmb3IgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgcG9pbnRzID0gbnVsbDtcclxuXHJcbiAgICAvLyBGbGFnIGluZGljYXRpbmcgd2hldGhlciBxdWVzdGlvbiBoYXMgYWxyZWFkeSBiZWVuIGFuc3dlcmVkXHJcbiAgICB2YXIgYW5zd2VyZWQgPSBmYWxzZTtcclxuXHJcbiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKG9wdHMpIHtcclxuICAgICAgICB0ZXh0ID0gb3B0cy50ZXh0O1xyXG4gICAgICAgIGluZm8gPSBvcHRzLmluZm8gfHwge307XHJcbiAgICAgICAgYW5zd2VyID0gb3B0cy5hbnN3ZXI7XHJcbiAgICAgICAgY2hlY2tBbnN3ZXIgPSBvcHRzLmNoZWNrQW5zd2VyIHx8IG51bGw7XHJcblxyXG4gICAgICAgIGhpbnRzID0gb3B0cy5oaW50cyB8fCB7XHJcbiAgICAgICAgICAgICAgICBhbGxvd2VkOiBmYWxzZSwgICAgIC8vIGlzIGEgaGludCBhbGxvd2VkP1xyXG4gICAgICAgICAgICAgICAgbWF4aW11bTogMCwgICAgICAgICAvLyBtYXhpbXVtIG51bWJlciBvZiBoaW50cyBmb3IgdGhpcyBxdWVzdGlvbiAoaXJyZWxldmFudCBpZiBhbGxvd2VkIGlzIHNldCB0byBmYWxzZSlcclxuICAgICAgICAgICAgICAgIGNvc3Q6IDAsICAgICAgICAgICAgLy8gbnVtYmVyIG9mIHBvaW50cyBzdWJ0cmFjdGVkIHBlciB1c2VkIGhpbnQgKGlycmVsZXZhbnQgaWYgYWxsb3dlZCBpcyBzZXQgdG8gZmFsc2UpXHJcbiAgICAgICAgICAgICAgICBnaXZlOiBudWxsICAgICAgICAgIC8vIGxhbWJkYSBmdW5jdGlvbiB0byBnaXZlIGEgaGludCBmb3IgYSBxdWVzdGlvblxyXG4gICAgICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICAgIGluaXQob3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jb25maWcgPSBmdW5jdGlvbihvcHRzKSB7XHJcbiAgICAgICAgaW5pdChvcHRzKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBxdWVzdGlvbiB0ZXh0LlxyXG4gICAgICovXHJcbiAgICB0aGlzLnF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgcXVlc3Rpb24gaW5mbyBvYmplY3QuXHJcbiAgICAgKiBBY3RzIGFzIGdldHRlciAod2l0aCBvbmx5IG9uZSBhcmd1bWVudCkgYW5kIHNldHRlciAod2l0aCB0d28gYXJndW1lbnRzKVxyXG4gICAgICovXHJcbiAgICB0aGlzLmluZm8gPSBmdW5jdGlvbihwcm9wLCB2YWx1ZSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIC8vIHNldHRlclxyXG4gICAgICAgICAgICBpbmZvW3Byb3BdID0gdmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gZ2V0dGVyXHJcbiAgICAgICAgICAgIHJldHVybiBpbmZvW3Byb3BdO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBlbnRpcmUgaW5mbyBvYmplY3QuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuZ2V0SW5mbyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBpbmZvO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIGNvcnJlY3QgYW5zd2VyIHRvIHRoZSBxdWVzdGlvbiBhZnRlciB0aGUgcXVlc3Rpb24gaGFzIGJlZW4gYW5zd2VyZWQuXHJcbiAgICAgKiBJZiB0aGUgcXVlc3Rpb24gaGFzIG5vdCBiZWVuIGFuc3dlcmVkIHlldCwgaXQgcmV0dXJucyBudWxsLlxyXG4gICAgICovXHJcbiAgICB0aGlzLnNvbHV0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGFuc3dlcmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGEgaGludCBmb3IgdGhlIHF1ZXN0aW9uLlxyXG4gICAgICogSWYgbm8gaGludHMgYXJlIGFsbG93ZWQsIG9yIHRoZSBtYXhpbXVtIG51bWJlciBvZiBoaW50cyBoYXZlIGJlZW4gdXNlZCwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCFoaW50cy5hbGxvd2VkIHx8IGhpbnRzVXNlZCA+PSBoaW50cy5tYXhpbXVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGhpbnRzLmFsbG93ZWQgJiYgIWhpbnRzLmdpdmUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGludHMgYWxsb3dlZCBidXQgbm8gZ2l2ZSBtZXRob2QgcGFzc2VkXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaGludHNVc2VkKys7XHJcblxyXG4gICAgICAgIHJldHVybiBoaW50cy5naXZlKGhpbnRzVXNlZCwgYW5zd2VyKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJtaXRzIGFuIGFuc3dlciB0byB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKiBJZiB0aGUgcXVlc3Rpb24gaGFzIGFscmVhZHkgYmVlbiBhbnN3ZXJlZCBvciBubyBjaGVja0Fuc3dlciBsYW1iZGEgaGFzIGJlZW4gc2V0LCB0aGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYW5zd2VyID0gZnVuY3Rpb24oc3VibWl0dGVkQW5zd2VyKSB7XHJcbiAgICAgICAgaWYgKGFuc3dlcmVkIHx8IWNoZWNrQW5zd2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFuc3dlcmVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gY2hlY2tBbnN3ZXIgbWV0aG9kIHNob3VsZCByZXR1cm4gdGhlIHN0YXR1cyByZXN1bHRzXHJcbiAgICAgICAgcG9pbnRzID0gY2hlY2tBbnN3ZXIoYW5zd2VyLCBzdWJtaXR0ZWRBbnN3ZXIsIGhpbnRzVXNlZCwgaGludHMuY29zdCwgaW5mbyk7XHJcblxyXG4gICAgICAgIC8vIGVuc3VyZSB0aGF0IG5vIG5lZ2F0aXZlIHBvaW50cyBhcmUgYXdhcmRlZFxyXG4gICAgICAgIHBvaW50cyA9IE1hdGgubWF4KDAsIHBvaW50cyk7XHJcblxyXG4gICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCFhbnN3ZXJlZCB8fCBwb2ludHMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHN0YXRlIG9mIHRoZSBxdWVzdGlvbi5cclxuICAgICAqL1xyXG4gICAgdGhpcy5hbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBhbnN3ZXJlZDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgaGludHMgYXJlIGFsbG93ZWQgZm9yIHRoaXMgcXVlc3Rpb24sIGZhbHNlIGlmIG5vdC5cclxuICAgICAqIElmIGhpbnRzIGhhdmUgbm90IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmhpbnRzQWxsb3dlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaGludHMuYWxsb3dlZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiByZW1haW5pbmcgaGludHMuXHJcbiAgICAgKiBJZiBubyBoaW50cyBhcmUgYWxsb3dlZCBmb3IgdGhpcyBxdWVzdGlvbiwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50c1JlbWFpbmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhbGxvd2VkID0gdGhpcy5oaW50c0FsbG93ZWQoKTtcclxuXHJcbiAgICAgICAgaWYgKGFsbG93ZWQgPT09IG51bGwgfHwgYWxsb3dlZCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gaGludHMubWF4aW11bSAtIGhpbnRzVXNlZDtcclxuICAgIH07XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyBhIHJhbmRvbSBpbnRlZ2VyIGJldHdlZW4gbWluIChpbmNsdXNpdmUpIGFuZCBtYXggKGluY2x1c2l2ZSlcclxuICogVXNpbmcgTWF0aC5yb3VuZCgpIHdpbGwgZ2l2ZSB5b3UgYSBub24tdW5pZm9ybSBkaXN0cmlidXRpb24hXHJcbiAqL1xyXG52YXIgZ2V0UmFuZG9tSW50ID0gZnVuY3Rpb24obWluLCBtYXgpIHtcclxuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgdGhlIHRleHQgYmV0d2VlbiB0d28gZGVsaW1pdGluZyB0ZXh0IG9jY3VycmVuY2VzXHJcbiAqL1xyXG52YXIgZ2V0U3RyaW5nQmV0d2VlbiA9IGZ1bmN0aW9uKHRleHQsIGZpcnN0U3RyaW5nLCBzZWNvbmRTdHJpbmcpIHtcclxuICAgIHZhciBmaXJzdFBvcyA9IHRleHQuaW5kZXhPZihmaXJzdFN0cmluZyk7XHJcbiAgICB2YXIgc2Vjb25kUG9zID0gdGV4dC5pbmRleE9mKHNlY29uZFN0cmluZyk7XHJcblxyXG4gICAgaWYgKGZpcnN0UG9zID49IDAgJiYgc2Vjb25kUG9zID49IDAgJiYgc2Vjb25kUG9zID4gZmlyc3RQb3MpIHtcclxuICAgICAgICByZXR1cm4gdGV4dC5zdWJzdHIoZmlyc3RQb3MgKyAxLCBzZWNvbmRQb3MgLSBmaXJzdFBvcyAtIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cy5RdWVzdGlvbiA9IFF1ZXN0aW9uO1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuUXVpeiA9IFF1aXo7XHJcbn0iLCJhbmd1bGFyLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAgICAgIC8vIGVuYWJsZSBIVE1MNSBwdXNoc3RhdGVcclxuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcblxyXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9ob21lJyk7XHJcblxyXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnaG9tZScsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9ob21lJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2hvbWUucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHBhcmFtczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogbnVsbFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3F1aXonLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvcXVpeicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9xdWl6LnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdjb3VudHJpZXMnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvY291bnRyaWVzJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2NvdW50cmllcy5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnY291bnRyaWVzLmRldGFpbCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy86YWxwaGEzQ29kZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9jb3VudHJpZXMtZGV0YWlsLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9sb2dpbicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9sb2dpbi5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnbG9nb3V0Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ291dCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTG9nb3V0Q3RybCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdyZWdpc3RlcicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9yZWdpc3RlcicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9yZWdpc3Rlci5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnc2V0dGluZ3MnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvc2V0dGluZ3MnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvc2V0dGluZ3MucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2Fib3V0Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2Fib3V0JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2Fib3V0LnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignQ291bnRyaWVzQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgQ291bnRyeVNydikge1xyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUxldHRlciA9IG51bGw7XHJcbiAgICAgICAgdmFyIGNvdW50cnlLZXlzID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXIgPSBDb3VudHJ5U3J2LmdldENvdW50cmllc0J5TGV0dGVyKCk7XHJcbiAgICAgICAgICAgIGNvdW50cnlLZXlzID0gT2JqZWN0LmtleXMoY291bnRyaWVzQnlMZXR0ZXIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCEkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyeUtleXMgPSBjb3VudHJ5S2V5cztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyaWVzQnlMZXR0ZXIgPSBjb3VudHJpZXNCeUxldHRlcjtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cnlLZXlzID0gY291bnRyeUtleXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyaWVzQnlMZXR0ZXIgPSBjb3VudHJpZXNCeUxldHRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmIChDb3VudHJ5U3J2LmFyZUNvdW50cmllc0xvYWRlZCgpKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ2NvdW50cmllcy5sb2FkZWQnLCBmdW5jdGlvbigpICB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdDb3VudHJ5RGV0YWlsQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgQ291bnRyeVNydiwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAgICAgdmFyIGFscGhhM0NvZGUgPSAkc3RhdGVQYXJhbXMuYWxwaGEzQ29kZTtcclxuXHJcbiAgICAgICAgaWYgKENvdW50cnlTcnYuYXJlQ291bnRyaWVzTG9hZGVkKCkpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmNvdW50cnkgPSBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTNDb2RlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ2NvdW50cmllcy5sb2FkZWQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJ5ID0gQ291bnRyeVNydi5nZXRDb3VudHJ5QnlBbHBoYTMoYWxwaGEzQ29kZSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJ5RnJvbVNlcnZpY2UgPSBmdW5jdGlvbihhbHBoYTMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhMyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmdldENvdW50cnlGcm9tU2VydmljZSA9IGdldENvdW50cnlGcm9tU2VydmljZTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdEcm9wZG93bkN0cmwnLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkc2NvcGUudG9nZ2xlRHJvcGRvd24gPSB0b2dnbGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuc2hvd0Ryb3Bkb3duID0gc2hvd0Ryb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5oaWRlRHJvcGRvd24gPSBoaWRlRHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmlzRHJvcGRvd25WaXNpYmxlID0gaXNEcm9wZG93blZpc2libGU7XHJcblxyXG4gICAgICAgICRzY29wZS5oYW5kbGVDbGlja091dHNpZGUgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNMSUNLRUQgT1VUU0lERVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gIXZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93RHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGlkZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0Ryb3Bkb3duVmlzaWJsZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZpc2libGU7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0hvbWVDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBMb2dTcnYsICRzdGF0ZVBhcmFtcykge1xyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gY2hlY2sgc3RhdGUgcGFyYW1zXHJcbiAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5hY3Rpb24pIHtcclxuICAgICAgICAgICAgdmFyIGFjdGlvbiA9ICRzdGF0ZVBhcmFtcy5hY3Rpb247XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKGFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAncmVnaXN0ZXIuc3VjY2Vzc2Z1bCc6XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0dyYXR1bGF0aW9uISBEaWUgQW5tZWxkdW5nIHdhciBlcmZvbGdyZWljaC4gSGVyemxpY2ggd2lsbGtvbW1lbiBiZWkgTWFnZWxsYW4uJ1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICBVc2VyU3J2LmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dpbiBldmVudFxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ2luJywgcmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyLnN0YXR1cyA9PT0gNDAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0ZhbHNjaGVyIEJlbnV0emVybmFtZSBvZGVyIFBhc3N3b3J0JztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdCZWltIEVpbmxvZ2dlbiBzY2hlaW50IGV0d2FzIHNjaGllZiBnZWdhbmdlbiB6dSBzZWluJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCcjdXNlcm5hbWUnKTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdMb2dvdXRDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2KSB7XHJcbiAgICAgICAgVXNlclNydi5sb2dvdXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ291dCBldmVudFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9nb3V0Jyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1F1aXpEaXJlY3RpdmVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCBRdWl6U3J2LCBMb2dTcnYsIEZvY3VzU3J2LCBuZ1Byb2dyZXNzRmFjdG9yeSkge1xyXG4gICAgICAgIC8vIFByb2dyZXNzIGJhciBpbml0aWFsaXphdGlvblxyXG4gICAgICAgICRzY29wZS5wcm9ncmVzc2JhciA9IG5nUHJvZ3Jlc3NGYWN0b3J5LmNyZWF0ZUluc3RhbmNlKCk7XHJcbiAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldFBhcmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1wcm9ncmVzcycpKTtcclxuICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0QWJzb2x1dGUoKTtcclxuICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0Q29sb3IoXCIjMzM2ZTdiXCIpO1xyXG5cclxuICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQgPSB7fTtcclxuICAgICAgICAkc2NvcGUuaGludCA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGFkZCBvcHRpb25zIGZvciBtdWx0aXBsaWVyIHNlbGVjdGlvblxyXG4gICAgICAgICRzY29wZS5tdWx0aXBsaWVyT3B0aW9ucyA9IFtcclxuICAgICAgICAgICAgeyB2YWx1ZTogMSwgbGFiZWw6ICcnIH0sXHJcbiAgICAgICAgICAgIHsgdmFsdWU6IDEwMDAsIGxhYmVsOiAnVHNkLid9LFxyXG4gICAgICAgICAgICB7IHZhbHVlOiAxMDAwMDAwLCBsYWJlbDogJ01pby4nfVxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbiA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVVaSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBnZXQgY3VycmVudCBxdWVzdGlvbiBmcm9tIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICBxdWVzdGlvbiA9IFF1aXpTcnYuZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBkZWxldGUgcHJldmlvdXMgaGludHNcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgaWYgKHF1ZXN0aW9uICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBtdWx0aXBsaWVycyBmb3IgcXVlc3Rpb25zIGNvbnRhaW5pbmcgbnVtYmVyc1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dCAmJiBxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQuaW5kZXhPZignbnVtYmVyJykgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXIuaGlnaCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IHsgdmFsdWU6IDEwMDAwMDAsIGxhYmVsOiAnTWlvLid9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXIubWVkaXVtJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyID0geyB2YWx1ZTogMTAwMCwgbGFiZWw6ICdUc2QuJ307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IHsgdmFsdWU6IDEsIGxhYmVsOiAnJyB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIHByb2dyZXNzIGJhclxyXG4gICAgICAgICAgICAgICAgdXBkYXRlUHJvZ3Jlc3NCYXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBmb2N1cyBhbnN3ZXIgaW5wdXRcclxuICAgICAgICAgICAgICAgIEZvY3VzU3J2KCcuYW5zd2VySW5wdXQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIHF1aXogaGFzIGVuZGVkLCBzZXQgcHJvZ3Jlc3MgYmFyIHRvIDBcclxuICAgICAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXQoMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVuZGVyUXVlc3Rpb25UZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXIoZ2V0UXVlc3Rpb24oKS5xdWVzdGlvbigpLCAncXVlc3Rpb24taGlnaGxpZ2h0JykgKyAnPyc7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uTWVkaWEgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFxdWVzdGlvbiB8fCAhcXVlc3Rpb24uZ2V0SW5mbygpLm1lZGlhKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uZ2V0SW5mbygpLm1lZGlhO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzdWJtaXRBbnN3ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhbnN3ZXIgPSAkc2NvcGUuYW5zd2VySW5wdXQuYW5zd2VyO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGlmIGl0IGlzIGEgbnVtYmVyIGlucHV0LCByZXBsYWNlICcsJyB3aXRoICcuJ1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dCAmJiBxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQuaW5kZXhPZignbnVtYmVyJykgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBhbnN3ZXIgPSBhbnN3ZXIucmVwbGFjZSgnLCcsICcuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gaWYgYSBtdWx0aXBsaWVyIGlzIGF2YWlsYWJsZSwgY2FsY3VsYXRlIGFuc3dlclxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5zd2VyICo9ICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKCdzdWJtaXR0aW5nIGFuc3dlcicsIGFuc3dlcik7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQucG9pbnRzID0gcXVlc3Rpb24uYW5zd2VyKGFuc3dlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGZvY3VzIHRvIG5leHQgcXVlc3Rpb24gYnV0dG9uXHJcbiAgICAgICAgICAgICAgICBGb2N1c1NydignI2J0bk5leHRRdWVzdGlvbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uQW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKSB8fCBxdWVzdGlvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uYW5zd2VyZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIFF1aXpTcnYubmV4dFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQuYW5zd2VyID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgIHVwZGF0ZVVpKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlcXVlc3RIaW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5oaW50ID0gcXVlc3Rpb24uaGludCgpO1xyXG5cclxuICAgICAgICAgICAgRm9jdXNTcnYoJy5hbnN3ZXJJbnB1dCcpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZW5kZXIgPSBmdW5jdGlvbih0ZXh0LCBjbGFzc05hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRleHRcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwiW1wiLCBcIjxzcGFuIGNsYXNzPSdcIiArIGNsYXNzTmFtZSArIFwiJz5cIilcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwiXVwiLCBcIjwvc3Bhbj5cIik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhbmRsZUtleVByZXNzID0gZnVuY3Rpb24oa2V5RXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGtleUV2ZW50LndoaWNoID09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJtaXRBbnN3ZXIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVQcm9ncmVzc0JhciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcHJvZ3Jlc3NQZXJjZW50ID0gZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCkgLyBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKSAqIDEwMDtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXQocHJvZ3Jlc3NQZXJjZW50KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgd2FzTGFzdFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKSA+PSBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY29udGludWVGaW5pc2hlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBuZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFRPRE8gd3JpdGUgcmVzdWx0IHRvIERCXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gaW5pdGlhbGx5IHVwZGF0ZSBVSVxyXG4gICAgICAgIHVwZGF0ZVVpKCk7XHJcblxyXG4gICAgICAgICRzY29wZS5nZXRRdWVzdGlvbiA9IGdldFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI7XHJcbiAgICAgICAgJHNjb3BlLnJlbmRlclF1ZXN0aW9uVGV4dCA9IHJlbmRlclF1ZXN0aW9uVGV4dDtcclxuICAgICAgICAkc2NvcGUuc3VibWl0QW5zd2VyID0gc3VibWl0QW5zd2VyO1xyXG4gICAgICAgICRzY29wZS5xdWVzdGlvbkFuc3dlcmVkID0gcXVlc3Rpb25BbnN3ZXJlZDtcclxuICAgICAgICAkc2NvcGUubmV4dFF1ZXN0aW9uID0gbmV4dFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5oYW5kbGVLZXlQcmVzcyA9IGhhbmRsZUtleVByZXNzO1xyXG4gICAgICAgICRzY29wZS5nZXRRdWVzdGlvbk1lZGlhID0gZ2V0UXVlc3Rpb25NZWRpYTtcclxuICAgICAgICAkc2NvcGUucmVxdWVzdEhpbnQgPSByZXF1ZXN0SGludDtcclxuICAgICAgICAkc2NvcGUud2FzTGFzdFF1ZXN0aW9uID0gd2FzTGFzdFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5jb250aW51ZUZpbmlzaGVkID0gY29udGludWVGaW5pc2hlZDtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2KSB7XHJcblxyXG4gICAgICAgIHZhciBzdGFydFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKFwiUXVpeiBzdGFydGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpelN0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuaGFzUXVpelN0YXJ0ZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpekVuZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2Lmhhc1F1aXpFbmRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXRUb3RhbFBvaW50cygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLnN0YXJ0UXVpeiA9IHN0YXJ0UXVpejtcclxuICAgICAgICAkc2NvcGUuaXNRdWl6UnVubmluZyA9IGlzUXVpelJ1bm5pbmc7XHJcbiAgICAgICAgJHNjb3BlLmhhc1F1aXpTdGFydGVkID0gaGFzUXVpelN0YXJ0ZWQ7XHJcbiAgICAgICAgJHNjb3BlLmhhc1F1aXpFbmRlZCA9IGhhc1F1aXpFbmRlZDtcclxuICAgICAgICAkc2NvcGUuZ2V0VG90YWxQb2ludHMgPSBnZXRUb3RhbFBvaW50cztcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdSZWdpc3RlckN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIExvZ1NydiwgRm9jdXNTcnYsIFVzZXJTcnYsICRzdGF0ZSwgJHdpbmRvdykge1xyXG4gICAgICAgIC8vIG5ldyB1c2VyIG9iamVjdFxyXG4gICAgICAgICRzY29wZS5uZXdVc2VyID0ge307XHJcblxyXG4gICAgICAgIC8vIG1lc3NhZ2Ugb2JqZWN0XHJcbiAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgcmVnaXN0ZXIgPSBmdW5jdGlvbiAoaXNWYWxpZCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzVmFsaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHZhbGlkYXRlQmVmb3JlU3VibWl0KCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIHBlcmZvcm0gYXBpIGNhbGxcclxuICAgICAgICAgICAgICAgIFVzZXJTcnYucmVnaXN0ZXIoJHNjb3BlLm5ld1VzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwIGNvbnRyb2xsZXIgYWJvdXQgbG9naW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ2luJywgcmVzcG9uc2UuZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gaG9tZSBwYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncmVnaXN0ZXIuc3VjY2Vzc2Z1bCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnQmVpIGRlciBBbm1lbGR1bmcgc2NoZWludCBldHdhcyBzY2hpZWYgZ2VnYW5nZW4genUgc2VpbidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlVGV4dDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZXJyLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1VzZXJuYW1lIGFscmVhZHkgZXhpc3RzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEZXIgQmVudXR6ZXJuYW1lIGV4aXN0aWVydCBiZXJlaXRzJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0JlaSBkZXIgQW5tZWxkdW5nIHNjaGVpbnQgZXR3YXMgc2NoaWVmIGdlZ2FuZ2VuIHp1IHNlaW4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbWVzc2FnZVRleHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB2YWxpZGF0ZUJlZm9yZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgdHdvIHBhc3N3b3JkcyBtYXRjaFxyXG4gICAgICAgICAgICB2YXIgcGFzc3dvcmQgPSAkc2NvcGUubmV3VXNlci5wYXNzd29yZDtcclxuICAgICAgICAgICAgdmFyIHBhc3N3b3JkMiA9ICRzY29wZS5uZXdVc2VyLnBhc3N3b3JkMjtcclxuXHJcbiAgICAgICAgICAgIGlmICghJHNjb3BlLm5ld1VzZXIudXNlcm5hbWUgfHwgISRzY29wZS5uZXdVc2VyLmVtYWlsIHx8ICFwYXNzd29yZCB8fCAhcGFzc3dvcmQyKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdBbGxlIEZlbGRlciBtw7xzc2VuIGF1c2dlZsO8bGx0IHNlaW4nXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhc3N3b3JkID09PSBcIlwiIHx8IHBhc3N3b3JkMiA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRGllIFBhc3N3w7ZydGVyIGvDtm5uZW4gbmljaHQgbGVlciBzZWluJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXNzd29yZCAhPT0gcGFzc3dvcmQyKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEaWUgUGFzc3fDtnJ0ZXIgc3RpbW1lbiBuaWNodCDDvGJlcmVpbidcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiAhJHNjb3BlLm1lc3NhZ2UgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRlbGVnYXRlU3VibWl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJlZ2lzdGVyKHRydWUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5kZWxlZ2F0ZVN1Ym1pdCA9IGRlbGVnYXRlU3VibWl0O1xyXG5cclxuICAgICAgICAkc2NvcGUucmVnaXN0ZXIgPSByZWdpc3RlcjtcclxuXHJcbiAgICAgICAgLy8gZm9jdXMgdXNlciBuYW1lIGZpZWxkXHJcbiAgICAgICAgRm9jdXNTcnYoJyN1c2VybmFtZScpO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1NldHRpbmdzQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgQXBwQ29uZmlnLCBGb2N1c1NydiwgTG9nU3J2LCBVc2VyU3J2KSB7XHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gdXNlciBjb2xvdXJzXHJcbiAgICAgICAgICAgIHZhciBjb2xvcnMgPSBBcHBDb25maWdbJ3NldHRpbmdzLnVzZXIuY29sb3JzJ107XHJcblxyXG4gICAgICAgICAgICAvLyB1c2VyIG9iamVjdFxyXG4gICAgICAgICAgICAkc2NvcGUudXNlck9iaiA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAkc2NvcGUudXNlci51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIGVtYWlsOiAkc2NvcGUudXNlci5lbWFpbCxcclxuICAgICAgICAgICAgICAgIGNvbG9yOiAkc2NvcGUudXNlci5jb2xvclxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJDb2xvcnMgPSBjb2xvcnM7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2V0Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJPYmouY29sb3IgPSBuZXdDb2xvcjtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciB1cGRhdGVVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBVc2VyU3J2LnVwZGF0ZUJhc2ljKCRzY29wZS51c2VyT2JqKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgdXNlciBvYmplY3RcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXNlci51c2VybmFtZSA9ICRzY29wZS51c2VyT2JqLnVzZXJuYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmVtYWlsID0gJHNjb3BlLnVzZXJPYmouZW1haWw7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuY29sb3IgPSAkc2NvcGUudXNlck9iai5jb2xvcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRWluc3RlbGx1bmdlbiB3dXJkZW4gZXJmb2xncmVpY2ggZ2VzcGVpY2hlcnQnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoJ1VwZGF0ZSB1c2VyJywgZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGVyci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1VzZXJuYW1lIGFscmVhZHkgZXhpc3RzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RlciBCZW51dHplcm5hbWUgaXN0IGJlcmVpdHMgdmVyZ2ViZW4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnRGllIEVpbnN0ZWxsdW5nZW4ga29ubnRlbiBuaWNodCBnZXNwZWljaGVydCB3ZXJkZW4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgZGVsZWdhdGVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVVzZXIodHJ1ZSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2V0Q29sb3IgPSBzZXRDb2xvcjtcclxuICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZVVzZXIgPSB1cGRhdGVVc2VyO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGVsZWdhdGVTdWJtaXQgPSBkZWxlZ2F0ZVN1Ym1pdDtcclxuXHJcbiAgICAgICAgICAgIC8vIGZvY3VzIHVzZXJuYW1lIGZpZWxkXHJcbiAgICAgICAgICAgIEZvY3VzU3J2KCcjdXNlcm5hbWUnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoJHNjb3BlLnVzZXIpIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gb3RoZXJ3aXNlLCB3YWl0IGZvciB1c2VyLmxvYWRlZCBldmVudFxyXG4gICAgICAgICRzY29wZS4kb24oJ3VzZXIubG9hZGVkJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmRpcmVjdGl2ZSgncXVpeicsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYnVpbGQvdmlld3MvdGVtcGxhdGVzL3F1aXotZGlyZWN0aXZlLnRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICBzY29wZTogdHJ1ZSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1F1aXpEaXJlY3RpdmVDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5maWx0ZXIoJ3JlbmRlckh0bWwnLCBmdW5jdGlvbigkc2NlKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHRleHQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwodGV4dCk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdBdXRoSW50ZXJjZXB0b3InLCBmdW5jdGlvbihBdXRoVG9rZW5TcnYpIHtcclxuICAgICAgICB2YXIgYWRkVG9rZW4gPSBmdW5jdGlvbihjb25maWcpIHtcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFRva2VuU3J2LmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snWC1BdXRoJ10gPSB0b2tlbjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0OiBhZGRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFRva2VuU3J2JywgZnVuY3Rpb24oJHdpbmRvdykge1xyXG4gICAgICAgIHZhciBzdG9yZSA9ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2U7XHJcbiAgICAgICAgdmFyIGtleSA9ICdhdXRoLXRva2VuJztcclxuXHJcbiAgICAgICAgdmFyIGdldFRva2VuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNldFRva2VuID0gZnVuY3Rpb24odG9rZW4pIHtcclxuICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5zZXRJdGVtKGtleSwgdG9rZW4pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUucmVtb3ZlSXRlbShrZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0VG9rZW46IGdldFRva2VuLFxyXG4gICAgICAgICAgICBzZXRUb2tlbjogc2V0VG9rZW5cclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0NvdW50cnlTcnYnLCBmdW5jdGlvbigkaHR0cCwgSW5kZXhlZERCU3J2LCBMb2dTcnYpIHtcclxuICAgICAgICAvLyBDb3VudHJpZXMgYXJyYXlcclxuICAgICAgICB2YXIgY291bnRyaWVzID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGNvdW50cmllc0J5QWxwaGEzID0gbnVsbDtcclxuICAgICAgICB2YXIgY291bnRyaWVzQnlMZXR0ZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBJbmRleGVkREJcclxuICAgICAgICB2YXIgZGF0YWJhc2UgPSAnbWFnZWxsYW4nO1xyXG4gICAgICAgIHZhciBzdG9yZSA9ICdjb3VudHJ5U3RvcmUnO1xyXG4gICAgICAgIHZhciBrZXlDb3VudHJpZXMgPSAnY291bnRyaWVzJztcclxuICAgICAgICB2YXIga2V5VmVyc2lvbiA9ICd2ZXJzaW9uJztcclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IEluZGV4ZWREQlNydi5pbmRleGVkREJBdmFpbGFibGUoKTtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvYWRDb3VudHJpZXMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9hZENvdW50cmllcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBjaGVjayBpZiBpbmRleGVkREIgaXMgYXZhaWxhYmxlXHJcbiAgICAgICAgICAgIGlmIChpbmRleGVkREJBdmFpbGFibGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgZGF0YWJhc2UgZXhpc3RzXHJcbiAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LmNyZWF0ZURhdGFiYXNlKGRhdGFiYXNlLCBzdG9yZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0RW1wdHlPYmplY3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEludGVybmFsVmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0RXh0ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihkZXRlcm1pbmVMb2FkU3RyYXRlZ3kpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGxvYWREYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllcyA9IG9ialsnY291bnRyaWVzJ107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmluZm8oXCJsb2FkZWQgY291bnRyaWVzIGZyb21cIiwgb2JqWydsb2FkU3RyYXRlZ3knXS50b1VwcGVyQ2FzZSgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGRpdGlvbmFsbHkgbWFwIGNvdW50cmllcyBieSB2YXJpb3VzIHByb3BlcnRpZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5QWxwaGEzID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUxldHRlciA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllcy5mb3JFYWNoKGZ1bmN0aW9uKGMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBieSBhbHBoYTMgY29kZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5QWxwaGEzW2NbJ2FscGhhM0NvZGUnXV0gPSBjO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBieSBsZXR0ZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlyc3RMZXR0ZXIgPSBjWyduYW1lJ10uc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZmlyc3RMZXR0ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnw4QnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RMZXR0ZXIgPSAnQSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ8OWJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TGV0dGVyID0gJ08nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICfDnCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdExldHRlciA9ICdVJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudHJpZXNCeUxldHRlcltmaXJzdExldHRlcl0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUxldHRlcltmaXJzdExldHRlcl0gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyW2ZpcnN0TGV0dGVyXS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGEzQ29kZTogYy5hbHBoYTNDb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBjLm5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiZmFpbGVkIHRvIGxvYWQgY291bnRyaWVzXCIsIGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBub3QsIHdlIGFsd2F5cyB0cnkgdG8gZG93bmxvYWQgaXQgZnJvbSB0aGUgY291bnRyeSBBUEkgZW5kcG9pbnRcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRDb3VudHJpZXNGcm9tQVBJKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5ID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaW50ZXJuYWxWZXJzaW9uID0gb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGV4dGVybmFsVmVyc2lvbiA9IG9ialtcImV4dGVybmFsVmVyc2lvblwiXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaW50ZXJuYWxWZXJzaW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ZXJuYWxWZXJzaW9uID4gaW50ZXJuYWxWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnZGInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIG9ialsnbG9hZFN0cmF0ZWd5J10gPSBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkRGF0YSA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyYXRlZ3kgPSBvYmpbJ2xvYWRTdHJhdGVneSddO1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdhcGknOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDb3VudHJpZXNGcm9tQVBJKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGNvdW50cmllcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmUgY291bnRyaWVzIGFuZCB2ZXJzaW9uIG51bWJlciBpbiBkYXRhYmFzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlDb3VudHJpZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAgY291bnRyaWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlWZXJzaW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdkYic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21EQihvYmopXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihfb2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfb2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ1Vua25vd24gbG9hZCBzdHJhdGVneScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RW1wdHlPYmplY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7fSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRJbnRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleVZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBpdGVtLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0ZXJuYWxWZXJzaW9uID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRWZXJzaW9uRnJvbUFQSSgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbih2ZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdID0gdmVyc2lvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNGcm9tREIgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleUNvdW50cmllcylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21BUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdW50cmllcycpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRWZXJzaW9uRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzL3ZlcnNpb24nKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YS52ZXJzaW9uIHx8IDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyeUJ5QWxwaGEzID0gZnVuY3Rpb24oYWxwaGEzKSB7XHJcbiAgICAgICAgICAgIGlmIChjb3VudHJpZXNCeUFscGhhMyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXNCeUFscGhhM1thbHBoYTNdO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNCeUxldHRlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoY291bnRyaWVzQnlMZXR0ZXIgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzQnlMZXR0ZXI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFyZUNvdW50cmllc0xvYWRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzICE9PSBudWxsICYmIGNvdW50cmllcy5sZW5ndGggPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXQsXHJcbiAgICAgICAgICAgIGdldENvdW50cnlCeUFscGhhMzogZ2V0Q291bnRyeUJ5QWxwaGEzLFxyXG4gICAgICAgICAgICBnZXRDb3VudHJpZXNCeUxldHRlcjogZ2V0Q291bnRyaWVzQnlMZXR0ZXIsXHJcbiAgICAgICAgICAgIGFyZUNvdW50cmllc0xvYWRlZDogYXJlQ291bnRyaWVzTG9hZGVkXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdGb2N1c1NydicsIGZ1bmN0aW9uKCR0aW1lb3V0LCAkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNlbGVjdG9yKSB7XHJcbiAgICAgICAgICAgIC8vIHRpbWVvdXQgbWFrZXMgc3VyZSB0aGF0IGlzIGludm9rZWQgYWZ0ZXIgYW55IG90aGVyIGV2ZW50IGhhcyBiZWVuIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgLy8gZS5nLiBjbGljayBldmVudHMgdGhhdCBuZWVkIHRvIHJ1biBiZWZvcmUgdGhlIGZvY3VzIG9yXHJcbiAgICAgICAgICAgIC8vIGlucHV0cyBlbGVtZW50cyB0aGF0IGFyZSBpbiBhIGRpc2FibGVkIHN0YXRlIGJ1dCBhcmUgZW5hYmxlZCB3aGVuIHRob3NlIGV2ZW50c1xyXG4gICAgICAgICAgICAvLyBhcmUgdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdJbmRleGVkREJTcnYnLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIGtleVBhdGggPSAnbmFtZSc7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREIgPSAkd2luZG93LmluZGV4ZWREQiB8fCAkd2luZG93LndlYmtpdEluZGV4ZWREQiB8fCAkd2luZG93Lm1zSW5kZXhlZERCO1xyXG4gICAgICAgIHZhciBJREJLZXlSYW5nZSA9ICR3aW5kb3cuSURCS2V5UmFuZ2UgfHwgJHdpbmRvdy53ZWJraXRJREJLZXlSYW5nZTtcclxuXHJcbiAgICAgICAgdmFyIElEQlRyYW5zYWN0aW9uID0gJHdpbmRvdy5JREJUcmFuc2FjdGlvbiB8fCAkd2luZG93LndlYmtpdElEQlRyYW5zYWN0aW9uO1xyXG5cclxuICAgICAgICBpZiAoSURCVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSA9IElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgfHwgJ3JlYWR3cml0ZSc7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSA9IElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSB8fCAncmVhZG9ubHknO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5kZXhlZERCID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBlIGlzIGFuIGluc3RhbmNlIG9mIElEQlZlcnNpb25DaGFuZ2VFdmVudFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IGlkYi5jcmVhdGVPYmplY3RTdG9yZShzdG9yZU5hbWUsIHsga2V5UGF0aDoga2V5UGF0aCB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkLCB1cGRhdGUsIGRlbGV0ZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZHJvcERhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBzdWNjZXNzZnVsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3AgZmFpbGVkXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFkZEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLmFkZChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwdXRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5wdXQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW1OYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IElEQktleVJhbmdlLm9ubHkoaXRlbU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKHJhbmdlKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gY3Vyc29yLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW1zID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjcmVhdGVEYXRhYmFzZTogY3JlYXRlRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGRyb3BEYXRhYmFzZTogZHJvcERhdGFiYXNlLFxyXG4gICAgICAgICAgICBhZGRJdGVtOiBhZGRJdGVtLFxyXG4gICAgICAgICAgICBwdXRJdGVtOiBwdXRJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW06IHJldHJpZXZlSXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtczogcmV0cmlldmVJdGVtcyxcclxuICAgICAgICAgICAgaW5kZXhlZERCQXZhaWxhYmxlOiBpbmRleGVkREJBdmFpbGFibGVcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0xvZ1NydicsIGZ1bmN0aW9uKEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBsb2dJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuaW5mb1wiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dFcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmVycm9yXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbmZvOiBsb2dJbmZvLFxyXG4gICAgICAgICAgICBlcnJvcjogbG9nRXJyb3JcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1F1aXpTcnYnLCBmdW5jdGlvbihBcHBDb25maWcsIENvdW50cnlTcnYsIExvZ1Nydikge1xyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUFscGhhMyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBxdWl6ID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHNldENvdW50cmllcyA9IGZ1bmN0aW9uKF9jb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgY291bnRyaWVzID0gX2NvdW50cmllcztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY291bnRyaWVzTG9hZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXMgIT09IG51bGwgJiYgY291bnRyaWVzLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb3VudHJpZXNMb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJDb3VudHJpZXMgaGF2ZSBub3QgYmVlbiBsb2FkZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcXVpeiA9IGNyZWF0ZVF1aXooJ2NvdW50cnknKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHF1aXouc3RhcnQoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouaGFzU3RhcnRlZCgpICYmICFxdWl6Lmhhc0VuZGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouaGFzU3RhcnRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoYXNRdWl6RW5kZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNFbmRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVRdWl6ID0gZnVuY3Rpb24ocXVpelR5cGUpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChxdWl6VHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY291bnRyeSc6XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVDb3VudHJ5UXVpeigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZUNvdW50cnlRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBjb3VudHJ5UXVpeiA9IG5ldyBRdWl6KCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZnVsbFBvaW50cyA9IDEwMDtcclxuICAgICAgICAgICAgdmFyIGhpbnRNYXhpbXVtID0gMztcclxuICAgICAgICAgICAgdmFyIGhpbnRDb3N0ID0gMjU7XHJcblxyXG4gICAgICAgICAgICB2YXIgbGFzdFF1ZXN0aW9uQm9udXMgPSAyLjU7XHJcblxyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25UeXBlcyA9IEFwcENvbmZpZ1sncXVpei5jb3VudHJ5LnR5cGVzJ107XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGVzTGVuZ3RoID0gT2JqZWN0LmtleXMocXVlc3Rpb25UeXBlcykubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgLy8gc2VsZWN0IGNvdW50cmllcyBmb3IgcXVlc3Rpb25zXHJcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZENvdW50cmllcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgbnVtYmVyT2ZRdWVzdGlvbnMgPSBBcHBDb25maWdbJ3F1aXouY291bnRyeS5xdWVzdGlvbnMnXTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtYmVyT2ZRdWVzdGlvbnM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnlPayA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlICghY291bnRyeU9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50cnkgPSBjb3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIGNvdW50cmllcy5sZW5ndGggLSAxKV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50cnlPayA9IHNlbGVjdGVkQ291bnRyaWVzLmluZGV4T2YoY291bnRyeVsnYWxwaGEzQ29kZSddKSA8IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ291bnRyaWVzLnB1c2goY291bnRyeVsnYWxwaGEzQ29kZSddKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gY3JlYXRlIHF1ZXN0aW9ucyBmb3IgcXVpelxyXG4gICAgICAgICAgICB2YXIgcWNudCA9IDA7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkQ291bnRyaWVzLmZvckVhY2goZnVuY3Rpb24oYWxwaGEzKSB7XHJcbiAgICAgICAgICAgICAgICBxY250Kys7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnkgPSBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTMpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGUgPSBxdWVzdGlvblR5cGVzW2dldFJhbmRvbUludCgxLCBxdWVzdGlvblR5cGVzTGVuZ3RoKV07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHRleHQgPSBnZXRRdWVzdGlvblRleHQocXVlc3Rpb25UeXBlLCBjb3VudHJ5KTtcclxuICAgICAgICAgICAgICAgIHZhciBpbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHF1ZXN0aW9uVHlwZSxcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dDogZ2V0UXVlc3Rpb25JbnB1dChxdWVzdGlvblR5cGUpLFxyXG4gICAgICAgICAgICAgICAgICAgIHVuaXQ6IGdldFF1ZXN0aW9uVW5pdChxdWVzdGlvblR5cGUpXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdmFyIGFuc3dlciA9IGdldFF1ZXN0aW9uQW5zd2VyKHF1ZXN0aW9uVHlwZSwgY291bnRyeSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tBbnN3ZXIgPSBnZXRDaGVja0Fuc3dlckxhbWJkYShxdWVzdGlvblR5cGUsIGZ1bGxQb2ludHMsIGxhc3RRdWVzdGlvbkJvbnVzKTtcclxuICAgICAgICAgICAgICAgIHZhciBoaW50cyA9IGdldFF1ZXN0aW9uSGludHMocXVlc3Rpb25UeXBlLCBoaW50TWF4aW11bSwgaGludENvc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHRoZSBsYXN0IHF1ZXN0aW9uIGlzIHRoZSBib251cyBxdWVzdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKHFjbnQgPj0gbnVtYmVyT2ZRdWVzdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmZvWydib251cyddID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBhZGQgaW5mbyBmb3IgZmxhZyBvZiBjb3VudHJ5XHJcbiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnRkxBR19PRl9DT1VOVFJZJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm8ubWVkaWEgPSAnZmxhZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mby5hbHBoYTJDb2RlID0gY291bnRyeS5hbHBoYTJDb2RlLnRvTG9jYWxlTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY291bnRyeVF1aXouYWRkUXVlc3Rpb24obmV3IFF1ZXN0aW9uKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgIGluZm86IGluZm8sXHJcbiAgICAgICAgICAgICAgICAgICAgYW5zd2VyOiBhbnN3ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tBbnN3ZXI6IGNoZWNrQW5zd2VyLFxyXG4gICAgICAgICAgICAgICAgICAgIGhpbnRzOiBoaW50c1xyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJ5UXVpejtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25UZXh0ID0gZnVuY3Rpb24odHlwZSwgY291bnRyeSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIGhlacOfdCBkaWUgSGF1cHRzdGFkdCB2b24gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJbXCIgKyBjb3VudHJ5LmNhcGl0YWwgKyBcIl0gaXN0IGRpZSBIYXVwdHN0YWR0IHZvbiB3ZWxjaGVtIExhbmRcIlxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIHZpZWxlIE1lbnNjaGVuIGxlYmVuIGluIFtcIiArIGNvdW50cnkubmFtZSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIGdyb8OfIGlzdCBkaWUgRmzDpGNoZSB2b24gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXZWxjaGVzIExhbmQgaGF0IGRpZXNlIEZsYWdnZVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25BbnN3ZXIgPSBmdW5jdGlvbih0eXBlLCBjb3VudHJ5KSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWx0U3BlbGxpbmdzID0gY291bnRyeS5hbHRTcGVsbGluZ3MgIT09IHVuZGVmaW5lZCAmJiBjb3VudHJ5LmFsdFNwZWxsaW5nc1snY2FwaXRhbCddICE9PSB1bmRlZmluZWQgPyBjb3VudHJ5LmFsdFNwZWxsaW5nc1snY2FwaXRhbCddIDogW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkuY2FwaXRhbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWx0U3BlbGxpbmdzOiBhbHRTcGVsbGluZ3NcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhbHRTcGVsbGluZ3MgPSBjb3VudHJ5LmFsdFNwZWxsaW5ncyAhPT0gdW5kZWZpbmVkICYmIGNvdW50cnkuYWx0U3BlbGxpbmdzWyduYW1lJ10gIT09IHVuZGVmaW5lZCA/IGNvdW50cnkuYWx0U3BlbGxpbmdzWyduYW1lJ10gOiBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbHRTcGVsbGluZ3M6IGFsdFNwZWxsaW5nc1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5LnBvcHVsYXRpb25cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5hcmVhXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uSW5wdXQgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ251bWJlci5oaWdoJztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbnVtYmVyLm1lZGl1bSc7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3RleHQuc3RhbmRhcmQnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uVW5pdCA9IGZ1bmN0aW9uKHR5cGUpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAna23Csic7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ0VpbndvaG5lcic7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDaGVja0Fuc3dlckxhbWJkYSA9IGZ1bmN0aW9uKHR5cGUsIGZ1bGxQb2ludHMsIGxhc3RRdWVzdGlvbkJvbnVzKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhbnN3ZXIsIHN1Ym1pdHRlZEFuc3dlciwgaGludHNVc2VkLCBoaW50Q29zdCwgaW5mbykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29ycmVjdCA9IHN1Ym1pdHRlZEFuc3dlciA9PT0gYW5zd2VyLmNvcnJlY3QgfHwgKGFuc3dlci5hbHRTcGVsbGluZ3MgJiYgYW5zd2VyLmFsdFNwZWxsaW5ncy5pbmRleE9mKHN1Ym1pdHRlZEFuc3dlcikgPj0gMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzID0gY29ycmVjdCA/IGZ1bGxQb2ludHMgOiAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaGludHMgYXJlIGFsbG93ZWQgYW5kIGhhdmUgYmVlbiB1c2VkLCBzdWJ0cmFjdCB0aGUgcG9pbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaW50c1VzZWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgLT0gKGhpbnRzVXNlZCAqIGhpbnRDb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYm9udXMgcG9pbnRzIGZvciBsYXN0IHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAqPSBsYXN0UXVlc3Rpb25Cb251cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhbnN3ZXIsIHN1Ym1pdHRlZEFuc3dlciwgaGludHNVc2VkLCBoaW50Q29zdCwgaW5mbykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjYWxjdWxhdGUgcGVyY2VudGFnZSBkaWZmZXJlbmNlIGZyb20gY29ycmVjdCBhbnN3ZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUGVyY2VudGFnZSA9IE1hdGguYWJzKHN1Ym1pdHRlZEFuc3dlciAtIGFuc3dlci5jb3JyZWN0KSAvIGFuc3dlci5jb3JyZWN0ICogMTAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50cztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSA2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA5MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gOSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gODA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDEyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA3MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDYwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxNikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDE4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA0MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMjApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAyNSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDMwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAxMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGhpbnRzIGFyZSBhbGxvd2VkIGFuZCBoYXZlIGJlZW4gdXNlZCwgc3VidHJhY3QgdGhlIHBvaW50c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGludHNVc2VkID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzIC09IChoaW50c1VzZWQgKiBoaW50Q29zdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJvbnVzIHBvaW50cyBmb3IgbGFzdCBxdWVzdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgKj0gbGFzdFF1ZXN0aW9uQm9udXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbkhpbnRzID0gZnVuY3Rpb24odHlwZSwgaGludHNQb3NzaWJsZSwgaGludENvc3QpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0ZMQUdfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4aW11bTogaGludHNQb3NzaWJsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29zdDogaGludENvc3QsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdpdmU6IGZ1bmN0aW9uKGhpbnRzVXNlZCwgYW5zd2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW5zd2VyLmNvcnJlY3Quc3Vic3RyKDAsIGhpbnRzVXNlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1F1aXpSdW5uaW5nKCkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1F1aXpSdW5uaW5nKCkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmdldE51bWJlck9mUXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouY3VycmVudFF1ZXN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBxdWl6Lm5leHRRdWVzdGlvbigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVpeiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmdldFRvdGFsUG9pbnRzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5pdDogaW5pdCxcclxuICAgICAgICAgICAgc2V0Q291bnRyaWVzOiBzZXRDb3VudHJpZXMsXHJcbiAgICAgICAgICAgIGlzUXVpelJ1bm5pbmc6IGlzUXVpelJ1bm5pbmcsXHJcbiAgICAgICAgICAgIGhhc1F1aXpTdGFydGVkOiBoYXNRdWl6U3RhcnRlZCxcclxuICAgICAgICAgICAgaGFzUXVpekVuZGVkOiBoYXNRdWl6RW5kZWQsXHJcbiAgICAgICAgICAgIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcjogZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyLFxyXG4gICAgICAgICAgICBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnM6IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uOiBnZXRDdXJyZW50UXVlc3Rpb24sXHJcbiAgICAgICAgICAgIG5leHRRdWVzdGlvbjogbmV4dFF1ZXN0aW9uLFxyXG4gICAgICAgICAgICBnZXRUb3RhbFBvaW50czogZ2V0VG90YWxQb2ludHNcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1Njb3JlU3J2JywgZnVuY3Rpb24oJGh0dHApIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBGZXRjaGVzIHRoZSBlbnRpcmUgaGlnaHNjb3JlIGxpc3QgaW4gYW4gYXJyYXkgZnJvbSB0aGUgQVBJLlxyXG4gICAgICAgICAqIFJldHVybnMgYSBwcm9taXNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBnZXRIaWdoc2NvcmVMaXN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9zY29yZXMvYWxsJylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihsaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobGlzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBGZXRjaGVzIHRoZSBoaWdoc2NvcmUgb2JqZWN0IGZvciB0aGUgbG9nZ2VkIGluIHVzZXIuXHJcbiAgICAgICAgICogSWYgdGhlIHVzZXIgaGFzIG5vIHJlc3VsdCB5ZXQsIGFuIGVtcHR5IG9iamVjdCBpcyByZXR1cm5lZC5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgZ2V0VXNlckhpZ2hzY29yZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvc2NvcmVzL3VzZXInKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKHNjb3JlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc2NvcmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgaGlnaHNjb3JlIG9iamVjdCBmb3IgdGhlIG92ZXJhbGwgaGlnaHNjb3JlLlxyXG4gICAgICAgICAqIElmIHRoZXJlIGlzIGN1cnJlbnRseSBubyByZXN1bHQgeWV0LCBhbiBlbXB0eSBvYmplY3QgaXMgcmV0dXJuZWQuXHJcbiAgICAgICAgICogUmV0dXJucyBhIHByb21pc2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGdldE92ZXJhbGxIaWdoc2NvcmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3Njb3Jlcy9oaWdoJylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHNjb3JlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFB1dHMgYSBoaWdoc2NvcmUgcmVzdWx0IGZvciB0aGUgbG9nZ2VkIGluIHVzZXIuXHJcbiAgICAgICAgICogQHBhcmFtIHNjb3JlICAgICBOdW1iZXIgd2l0aCB0aGUgYWNoaWV2ZWQgc2NvcmUuXHJcbiAgICAgICAgICogQHJldHVybnMge1Byb21pc2V9XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIHB1dEhpZ2hzY29yZSA9IGZ1bmN0aW9uKHNjb3JlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnB1dCgnL2FwaS9zY29yZXMnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldEhpZ2hzY29yZUxpc3Q6IGdldEhpZ2hzY29yZUxpc3QsXHJcbiAgICAgICAgICAgIGdldFVzZXJIaWdoc2NvcmU6IGdldFVzZXJIaWdoc2NvcmUsXHJcbiAgICAgICAgICAgIGdldE92ZXJhbGxIaWdoc2NvcmU6IGdldE92ZXJhbGxIaWdoc2NvcmUsXHJcbiAgICAgICAgICAgIHB1dEhpZ2hzY29yZTogcHV0SGlnaHNjb3JlXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdVc2VyU3J2JywgZnVuY3Rpb24oJGh0dHAsIEF1dGhUb2tlblNydiwgQXBwQ29uZmlnKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXInKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlckZyb21TdG9yYWdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhUb2tlblNydi5nZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbih0b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGdldFVzZXIoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBubyB0b2tlbiwgd2UgcmVqZWN0IHRoZSBwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gdG9rZW4gaW4gc3RvcmFnZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb24nLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IHJlc3BvbnNlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2F2ZSB0b2tlbiBsb2NhbGx5XHJcbiAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4oc2VsZi50b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFVzZXIoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnRva2VuID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyByZW1vdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVnaXN0ZXIgPSBmdW5jdGlvbihuZXdVc2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIC8vIHNlbGVjdCBhIHJhbmRvbSBjb2xvciBmb3IgdGhlIHVzZXJcclxuICAgICAgICAgICAgICAgIHZhciBjb2xvcnMgPSBBcHBDb25maWdbJ3NldHRpbmdzLnVzZXIuY29sb3JzJ107XHJcbiAgICAgICAgICAgICAgICBuZXdVc2VyLmNvbG9yID0gY29sb3JzW2dldFJhbmRvbUludCgwLCBjb2xvcnMubGVuZ3RoIC0gMSldO1xyXG5cclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvdXNlcicsIG5ld1VzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpbW1lZGlhdGVseSBsb2cgdGhlIHVzZXIgaW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9naW4obmV3VXNlci51c2VybmFtZSwgbmV3VXNlci5wYXNzd29yZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSkgIDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlQmFzaWMgPSBmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnB1dCgnL2FwaS91c2VyL2Jhc2ljJywgdXNlcilcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFVzZXI6IGdldFVzZXIsXHJcbiAgICAgICAgICAgIGdldFVzZXJGcm9tU3RvcmFnZTogZ2V0VXNlckZyb21TdG9yYWdlLFxyXG4gICAgICAgICAgICBsb2dpbjogbG9naW4sXHJcbiAgICAgICAgICAgIGxvZ291dDogbG9nb3V0LFxyXG4gICAgICAgICAgICByZWdpc3RlcjogcmVnaXN0ZXIsXHJcbiAgICAgICAgICAgIHVwZGF0ZUJhc2ljOiB1cGRhdGVCYXNpY1xyXG4gICAgICAgIH07XHJcbiAgICB9KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
