var magellan=angular.module("magellan",["ui.router","ngProgress"],["$httpProvider",function(n){n.interceptors.push("AuthInterceptor")}]);magellan.constant("AppConfig",{"log.info":!0,"log.error":!0,"quiz.questions.number":16}),magellan.controller("AppCtrl",["$scope","$state","UserSrv","CountrySrv","QuizSrv",function(n,t,e,r,o){n.app={config:{title:"Magellan",subtitle:"Test your knowledge about the countries of our world",author:"Michael Stifter"}},e.getUserFromStorage().then(function(t){n.user=t,r.init().then(function(t){n.$broadcast("countries.loaded",t),o.setCountries(t)})})["catch"](function(n){}),n.isProgressBarVisible=function(){return t.is("quiz")},n.$on("app.login",function(e,u){n.user=u,r.init().then(function(t){n.$broadcast("countries.loaded",t),o.setCountries(t)}),t.go("quiz")}),n.$on("app.logout",function(e,r){n.user=null,t.go("home")})}]);var Quiz=function(){var n=[],t=!0;this.addQuestion=function(t){n.push(t)},this.getQuestions=function(){return n},this.isActive=function(){return t}},Question=function(n){n=n||{},this.type=n.type||this.getRandomType(),this.country=n.country||null,this.state=n.state||this.states.NOT_ANSWERED};Question.prototype.states={NOT_ANSWERED:1,CORRECT:2,INCORRECT:3},Question.prototype.types={CAPITAL_OF_COUNTRY:"capital-of-country",COUNTRY_OF_CAPITAL:"country-of-capital",INHABITANTS_OF_COUNTRY:"inhabitants-of-country"},Question.prototype.getRandomType=function(){var n=Object.keys(this.types);return this.types[n[getRandomInt(0,n.length-1)]]};var getRandomInt=function(n,t){return Math.floor(Math.random()*(t-n+1))+n},getStringBetween=function(n,t,e){var r=n.indexOf(t),o=n.indexOf(e);return r>=0&&o>=0&&o>r?n.substr(r+1,o-r-1):null};angular.module("magellan").config(["$locationProvider","$stateProvider","$urlRouterProvider",function(n,t,e){n.html5Mode(!0),e.otherwise("/home"),t.state("home",{url:"/home",templateUrl:"/build/views/partials/home.partial.html"}).state("quiz",{url:"/quiz",templateUrl:"/build/views/partials/quiz.partial.html"}).state("login",{url:"/login",templateUrl:"/build/views/partials/login.partial.html"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}).state("register",{url:"/register",templateUrl:"/build/views/partials/register.partial.html"}).state("about",{url:"/about",templateUrl:"/build/views/partials/about.partial.html"})}]),angular.module("magellan").controller("DropdownCtrl",["$scope",function(n){function t(){u=!u}function e(){u=!0}function r(){u=!1}function o(){return u}var u=!1;n.toggleDropdown=t,n.showDropdown=e,n.hideDropdown=r,n.isDropdownVisible=o,n.handleClickOutside=function(n){console.log("CLICKED OUTSIDE")}}]),angular.module("magellan").controller("LoginCtrl",["$scope","UserSrv","FocusSrv",function(n,t,e){n.login=function(e,r){t.login(e,r).then(function(t){n.$emit("app.login",t.data)})["catch"](function(n){console.error(n)})},e("username")}]),angular.module("magellan").controller("LogoutCtrl",["$scope","UserSrv",function(n,t){t.logout().then(function(){n.$emit("app.logout")})}]),angular.module("magellan").controller("QuizCtrl",["$scope","QuizSrv","LogSrv","FocusSrv","ngProgressFactory",function(n,t,e,r,o){n.progressbar=o.createInstance(),n.progressbar.setParent(document.getElementById("quiz-progress")),n.progressbar.setAbsolute(),n.progressbar.setColor("#336e7b");var u=function(){t.init().then(function(){r("answer")})["catch"](function(n){e.error("Could not start quiz",n)})},i=function(){return t.isQuizRunning()},a=function(){return t.getCurrentQuestionNumber()},s=function(){return t.getNumberOfQuizQuestions()},c=function(){return g(t.getQuestionText(),"question-highlight")+"?"},l=function(){return g(t.getAnswerText(),"answer-highlight-"+t.getAnswerStatus())},f=function(){return t.questionAnswered()},g=function(n,t){return n.replace("[","<span class='"+t+"'>").replace("]","</span>")},p=function(e){e&&(t.submitAnswer(e),n.progressbar.set(100*t.getProgressPercentage()),r("btnNextQuestion"))},f=function(){return t.questionAnswered()},d=function(){n.qu.answer="",t.nextQuestion(),r("answer")},m=function(t){13==t.which&&p(n.qu.answer)};n.startQuiz=u,n.isQuizRunning=i,n.getCurrentQuestionNumber=a,n.getNumberOfQuizQuestions=s,n.getQuestionText=c,n.getAnswerText=l,n.submitAnswer=p,n.questionAnswered=f,n.nextQuestion=d,n.handleKeyPress=m,n.qu={answer:""}}]),angular.module("magellan").filter("renderHtml",["$sce",function(n){return n.trustAsHtml}]),angular.module("magellan").factory("AuthInterceptor",["AuthTokenSrv",function(n){var t=function(t){var e=n.getToken();return e&&(t.headers=t.headers||{},t.headers["X-Auth"]=e),t};return{request:t}}]),angular.module("magellan").factory("AuthTokenSrv",["$window",function(n){var t=n.sessionStorage,e="auth-token",r=function(){return t.getItem(e)},o=function(n){n?t.setItem(e,n):t.removeItem(e)};return{getToken:r,setToken:o}}]),angular.module("magellan").factory("CountrySrv",["$http","IndexedDBSrv","LogSrv",function(n,t,e){var r=null,o="magellan",u="countryStore",i="countries",a="version",s=t.indexedDBAvailable(),c=function(){return l()},l=function(){return s?new Promise(function(n,i){t.createDatabase(o,u).then(p).then(d).then(m).then(f).then(g).then(function(t){r=t.countries,e.info("loaded countries from",t.loadStrategy.toUpperCase()),n(r)})["catch"](function(n){e.error("failed to load countries",n),i(n)})}):v()},f=function(n){return new Promise(function(t,e){var r,o=n.internalVersion,u=n.externalVersion;r=null===o?"api":u>o?"api":"db",n.loadStrategy=r,t(n)})},g=function(n){return new Promise(function(e,r){var s=n.loadStrategy;switch(s){case"api":v().then(function(r){n.countries=r,t.putItem(o,u,{name:i,value:r}),t.putItem(o,u,{name:a,value:n.externalVersion}),e(n)})["catch"](function(n){r(n)});break;case"db":h(n).then(function(n){e(n)})["catch"](function(n){r(n)});break;default:r("Unknown load strategy")}})},p=function(){return new Promise(function(n,t){n({})})},d=function(n){return new Promise(function(e,r){t.retrieveItem(o,u,a).then(function(t){n.internalVersion=t.value,e(n)})["catch"](function(t){n.internalVersion=null,e(n)})})},m=function(n){return w().then(function(t){return n.externalVersion=t,n})},h=function(n){return new Promise(function(e,r){t.retrieveItem(o,u,i).then(function(t){n.countries=t.value,e(n)})["catch"](function(n){e(null)})})},v=function(){return new Promise(function(t,e){n.get("/api/countries").then(function(n){t(n.data)})["catch"](function(n){e(n)})})},w=function(){return new Promise(function(t,e){n.get("/api/countries/version").then(function(n){t(n.data.version||0)})["catch"](function(n){t(0)})})};return{init:c}}]),angular.module("magellan").factory("FocusSrv",["$timeout","$window",function(n,t){return function(e){n(function(){var n=t.document.getElementById(e);n&&n.focus()})}}]),angular.module("magellan").factory("IndexedDBSrv",["$window",function(n){var t="name",e=n.indexedDB||n.webkitIndexedDB||n.msIndexedDB,r=n.IDBKeyRange||n.webkitIDBKeyRange,o=n.IDBTransaction||n.webkitIDBTransaction;o&&(o.READ_WRITE=o.READ_WRITE||"readwrite",o.READ_ONLY=o.READ_ONLY||"readonly");var u=function(){return!!e},i=function(n,r){return new Promise(function(o,u){var i=e.open(n);i.onupgradeneeded=function(n){var e=n.target.result;e.createObjectStore(r,{keyPath:t})},i.onsuccess=function(n){o(n)},i.onerror=function(n){u(n)}})},a=function(n){return new Promise(function(t,r){var o=e.deleteDatabase(n);o.onsuccess=function(n){t(n)},o.onerror=function(n){r(n)}})},s=function(n,t,r){return new Promise(function(u,i){var a=e.open(n);a.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_WRITE),s=a.objectStore(t),c=s.add(r);c.onsuccess=function(n){u(n)},c.onerror=function(n){i(n)}}})},c=function(n,t,r){return new Promise(function(u,i){var a=e.open(n);a.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_WRITE),s=a.objectStore(t),c=s.put(r);c.onsuccess=function(n){u(n)},c.onerror=function(n){i(n)}}})},l=function(n,t,u){return new Promise(function(i,a){var s=null,c=e.open(n);c.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_ONLY),c=a.objectStore(t),l=r.only(u);c.openCursor(l).onsuccess=function(n){var t=n.target.result;t?(s=t.value,t["continue"]()):i(s)}},c.onerror=function(n){a(n)}})},f=function(n,t){return new Promise(function(r,u){var i=[],a=e.open(n);a.onsuccess=function(n){var e=n.target.result,u=e.transaction(t,o.READ_ONLY),a=u.objectStore(t);a.openCursor().onsuccess=function(n){var t=n.target.result;t?(i.push(t.value),t["continue"]()):r(i)}},a.onerror=function(n){u(n)}})};return{createDatabase:i,dropDatabase:a,addItem:s,putItem:c,retrieveItem:l,retrieveItems:f,indexedDBAvailable:u}}]),angular.module("magellan").factory("LogSrv",["AppConfig",function(n){var t=function(){n["log.info"]&&console.log.apply(console,arguments)},e=function(){n["log.error"]&&console.error.apply(console,arguments)};return{info:t,error:e}}]),angular.module("magellan").factory("QuizSrv",["AppConfig","LogSrv",function(n,t){var e=null,r=null,o=null,u=function(){return new Promise(function(t,e){s()||e("Countries not loaded"),null!==r&&r.isActive()===!0&&e("A quiz is currently being played"),r=new Quiz;for(var u=0;u<n["quiz.questions.number"];u++)r.addQuestion(new Question({country:a()}));o=0,t()})},i=function(n){e=n},a=function(){return e[getRandomInt(0,e.length-1)]},s=function(){return null!==e&&e.length>0},c=function(){return null!==r},l=function(){return r.getQuestions()[o]},f=function(){return null!==o?o+1:null},g=function(){return null!==r?r.getQuestions().length:null},p=function(n){var t=l(),e=m(t);t.state=n===e?t.states.CORRECT:t.states.INCORRECT},d=function(){var n=l();switch(n.type){case n.types.CAPITAL_OF_COUNTRY:return"Wie hei√üt die Hauptstadt von ["+n.country.name+"]";case n.types.COUNTRY_OF_CAPITAL:return"["+n.country.capital+"] ist die Hauptstadt von welchem Land";case n.types.INHABITANTS_OF_COUNTRY:return"Wie viele Einwohner hat ["+n.country.name+"]";default:t.error("Unknown question type",n.type)}},m=function(n){if(n&&n.type)switch(n.type){case n.types.CAPITAL_OF_COUNTRY:return n.country.capital;case n.types.COUNTRY_OF_CAPITAL:return n.country.name;case n.types.INHABITANTS_OF_COUNTRY:return n.country.population;default:return t.error("Unknown question type",n.type),null}},h=function(){var n=l(),t=n.state;switch(t){case n.states.CORRECT:return"correct";case n.states.INCORRECT:return"incorrect";default:return null}},v=function(){var n=l();return n.state!==n.states.NOT_ANSWERED},w=function(){var n=l();return"["+m(n)+"]"},y=function(){f()+1<=g()&&o++},A=function(){return f()/g()};return{init:u,setCountries:i,isQuizRunning:c,getCurrentQuestionNumber:f,getNumberOfQuizQuestions:g,getQuestionText:d,getAnswerStatus:h,getAnswerText:w,submitAnswer:p,questionAnswered:v,nextQuestion:y,getProgressPercentage:A}}]),angular.module("magellan").factory("UserSrv",["$http","AuthTokenSrv",function(n,t){var e=this,r=function(){return n.get("/api/user")},o=function(){return new Promise(function(n,e){var o=t.getToken();o?(t.setToken(o),r().then(function(t){n(t.data)})["catch"](function(n){e(n)})):e("No token in storage")})},u=function(o,u){return n.post("/api/session",{username:o,password:u}).then(function(n){return e.token=n.data,t.setToken(e.token),r()})},i=function(){return new Promise(function(n,r){e.token=null,t.setToken(),n()})};return{getUser:r,getUserFromStorage:o,login:u,logout:i}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjcmlwdC5qcyIsIm1vZGVscy5qcyIsInJvdXRlcy5qcyIsImNvbnRyb2xsZXJzL2Ryb3Bkb3duLmN0cmwuanMiLCJjb250cm9sbGVycy9sb2dpbi5jdHJsLmpzIiwiY29udHJvbGxlcnMvbG9nb3V0LmN0cmwuanMiLCJjb250cm9sbGVycy9xdWl6LmN0cmwuanMiLCJmaWx0ZXJzL3JlbmRlckh0bWwuZmlsdGVyLmpzIiwiaW50ZXJjZXB0b3JzL2F1dGguaW50ZXJjZXB0b3IuanMiLCJzZXJ2aWNlcy9hdXRoLXRva2VuLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9jb3VudHJ5LnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9mb2N1cy5zZXJ2aWNlLmpzIiwic2VydmljZXMvaW5kZXhlZC1kYi5zZXJ2aWNlLmpzIiwic2VydmljZXMvbG9nLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9xdWl6LnNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyLnNlcnZpY2UuanMiXSwibmFtZXMiOlsibWFnZWxsYW4iLCJhbmd1bGFyIiwibW9kdWxlIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCJjb25zdGFudCIsImxvZy5pbmZvIiwibG9nLmVycm9yIiwicXVpei5xdWVzdGlvbnMubnVtYmVyIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRzdGF0ZSIsIlVzZXJTcnYiLCJDb3VudHJ5U3J2IiwiUXVpelNydiIsImFwcCIsImNvbmZpZyIsInRpdGxlIiwic3VidGl0bGUiLCJhdXRob3IiLCJnZXRVc2VyRnJvbVN0b3JhZ2UiLCJ0aGVuIiwidXNlciIsImluaXQiLCJjb3VudHJpZXMiLCIkYnJvYWRjYXN0Iiwic2V0Q291bnRyaWVzIiwiZXJyIiwiaXNQcm9ncmVzc0JhclZpc2libGUiLCJpcyIsIiRvbiIsImV2ZW50IiwiZGF0YSIsImdvIiwiUXVpeiIsInF1ZXN0aW9ucyIsImFjdGl2ZSIsInRoaXMiLCJhZGRRdWVzdGlvbiIsInF1ZXN0aW9uIiwiZ2V0UXVlc3Rpb25zIiwiaXNBY3RpdmUiLCJRdWVzdGlvbiIsIm9wdGlvbnMiLCJ0eXBlIiwiZ2V0UmFuZG9tVHlwZSIsImNvdW50cnkiLCJzdGF0ZSIsInN0YXRlcyIsIk5PVF9BTlNXRVJFRCIsInByb3RvdHlwZSIsIkNPUlJFQ1QiLCJJTkNPUlJFQ1QiLCJ0eXBlcyIsIkNBUElUQUxfT0ZfQ09VTlRSWSIsIkNPVU5UUllfT0ZfQ0FQSVRBTCIsIklOSEFCSVRBTlRTX09GX0NPVU5UUlkiLCJPYmplY3QiLCJrZXlzIiwiZ2V0UmFuZG9tSW50IiwibGVuZ3RoIiwibWluIiwibWF4IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZ2V0U3RyaW5nQmV0d2VlbiIsInRleHQiLCJmaXJzdFN0cmluZyIsInNlY29uZFN0cmluZyIsImZpcnN0UG9zIiwiaW5kZXhPZiIsInNlY29uZFBvcyIsInN1YnN0ciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJvdGhlcndpc2UiLCJ1cmwiLCJ0ZW1wbGF0ZVVybCIsInRvZ2dsZURyb3Bkb3duIiwidmlzaWJsZSIsInNob3dEcm9wZG93biIsImhpZGVEcm9wZG93biIsImlzRHJvcGRvd25WaXNpYmxlIiwiaGFuZGxlQ2xpY2tPdXRzaWRlIiwiY29uc29sZSIsImxvZyIsIkZvY3VzU3J2IiwibG9naW4iLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwicmVzcG9uc2UiLCIkZW1pdCIsImVycm9yIiwibG9nb3V0IiwiTG9nU3J2IiwibmdQcm9ncmVzc0ZhY3RvcnkiLCJwcm9ncmVzc2JhciIsImNyZWF0ZUluc3RhbmNlIiwic2V0UGFyZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInNldEFic29sdXRlIiwic2V0Q29sb3IiLCJzdGFydFF1aXoiLCJpc1F1aXpSdW5uaW5nIiwiZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyIiwiZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zIiwiZ2V0UXVlc3Rpb25UZXh0IiwicmVuZGVyUXVlc3Rpb24iLCJnZXRBbnN3ZXJUZXh0IiwiZ2V0QW5zd2VyU3RhdHVzIiwicXVlc3Rpb25BbnN3ZXJlZCIsImNsYXNzTmFtZSIsInJlcGxhY2UiLCJzdWJtaXRBbnN3ZXIiLCJhbnN3ZXIiLCJzZXQiLCJnZXRQcm9ncmVzc1BlcmNlbnRhZ2UiLCJuZXh0UXVlc3Rpb24iLCJxdSIsImhhbmRsZUtleVByZXNzIiwia2V5RXZlbnQiLCJ3aGljaCIsImZpbHRlciIsIiRzY2UiLCJ0cnVzdEFzSHRtbCIsImZhY3RvcnkiLCJBdXRoVG9rZW5TcnYiLCJhZGRUb2tlbiIsInRva2VuIiwiZ2V0VG9rZW4iLCJoZWFkZXJzIiwicmVxdWVzdCIsIiR3aW5kb3ciLCJzdG9yZSIsInNlc3Npb25TdG9yYWdlIiwia2V5IiwiZ2V0SXRlbSIsInNldFRva2VuIiwic2V0SXRlbSIsInJlbW92ZUl0ZW0iLCIkaHR0cCIsIkluZGV4ZWREQlNydiIsImRhdGFiYXNlIiwia2V5Q291bnRyaWVzIiwia2V5VmVyc2lvbiIsImluZGV4ZWREQkF2YWlsYWJsZSIsImxvYWRDb3VudHJpZXMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImNyZWF0ZURhdGFiYXNlIiwiZ2V0RW1wdHlPYmplY3QiLCJnZXRJbnRlcm5hbFZlcnNpb24iLCJnZXRFeHRlcm5hbFZlcnNpb24iLCJkZXRlcm1pbmVMb2FkU3RyYXRlZ3kiLCJsb2FkRGF0YSIsIm9iaiIsImluZm8iLCJ0b1VwcGVyQ2FzZSIsImdldENvdW50cmllc0Zyb21BUEkiLCJzdHJhdGVneSIsImludGVybmFsVmVyc2lvbiIsImV4dGVybmFsVmVyc2lvbiIsInB1dEl0ZW0iLCJuYW1lIiwidmFsdWUiLCJnZXRDb3VudHJpZXNGcm9tREIiLCJfb2JqIiwicmV0cmlldmVJdGVtIiwiaXRlbSIsImdldFZlcnNpb25Gcm9tQVBJIiwidmVyc2lvbiIsImdldCIsIiR0aW1lb3V0IiwiaWQiLCJlbGVtZW50IiwiZm9jdXMiLCJrZXlQYXRoIiwiaW5kZXhlZERCIiwid2Via2l0SW5kZXhlZERCIiwibXNJbmRleGVkREIiLCJJREJLZXlSYW5nZSIsIndlYmtpdElEQktleVJhbmdlIiwiSURCVHJhbnNhY3Rpb24iLCJ3ZWJraXRJREJUcmFuc2FjdGlvbiIsIlJFQURfV1JJVEUiLCJSRUFEX09OTFkiLCJkYk5hbWUiLCJzdG9yZU5hbWUiLCJvcGVuIiwib251cGdyYWRlbmVlZGVkIiwiZSIsImlkYiIsInRhcmdldCIsInJlc3VsdCIsImNyZWF0ZU9iamVjdFN0b3JlIiwib25zdWNjZXNzIiwib25lcnJvciIsImRyb3BEYXRhYmFzZSIsImRlbGV0ZURhdGFiYXNlIiwiYWRkSXRlbSIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJyZXF1ZXN0QWRkIiwiYWRkIiwicHV0IiwiaXRlbU5hbWUiLCJyYW5nZSIsIm9ubHkiLCJvcGVuQ3Vyc29yIiwiY3Vyc29yIiwicmV0cmlldmVJdGVtcyIsIml0ZW1zIiwiQXBwQ29uZmlnIiwibG9nSW5mbyIsImFwcGx5IiwiYXJndW1lbnRzIiwibG9nRXJyb3IiLCJxdWl6IiwiY3VycmVudFF1ZXN0aW9uTm8iLCJjb3VudHJpZXNMb2FkZWQiLCJpIiwiZ2V0UmFuZG9tQ291bnRyeSIsIl9jb3VudHJpZXMiLCJnZXRDdXJyZW50UXVlc3Rpb24iLCJjb3JyZWN0QW5zd2VyIiwiZ2V0QW5zd2VyVG9RdWVzdGlvbiIsImNhcGl0YWwiLCJwb3B1bGF0aW9uIiwic2VsZiIsImdldFVzZXIiLCJwb3N0Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxVQUFBQyxRQUFBQyxPQUFBLFlBQ0EsWUFDQSxlQ0NJLGdCREFKLFNBQUFDLEdBQ0FBLEVBQUFDLGFBQUFDLEtBQUEscUJBSUFMLFVBQUFNLFNBQUEsYUFDQUMsWUFBQSxFQUNBQyxhQUFBLEVBRUFDLHdCQUFBLEtBR0FULFNBQUFVLFdBQUEsV0FBQSxTQUFBLFNBQUEsVUFBQSxhQUFBLFVBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FFQUosRUFBQUssS0FDQUMsUUFD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LGNBR0E1SixFQUFBLFdBQ0EsTUFBQSxJQUFBbUksU0FBQSxTQUFBQyxFQUFBQyxHQUNBLEdBQUFyQixHQUFBRixFQUFBRyxVQUVBRCxJQUNBRixFQUFBVyxTQUFBVCxHQUVBc0csSUFDQXJOLEtBQUEsU0FBQXdFLEdBQ0EyRCxFQUFBM0QsRUFBQTdELFFBRkEwTSxTQUlBLFNBQUEvTSxHQUNBOEgsRUFBQTlILE1BSUE4SCxFQUFBLDBCQUtBL0QsRUFBQSxTQUFBQyxFQUFBQyxHQUNBLE1BQUFvRCxHQUFBMkYsS0FBQSxnQkFDQWhKLFNBQUFBLEVBQ0FDLFNBQUFBLElBQ0F2RSxLQUFBLFNBQUF3RSxHQU1BLE1BTEE0SSxHQUFBckcsTUFBQXZDLEVBQUE3RCxLQUdBa0csRUFBQVcsU0FBQTRGLEVBQUFyRyxPQUVBc0csT0FJQTFJLEVBQUEsV0FDQSxNQUFBLElBQUF1RCxTQUFBLFNBQUFDLEVBQUFDLEdBQ0FnRixFQUFBckcsTUFBQSxLQUdBRixFQUFBVyxXQUVBVyxNQUlBLFFBQ0FrRixRQUFBQSxFQUNBdE4sbUJBQUFBLEVBQ0FzRSxNQUFBQSxFQUNBTSxPQUFBQSIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbWFnZWxsYW4gPSBhbmd1bGFyLm1vZHVsZShcIm1hZ2VsbGFuXCIsIFtcclxuICAgICd1aS5yb3V0ZXInLFxyXG4gICAgJ25nUHJvZ3Jlc3MnXHJcbl0sIGZ1bmN0aW9uIGNvbmZpZygkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBdXRoSW50ZXJjZXB0b3InKTtcclxufSk7XHJcblxyXG4vLyBkZWZpbmUgYXBwbGljYXRpb24gY29uc3RhbnRzXHJcbm1hZ2VsbGFuLmNvbnN0YW50KFwiQXBwQ29uZmlnXCIsIHtcclxuICAgIFwibG9nLmluZm9cIjogdHJ1ZSxcclxuICAgIFwibG9nLmVycm9yXCI6IHRydWUsXHJcblxyXG4gICAgXCJxdWl6LnF1ZXN0aW9ucy5udW1iZXJcIjogMTZcclxufSk7XHJcblxyXG5tYWdlbGxhbi5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgVXNlclNydiwgQ291bnRyeVNydiwgUXVpelNydikge1xyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGNvbmZpZyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS5hcHAgPSB7XHJcbiAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgIHRpdGxlOiBcIk1hZ2VsbGFuXCIsXHJcbiAgICAgICAgICAgIHN1YnRpdGxlOiBcIlRlc3QgeW91ciBrbm93bGVkZ2UgYWJvdXQgdGhlIGNvdW50cmllcyBvZiBvdXIgd29ybGRcIixcclxuICAgICAgICAgICAgYXV0aG9yOiBcIk1pY2hhZWwgU3RpZnRlclwiXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgaW5pdGlhbGl6YXRpb24gLS0tLS0tLS0tLS0tXHJcbiAgICBVc2VyU3J2LmdldFVzZXJGcm9tU3RvcmFnZSgpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICAgICAkc2NvcGUudXNlciA9IHVzZXI7XHJcblxyXG4gICAgICAgICAgICAvLyBpbml0IGNvdW50cnkgc2VydmljZVxyXG4gICAgICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2NvdW50cmllcy5sb2FkZWQnLCBjb3VudHJpZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgIFF1aXpTcnYuc2V0Q291bnRyaWVzKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgLy8gdGhlIG9ubHkgZXJyb3IgdGhhdCBjYW4gb2NjdXIgaXMgdGhhdCB0aGVyZSBpcyBubyB0b2tlbiBpbiBzdG9yYWdlLCB3ZSBkbyBub3QgbmVlZCB0byByZWFjdCB0byB0aGF0XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLmlzUHJvZ3Jlc3NCYXJWaXNpYmxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuICRzdGF0ZS5pcygncXVpeicpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBFdmVudCBoYW5kbGluZyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS4kb24oJ2FwcC5sb2dpbicsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gc3RvcmUgdXNlciBvYmplY3QgaW4gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IGRhdGE7XHJcblxyXG4gICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgQ291bnRyeVNydi5pbml0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGNvdW50cmllcyBpbiBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgICAgIFF1aXpTcnYuc2V0Q291bnRyaWVzKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBnbyB0byBxdWl6IHBhZ2VcclxuICAgICAgICAkc3RhdGUuZ28oJ3F1aXonKTtcclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS4kb24oJ2FwcC5sb2dvdXQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHJlbW92ZSB1c2VyIG9iamVjdCBmcm9tIHNjb3BlXHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBnbyB0byBob21lIHBhZ2VcclxuICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgIH0pO1xyXG59KTsiLCJ2YXIgbWFnZWxsYW4gPSBhbmd1bGFyLm1vZHVsZShcIm1hZ2VsbGFuXCIsIFtcclxuICAgICd1aS5yb3V0ZXInLFxyXG4gICAgJ25nUHJvZ3Jlc3MnXHJcbl0sIFtcIiRodHRwUHJvdmlkZXJcIiwgZnVuY3Rpb24gY29uZmlnKCRodHRwUHJvdmlkZXIpIHtcclxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG59XSk7XHJcblxyXG4vLyBkZWZpbmUgYXBwbGljYXRpb24gY29uc3RhbnRzXHJcbm1hZ2VsbGFuLmNvbnN0YW50KFwiQXBwQ29uZmlnXCIsIHtcclxuICAgIFwibG9nLmluZm9cIjogdHJ1ZSxcclxuICAgIFwibG9nLmVycm9yXCI6IHRydWUsXHJcblxyXG4gICAgXCJxdWl6LnF1ZXN0aW9ucy5udW1iZXJcIjogMTZcclxufSk7XHJcblxyXG5tYWdlbGxhbi5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBbXCIkc2NvcGVcIiwgXCIkc3RhdGVcIiwgXCJVc2VyU3J2XCIsIFwiQ291bnRyeVNydlwiLCBcIlF1aXpTcnZcIiwgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIFVzZXJTcnYsIENvdW50cnlTcnYsIFF1aXpTcnYpIHtcclxuICAgIC8vIC0tLS0tLS0tLS0tIEFwcCBjb25maWcgLS0tLS0tLS0tLS0tXHJcbiAgICAkc2NvcGUuYXBwID0ge1xyXG4gICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICB0aXRsZTogXCJNYWdlbGxhblwiLFxyXG4gICAgICAgICAgICBzdWJ0aXRsZTogXCJUZXN0IHlvdXIga25vd2xlZGdlIGFib3V0IHRoZSBjb3VudHJpZXMgb2Ygb3VyIHdvcmxkXCIsXHJcbiAgICAgICAgICAgIGF1dGhvcjogXCJNaWNoYWVsIFN0aWZ0ZXJcIlxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGluaXRpYWxpemF0aW9uIC0tLS0tLS0tLS0tLVxyXG4gICAgVXNlclNydi5nZXRVc2VyRnJvbVN0b3JhZ2UoKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgLy8gc3RvcmUgdXNlciBvYmplY3QgaW4gc2NvcGVcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xyXG5cclxuICAgICAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICAgICAgQ291bnRyeVNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGNvdW50cmllcyBpbiBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICBRdWl6U3J2LnNldENvdW50cmllcyhjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgIC8vIHRoZSBvbmx5IGVycm9yIHRoYXQgY2FuIG9jY3VyIGlzIHRoYXQgdGhlcmUgaXMgbm8gdG9rZW4gaW4gc3RvcmFnZSwgd2UgZG8gbm90IG5lZWQgdG8gcmVhY3QgdG8gdGhhdFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICRzY29wZS5pc1Byb2dyZXNzQmFyVmlzaWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiAkc3RhdGUuaXMoJ3F1aXonKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gRXZlbnQgaGFuZGxpbmcgLS0tLS0tLS0tLS0tXHJcbiAgICAkc2NvcGUuJG9uKCdhcHAubG9naW4nLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHN0b3JlIHVzZXIgb2JqZWN0IGluIHNjb3BlXHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBkYXRhO1xyXG5cclxuICAgICAgICAvLyBpbml0IGNvdW50cnkgc2VydmljZVxyXG4gICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2NvdW50cmllcy5sb2FkZWQnLCBjb3VudHJpZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICBRdWl6U3J2LnNldENvdW50cmllcyhjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gZ28gdG8gcXVpeiBwYWdlXHJcbiAgICAgICAgJHN0YXRlLmdvKCdxdWl6Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuJG9uKCdhcHAubG9nb3V0JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyByZW1vdmUgdXNlciBvYmplY3QgZnJvbSBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gZ28gdG8gaG9tZSBwYWdlXHJcbiAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICB9KTtcclxufV0pO1xuLy8gb3duIGNsYXNzZXMgYW5kIGZ1bmN0aW9uc1xyXG5cclxuLy8gLS0tLS0tLS0tLSBRVUlaIC0tLS0tLS0tLS1cclxudmFyIFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgIC8vIHF1ZXN0aW9ucyBhcnJheVxyXG4gICAgdmFyIHF1ZXN0aW9ucyA9IFtdO1xyXG5cclxuICAgIC8vIGZsYWcgaW5kaWNhdGluZyBpZiBxdWl6IGlzIGN1cnJlbnRseSBhY3RpdmVcclxuICAgIHZhciBhY3RpdmUgPSB0cnVlO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHF1ZXN0aW9uIHRvIHRoZSBxdWVzdGlvbnMgYXJyYXlcclxuICAgICAqIEBwYXJhbSBxdWVzdGlvblxyXG4gICAgICovXHJcbiAgICB0aGlzLmFkZFF1ZXN0aW9uID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcclxuICAgICAgICBxdWVzdGlvbnMucHVzaChxdWVzdGlvbik7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0UXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9ucztcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5pc0FjdGl2ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBhY3RpdmU7XHJcbiAgICB9O1xyXG59O1xyXG5cclxuLy8gLS0tLS0tLS0tLSBRVUVTVElPTiAtLS0tLS0tLS0tXHJcbnZhciBRdWVzdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG5cclxuICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZSB8fCB0aGlzLmdldFJhbmRvbVR5cGUoKTtcclxuICAgIHRoaXMuY291bnRyeSA9IG9wdGlvbnMuY291bnRyeSB8fCBudWxsO1xyXG4gICAgdGhpcy5zdGF0ZSA9IG9wdGlvbnMuc3RhdGUgfHwgdGhpcy5zdGF0ZXMuTk9UX0FOU1dFUkVEO1xyXG59O1xyXG5cclxuUXVlc3Rpb24ucHJvdG90eXBlLnN0YXRlcyA9IHtcclxuICAgIFwiTk9UX0FOU1dFUkVEXCI6IDEsXHJcbiAgICBcIkNPUlJFQ1RcIjogMixcclxuICAgIFwiSU5DT1JSRUNUXCI6IDNcclxufTtcclxuXHJcblF1ZXN0aW9uLnByb3RvdHlwZS50eXBlcyA9IHtcclxuICAgIFwiQ0FQSVRBTF9PRl9DT1VOVFJZXCI6IFwiY2FwaXRhbC1vZi1jb3VudHJ5XCIsXHJcbiAgICBcIkNPVU5UUllfT0ZfQ0FQSVRBTFwiOiBcImNvdW50cnktb2YtY2FwaXRhbFwiLFxyXG4gICAgXCJJTkhBQklUQU5UU19PRl9DT1VOVFJZXCI6IFwiaW5oYWJpdGFudHMtb2YtY291bnRyeVwiXHJcbn07XHJcblxyXG5RdWVzdGlvbi5wcm90b3R5cGUuZ2V0UmFuZG9tVHlwZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHR5cGVzID0gT2JqZWN0LmtleXModGhpcy50eXBlcyk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMudHlwZXNbdHlwZXNbZ2V0UmFuZG9tSW50KDAsIHR5cGVzLmxlbmd0aCAtIDEpXV07XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyBhIHJhbmRvbSBpbnRlZ2VyIGJldHdlZW4gbWluIChpbmNsdXNpdmUpIGFuZCBtYXggKGluY2x1c2l2ZSlcclxuICogVXNpbmcgTWF0aC5yb3VuZCgpIHdpbGwgZ2l2ZSB5b3UgYSBub24tdW5pZm9ybSBkaXN0cmlidXRpb24hXHJcbiAqL1xyXG52YXIgZ2V0UmFuZG9tSW50ID0gZnVuY3Rpb24obWluLCBtYXgpIHtcclxuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgdGhlIHRleHQgYmV0d2VlbiB0d28gZGVsaW1pdGluZyB0ZXh0IG9jY3VycmVuY2VzXHJcbiAqL1xyXG52YXIgZ2V0U3RyaW5nQmV0d2VlbiA9IGZ1bmN0aW9uKHRleHQsIGZpcnN0U3RyaW5nLCBzZWNvbmRTdHJpbmcpIHtcclxuICAgIHZhciBmaXJzdFBvcyA9IHRleHQuaW5kZXhPZihmaXJzdFN0cmluZyk7XHJcbiAgICB2YXIgc2Vjb25kUG9zID0gdGV4dC5pbmRleE9mKHNlY29uZFN0cmluZyk7XHJcblxyXG4gICAgaWYgKGZpcnN0UG9zID49IDAgJiYgc2Vjb25kUG9zID49IDAgJiYgc2Vjb25kUG9zID4gZmlyc3RQb3MpIHtcclxuICAgICAgICByZXR1cm4gdGV4dC5zdWJzdHIoZmlyc3RQb3MgKyAxLCBzZWNvbmRQb3MgLSBmaXJzdFBvcyAtIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG59O1xyXG5cbmFuZ3VsYXIubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29uZmlnKFtcIiRsb2NhdGlvblByb3ZpZGVyXCIsIFwiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgZnVuY3Rpb24oJGxvY2F0aW9uUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgICAgICAvLyBlbmFibGUgSFRNTDUgcHVzaHN0YXRlXHJcbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG5cclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvaG9tZScpO1xyXG5cclxuICAgICAgICAkc3RhdGVQcm92aWRlclxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hvbWUnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvaG9tZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9ob21lLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdxdWl6Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3F1aXonLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvcXVpei5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvbG9naW4ucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ291dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9sb2dvdXQnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ291dEN0cmwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncmVnaXN0ZXInLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvcmVnaXN0ZXInLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvcmVnaXN0ZXIucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2Fib3V0Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2Fib3V0JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2Fib3V0LnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignRHJvcGRvd25DdHJsJywgW1wiJHNjb3BlXCIsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG4gICAgICAgIHZhciB2aXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICRzY29wZS50b2dnbGVEcm9wZG93biA9IHRvZ2dsZURyb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5zaG93RHJvcGRvd24gPSBzaG93RHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmhpZGVEcm9wZG93biA9IGhpZGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuaXNEcm9wZG93blZpc2libGUgPSBpc0Ryb3Bkb3duVmlzaWJsZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmhhbmRsZUNsaWNrT3V0c2lkZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ0xJQ0tFRCBPVVRTSURFXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSAhdmlzaWJsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dEcm9wZG93bigpIHtcclxuICAgICAgICAgICAgdmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoaWRlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzRHJvcGRvd25WaXNpYmxlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmlzaWJsZTtcclxuICAgICAgICB9XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTG9naW5DdHJsJywgW1wiJHNjb3BlXCIsIFwiVXNlclNydlwiLCBcIkZvY3VzU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgVXNlclNydi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ2luIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBub3RpZnkgdXNlciBhYm91dCBlcnJvciBpbiBsb2dpbiBwcm9jZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCd1c2VybmFtZScpO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ291dEN0cmwnLCBbXCIkc2NvcGVcIiwgXCJVc2VyU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydikge1xyXG4gICAgICAgIFVzZXJTcnYubG9nb3V0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dvdXQgZXZlbnRcclxuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ291dCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6Q3RybCcsIFtcIiRzY29wZVwiLCBcIlF1aXpTcnZcIiwgXCJMb2dTcnZcIiwgXCJGb2N1c1NydlwiLCBcIm5nUHJvZ3Jlc3NGYWN0b3J5XCIsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2LCBGb2N1c1NydiwgbmdQcm9ncmVzc0ZhY3RvcnkpIHtcclxuXHJcbiAgICAgICAgLy8gUHJvZ3Jlc3MgYmFyIGluaXRpYWxpemF0aW9uXHJcbiAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyID0gbmdQcm9ncmVzc0ZhY3RvcnkuY3JlYXRlSW5zdGFuY2UoKTtcclxuICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0UGFyZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXByb2dyZXNzJykpO1xyXG4gICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRBYnNvbHV0ZSgpO1xyXG4gICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRDb2xvcihcIiMzMzZlN2JcIik7XHJcblxyXG4gICAgICAgIHZhciBzdGFydFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIEZvY3VzU3J2KCdhbnN3ZXInKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiQ291bGQgbm90IHN0YXJ0IHF1aXpcIiwgZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyUXVlc3Rpb24oUXVpelNydi5nZXRRdWVzdGlvblRleHQoKSwgXCJxdWVzdGlvbi1oaWdobGlnaHRcIikgKyBcIj9cIjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QW5zd2VyVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyUXVlc3Rpb24oUXVpelNydi5nZXRBbnN3ZXJUZXh0KCksIFwiYW5zd2VyLWhpZ2hsaWdodC1cIiArIFF1aXpTcnYuZ2V0QW5zd2VyU3RhdHVzKCkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbkFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LnF1ZXN0aW9uQW5zd2VyZWQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciByZW5kZXJRdWVzdGlvbiA9IGZ1bmN0aW9uKHRleHQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dFxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJbXCIsIFwiPHNwYW4gY2xhc3M9J1wiICsgY2xhc3NOYW1lICsgXCInPlwiKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJdXCIsIFwiPC9zcGFuPlwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc3VibWl0QW5zd2VyID0gZnVuY3Rpb24oYW5zd2VyKSB7XHJcbiAgICAgICAgICAgIGlmIChhbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgIFF1aXpTcnYuc3VibWl0QW5zd2VyKGFuc3dlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IHByb2dyZXNzIGJhclxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldChRdWl6U3J2LmdldFByb2dyZXNzUGVyY2VudGFnZSgpICogMTAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgZm9jdXMgdG8gbmV4dCBxdWVzdGlvbiBidXR0b25cclxuICAgICAgICAgICAgICAgIEZvY3VzU3J2KCdidG5OZXh0UXVlc3Rpb24nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbkFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LnF1ZXN0aW9uQW5zd2VyZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5xdS5hbnN3ZXIgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgUXVpelNydi5uZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIEZvY3VzU3J2KCdhbnN3ZXInKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZGxlS2V5UHJlc3MgPSBmdW5jdGlvbihrZXlFdmVudCkge1xyXG4gICAgICAgICAgICBpZiAoa2V5RXZlbnQud2hpY2ggPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHN1Ym1pdEFuc3dlcigkc2NvcGUucXUuYW5zd2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zdGFydFF1aXogPSBzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmlzUXVpelJ1bm5pbmcgPSBpc1F1aXpSdW5uaW5nO1xyXG4gICAgICAgICRzY29wZS5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI7XHJcbiAgICAgICAgJHNjb3BlLmdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucztcclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb25UZXh0ID0gZ2V0UXVlc3Rpb25UZXh0O1xyXG4gICAgICAgICRzY29wZS5nZXRBbnN3ZXJUZXh0ID0gZ2V0QW5zd2VyVGV4dDtcclxuICAgICAgICAkc2NvcGUuc3VibWl0QW5zd2VyID0gc3VibWl0QW5zd2VyO1xyXG4gICAgICAgICRzY29wZS5xdWVzdGlvbkFuc3dlcmVkID0gcXVlc3Rpb25BbnN3ZXJlZDtcclxuICAgICAgICAkc2NvcGUubmV4dFF1ZXN0aW9uID0gbmV4dFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5oYW5kbGVLZXlQcmVzcyA9IGhhbmRsZUtleVByZXNzO1xyXG5cclxuICAgICAgICAkc2NvcGUucXUgPSB7XHJcbiAgICAgICAgICAgIGFuc3dlcjogXCJcIlxyXG4gICAgICAgIH07XHJcblxyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZpbHRlcigncmVuZGVySHRtbCcsIFtcIiRzY2VcIiwgZnVuY3Rpb24oJHNjZSkge1xyXG4gICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIFtcIkF1dGhUb2tlblNydlwiLCBmdW5jdGlvbihBdXRoVG9rZW5TcnYpIHtcclxuICAgICAgICB2YXIgYWRkVG9rZW4gPSBmdW5jdGlvbihjb25maWcpIHtcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFRva2VuU3J2LmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snWC1BdXRoJ10gPSB0b2tlbjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0OiBhZGRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFRva2VuU3J2JywgW1wiJHdpbmRvd1wiLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZTtcclxuICAgICAgICB2YXIga2V5ID0gJ2F1dGgtdG9rZW4nO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0VG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnNldEl0ZW0oa2V5LCB0b2tlbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRUb2tlbjogZ2V0VG9rZW4sXHJcbiAgICAgICAgICAgIHNldFRva2VuOiBzZXRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQ291bnRyeVNydicsIFtcIiRodHRwXCIsIFwiSW5kZXhlZERCU3J2XCIsIFwiTG9nU3J2XCIsIGZ1bmN0aW9uKCRodHRwLCBJbmRleGVkREJTcnYsIExvZ1Nydikge1xyXG4gICAgICAgIC8vIENvdW50cmllcyBhcnJheVxyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBJbmRleGVkREJcclxuICAgICAgICB2YXIgZGF0YWJhc2UgPSAnbWFnZWxsYW4nO1xyXG4gICAgICAgIHZhciBzdG9yZSA9ICdjb3VudHJ5U3RvcmUnO1xyXG4gICAgICAgIHZhciBrZXlDb3VudHJpZXMgPSAnY291bnRyaWVzJztcclxuICAgICAgICB2YXIga2V5VmVyc2lvbiA9ICd2ZXJzaW9uJztcclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IEluZGV4ZWREQlNydi5pbmRleGVkREJBdmFpbGFibGUoKTtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvYWRDb3VudHJpZXMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9hZENvdW50cmllcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBjaGVjayBpZiBpbmRleGVkREIgaXMgYXZhaWxhYmxlXHJcbiAgICAgICAgICAgIGlmIChpbmRleGVkREJBdmFpbGFibGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgZGF0YWJhc2UgZXhpc3RzXHJcbiAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LmNyZWF0ZURhdGFiYXNlKGRhdGFiYXNlLCBzdG9yZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0RW1wdHlPYmplY3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEludGVybmFsVmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0RXh0ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihkZXRlcm1pbmVMb2FkU3RyYXRlZ3kpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGxvYWREYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllcyA9IG9ialsnY291bnRyaWVzJ107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmluZm8oXCJsb2FkZWQgY291bnRyaWVzIGZyb21cIiwgb2JqWydsb2FkU3RyYXRlZ3knXS50b1VwcGVyQ2FzZSgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihcImZhaWxlZCB0byBsb2FkIGNvdW50cmllc1wiLCBlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgbm90LCB3ZSBhbHdheXMgdHJ5IHRvIGRvd25sb2FkIGl0IGZyb20gdGhlIGNvdW50cnkgQVBJIGVuZHBvaW50XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q291bnRyaWVzRnJvbUFQSSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRldGVybWluZUxvYWRTdHJhdGVneSA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyYXRlZ3k7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGludGVybmFsVmVyc2lvbiA9IG9ialtcImludGVybmFsVmVyc2lvblwiXTtcclxuICAgICAgICAgICAgICAgIHZhciBleHRlcm5hbFZlcnNpb24gPSBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGludGVybmFsVmVyc2lvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2FwaSc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV4dGVybmFsVmVyc2lvbiA+IGludGVybmFsVmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2FwaSc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2RiJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBvYmpbJ2xvYWRTdHJhdGVneSddID0gc3RyYXRlZ3k7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9hZERhdGEgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0cmF0ZWd5ID0gb2JqWydsb2FkU3RyYXRlZ3knXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXBpJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q291bnRyaWVzRnJvbUFQSSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJjb3VudHJpZXNcIl0gPSBjb3VudHJpZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0b3JlIGNvdW50cmllcyBhbmQgdmVyc2lvbiBudW1iZXIgaW4gZGF0YWJhc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucHV0SXRlbShkYXRhYmFzZSwgc3RvcmUsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToga2V5Q291bnRyaWVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogIGNvdW50cmllc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucHV0SXRlbShkYXRhYmFzZSwgc3RvcmUsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToga2V5VmVyc2lvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9ialtcImV4dGVybmFsVmVyc2lvblwiXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGInOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDb3VudHJpZXNGcm9tREIob2JqKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oX29iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoX29iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdVbmtub3duIGxvYWQgc3RyYXRlZ3knKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEVtcHR5T2JqZWN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoe30pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0SW50ZXJuYWxWZXJzaW9uID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5yZXRyaWV2ZUl0ZW0oZGF0YWJhc2UsIHN0b3JlLCBrZXlWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdID0gaXRlbS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEV4dGVybmFsVmVyc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0VmVyc2lvbkZyb21BUEkoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialtcImV4dGVybmFsVmVyc2lvblwiXSA9IHZlcnNpb247XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzRnJvbURCID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5yZXRyaWV2ZUl0ZW0oZGF0YWJhc2UsIHN0b3JlLCBrZXlDb3VudHJpZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJjb3VudHJpZXNcIl0gPSBpdGVtLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNGcm9tQVBJID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9jb3VudHJpZXMnKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VmVyc2lvbkZyb21BUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdW50cmllcy92ZXJzaW9uJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEudmVyc2lvbiB8fCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5pdDogaW5pdFxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnRm9jdXNTcnYnLCBbXCIkdGltZW91dFwiLCBcIiR3aW5kb3dcIiwgZnVuY3Rpb24oJHRpbWVvdXQsICR3aW5kb3cpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaWQpIHtcclxuICAgICAgICAgICAgLy8gdGltZW91dCBtYWtlcyBzdXJlIHRoYXQgaXMgaW52b2tlZCBhZnRlciBhbnkgb3RoZXIgZXZlbnQgaGFzIGJlZW4gdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAvLyBlLmcuIGNsaWNrIGV2ZW50cyB0aGF0IG5lZWQgdG8gcnVuIGJlZm9yZSB0aGUgZm9jdXMgb3JcclxuICAgICAgICAgICAgLy8gaW5wdXRzIGVsZW1lbnRzIHRoYXQgYXJlIGluIGEgZGlzYWJsZWQgc3RhdGUgYnV0IGFyZSBlbmFibGVkIHdoZW4gdGhvc2UgZXZlbnRzXHJcbiAgICAgICAgICAgIC8vIGFyZSB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdJbmRleGVkREJTcnYnLCBbXCIkd2luZG93XCIsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcclxuICAgICAgICB2YXIga2V5UGF0aCA9ICduYW1lJztcclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQiA9ICR3aW5kb3cuaW5kZXhlZERCIHx8ICR3aW5kb3cud2Via2l0SW5kZXhlZERCIHx8ICR3aW5kb3cubXNJbmRleGVkREI7XHJcbiAgICAgICAgdmFyIElEQktleVJhbmdlID0gJHdpbmRvdy5JREJLZXlSYW5nZSB8fCAkd2luZG93LndlYmtpdElEQktleVJhbmdlO1xyXG5cclxuICAgICAgICB2YXIgSURCVHJhbnNhY3Rpb24gPSAkd2luZG93LklEQlRyYW5zYWN0aW9uIHx8ICR3aW5kb3cud2Via2l0SURCVHJhbnNhY3Rpb247XHJcblxyXG4gICAgICAgIGlmIChJREJUcmFuc2FjdGlvbikge1xyXG4gICAgICAgICAgICBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFID0gSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSB8fCAncmVhZHdyaXRlJztcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZID0gSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZIHx8ICdyZWFkb25seSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbmRleGVkREIgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZURhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGUgaXMgYW4gaW5zdGFuY2Ugb2YgSURCVmVyc2lvbkNoYW5nZUV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gaWRiLmNyZWF0ZU9iamVjdFN0b3JlKHN0b3JlTmFtZSwgeyBrZXlQYXRoOiBrZXlQYXRoIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGQsIHVwZGF0ZSwgZGVsZXRlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkcm9wRGF0YWJhc2UgPSBmdW5jdGlvbihkYk5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkcm9wIHN1Y2Nlc3NmdWxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBmYWlsZWRcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYWRkSXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0QWRkID0gc3RvcmUuYWRkKGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHB1dEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLnB1dChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gSURCS2V5UmFuZ2Uub25seShpdGVtTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLm9wZW5DdXJzb3IocmFuZ2UpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBjdXJzb3IudmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJldHJpZXZlSXRlbXMgPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGNyZWF0ZURhdGFiYXNlOiBjcmVhdGVEYXRhYmFzZSxcclxuICAgICAgICAgICAgZHJvcERhdGFiYXNlOiBkcm9wRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGFkZEl0ZW06IGFkZEl0ZW0sXHJcbiAgICAgICAgICAgIHB1dEl0ZW06IHB1dEl0ZW0sXHJcbiAgICAgICAgICAgIHJldHJpZXZlSXRlbTogcmV0cmlldmVJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW1zOiByZXRyaWV2ZUl0ZW1zLFxyXG4gICAgICAgICAgICBpbmRleGVkREJBdmFpbGFibGU6IGluZGV4ZWREQkF2YWlsYWJsZVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnTG9nU3J2JywgW1wiQXBwQ29uZmlnXCIsIGZ1bmN0aW9uKEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBsb2dJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuaW5mb1wiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dFcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmVycm9yXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbmZvOiBsb2dJbmZvLFxyXG4gICAgICAgICAgICBlcnJvcjogbG9nRXJyb3JcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1F1aXpTcnYnLCBbXCJBcHBDb25maWdcIiwgXCJMb2dTcnZcIiwgZnVuY3Rpb24oQXBwQ29uZmlnLCBMb2dTcnYpIHtcclxuICAgICAgICB2YXIgY291bnRyaWVzID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHF1aXogPSBudWxsO1xyXG4gICAgICAgIHZhciBjdXJyZW50UXVlc3Rpb25ObyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY291bnRyaWVzTG9hZGVkKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJDb3VudHJpZXMgbm90IGxvYWRlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocXVpeiAhPT0gbnVsbCAmJiBxdWl6LmlzQWN0aXZlKCkgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJBIHF1aXogaXMgY3VycmVudGx5IGJlaW5nIHBsYXllZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgcXVpeiBvYmplY3RcclxuICAgICAgICAgICAgICAgIHF1aXogPSBuZXcgUXVpeigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQXBwQ29uZmlnWydxdWl6LnF1ZXN0aW9ucy5udW1iZXInXTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcXVpei5hZGRRdWVzdGlvbihuZXcgUXVlc3Rpb24oe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJ5OiBnZXRSYW5kb21Db3VudHJ5KClcclxuICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uTm8gPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNldENvdW50cmllcyA9IGZ1bmN0aW9uKF9jb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgY291bnRyaWVzID0gX2NvdW50cmllcztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UmFuZG9tQ291bnRyeSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzW2dldFJhbmRvbUludCgwLCBjb3VudHJpZXMubGVuZ3RoIC0gMSldO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjb3VudHJpZXNMb2FkZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllcyAhPT0gbnVsbCAmJiBjb3VudHJpZXMubGVuZ3RoID4gMDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaXNRdWl6UnVubmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcXVpeiAhPT0gbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmdldFF1ZXN0aW9ucygpW2N1cnJlbnRRdWVzdGlvbk5vXTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50UXVlc3Rpb25ObyAhPT0gbnVsbCA/IGN1cnJlbnRRdWVzdGlvbk5vICsgMSA6IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcXVpeiAhPT0gbnVsbCA/IHF1aXouZ2V0UXVlc3Rpb25zKCkubGVuZ3RoIDogbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc3VibWl0QW5zd2VyID0gZnVuY3Rpb24oYW5zd2VyKSB7XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbiA9IGdldEN1cnJlbnRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNvcnJlY3RBbnN3ZXIgPSBnZXRBbnN3ZXJUb1F1ZXN0aW9uKHF1ZXN0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIHF1ZXN0aW9uLnN0YXRlID0gYW5zd2VyID09PSBjb3JyZWN0QW5zd2VyID8gcXVlc3Rpb24uc3RhdGVzLkNPUlJFQ1QgOiBxdWVzdGlvbi5zdGF0ZXMuSU5DT1JSRUNUO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKHF1ZXN0aW9uLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuQ0FQSVRBTF9PRl9DT1VOVFJZOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldpZSBoZWnDn3QgZGllIEhhdXB0c3RhZHQgdm9uIFtcIiArIHF1ZXN0aW9uLmNvdW50cnkubmFtZSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuQ09VTlRSWV9PRl9DQVBJVEFMOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIltcIiArIHF1ZXN0aW9uLmNvdW50cnkuY2FwaXRhbCArIFwiXSBpc3QgZGllIEhhdXB0c3RhZHQgdm9uIHdlbGNoZW0gTGFuZFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuSU5IQUJJVEFOVFNfT0ZfQ09VTlRSWTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgdmllbGUgRWlud29obmVyIGhhdCBbXCIgKyBxdWVzdGlvbi5jb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihcIlVua25vd24gcXVlc3Rpb24gdHlwZVwiLCBxdWVzdGlvbi50eXBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRBbnN3ZXJUb1F1ZXN0aW9uID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcclxuICAgICAgICAgICAgaWYgKCFxdWVzdGlvbiB8fCAhcXVlc3Rpb24udHlwZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKHF1ZXN0aW9uLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuQ0FQSVRBTF9PRl9DT1VOVFJZOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5jb3VudHJ5LmNhcGl0YWw7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5DT1VOVFJZX09GX0NBUElUQUw6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmNvdW50cnkubmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnR5cGVzLklOSEFCSVRBTlRTX09GX0NPVU5UUlk6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmNvdW50cnkucG9wdWxhdGlvbjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihcIlVua25vd24gcXVlc3Rpb24gdHlwZVwiLCBxdWVzdGlvbi50eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRBbnN3ZXJTdGF0dXMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgc3RhdGUgPSBxdWVzdGlvbi5zdGF0ZTtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAoc3RhdGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24uc3RhdGVzLkNPUlJFQ1Q6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiY29ycmVjdFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24uc3RhdGVzLklOQ09SUkVDVDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJpbmNvcnJlY3RcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uQW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uc3RhdGUgIT09IHF1ZXN0aW9uLnN0YXRlcy5OT1RfQU5TV0VSRUQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEFuc3dlclRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gXCJbXCIgKyBnZXRBbnN3ZXJUb1F1ZXN0aW9uKHF1ZXN0aW9uKSArIFwiXVwiO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBuZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpICsgMSA8PSBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKSkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uTm8rKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRQcm9ncmVzc1BlcmNlbnRhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpIC8gZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBzZXRDb3VudHJpZXM6IHNldENvdW50cmllcyxcclxuICAgICAgICAgICAgaXNRdWl6UnVubmluZzogaXNRdWl6UnVubmluZyxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyOiBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIsXHJcbiAgICAgICAgICAgIGdldE51bWJlck9mUXVpelF1ZXN0aW9uczogZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zLFxyXG4gICAgICAgICAgICBnZXRRdWVzdGlvblRleHQ6IGdldFF1ZXN0aW9uVGV4dCxcclxuICAgICAgICAgICAgZ2V0QW5zd2VyU3RhdHVzOiBnZXRBbnN3ZXJTdGF0dXMsXHJcbiAgICAgICAgICAgIGdldEFuc3dlclRleHQ6IGdldEFuc3dlclRleHQsXHJcbiAgICAgICAgICAgIHN1Ym1pdEFuc3dlcjogc3VibWl0QW5zd2VyLFxyXG4gICAgICAgICAgICBxdWVzdGlvbkFuc3dlcmVkOiBxdWVzdGlvbkFuc3dlcmVkLFxyXG4gICAgICAgICAgICBuZXh0UXVlc3Rpb246IG5leHRRdWVzdGlvbixcclxuICAgICAgICAgICAgZ2V0UHJvZ3Jlc3NQZXJjZW50YWdlOiBnZXRQcm9ncmVzc1BlcmNlbnRhZ2VcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1VzZXJTcnYnLCBbXCIkaHR0cFwiLCBcIkF1dGhUb2tlblNydlwiLCBmdW5jdGlvbigkaHR0cCwgQXV0aFRva2VuU3J2KSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXInKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlckZyb21TdG9yYWdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhUb2tlblNydi5nZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbih0b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGdldFVzZXIoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBubyB0b2tlbiwgd2UgcmVqZWN0IHRoZSBwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gdG9rZW4gaW4gc3RvcmFnZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb24nLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IHJlc3BvbnNlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2F2ZSB0b2tlbiBsb2NhbGx5XHJcbiAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4oc2VsZi50b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFVzZXIoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnRva2VuID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyByZW1vdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRVc2VyOiBnZXRVc2VyLFxyXG4gICAgICAgICAgICBnZXRVc2VyRnJvbVN0b3JhZ2U6IGdldFVzZXJGcm9tU3RvcmFnZSxcclxuICAgICAgICAgICAgbG9naW46IGxvZ2luLFxyXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dFxyXG4gICAgICAgIH1cclxuICAgIH1dKTsiLCIvLyBvd24gY2xhc3NlcyBhbmQgZnVuY3Rpb25zXHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVSVogLS0tLS0tLS0tLVxyXG52YXIgUXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gcXVlc3Rpb25zIGFycmF5XHJcbiAgICB2YXIgcXVlc3Rpb25zID0gW107XHJcblxyXG4gICAgLy8gZmxhZyBpbmRpY2F0aW5nIGlmIHF1aXogaXMgY3VycmVudGx5IGFjdGl2ZVxyXG4gICAgdmFyIGFjdGl2ZSA9IHRydWU7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgcXVlc3Rpb24gdG8gdGhlIHF1ZXN0aW9ucyBhcnJheVxyXG4gICAgICogQHBhcmFtIHF1ZXN0aW9uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYWRkUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgIHF1ZXN0aW9ucy5wdXNoKHF1ZXN0aW9uKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmlzQWN0aXZlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGFjdGl2ZTtcclxuICAgIH07XHJcbn07XHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVRVNUSU9OIC0tLS0tLS0tLS1cclxudmFyIFF1ZXN0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlIHx8IHRoaXMuZ2V0UmFuZG9tVHlwZSgpO1xyXG4gICAgdGhpcy5jb3VudHJ5ID0gb3B0aW9ucy5jb3VudHJ5IHx8IG51bGw7XHJcbiAgICB0aGlzLnN0YXRlID0gb3B0aW9ucy5zdGF0ZSB8fCB0aGlzLnN0YXRlcy5OT1RfQU5TV0VSRUQ7XHJcbn07XHJcblxyXG5RdWVzdGlvbi5wcm90b3R5cGUuc3RhdGVzID0ge1xyXG4gICAgXCJOT1RfQU5TV0VSRURcIjogMSxcclxuICAgIFwiQ09SUkVDVFwiOiAyLFxyXG4gICAgXCJJTkNPUlJFQ1RcIjogM1xyXG59O1xyXG5cclxuUXVlc3Rpb24ucHJvdG90eXBlLnR5cGVzID0ge1xyXG4gICAgXCJDQVBJVEFMX09GX0NPVU5UUllcIjogXCJjYXBpdGFsLW9mLWNvdW50cnlcIixcclxuICAgIFwiQ09VTlRSWV9PRl9DQVBJVEFMXCI6IFwiY291bnRyeS1vZi1jYXBpdGFsXCIsXHJcbiAgICBcIklOSEFCSVRBTlRTX09GX0NPVU5UUllcIjogXCJpbmhhYml0YW50cy1vZi1jb3VudHJ5XCJcclxufTtcclxuXHJcblF1ZXN0aW9uLnByb3RvdHlwZS5nZXRSYW5kb21UeXBlID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgdHlwZXMgPSBPYmplY3Qua2V5cyh0aGlzLnR5cGVzKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy50eXBlc1t0eXBlc1tnZXRSYW5kb21JbnQoMCwgdHlwZXMubGVuZ3RoIC0gMSldXTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gKGluY2x1c2l2ZSkgYW5kIG1heCAoaW5jbHVzaXZlKVxyXG4gKiBVc2luZyBNYXRoLnJvdW5kKCkgd2lsbCBnaXZlIHlvdSBhIG5vbi11bmlmb3JtIGRpc3RyaWJ1dGlvbiFcclxuICovXHJcbnZhciBnZXRSYW5kb21JbnQgPSBmdW5jdGlvbihtaW4sIG1heCkge1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyB0aGUgdGV4dCBiZXR3ZWVuIHR3byBkZWxpbWl0aW5nIHRleHQgb2NjdXJyZW5jZXNcclxuICovXHJcbnZhciBnZXRTdHJpbmdCZXR3ZWVuID0gZnVuY3Rpb24odGV4dCwgZmlyc3RTdHJpbmcsIHNlY29uZFN0cmluZykge1xyXG4gICAgdmFyIGZpcnN0UG9zID0gdGV4dC5pbmRleE9mKGZpcnN0U3RyaW5nKTtcclxuICAgIHZhciBzZWNvbmRQb3MgPSB0ZXh0LmluZGV4T2Yoc2Vjb25kU3RyaW5nKTtcclxuXHJcbiAgICBpZiAoZmlyc3RQb3MgPj0gMCAmJiBzZWNvbmRQb3MgPj0gMCAmJiBzZWNvbmRQb3MgPiBmaXJzdFBvcykge1xyXG4gICAgICAgIHJldHVybiB0ZXh0LnN1YnN0cihmaXJzdFBvcyArIDEsIHNlY29uZFBvcyAtIGZpcnN0UG9zIC0gMSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn07XHJcbiIsImFuZ3VsYXIubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbiAgICAgICAgLy8gZW5hYmxlIEhUTUw1IHB1c2hzdGF0ZVxyXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2hvbWUnKTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hvbWUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvaG9tZS5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncXVpeicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9xdWl6JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3F1aXoucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2xvZ2luLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9nb3V0JyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dvdXRDdHJsJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3JlZ2lzdGVyLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdhYm91dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hYm91dCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9hYm91dC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0Ryb3Bkb3duQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG4gICAgICAgIHZhciB2aXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICRzY29wZS50b2dnbGVEcm9wZG93biA9IHRvZ2dsZURyb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5zaG93RHJvcGRvd24gPSBzaG93RHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmhpZGVEcm9wZG93biA9IGhpZGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuaXNEcm9wZG93blZpc2libGUgPSBpc0Ryb3Bkb3duVmlzaWJsZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmhhbmRsZUNsaWNrT3V0c2lkZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ0xJQ0tFRCBPVVRTSURFXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSAhdmlzaWJsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dEcm9wZG93bigpIHtcclxuICAgICAgICAgICAgdmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoaWRlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzRHJvcGRvd25WaXNpYmxlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmlzaWJsZTtcclxuICAgICAgICB9XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTG9naW5DdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2LCBGb2N1c1Nydikge1xyXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICBVc2VyU3J2LmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcGxpY2F0aW9uIGNvbnRyb2wgYWJvdXQgbG9naW4gZXZlbnRcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dpbicsIHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IG5vdGlmeSB1c2VyIGFib3V0IGVycm9yIGluIGxvZ2luIHByb2Nlc3NcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGZvY3VzIHVzZXJuYW1lIGZpZWxkXHJcbiAgICAgICAgRm9jdXNTcnYoJ3VzZXJuYW1lJyk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTG9nb3V0Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydikge1xyXG4gICAgICAgIFVzZXJTcnYubG9nb3V0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dvdXQgZXZlbnRcclxuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ291dCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2LCBGb2N1c1NydiwgbmdQcm9ncmVzc0ZhY3RvcnkpIHtcclxuXHJcbiAgICAgICAgLy8gUHJvZ3Jlc3MgYmFyIGluaXRpYWxpemF0aW9uXHJcbiAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyID0gbmdQcm9ncmVzc0ZhY3RvcnkuY3JlYXRlSW5zdGFuY2UoKTtcclxuICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0UGFyZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXByb2dyZXNzJykpO1xyXG4gICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRBYnNvbHV0ZSgpO1xyXG4gICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRDb2xvcihcIiMzMzZlN2JcIik7XHJcblxyXG4gICAgICAgIHZhciBzdGFydFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIEZvY3VzU3J2KCdhbnN3ZXInKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiQ291bGQgbm90IHN0YXJ0IHF1aXpcIiwgZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyUXVlc3Rpb24oUXVpelNydi5nZXRRdWVzdGlvblRleHQoKSwgXCJxdWVzdGlvbi1oaWdobGlnaHRcIikgKyBcIj9cIjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QW5zd2VyVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyUXVlc3Rpb24oUXVpelNydi5nZXRBbnN3ZXJUZXh0KCksIFwiYW5zd2VyLWhpZ2hsaWdodC1cIiArIFF1aXpTcnYuZ2V0QW5zd2VyU3RhdHVzKCkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbkFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LnF1ZXN0aW9uQW5zd2VyZWQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciByZW5kZXJRdWVzdGlvbiA9IGZ1bmN0aW9uKHRleHQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dFxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJbXCIsIFwiPHNwYW4gY2xhc3M9J1wiICsgY2xhc3NOYW1lICsgXCInPlwiKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJdXCIsIFwiPC9zcGFuPlwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc3VibWl0QW5zd2VyID0gZnVuY3Rpb24oYW5zd2VyKSB7XHJcbiAgICAgICAgICAgIGlmIChhbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgIFF1aXpTcnYuc3VibWl0QW5zd2VyKGFuc3dlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IHByb2dyZXNzIGJhclxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldChRdWl6U3J2LmdldFByb2dyZXNzUGVyY2VudGFnZSgpICogMTAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgZm9jdXMgdG8gbmV4dCBxdWVzdGlvbiBidXR0b25cclxuICAgICAgICAgICAgICAgIEZvY3VzU3J2KCdidG5OZXh0UXVlc3Rpb24nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbkFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LnF1ZXN0aW9uQW5zd2VyZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5xdS5hbnN3ZXIgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgUXVpelNydi5uZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIEZvY3VzU3J2KCdhbnN3ZXInKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZGxlS2V5UHJlc3MgPSBmdW5jdGlvbihrZXlFdmVudCkge1xyXG4gICAgICAgICAgICBpZiAoa2V5RXZlbnQud2hpY2ggPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHN1Ym1pdEFuc3dlcigkc2NvcGUucXUuYW5zd2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zdGFydFF1aXogPSBzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmlzUXVpelJ1bm5pbmcgPSBpc1F1aXpSdW5uaW5nO1xyXG4gICAgICAgICRzY29wZS5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI7XHJcbiAgICAgICAgJHNjb3BlLmdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucztcclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb25UZXh0ID0gZ2V0UXVlc3Rpb25UZXh0O1xyXG4gICAgICAgICRzY29wZS5nZXRBbnN3ZXJUZXh0ID0gZ2V0QW5zd2VyVGV4dDtcclxuICAgICAgICAkc2NvcGUuc3VibWl0QW5zd2VyID0gc3VibWl0QW5zd2VyO1xyXG4gICAgICAgICRzY29wZS5xdWVzdGlvbkFuc3dlcmVkID0gcXVlc3Rpb25BbnN3ZXJlZDtcclxuICAgICAgICAkc2NvcGUubmV4dFF1ZXN0aW9uID0gbmV4dFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5oYW5kbGVLZXlQcmVzcyA9IGhhbmRsZUtleVByZXNzO1xyXG5cclxuICAgICAgICAkc2NvcGUucXUgPSB7XHJcbiAgICAgICAgICAgIGFuc3dlcjogXCJcIlxyXG4gICAgICAgIH07XHJcblxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZpbHRlcigncmVuZGVySHRtbCcsIGZ1bmN0aW9uKCRzY2UpIHtcclxuICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbDtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdBdXRoSW50ZXJjZXB0b3InLCBmdW5jdGlvbihBdXRoVG9rZW5TcnYpIHtcclxuICAgICAgICB2YXIgYWRkVG9rZW4gPSBmdW5jdGlvbihjb25maWcpIHtcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFRva2VuU3J2LmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snWC1BdXRoJ10gPSB0b2tlbjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0OiBhZGRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFRva2VuU3J2JywgZnVuY3Rpb24oJHdpbmRvdykge1xyXG4gICAgICAgIHZhciBzdG9yZSA9ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2U7XHJcbiAgICAgICAgdmFyIGtleSA9ICdhdXRoLXRva2VuJztcclxuXHJcbiAgICAgICAgdmFyIGdldFRva2VuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNldFRva2VuID0gZnVuY3Rpb24odG9rZW4pIHtcclxuICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5zZXRJdGVtKGtleSwgdG9rZW4pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUucmVtb3ZlSXRlbShrZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0VG9rZW46IGdldFRva2VuLFxyXG4gICAgICAgICAgICBzZXRUb2tlbjogc2V0VG9rZW5cclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0NvdW50cnlTcnYnLCBmdW5jdGlvbigkaHR0cCwgSW5kZXhlZERCU3J2LCBMb2dTcnYpIHtcclxuICAgICAgICAvLyBDb3VudHJpZXMgYXJyYXlcclxuICAgICAgICB2YXIgY291bnRyaWVzID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gSW5kZXhlZERCXHJcbiAgICAgICAgdmFyIGRhdGFiYXNlID0gJ21hZ2VsbGFuJztcclxuICAgICAgICB2YXIgc3RvcmUgPSAnY291bnRyeVN0b3JlJztcclxuICAgICAgICB2YXIga2V5Q291bnRyaWVzID0gJ2NvdW50cmllcyc7XHJcbiAgICAgICAgdmFyIGtleVZlcnNpb24gPSAndmVyc2lvbic7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREJBdmFpbGFibGUgPSBJbmRleGVkREJTcnYuaW5kZXhlZERCQXZhaWxhYmxlKCk7XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2FkQ291bnRyaWVzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvYWRDb3VudHJpZXMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgaW5kZXhlZERCIGlzIGF2YWlsYWJsZVxyXG4gICAgICAgICAgICBpZiAoaW5kZXhlZERCQXZhaWxhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGRhdGFiYXNlIGV4aXN0c1xyXG4gICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5jcmVhdGVEYXRhYmFzZShkYXRhYmFzZSwgc3RvcmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEVtcHR5T2JqZWN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRJbnRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEV4dGVybmFsVmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihsb2FkRGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXMgPSBvYmpbJ2NvdW50cmllcyddO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKFwibG9hZGVkIGNvdW50cmllcyBmcm9tXCIsIG9ialsnbG9hZFN0cmF0ZWd5J10udG9VcHBlckNhc2UoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoXCJmYWlsZWQgdG8gbG9hZCBjb3VudHJpZXNcIiwgZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCwgd2UgYWx3YXlzIHRyeSB0byBkb3dubG9hZCBpdCBmcm9tIHRoZSBjb3VudHJ5IEFQSSBlbmRwb2ludFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldENvdW50cmllc0Zyb21BUEkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZXRlcm1pbmVMb2FkU3RyYXRlZ3kgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBpbnRlcm5hbFZlcnNpb24gPSBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl07XHJcbiAgICAgICAgICAgICAgICB2YXIgZXh0ZXJuYWxWZXJzaW9uID0gb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpbnRlcm5hbFZlcnNpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChleHRlcm5hbFZlcnNpb24gPiBpbnRlcm5hbFZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdkYic7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqWydsb2FkU3RyYXRlZ3knXSA9IHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvYWREYXRhID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneSA9IG9ialsnbG9hZFN0cmF0ZWd5J107XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChzdHJhdGVneSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FwaSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21BUEkoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gY291bnRyaWVzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBjb3VudHJpZXMgYW5kIHZlcnNpb24gbnVtYmVyIGluIGRhdGFiYXNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleUNvdW50cmllcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICBjb3VudHJpZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleVZlcnNpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RiJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q291bnRyaWVzRnJvbURCKG9iailcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKF9vYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF9vYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnVW5rbm93biBsb2FkIHN0cmF0ZWd5Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFbXB0eU9iamVjdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHt9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEludGVybmFsVmVyc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5VmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFeHRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldFZlcnNpb25Gcm9tQVBJKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl0gPSB2ZXJzaW9uO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21EQiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5Q291bnRyaWVzKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gaXRlbS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFZlcnNpb25Gcm9tQVBJID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9jb3VudHJpZXMvdmVyc2lvbicpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhLnZlcnNpb24gfHwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXRcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0ZvY3VzU3J2JywgZnVuY3Rpb24oJHRpbWVvdXQsICR3aW5kb3cpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaWQpIHtcclxuICAgICAgICAgICAgLy8gdGltZW91dCBtYWtlcyBzdXJlIHRoYXQgaXMgaW52b2tlZCBhZnRlciBhbnkgb3RoZXIgZXZlbnQgaGFzIGJlZW4gdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAvLyBlLmcuIGNsaWNrIGV2ZW50cyB0aGF0IG5lZWQgdG8gcnVuIGJlZm9yZSB0aGUgZm9jdXMgb3JcclxuICAgICAgICAgICAgLy8gaW5wdXRzIGVsZW1lbnRzIHRoYXQgYXJlIGluIGEgZGlzYWJsZWQgc3RhdGUgYnV0IGFyZSBlbmFibGVkIHdoZW4gdGhvc2UgZXZlbnRzXHJcbiAgICAgICAgICAgIC8vIGFyZSB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdJbmRleGVkREJTcnYnLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIGtleVBhdGggPSAnbmFtZSc7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREIgPSAkd2luZG93LmluZGV4ZWREQiB8fCAkd2luZG93LndlYmtpdEluZGV4ZWREQiB8fCAkd2luZG93Lm1zSW5kZXhlZERCO1xyXG4gICAgICAgIHZhciBJREJLZXlSYW5nZSA9ICR3aW5kb3cuSURCS2V5UmFuZ2UgfHwgJHdpbmRvdy53ZWJraXRJREJLZXlSYW5nZTtcclxuXHJcbiAgICAgICAgdmFyIElEQlRyYW5zYWN0aW9uID0gJHdpbmRvdy5JREJUcmFuc2FjdGlvbiB8fCAkd2luZG93LndlYmtpdElEQlRyYW5zYWN0aW9uO1xyXG5cclxuICAgICAgICBpZiAoSURCVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSA9IElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgfHwgJ3JlYWR3cml0ZSc7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSA9IElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSB8fCAncmVhZG9ubHknO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5kZXhlZERCID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBlIGlzIGFuIGluc3RhbmNlIG9mIElEQlZlcnNpb25DaGFuZ2VFdmVudFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IGlkYi5jcmVhdGVPYmplY3RTdG9yZShzdG9yZU5hbWUsIHsga2V5UGF0aDoga2V5UGF0aCB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkLCB1cGRhdGUsIGRlbGV0ZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZHJvcERhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBzdWNjZXNzZnVsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3AgZmFpbGVkXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFkZEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLmFkZChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwdXRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5wdXQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW1OYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IElEQktleVJhbmdlLm9ubHkoaXRlbU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKHJhbmdlKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gY3Vyc29yLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW1zID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjcmVhdGVEYXRhYmFzZTogY3JlYXRlRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGRyb3BEYXRhYmFzZTogZHJvcERhdGFiYXNlLFxyXG4gICAgICAgICAgICBhZGRJdGVtOiBhZGRJdGVtLFxyXG4gICAgICAgICAgICBwdXRJdGVtOiBwdXRJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW06IHJldHJpZXZlSXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtczogcmV0cmlldmVJdGVtcyxcclxuICAgICAgICAgICAgaW5kZXhlZERCQXZhaWxhYmxlOiBpbmRleGVkREJBdmFpbGFibGVcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0xvZ1NydicsIGZ1bmN0aW9uKEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBsb2dJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuaW5mb1wiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dFcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmVycm9yXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbmZvOiBsb2dJbmZvLFxyXG4gICAgICAgICAgICBlcnJvcjogbG9nRXJyb3JcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1F1aXpTcnYnLCBmdW5jdGlvbihBcHBDb25maWcsIExvZ1Nydikge1xyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgcXVpeiA9IG51bGw7XHJcbiAgICAgICAgdmFyIGN1cnJlbnRRdWVzdGlvbk5vID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb3VudHJpZXNMb2FkZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkNvdW50cmllcyBub3QgbG9hZGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChxdWl6ICE9PSBudWxsICYmIHF1aXouaXNBY3RpdmUoKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkEgcXVpeiBpcyBjdXJyZW50bHkgYmVpbmcgcGxheWVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBxdWl6IG9iamVjdFxyXG4gICAgICAgICAgICAgICAgcXVpeiA9IG5ldyBRdWl6KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBBcHBDb25maWdbJ3F1aXoucXVlc3Rpb25zLm51bWJlciddOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBxdWl6LmFkZFF1ZXN0aW9uKG5ldyBRdWVzdGlvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnk6IGdldFJhbmRvbUNvdW50cnkoKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50UXVlc3Rpb25ObyA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0Q291bnRyaWVzID0gZnVuY3Rpb24oX2NvdW50cmllcykge1xyXG4gICAgICAgICAgICBjb3VudHJpZXMgPSBfY291bnRyaWVzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRSYW5kb21Db3VudHJ5ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIGNvdW50cmllcy5sZW5ndGggLSAxKV07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNvdW50cmllc0xvYWRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzICE9PSBudWxsICYmIGNvdW50cmllcy5sZW5ndGggPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6ICE9PSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0UXVlc3Rpb25zKClbY3VycmVudFF1ZXN0aW9uTm9dO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbk5vICE9PSBudWxsID8gY3VycmVudFF1ZXN0aW9uTm8gKyAxIDogbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6ICE9PSBudWxsID8gcXVpei5nZXRRdWVzdGlvbnMoKS5sZW5ndGggOiBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzdWJtaXRBbnN3ZXIgPSBmdW5jdGlvbihhbnN3ZXIpIHtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgY29ycmVjdEFuc3dlciA9IGdldEFuc3dlclRvUXVlc3Rpb24ocXVlc3Rpb24pO1xyXG5cclxuICAgICAgICAgICAgcXVlc3Rpb24uc3RhdGUgPSBhbnN3ZXIgPT09IGNvcnJlY3RBbnN3ZXIgPyBxdWVzdGlvbi5zdGF0ZXMuQ09SUkVDVCA6IHF1ZXN0aW9uLnN0YXRlcy5JTkNPUlJFQ1Q7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAocXVlc3Rpb24udHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5DQVBJVEFMX09GX0NPVU5UUlk6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIGhlacOfdCBkaWUgSGF1cHRzdGFkdCB2b24gW1wiICsgcXVlc3Rpb24uY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5DT1VOVFJZX09GX0NBUElUQUw6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiW1wiICsgcXVlc3Rpb24uY291bnRyeS5jYXBpdGFsICsgXCJdIGlzdCBkaWUgSGF1cHRzdGFkdCB2b24gd2VsY2hlbSBMYW5kXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5JTkhBQklUQU5UU19PRl9DT1VOVFJZOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldpZSB2aWVsZSBFaW53b2huZXIgaGF0IFtcIiArIHF1ZXN0aW9uLmNvdW50cnkubmFtZSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiVW5rbm93biBxdWVzdGlvbiB0eXBlXCIsIHF1ZXN0aW9uLnR5cGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEFuc3dlclRvUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgICAgICBpZiAoIXF1ZXN0aW9uIHx8ICFxdWVzdGlvbi50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAocXVlc3Rpb24udHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5DQVBJVEFMX09GX0NPVU5UUlk6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmNvdW50cnkuY2FwaXRhbDtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnR5cGVzLkNPVU5UUllfT0ZfQ0FQSVRBTDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uY291bnRyeS5uYW1lO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuSU5IQUJJVEFOVFNfT0ZfQ09VTlRSWTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uY291bnRyeS5wb3B1bGF0aW9uO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiVW5rbm93biBxdWVzdGlvbiB0eXBlXCIsIHF1ZXN0aW9uLnR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEFuc3dlclN0YXR1cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHF1ZXN0aW9uLnN0YXRlO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChzdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi5zdGF0ZXMuQ09SUkVDVDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJjb3JyZWN0XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi5zdGF0ZXMuSU5DT1JSRUNUOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImluY29ycmVjdFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25BbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5zdGF0ZSAhPT0gcXVlc3Rpb24uc3RhdGVzLk5PVF9BTlNXRVJFRDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QW5zd2VyVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBcIltcIiArIGdldEFuc3dlclRvUXVlc3Rpb24ocXVlc3Rpb24pICsgXCJdXCI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCkgKyAxIDw9IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50UXVlc3Rpb25ObysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFByb2dyZXNzUGVyY2VudGFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCkgLyBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXQsXHJcbiAgICAgICAgICAgIHNldENvdW50cmllczogc2V0Q291bnRyaWVzLFxyXG4gICAgICAgICAgICBpc1F1aXpSdW5uaW5nOiBpc1F1aXpSdW5uaW5nLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI6IGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcixcclxuICAgICAgICAgICAgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zOiBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMsXHJcbiAgICAgICAgICAgIGdldFF1ZXN0aW9uVGV4dDogZ2V0UXVlc3Rpb25UZXh0LFxyXG4gICAgICAgICAgICBnZXRBbnN3ZXJTdGF0dXM6IGdldEFuc3dlclN0YXR1cyxcclxuICAgICAgICAgICAgZ2V0QW5zd2VyVGV4dDogZ2V0QW5zd2VyVGV4dCxcclxuICAgICAgICAgICAgc3VibWl0QW5zd2VyOiBzdWJtaXRBbnN3ZXIsXHJcbiAgICAgICAgICAgIHF1ZXN0aW9uQW5zd2VyZWQ6IHF1ZXN0aW9uQW5zd2VyZWQsXHJcbiAgICAgICAgICAgIG5leHRRdWVzdGlvbjogbmV4dFF1ZXN0aW9uLFxyXG4gICAgICAgICAgICBnZXRQcm9ncmVzc1BlcmNlbnRhZ2U6IGdldFByb2dyZXNzUGVyY2VudGFnZVxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnVXNlclNydicsIGZ1bmN0aW9uKCRodHRwLCBBdXRoVG9rZW5TcnYpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBnZXRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcicpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRVc2VyRnJvbVN0b3JhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFRva2VuU3J2LmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKHRva2VuKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0VXNlcigpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHRva2VuLCB3ZSByZWplY3QgdGhlIHByb21pc2VcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJObyB0b2tlbiBpbiBzdG9yYWdlXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvc2Vzc2lvbicsIHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnRva2VuID0gcmVzcG9uc2UuZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzYXZlIHRva2VuIGxvY2FsbHlcclxuICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbihzZWxmLnRva2VuKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VXNlcigpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9nb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9rZW4gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSB0b2tlbiBsb2NhbGx5XHJcbiAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFVzZXI6IGdldFVzZXIsXHJcbiAgICAgICAgICAgIGdldFVzZXJGcm9tU3RvcmFnZTogZ2V0VXNlckZyb21TdG9yYWdlLFxyXG4gICAgICAgICAgICBsb2dpbjogbG9naW4sXHJcbiAgICAgICAgICAgIGxvZ291dDogbG9nb3V0XHJcbiAgICAgICAgfVxyXG4gICAgfSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
