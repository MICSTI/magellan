var magellan=angular.module("magellan",["ui.router","ngProgress","ngAnimate"],["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]);magellan.constant("AppConfig",{"log.info":!0,"log.error":!0,"quiz.country.questions":3,"quiz.country.types":{1:"CAPITAL_OF_COUNTRY",2:"COUNTRY_OF_CAPITAL",3:"POPULATION_OF_COUNTRY",4:"AREA_OF_COUNTRY",5:"FLAG_OF_COUNTRY",6:"LOCATION_OF_COUNTRY"},"settings.user.colors":["soft_red","thunderbird","old_brick","new_york_pink","snuff","honey_flower","san_marino","shakespeare","ming","gossip","eucalyptus","mountain_meadow","jade","confetti","california","burnt_orange","jaffa","gallery","edward","lynch"]}),magellan.controller("AppCtrl",["$rootScope","$scope","$state","AuthSrv","UserSrv","CountrySrv","QuizSrv",function(e,n,t,r,o,i,s){n.app={config:{title:"Magellan",subtitle:"Teste dein Wissen über die Länder unserer Erde",author:"Michael Stifter"}},r.getUser().then(function(e){n.user=e,n.$broadcast("user.loaded"),i.init().then(function(e){n.$broadcast("countries.loaded",e),s.setCountries(e)})})["catch"](function(e){n.user=null}),n.isProgressBarVisible=function(){return t.is("quiz")};var a=function(){t.go("home")};n.goToHome=a,e.$on("$stateChangeError",function(e,n,r,o,i,s){"Not authorized"===s&&t.go("home")}),n.$on("app.login",function(e,o){n.user=o,r.setUser(o),i.init().then(function(e){n.$broadcast("countries.loaded",e),s.setCountries(e)}),t.go("home")}),n.$on("app.logout",function(e,o){n.user=null,r.clearUser(),t.go("home")})}]);var createMap=function(){new Datamap({element:document.getElementById("map-container"),geographyConfig:{highlightOnHover:!0,popupOnHover:!1}})},Quiz=function(){var e=null,n=[];this.start=function(){if(n.length<=0)throw Error("Cannot start a quiz without questions");return this.nextQuestion()},this.isActive=function(){return this.hasStarted()&&!this.hasEnded()},this.hasStarted=function(){return null!==e},this.hasEnded=function(){return this.hasStarted()&&e>=n.length},this.submitted=!1,this.addQuestion=function(e){if(void 0===e)throw Error("No question object passed");var t=!0,r=["config","hint","solution","answer","question","getInfo","info","points","answered","hintsAllowed","hintsRemaining"];r.forEach(function(n){if(!e.hasOwnProperty(n))throw t=!1,new Error("Question must have property '"+n+"'")}),t&&n.push(e)},this.nextQuestion=function(){return null===e?e=0:e++,this.hasEnded()?!1:n[e]},this.currentQuestion=function(){return this.isActive()?n[e]:null},this.getTotalPoints=function(){if(!this.hasStarted())return null;var e=0;return n.forEach(function(n){var t=n.points();void 0!==t&&(e+=t)}),e},this.getCurrentQuestionNumber=function(){return null===e?null:e+1},this.getNumberOfQuestions=function(){return n.length}},Question=function(e){var n=null,t=null,r=null,o=null,i=0,s=null,a=null,u=!1,l=function(e){n=e.text,t=e.info||{},r=e.answer,s=e.checkAnswer||null,o=e.hints||{allowed:!1,maximum:0,cost:0,give:null}};e&&l(e),this.config=function(e){l(e)},this.question=function(){return n},this.info=function(e,n){return void 0===n?t[e]:void(t[e]=n)},this.getInfo=function(){return t},this.solution=function(){return u?r:null},this.hint=function(){if(!o.allowed)return null;if(o.allowed&&!o.give)throw new Error("Hints allowed but no give method passed");return i<o.maximum&&i++,o.give(i,r)},this.answer=function(e){return!u&&s?(u=!0,a=s(r,e,i,o.cost,t),a=Math.max(0,a),a=Math.floor(a)):void 0},this.points=function(){return u&&null!==a?a:void 0},this.answered=function(){return u},this.hintsAllowed=function(){return null!==o?o.allowed:null},this.hintsRemaining=function(){var e=this.hintsAllowed();return null===e||e===!1?null:o.maximum-i}},getRandomInt=function(e,n){return Math.floor(Math.random()*(n-e+1))+e},getStringBetween=function(e,n,t){var r=e.indexOf(n),o=e.indexOf(t);return r>=0&&o>=0&&o>r?e.substr(r+1,o-r-1):null},PasswordRequirementsValidator=function(){var e=this,n={minLength:8,maxLength:void 0,lowercaseChars:1,uppercaseChars:1,specialChars:1,numericChars:1},t=null;this.input=null,this.check=function(e){if("undefined"==typeof e)throw new Error("Missing mandatory input parameter");if("string"!=typeof e)throw new Error('First input parameter must be of type "string"');this.input=e;var n=[],t=r();return t.forEach(function(e){var t=i(e);t!==!0&&n.push(e)}),{passwordOk:0===n.length,failedChecks:n}},this.setConfig=function(e){t=e},this.getConfig=function(){return t||n};var r=function(){return Object.keys(e.getConfig())},o=function(n){return e.getConfig()[n]},i=function(n){if("string"!=typeof e.input)return!1;var t=o(n);if(!t)return!0;switch(n){case"minLength":return e.input.length>=t;case"maxLength":return e.input.length<=t;case"lowercaseChars":var r=e.input.length-e.input.replace(/[a-z]/g,"").length;return r>=t;case"uppercaseChars":var i=e.input.length-e.input.replace(/[A-Z]/g,"").length;return i>=t;case"specialChars":var s=e.input.length-e.input.replace(/[!@§$%&#^*_:;.°,+"'`´\{\}\(\)\[\]\/\\-]/g,"").length;return s>=t;case"numericChars":var a=e.input.length-e.input.replace(/[0-9]/g,"").length;return a>=t;default:return}}};PasswordRequirementsValidator.CONFIG_PROPERTIES=["minLength","maxLength","lowercaseChars","uppercaseChars","specialChars","numericChars"],"undefined"!=typeof module&&module.exports&&(module.exports.Question=Question,module.exports.Quiz=Quiz,module.exports.PasswordRequirementsValidator=PasswordRequirementsValidator),angular.module("magellan").config(["$locationProvider","$stateProvider","$urlRouterProvider",function(e,n,t){e.html5Mode(!0),t.otherwise("/home");var r=function(e,n,t){return e.getUser().then(function(e){return e})["catch"](function(e){return t.reject("Not authorized")})};r.$inject=["AuthSrv","LogSrv","$q"],n.state("home",{url:"/home",templateUrl:"/build/views/partials/home.partial.html"}).state("quiz",{url:"/quiz",templateUrl:"/build/views/partials/quiz.partial.html",resolve:{auth:r}}).state("countries",{url:"/countries",templateUrl:"/build/views/partials/countries.partial.html",resolve:{auth:r}}).state("countries.detail",{url:"/:alpha3Code",templateUrl:"/build/views/partials/countries-detail.partial.html",resolve:{auth:r}}).state("login",{url:"/login",templateUrl:"/build/views/partials/login.partial.html"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}).state("register",{url:"/register",templateUrl:"/build/views/partials/register.partial.html"}).state("settings",{url:"/settings",templateUrl:"/build/views/partials/settings.partial.html",resolve:{auth:r}}).state("password",{url:"/password",templateUrl:"/build/views/partials/password-change.partial.html",resolve:{auth:r}}).state("reset",{url:"/password/reset/:token",templateUrl:"/build/views/partials/password-reset.partial.html"}).state("forgot",{url:"/password/forgot",templateUrl:"/build/views/partials/password-forgot.partial.html"}).state("about",{url:"/about",templateUrl:"/build/views/partials/about.partial.html"}).state("highscore",{url:"/highscore",templateUrl:"/build/views/partials/highscore.partial.html",resolve:{auth:r}}).state("faq",{url:"/faq",templateUrl:"/build/views/partials/faq.partial.html",params:{action:null}}).state("countries-difficulty",{url:"/countries-difficulty",templateUrl:"/build/views/partials/country-difficulty.partial.html",resolve:{auth:r}})}]),angular.module("magellan").controller("CountriesCtrl",["$scope","CountrySrv",function(e,n){var t=null,r=null,o=function(){t=n.getCountriesByLetter(),r=Object.keys(t).sort(),e.$$phase?(e.countryKeys=r,e.countriesByLetter=t):e.$apply(function(){e.countryKeys=r,e.countriesByLetter=t})};n.areCountriesLoaded()&&o(),e.$on("countries.loaded",function(){o()})}]),angular.module("magellan").controller("CountryDetailCtrl",["$scope","CountrySrv","$stateParams",function(e,n,t){var r=t.alpha3Code;n.areCountriesLoaded()&&(e.country=n.getCountryByAlpha3(r)),e.$on("countries.loaded",function(){e.$apply(function(){e.country=n.getCountryByAlpha3(r)})});var o=function(e){return n.getCountryByAlpha3(e)};e.getCountryFromService=o}]),angular.module("magellan").controller("CountryDifficultyCtrl",["$scope","CountrySrv",function(e,n){var t=function(){var t=n.getCountries(),r={easy:[],medium:[],hard:[],unassigned:[]};t.sort(function(e,n){return n.population-e.population}).forEach(function(e){r[e.difficulty].push(e)}),e.$$phase?(e.difficulties=r,e.difficultyKeys=Object.keys(r)):e.$apply(function(){e.difficulties=r,e.difficultyKeys=Object.keys(r)})};n.areCountriesLoaded()&&t(),e.$on("countries.loaded",function(e,n){t()})}]),angular.module("magellan").controller("DropdownCtrl",["$scope",function(e){function n(){i=!i}function t(){i=!0}function r(){i=!1}function o(){return i}var i=!1;e.toggleDropdown=n,e.showDropdown=t,e.hideDropdown=r,e.isDropdownVisible=o,e.$on("click.outside",function(n,t){o()&&(e.$$phase?r():e.$apply(function(){r()}))})}]),angular.module("magellan").controller("FaqCtrl",["$scope","LogSrv","$stateParams",function(e,n,t){if(e.message=null,t.action){var r=t.action;switch(r){case"register.successful":e.message={type:"success",text:"Gratulation! Die Anmeldung war erfolgreich. Herzlich willkommen bei Magellan."};break;default:e.message=null}}}]),angular.module("magellan").controller("ForgotCtrl",["$scope","UserSrv","LogSrv","FocusSrv",function(e,n,t,r){e.passObj={},e.message={};var o=function(){return e.passObj.email?void n.forgotPassword({email:e.passObj.email}).then(function(e){var n=e.valid,t=void 0!==n?" Der Link ist "+n+" Stunden lang gültig.":"";s("success","Das E-Mail wurde erfolgreich versandt."+t)})["catch"](function(e){"No user with this e-mail address found"===e.message?s("error","Es wurde kein Benutzer mit dieser E-Mail-Adresse gefunden"):s("error","Beim Versenden des Links ist etwas schiefgegangen")}):void s("error","Alle Felder müssen ausgefüllt sein")},i=function(){o()},s=function(n,t){e.$$phase?e.message={type:n,text:t}:e.$apply(function(){e.message={type:n,text:t}})};r("#email"),e.forgotPassword=o,e.delegateSubmit=i}]),angular.module("magellan").controller("HighscoreCtrl",["$scope","ScoreSrv","LogSrv",function(e,n,t){e.scoreList=[],e.isDataLoading=!0,n.getHighscoreList().then(function(n){e.$$phase?e.scoreList=i(n):e.$apply(function(){e.scoreList=i(n)}),r(!1)})["catch"](function(e){t.error(e),r(!1)});var r=function(n){e.$$phase?e.isDataLoading=n:e.$apply(function(){e.isDataLoading=n})},o=function(n){return e.user._id===n},i=function(e){var n=0,t=null;return e.forEach(function(e){t&&e.score===t||(n++,e.rank=n+"."),t=e.score}),e};e.isMyself=o}]),angular.module("magellan").controller("LoginCtrl",["$scope","UserSrv","FocusSrv",function(e,n,t){e.message=null,e.login=function(t,r){n.login(t,r).then(function(n){e.message=null,e.$emit("app.login",n.data)})["catch"](function(n){console.error(n);var t;t=401===n.status?"Falscher Benutzername oder Passwort":"Beim Einloggen scheint etwas schief gegangen zu sein",e.message={type:"error",text:t}})},t("#username")}]),angular.module("magellan").controller("LogoutCtrl",["$scope","UserSrv",function(e,n){n.logout().then(function(){e.$emit("app.logout")})}]),angular.module("magellan").controller("MapCtrl",["$scope",function(e){}]),angular.module("magellan").controller("PasswordRequirementsCtrl",["$scope",function(e){var n=[{key:"minLength",description:"Das Passwort muss zumindest 8 Zeichen lang sein"},{key:"lowercaseChars",description:"Das Passwort muss zumindest einen Kleinbuchstaben enthalten"},{key:"uppercaseChars",description:"Das Passwort muss zumindest einen Großbuchstaben enthalten"},{key:"numericChars",description:"Das Passwort muss zumindest eine Zahl enthalten"},{key:"specialChars",description:"Das Passwort muss zumindest ein Sonderzeichen enthalten"}],t=new PasswordRequirementsValidator;e.$watch("passwordInput",function(e,n,t){o(e)});var r=function(n,t){e[n]=t},o=function(e){var o=t.check(e);r("requirements",n.map(function(e){return{description:e.description,fulfilled:o.failedChecks.indexOf(e.key)<0}})),r("passwordOk",o.passwordOk)};r("passwordOk",!1)}]),angular.module("magellan").controller("PasswordCtrl",["$scope","UserSrv","LogSrv","FocusSrv",function(e,n,t,r){e.passObj={},e.message={};var o=function(){return e.passObj.old&&e.passObj["new"]&&e.passObj.confirmation?e.passObj["new"]!==e.passObj.confirmation?void s("error","Die Passwörter stimmen nicht überein"):void n.updatePassword({old:e.passObj.old,password:e.passObj["new"]}).then(function(e){s("success","Das neue Passwort wurde erfolgreich gespeichert")})["catch"](function(e){"Old password incorrect"===e.message?s("error","Das alte Passwort ist nicht korrekt"):"Password does not match requirements"===e.message?s("error","Das Passwort entspricht nicht den Sicherheitsrichtlinien"):s("error","Das neue Passwort konnte nicht gespeichert werden")}):void s("error","Alle Felder müssen ausgefüllt sein")},i=function(){o()},s=function(n,t){e.$$phase?e.message={type:n,text:t}:e.$apply(function(){e.message={type:n,text:t}})};r("#password-current"),e.updatePassword=o,e.delegateSubmit=i}]),angular.module("magellan").controller("QuizDirectiveController",["$scope","QuizSrv","LogSrv","FocusSrv","ngProgressFactory","$filter",function(e,n,t,r,o,i){var s,a=function(){e.progressbar=o.createInstance(),e.progressbar.setParent(document.getElementById("quiz-progress")),e.progressbar.setAbsolute(),e.progressbar.setColor("#336e7b"),e.isResultsPageVisible=!1,e.achievements=[],e.bests=[],e.answerInput={},e.hint=null,e.multiplierOptions=[{value:1,label:""},{value:1e3,label:"Tsd."},{value:1e6,label:"Mio."}],s=null},u=function(){if(s=n.getCurrentQuestion(),e.hint=null,null!==s){if(s.getInfo().input&&0===s.getInfo().input.indexOf("number"))switch(s.getInfo().input){case"number.high":e.answerInput.multiplier={value:1e6,label:"Mio."};break;case"number.medium":e.answerInput.multiplier={value:1e3,label:"Tsd."};break;default:e.answerInput.multiplier={value:1,label:""}}else e.answerInput.multiplier=null;P(),r(".answerInput")}},l=function(){return s},c=function(){return n.getCurrentQuestionNumber()},f=function(){return n.getNumberOfQuizQuestions()},d=function(){return C(l().question(),"question-highlight")+"?"},p=function(){return s&&s.getInfo().media?s.getInfo().media:null},g=function(){e.isResultsPageVisible=!0},h=function(){e.$$phase?e.isResultsPageVisible=!1:e.$apply(function(){e.isResultsPageVisible=!1})},m=function(){return null===s?!1:null===s.hintsRemaining()?!1:s.hintsRemaining()>0},v=function(){if(e.answerInput.answer&&!s.answered()){var n=String(e.answerInput.answer).trim();s.getInfo().input&&0===s.getInfo().input.indexOf("number")&&(n=n.replace(",",".")),e.answerInput.multiplier&&(n*=e.answerInput.multiplier.value),e.answerInput.points=s.answer(n),r(A()?"#btnContinueFinished":"#btnNextQuestion")}},w=function(){return n.isQuizRunning()&&null!==s?s.answered():!1},b=function(){n.nextQuestion(),e.answerInput.answer="",u()},O=function(){e.hint=s.hint(),r(".answerInput")},C=function(e,n){return e.replace("[","<span class='"+n+"'>").replace("]","</span>")},y=function(e){13==e.which&&v()},P=function(){var n=c()/f()*100;e.progressbar.set(n)},A=function(){return c()>=f()},S=function(n,t,r){var o=[],i=!0;if(n.indexOf("overall_best")>=0&&(o.push({text:"Du hast einen neuen absoluten Rekord geschafft!"}),i=!1),n.indexOf("overall_best_equalised")>=0&&(o.push({text:"Du hast den aktuellen absoluten Rekord eingestellt!"}),i=!1),n.indexOf("personal_best")>=0&&n.indexOf("overall_best")<0&&(o.push({text:"Du hast einen neuen persönlichen Rekord geschafft!"}),i=!1),n.indexOf("personal_best_equalised")>=0&&n.indexOf("overall_best_equalised")<0&&(o.push({text:"Du hast gleich viele Punkte geschafft wie bei deinem persönlichen Rekord!"}),i=!1),n.indexOf("new_daily_best")>=0&&0===o.length&&o.push({text:"Du hast einen neuen persönlichen Tagesrekord geschafft!"}),e.$$phase?e.achievements=o:e.$apply(function(){e.achievements=o}),i&&t&&t.id&&t.date&&t.score&&r&&r.id&&r.date&&r.score){var s=[];r.type="overall",s.push(r),t.id!==r.id&&(t.type="personal",s.push(t)),e.$$phase?e.bests=s:e.$apply(function(){e.bests=s})}else e.$$phase?e.bests=null:e.$apply(function(){e.bests=null})},$=function(){e.progressbar.set(0),g(),b(),n.conclude().then(function(e){S(e.events||[],e.personalBest,e.overallBest)})["catch"](function(e){t.error(e)})},_=function(n){var t;if("personal"===n.type)t="Dein persönlicher Rekord liegt bei <span class='bold'>{POINTS} Punkten</span>, aufgestellt am {DATE}.";else{var r=n.id===e.user._id;t=r?"Du hältst den absoluten Rekord mit <span class='bold'>{POINTS} Punkten</span>, aufgestellt am {DATE}.":"<span class='highlight'>{USERNAME}</span> hält den absoluten Rekord mit <span class='bold'>{POINTS} Punkten</span>, aufgestellt am {DATE}."}return t.replace("{POINTS}",i("number")(n.score)).replace("{DATE}",T(n.date)).replace("{USERNAME}",n.username)},T=function(e){return e=new Date(e),U(e.getDate(),"00")+"."+U(e.getMonth()+1,"00")+"."+(e.getYear()+1900)},U=function(e,n){return String(n+e).slice(-n.length)},k=function(){quiz=null,e.$emit("quiz.restart"),a(),u()},R=function(e,n){if(13==e.which)switch(n){case"next_question":b();break;case"continue_finished":$()}};e.$on("quiz.start",function(e,n){h()}),e.$on("$destroy",function(e,t){n.hasQuizStarted()&&n.hasQuizEnded()&&n.dispose()}),a(),u(),e.getQuestion=l,e.getCurrentQuestionNumber=c,e.renderQuestionText=d,e.submitAnswer=v,e.questionAnswered=w,e.nextQuestion=b,e.handleKeyPress=y,e.getQuestionMedia=p,e.requestHint=O,e.wasLastQuestion=A,e.continueFinished=$,e.getBestText=_,e.restartQuiz=k,e.hintsAvailable=m,e.enterListener=R}]),angular.module("magellan").controller("QuizCtrl",["$scope","QuizSrv","LogSrv",function(e,n,t){var r=function(e){n.init().then(function(){e&&"function"==typeof e&&e()})["catch"](function(e){t.error(e)})},o=function(){return n.isQuizRunning()},i=function(){return n.hasQuizStarted()},s=function(){return n.hasQuizEnded()},a=function(){return n.getTotalPoints()};e.$on("quiz.restart",function(t,o){n.dispose(),r(function(){e.$broadcast("quiz.start")})}),e.startQuiz=r,e.isQuizRunning=o,e.hasQuizStarted=i,e.hasQuizEnded=s,e.getTotalPoints=a}]),angular.module("magellan").controller("RegisterCtrl",["$scope","LogSrv","FocusSrv","UserSrv","$state","$window",function(e,n,t,r,o,i){e.newUser={},e.message=null;var s=function(t){return t?void(a()&&r.register(e.newUser).then(function(n){200===n.status?(e.$emit("app.login",n.data),o.go("faq",{action:"register.successful"})):e.message={type:"error",text:"Bei der Anmeldung scheint etwas schief gegangen zu sein"}})["catch"](function(t){n.error(t);var r;switch(t.message){case"Username already exists":r="Der Benutzername ist bereits in Verwendung";break;case"Email address already exists":r="Die E-Mail-Adresse ist bereits in Verwendung";break;case"Password does not match requirements":r="Das Passwort entspricht nicht den Sicherheitsrichtlinien";break;default:r="Bei der Anmeldung scheint etwas schief gegangen zu sein"}e.$$phase?e.message={type:"error",text:r}:e.$apply(function(){e.message={type:"error",text:r}})})):!1},a=function(){e.message=null;var n=e.newUser.password,t=e.newUser.password2;return e.newUser.username&&e.newUser.email&&n&&t?""===n||""===t?e.message={type:"error",text:"Die Passwörter können nicht leer sein"}:n!==t&&(e.message={type:"error",text:"Die Passwörter stimmen nicht überein"}):e.message={type:"error",text:"Alle Felder müssen ausgefüllt sein"},!e.message},u=function(){s(!0)};e.delegateSubmit=u,e.register=s,t("#username")}]),angular.module("magellan").controller("ResetCtrl",["$scope","UserSrv","LogSrv","FocusSrv","$stateParams",function(e,n,t,r,o){e.passObj={},e.message={};var i=o.token,s=function(){return e.passObj["new"]&&e.passObj.confirmation?e.passObj["new"]!==e.passObj.confirmation?void u("error","Die Passwörter stimmen nicht überein"):i?void n.resetPassword({token:i,password:e.passObj["new"]}).then(function(e){u("success","Das Passwort wurde erfolgreich gespeichert")})["catch"](function(e){"Invalid token"===e.message?u("error","Der Zurücksetzen-Link ist leider nicht mehr gültig"):"Password does not match requirements"===e.message?u("error","Das Passwort entspricht nicht den Sicherheitsrichtlinien"):u("error","Das neue Passwort konnte nicht gespeichert werden")}):void u("error","Kein gültiger Zurücksetzen-Link"):void u("error","Alle Felder müssen ausgefüllt sein")},a=function(){s()},u=function(n,t){e.$$phase?e.message={type:n,text:t}:e.$apply(function(){e.message={type:n,text:t}})};r("#password-new"),e.resetPassword=s,e.delegateSubmit=a}]),angular.module("magellan").controller("SettingsCtrl",["$scope","AppConfig","FocusSrv","LogSrv","UserSrv",function(e,n,t,r,o){var i=function(){e.message=null;var i=n["settings.user.colors"];e.userObj={username:e.user.username,email:e.user.email,color:e.user.color},e.userColors=i;var s=function(n){e.userObj.color=n},a=function(){o.updateBasic(e.userObj).then(function(n){e.user.username=e.userObj.username,e.user.email=e.userObj.email,e.user.color=e.userObj.color,e.$apply(function(){e.message={type:"success",text:"Einstellungen wurden erfolgreich gespeichert"}})})["catch"](function(n){r.error("Update user",n);var t;switch(n.message){case"Username already exists":t="Der Benutzername ist bereits vergeben";break;case"Email address already exists":t="Die E-Mail-Adresse ist bereits vergeben";break;default:t="Die Einstellungen konnten nicht gespeichert werden"}e.$apply(function(){e.message={type:"error",text:t}})})},u=function(){a(!0)};e.setColor=s,e.updateUser=a,e.delegateSubmit=u,t("#username")};e.user&&i(),e.$on("user.loaded",function(e,n){i()})}]),angular.module("magellan").directive("clickOutside",["$parse","$document","$rootScope",function(e,n,t){return{restrict:"A",link:function(e,r,o){function i(e){e.stopPropagation();var n=$(e.target).parents(),o=-1!==n.index($(r)),i=e.target===r[0],s=!o&&!i;s&&t.$broadcast("click.outside",e)}n.bind("click",i),r.bind("remove",function(){n.unbind("click",i)})}}}]),angular.module("magellan").directive("map",function(){return{restrict:"E",templateUrl:"build/views/templates/map.template.html",controller:"MapCtrl",link:function(e,n,t){new Datamap({element:document.getElementById("map-container"),fills:{defaultFill:"#22a7f0"},geographyConfig:{highlightOnHover:!0,popuponHover:!0,highlightFillColor:"#019875",highlightBorderColor:"rgba(200, 247, 197, 0.4)"}})}}}),angular.module("magellan").directive("passwordRequirements",function(){return{restrict:"E",templateUrl:"build/views/templates/password-requirements.template.html",controller:"PasswordRequirementsCtrl",scope:{passwordInput:"@attributeInput"}}}),angular.module("magellan").directive("quiz",function(){return{templateUrl:"build/views/templates/quiz-directive.template.html",scope:!0,controller:"QuizDirectiveController",restrict:"E",link:function(e,n,t){}}}),angular.module("magellan").filter("renderHtml",["$sce",function(e){return function(n){return e.trustAsHtml(n)}}]),angular.module("magellan").filter("textOrNumber",["$filter",function(e){return function(n,t){return t=void 0!==t?0:t,isNaN(n)?n:e("number")(n,t)}}]),angular.module("magellan").factory("AuthInterceptor",["AuthTokenSrv",function(e){var n=function(n){var t=e.getToken();return t&&(n.headers=n.headers||{},n.headers["X-Auth"]=t),n};return{request:n}}]),angular.module("magellan").factory("AuthTokenSrv",["$window",function(e){var n=e.sessionStorage,t="auth-token",r=function(){return n.getItem(t)},o=function(e){e?n.setItem(t,e):n.removeItem(t)};return{getToken:r,setToken:o}}]),angular.module("magellan").factory("AuthSrv",["UserSrv",function(e){var n=null,t=function(){return new Promise(function(t,r){null!==n?t(n):e.getUserFromStorage().then(function(e){n=e,t(e)})["catch"](function(e){r("Not logged in")})})},r=function(e){n=e},o=function(){n=null};return{setUser:r,getUser:t,clearUser:o}}]),angular.module("magellan").factory("CountrySrv",["$http","IndexedDBSrv","LogSrv",function(e,n,t){var r=null,o=null,i=null,s="magellan",a="countryStore",u="countries",l="version",c=n.indexedDBAvailable(),f=function(){return d()},d=function(){return c?new Promise(function(e,u){n.createDatabase(s,a).then(h).then(m).then(v).then(p).then(g).then(function(n){r=n.countries,t.info("loaded countries from",n.loadStrategy.toUpperCase()),o={},i={},r.forEach(function(e){o[e.alpha3Code]=e;var n=e.name.substr(0,1).toUpperCase();switch(n){case"Ä":n="A";break;case"Ö":n="O";break;case"Ü":n="U"}void 0===i[n]&&(i[n]=[]),i[n].push({alpha3Code:e.alpha3Code,name:e.name})}),e(r)})["catch"](function(e){t.error("failed to load countries",e),u(e)})}):b()},p=function(e){return new Promise(function(n,t){var r,o=e.internalVersion,i=e.externalVersion;r=null===o?"api":i>o?"api":"db",e.loadStrategy=r,n(e)})},g=function(e){return new Promise(function(t,r){var o=e.loadStrategy;switch(o){case"api":b().then(function(r){e.countries=r,n.putItem(s,a,{name:u,value:r}),n.putItem(s,a,{name:l,value:e.externalVersion}),t(e)})["catch"](function(e){r(e)});break;case"db":w(e).then(function(e){t(e)})["catch"](function(e){r(e)});break;default:r("Unknown load strategy")}})},h=function(){return new Promise(function(e,n){e({})})},m=function(e){return new Promise(function(t,r){n.retrieveItem(s,a,l).then(function(n){e.internalVersion=n.value,t(e)})["catch"](function(n){e.internalVersion=null,t(e)})})},v=function(e){return O().then(function(n){return e.externalVersion=n,e})},w=function(e){return new Promise(function(t,r){n.retrieveItem(s,a,u).then(function(n){e.countries=n.value,t(e)})["catch"](function(e){t(null)})})},b=function(){return new Promise(function(n,t){e.get("/api/countries").then(function(e){n(e.data)})["catch"](function(e){t(e)})})},O=function(){return new Promise(function(n,t){e.get("/api/countries/version").then(function(e){n(e.data.version||0)})["catch"](function(e){n(0)})})},C=function(e){return null===o?null:o[e]},y=function(){return r},P=function(){return null===i?null:i},A=function(){return null!==r&&r.length>0};return{init:f,getCountries:y,getCountryByAlpha3:C,getCountriesByLetter:P,areCountriesLoaded:A}}]),angular.module("magellan").factory("EventSrv",["$http","LogSrv",function(e,n){var t=function(t){e.post("/api/event/add",{name:t}).success(function(e){})["catch"](function(e){n.error("failed to add event",e)})};return{add:t}}]),angular.module("magellan").factory("FocusSrv",["$timeout","$window",function(e,n){return function(t){e(function(){var e=n.document.querySelector(t);e&&e.focus()})}}]),angular.module("magellan").factory("IndexedDBSrv",["$window",function(e){var n="name",t=e.indexedDB||e.webkitIndexedDB||e.msIndexedDB,r=e.IDBKeyRange||e.webkitIDBKeyRange,o=e.IDBTransaction||e.webkitIDBTransaction;o&&(o.READ_WRITE=o.READ_WRITE||"readwrite",o.READ_ONLY=o.READ_ONLY||"readonly");var i=function(){return!!t},s=function(e,r){return new Promise(function(o,i){var s=t.open(e);s.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore(r,{keyPath:n})},s.onsuccess=function(e){o(e)},s.onerror=function(e){i(e)}})},a=function(e){return new Promise(function(n,r){var o=t.deleteDatabase(e);o.onsuccess=function(e){n(e)},o.onerror=function(e){r(e)}})},u=function(e,n,r){return new Promise(function(i,s){var a=t.open(e);a.onsuccess=function(e){var t=e.target.result,a=t.transaction(n,o.READ_WRITE),u=a.objectStore(n),l=u.add(r);l.onsuccess=function(e){i(e)},l.onerror=function(e){s(e)}}})},l=function(e,n,r){return new Promise(function(i,s){var a=t.open(e);a.onsuccess=function(e){var t=e.target.result,a=t.transaction(n,o.READ_WRITE),u=a.objectStore(n),l=u.put(r);l.onsuccess=function(e){i(e)},l.onerror=function(e){s(e)}}})},c=function(e,n,i){return new Promise(function(s,a){var u=null,l=t.open(e);l.onsuccess=function(e){var t=e.target.result,a=t.transaction(n,o.READ_ONLY),l=a.objectStore(n),c=r.only(i);l.openCursor(c).onsuccess=function(e){var n=e.target.result;n?(u=n.value,n["continue"]()):s(u)}},l.onerror=function(e){a(e)}})},f=function(e,n){return new Promise(function(r,i){var s=[],a=t.open(e);a.onsuccess=function(e){var t=e.target.result,i=t.transaction(n,o.READ_ONLY),a=i.objectStore(n);a.openCursor().onsuccess=function(e){var n=e.target.result;n?(s.push(n.value),n["continue"]()):r(s)}},a.onerror=function(e){i(e)}})};return{createDatabase:s,dropDatabase:a,addItem:u,putItem:l,retrieveItem:c,retrieveItems:f,indexedDBAvailable:i}}]),angular.module("magellan").factory("LogSrv",["AppConfig",function(e){var n=function(){e["log.info"]&&console.log.apply(console,arguments)},t=function(){e["log.error"]&&console.error.apply(console,arguments)};return{info:n,error:t}}]),angular.module("magellan").factory("QuizSrv",["AppConfig","CountrySrv","ScoreSrv","EventSrv",function(e,n,t,r){var o=null,i=null,s=function(e){o=e},a=function(){return null!==o&&o.length>0},u=function(){return new Promise(function(e,n){a||n("Countries have not been loaded"),i=p("country"),r.add("quiz.start"),e(i.start())})},l=function(){i=null},c=function(){return null===i?!1:i.hasStarted()&&!i.hasEnded()},f=function(){return null===i?!1:i.hasStarted()},d=function(){return null===i?!1:i.hasEnded()},p=function(e){switch(e){case"country":default:return g()}},g=function(){for(var t=new Quiz,r=100,i=3,s=25,a=2.5,u=e["quiz.country.types"],l=(Object.keys(u).length,[]),c=e["quiz.country.questions"],f=o.filter(function(e){return"easy"===e.difficulty}),d=o.filter(function(e){return"medium"===e.difficulty}),p=o.filter(function(e){return"hard"===e.difficulty}),g=0;c>g;g++){for(var C,y=!1;!y;)C=5>g?f[getRandomInt(0,f.length-1)]:10>g?d[getRandomInt(0,d.length-1)]:p[getRandomInt(0,p.length-1)],y=l.indexOf(C.alpha3Code)<0;l.push(C.alpha3Code)}var P=l.splice(0,l.length-1),A=_(P);A.push(l[l.length-1]);for(var S=[],$=0;c>$;$++)S.push(6);var T=_(S),U=0;return A.forEach(function(e,o){U++;var l=n.getCountryByAlpha3(e),f=u[T[o]],d=h(f,l),p={type:f,difficulty:l.difficulty,input:v(f),unit:w(f)},g=m(f,l),C=b(f,r,a),y=O(f,i,s);U>=c&&(p.bonus=!0),"FLAG_OF_COUNTRY"===f&&(p.media="flag",p.alpha2Code=l.alpha2Code.toLocaleLowerCase()),"LOCATION_OF_COUNTRY"===f&&(p.media="map",p.alpha2Code=l.alpha2Code.toLocaleLowerCase()),t.addQuestion(new Question({text:d,info:p,answer:g,checkAnswer:C,hints:y}))}),t},h=function(e,n){switch(e){case"CAPITAL_OF_COUNTRY":return"Wie heißt die Hauptstadt von ["+n.name+"]";case"COUNTRY_OF_CAPITAL":return"["+n.capital+"] ist die Hauptstadt von welchem Land";case"POPULATION_OF_COUNTRY":return"Wie viele Menschen leben in ["+n.name+"]";case"AREA_OF_COUNTRY":return"Wie groß ist die Fläche von ["+n.name+"]";case"FLAG_OF_COUNTRY":return"Welches Land hat diese Flagge";case"LOCATION_OF_COUNTRY":return"Wo befindet sich ["+n.name+"]";default:return"?"}},m=function(e,n){switch(e){case"CAPITAL_OF_COUNTRY":var t=void 0!==n.altSpellings&&void 0!==n.altSpellings.capital?n.altSpellings.capital:[];return{correct:n.capital,altSpellings:t};case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":var t=void 0!==n.altSpellings&&void 0!==n.altSpellings.name?n.altSpellings.name:[];return{correct:n.name,altSpellings:t};case"POPULATION_OF_COUNTRY":return{correct:n.population};case"AREA_OF_COUNTRY":return{correct:n.area};case"LOCATION_OF_COUNTRY":return{correct:n.alpha2Code};default:return"?"}},v=function(e){switch(e){case"POPULATION_OF_COUNTRY":return"number.high";case"AREA_OF_COUNTRY":return"number.medium";case"LOCATION_OF_COUNTRY":return"map.point";case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":default:return"text.standard"}},w=function(e){switch(e){case"AREA_OF_COUNTRY":return"km²";case"POPULATION_OF_COUNTRY":return"Einwohner";default:return null}},b=function(e,n,t){switch(e){case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":case"LOCATION_OF_COUNTRY":return function(e,r,o,i,s){var a;a=e.altSpellings&&e.altSpellings.length>0?e.altSpellings.map(function(e){return e.toLocaleLowerCase()}):[];var u=r.toLocaleLowerCase()===e.correct.toLocaleLowerCase()||a&&a.indexOf(r)>=0,l=u?n:0;return o>0&&(l-=o*i),void 0!==s&&void 0!==s.bonus&&s.bonus===!0&&(l*=t),l};case"POPULATION_OF_COUNTRY":case"AREA_OF_COUNTRY":return function(e,n,r,o,i){var s,a=Math.abs(n-e.correct)/e.correct*100;return s=3>=a?100:6>=a?90:9>=a?80:12>=a?70:14>=a?60:16>=a?50:18>=a?40:20>=a?30:25>=a?20:30>=a?10:0,
r>0&&(s-=r*o),void 0!==i&&void 0!==i.bonus&&i.bonus===!0&&(s*=t),s};default:return"?"}},O=function(e,n,t){switch(e){case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":case"FLAG_OF_COUNTRY":return{allowed:!0,maximum:n,cost:t,give:function(e,n){return n.correct.substr(0,e)}};case"POPULATION_OF_COUNTRY":case"AREA_OF_COUNTRY":return{allowed:!1};default:return"?"}},C=function(){return c()?i.getCurrentQuestionNumber():null},y=function(){return c()?i.getNumberOfQuestions():null},P=function(){return c()?i.currentQuestion():null},A=function(){c()&&i.nextQuestion()},S=function(){return null===i?null:i.getTotalPoints()},$=function(){return new Promise(function(e,n){null!==i&&i.hasEnded()?(i.submitted===!0&&n("Quiz has already been submitted"),i.submitted=!0,t.putHighscore(i.getTotalPoints()).then(function(n){r.add("quiz.finish"),e(n)})["catch"](function(e){n(e)})):n("No quiz is currently running")})},_=function(e){for(var n,t,r=e.length;0!==r;)t=Math.floor(Math.random()*r),r-=1,n=e[r],e[r]=e[t],e[t]=n;return e};return{init:u,setCountries:s,isQuizRunning:c,hasQuizStarted:f,hasQuizEnded:d,getCurrentQuestionNumber:C,getNumberOfQuizQuestions:y,getCurrentQuestion:P,nextQuestion:A,getTotalPoints:S,conclude:$,dispose:l}}]),angular.module("magellan").factory("ScoreSrv",["$http",function(e){var n=function(){return new Promise(function(n,t){e.get("/api/scores/all").success(function(e){n(e)}).error(function(e){t(e)})})},t=function(){return new Promise(function(n,t){e.get("/api/scores/user").success(function(e){n(e)}).error(function(e){t(e)})})},r=function(){return new Promise(function(n,t){e.get("/api/scores/high").success(function(e){n(e)}).error(function(e){t(e)})})},o=function(n){return new Promise(function(t,r){e.put("/api/scores",{score:n}).success(function(e){t(e)}).error(function(e){r(e)})})};return{getHighscoreList:n,getUserHighscore:t,getOverallHighscore:r,putHighscore:o}}]),angular.module("magellan").factory("UserSrv",["$http","AuthTokenSrv","AppConfig",function(e,n,t){var r=this,o=function(){return e.get("/api/user")},i=function(){return new Promise(function(e,t){var r=n.getToken();r?(n.setToken(r),o().then(function(n){e(n.data)})["catch"](function(e){t(e)})):t("No token in storage")})},s=function(t,i){return e.post("/api/session",{username:t,password:i}).then(function(e){return r.token=e.data,n.setToken(r.token),o()})},a=function(){return new Promise(function(e,t){r.token=null,n.setToken(),e()})},u=function(n){return new Promise(function(r,o){var i=t["settings.user.colors"];n.color=i[getRandomInt(0,i.length-1)],e.post("/api/user",n).success(function(e){s(n.username,n.password).then(function(e){r(e)})["catch"](function(e){o(e)})}).error(function(e){o(e)})})},l=function(n){return new Promise(function(t,r){e.put("/api/user/basic",n).success(function(e){t(e)}).error(function(e){r(e)})})},c=function(n){return new Promise(function(t,r){e.put("/api/user/password",n).success(function(e){t(e)}).error(function(e){r(e)})})},f=function(n){return new Promise(function(t,r){e.post("/api/password/reset",n).success(function(e){t(e)}).error(function(e){r(e)})})},d=function(n){return new Promise(function(t,r){e.post("/api/password/forgot",n).success(function(e){t(e)}).error(function(e){r(e)})})};return{getUser:o,getUserFromStorage:i,login:s,logout:a,register:u,updateBasic:l,updatePassword:c,resetPassword:f,forgotPassword:d}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjcmlwdC5qcyIsIm1vZGVscy5qcyIsInJvdXRlcy5qcyIsImNvbnRyb2xsZXJzL2NvdW50cmllcy5jdHJsLmpzIiwiY29udHJvbGxlcnMvY291bnRyeS1kZXRhaWwuY3RybC5qcyIsImNvbnRyb2xsZXJzL2NvdW50cnktZGlmZmljdWx0eS5jdHJsLmpzIiwiY29udHJvbGxlcnMvZHJvcGRvd24uY3RybC5qcyIsImNvbnRyb2xsZXJzL2ZhcS5jdHJsLmpzIiwiY29udHJvbGxlcnMvZm9yZ290LmN0cmwuanMiLCJjb250cm9sbGVycy9oaWdoc2NvcmUuY3RybC5qcyIsImNvbnRyb2xsZXJzL2xvZ2luLmN0cmwuanMiLCJjb250cm9sbGVycy9sb2dvdXQuY3RybC5qcyIsImNvbnRyb2xsZXJzL21hcC5jdHJsLmpzIiwiY29udHJvbGxlcnMvcGFzc3dvcmQtcmVxdWlyZW1lbnRzLmN0cmwuanMiLCJjb250cm9sbGVycy9wYXNzd29yZC5jdHJsLmpzIiwiY29udHJvbGxlcnMvcXVpei1kaXJlY3RpdmUuY3RybC5qcyIsImNvbnRyb2xsZXJzL3F1aXouY3RybC5qcyIsImNvbnRyb2xsZXJzL3JlZ2lzdGVyLmN0cmwuanMiLCJjb250cm9sbGVycy9yZXNldC5jdHJsLmpzIiwiY29udHJvbGxlcnMvc2V0dGluZ3MuY3RybC5qcyIsImRpcmVjdGl2ZXMvY2xpY2stb3V0c2lkZS5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL21hcC5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL3Bhc3N3b3JkLXJlcXVpcmVtZW50cy5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL3F1aXouZGlyZWN0aXZlLmpzIiwiZmlsdGVycy9yZW5kZXJIdG1sLmZpbHRlci5qcyIsImZpbHRlcnMvdGV4dE9yTnVtYmVyLmpzIiwiaW50ZXJjZXB0b3JzL2F1dGguaW50ZXJjZXB0b3IuanMiLCJzZXJ2aWNlcy9hdXRoLXRva2VuLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9hdXRoLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9jb3VudHJ5LnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9ldmVudC5zZXJ2aWNlLmpzIiwic2VydmljZXMvZm9jdXMuc2VydmljZS5qcyIsInNlcnZpY2VzL2luZGV4ZWQtZGIuc2VydmljZS5qcyIsInNlcnZpY2VzL2xvZy5zZXJ2aWNlLmpzIiwic2VydmljZXMvcXVpei5zZXJ2aWNlLmpzIiwic2VydmljZXMvc2NvcmUuc2VydmljZS5qcyIsInNlcnZpY2VzL3VzZXIuc2VydmljZS5qcyJdLCJuYW1lcyI6WyJtYWdlbGxhbiIsImFuZ3VsYXIiLCJtb2R1bGUiLCIkaHR0cFByb3ZpZGVyIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsImNvbnN0YW50IiwibG9nLmluZm8iLCJsb2cuZXJyb3IiLCJxdWl6LmNvdW50cnkucXVlc3Rpb25zIiwicXVpei5jb3VudHJ5LnR5cGVzIiwiMSIsIjIiLCIzIiwiNCIsIjUiLCI2Iiwic2V0dGluZ3MudXNlci5jb2xvcnMiLCJjb250cm9sbGVyIiwiJHJvb3RTY29wZSIsIiRzY29wZSIsIiRzdGF0ZSIsIkF1dGhTcnYiLCJVc2VyU3J2IiwiQ291bnRyeVNydiIsIlF1aXpTcnYiLCJhcHAiLCJjb25maWciLCJ0aXRsZSIsInN1YnRpdGxlIiwiYXV0aG9yIiwiZ2V0VXNlciIsInRoZW4iLCJ1c2VyIiwiJGJyb2FkY2FzdCIsImluaXQiLCJjb3VudHJpZXMiLCJzZXRDb3VudHJpZXMiLCJlcnIiLCJpc1Byb2dyZXNzQmFyVmlzaWJsZSIsImlzIiwiZ29Ub0hvbWUiLCJnbyIsIiRvbiIsImV2ZW50IiwidG9TdGF0ZSIsInRvUGFyYW1zIiwiZnJvbVN0YXRlIiwiZnJvbVBhcmFtcyIsImVycm9yIiwiZGF0YSIsInNldFVzZXIiLCJjbGVhclVzZXIiLCJjcmVhdGVNYXAiLCJEYXRhbWFwIiwiZWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZW9ncmFwaHlDb25maWciLCJoaWdobGlnaHRPbkhvdmVyIiwicG9wdXBPbkhvdmVyIiwiUXVpeiIsImN1cnJlbnRRdWVzdGlvbklkeCIsInF1ZXN0aW9ucyIsInRoaXMiLCJzdGFydCIsImxlbmd0aCIsIkVycm9yIiwibmV4dFF1ZXN0aW9uIiwiaXNBY3RpdmUiLCJoYXNTdGFydGVkIiwiaGFzRW5kZWQiLCJzdWJtaXR0ZWQiLCJhZGRRdWVzdGlvbiIsInF1ZXN0aW9uIiwidW5kZWZpbmVkIiwidmFsaWQiLCJuZWNlc3NhcnlQcm9wZXJ0aWVzIiwiZm9yRWFjaCIsInByb3BlcnR5IiwiaGFzT3duUHJvcGVydHkiLCJjdXJyZW50UXVlc3Rpb24iLCJnZXRUb3RhbFBvaW50cyIsInRvdGFsUG9pbnRzIiwicG9pbnRzIiwiZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyIiwiZ2V0TnVtYmVyT2ZRdWVzdGlvbnMiLCJRdWVzdGlvbiIsIm9wdGlvbnMiLCJ0ZXh0IiwiaW5mbyIsImFuc3dlciIsImhpbnRzIiwiaGludHNVc2VkIiwiY2hlY2tBbnN3ZXIiLCJhbnN3ZXJlZCIsIm9wdHMiLCJhbGxvd2VkIiwibWF4aW11bSIsImNvc3QiLCJnaXZlIiwicHJvcCIsInZhbHVlIiwiZ2V0SW5mbyIsInNvbHV0aW9uIiwiaGludCIsInN1Ym1pdHRlZEFuc3dlciIsIk1hdGgiLCJtYXgiLCJmbG9vciIsImhpbnRzQWxsb3dlZCIsImhpbnRzUmVtYWluaW5nIiwiZ2V0UmFuZG9tSW50IiwibWluIiwicmFuZG9tIiwiZ2V0U3RyaW5nQmV0d2VlbiIsImZpcnN0U3RyaW5nIiwic2Vjb25kU3RyaW5nIiwiZmlyc3RQb3MiLCJpbmRleE9mIiwic2Vjb25kUG9zIiwic3Vic3RyIiwiUGFzc3dvcmRSZXF1aXJlbWVudHNWYWxpZGF0b3IiLCJzZWxmIiwiZGVmYXVsdENvbmZpZyIsIm1pbkxlbmd0aCIsIm1heExlbmd0aCIsImxvd2VyY2FzZUNoYXJzIiwidXBwZXJjYXNlQ2hhcnMiLCJzcGVjaWFsQ2hhcnMiLCJudW1lcmljQ2hhcnMiLCJjb25maWd1cmF0aW9uIiwiaW5wdXQiLCJjaGVjayIsIl9pbnB1dCIsImZhaWxlZENoZWNrcyIsImNvbmZpZ1Byb3BlcnRpZXMiLCJnZXRDb25maWdQcm9wZXJ0aWVzIiwiY29uZmlnUHJvcCIsInJlc3VsdCIsInBlcmZvcm1DaGVjayIsInBhc3N3b3JkT2siLCJzZXRDb25maWciLCJfY29uZmlnIiwiZ2V0Q29uZmlnIiwiT2JqZWN0Iiwia2V5cyIsImdldENvbmZpZ1Byb3BlcnR5IiwicHJvcGVydHlWYWx1ZSIsIm51bUxvd2VyIiwicmVwbGFjZSIsIm51bVVwcGVyIiwibnVtU3BlY2lhbHMiLCJudW1OdW1iZXJzIiwiQ09ORklHX1BST1BFUlRJRVMiLCJleHBvcnRzIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsImh0bWw1TW9kZSIsIm90aGVyd2lzZSIsImF1dGhvcml6ZSIsIkxvZ1NydiIsIiRxIiwicmVqZWN0IiwiJGluamVjdCIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJyZXNvbHZlIiwiYXV0aCIsInBhcmFtcyIsImFjdGlvbiIsImNvdW50cmllc0J5TGV0dGVyIiwiY291bnRyeUtleXMiLCJnZXRDb3VudHJpZXNCeUxldHRlciIsInNvcnQiLCIkJHBoYXNlIiwiJGFwcGx5IiwiYXJlQ291bnRyaWVzTG9hZGVkIiwiJHN0YXRlUGFyYW1zIiwiYWxwaGEzQ29kZSIsImNvdW50cnkiLCJnZXRDb3VudHJ5QnlBbHBoYTMiLCJnZXRDb3VudHJ5RnJvbVNlcnZpY2UiLCJhbHBoYTMiLCJnZXRDb3VudHJpZXMiLCJkaWZmaWN1bHRpZXMiLCJlYXN5IiwibWVkaXVtIiwiaGFyZCIsInVuYXNzaWduZWQiLCJhIiwiYiIsInBvcHVsYXRpb24iLCJjIiwiZGlmZmljdWx0eSIsImRpZmZpY3VsdHlLZXlzIiwidG9nZ2xlRHJvcGRvd24iLCJ2aXNpYmxlIiwic2hvd0Ryb3Bkb3duIiwiaGlkZURyb3Bkb3duIiwiaXNEcm9wZG93blZpc2libGUiLCJtZXNzYWdlIiwidHlwZSIsIkZvY3VzU3J2IiwicGFzc09iaiIsImZvcmdvdFBhc3N3b3JkIiwiZW1haWwiLCJ2YWxpZGl0eSIsInZhbGlkVGV4dCIsInNldE1lc3NhZ2UiLCJkZWxlZ2F0ZVN1Ym1pdCIsIlNjb3JlU3J2Iiwic2NvcmVMaXN0IiwiaXNEYXRhTG9hZGluZyIsImdldEhpZ2hzY29yZUxpc3QiLCJsaXN0IiwiY3JlYXRlUmFua2luZyIsInNldExvYWRpbmdTdGF0ZSIsImlzTXlzZWxmIiwiaWQiLCJfaWQiLCJyYW5rIiwicHJldmlvdXNTY29yZSIsImVudHJ5Iiwic2NvcmUiLCJsb2dpbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJyZXNwb25zZSIsIiRlbWl0IiwiY29uc29sZSIsIm1lc3NhZ2VUZXh0Iiwic3RhdHVzIiwibG9nb3V0IiwicmVxcyIsImtleSIsImRlc2NyaXB0aW9uIiwidmFsaWRhdG9yIiwiJHdhdGNoIiwibmV3VmFsdWUiLCJvbGRWYWx1ZSIsInNjb3BlIiwidXBkYXRlUmVxdWlyZW1lbnRzIiwic2V0U2NvcGVQcm9wZXJ0eSIsIm1hcCIsInJlcXVpcmVtZW50IiwiZnVsZmlsbGVkIiwidXBkYXRlUGFzc3dvcmQiLCJvbGQiLCJjb25maXJtYXRpb24iLCJuZ1Byb2dyZXNzRmFjdG9yeSIsIiRmaWx0ZXIiLCJpbml0Q3RybCIsInByb2dyZXNzYmFyIiwiY3JlYXRlSW5zdGFuY2UiLCJzZXRQYXJlbnQiLCJzZXRBYnNvbHV0ZSIsInNldENvbG9yIiwiaXNSZXN1bHRzUGFnZVZpc2libGUiLCJhY2hpZXZlbWVudHMiLCJiZXN0cyIsImFuc3dlcklucHV0IiwibXVsdGlwbGllck9wdGlvbnMiLCJsYWJlbCIsInVwZGF0ZVVpIiwiZ2V0Q3VycmVudFF1ZXN0aW9uIiwibXVsdGlwbGllciIsInVwZGF0ZVByb2dyZXNzQmFyIiwiZ2V0UXVlc3Rpb24iLCJnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMiLCJyZW5kZXJRdWVzdGlvblRleHQiLCJyZW5kZXIiLCJnZXRRdWVzdGlvbk1lZGlhIiwibWVkaWEiLCJzaG93UmVzdWx0c1BhZ2UiLCJoaWRlUmVzdWx0c1BhZ2UiLCJoaW50c0F2YWlsYWJsZSIsInN1Ym1pdEFuc3dlciIsIlN0cmluZyIsInRyaW0iLCJ3YXNMYXN0UXVlc3Rpb24iLCJxdWVzdGlvbkFuc3dlcmVkIiwiaXNRdWl6UnVubmluZyIsInJlcXVlc3RIaW50IiwiY2xhc3NOYW1lIiwiaGFuZGxlS2V5UHJlc3MiLCJrZXlFdmVudCIsIndoaWNoIiwicHJvZ3Jlc3NQZXJjZW50Iiwic2V0IiwicGFyc2VFdmVudHMiLCJldmVudHMiLCJwZXJzb25hbEJlc3QiLCJvdmVyYWxsQmVzdCIsInNob3dCZXN0cyIsImRhdGUiLCJjb250aW51ZUZpbmlzaGVkIiwiY29uY2x1ZGUiLCJnZXRCZXN0VGV4dCIsImJlc3QiLCJmcm9tTXlzZWxmIiwiZ2V0Rm9ybWF0dGVkRGF0ZSIsIkRhdGUiLCJwYWQiLCJnZXREYXRlIiwiZ2V0TW9udGgiLCJnZXRZZWFyIiwic3RyIiwicGFkVmFsdWUiLCJzbGljZSIsInJlc3RhcnRRdWl6IiwicXVpeiIsImVudGVyTGlzdGVuZXIiLCJrZXlQcmVzcyIsImZ1bmMiLCJoYXNRdWl6U3RhcnRlZCIsImhhc1F1aXpFbmRlZCIsImRpc3Bvc2UiLCJzdGFydFF1aXoiLCJjYiIsIiR3aW5kb3ciLCJuZXdVc2VyIiwicmVnaXN0ZXIiLCJpc1ZhbGlkIiwidmFsaWRhdGVCZWZvcmVTdWJtaXQiLCJwYXNzd29yZDIiLCJ0b2tlbiIsInJlc2V0UGFzc3dvcmQiLCJBcHBDb25maWciLCJjb2xvcnMiLCJ1c2VyT2JqIiwiY29sb3IiLCJ1c2VyQ29sb3JzIiwibmV3Q29sb3IiLCJ1cGRhdGVVc2VyIiwidXBkYXRlQmFzaWMiLCJkaXJlY3RpdmUiLCIkcGFyc2UiLCIkZG9jdW1lbnQiLCJyZXN0cmljdCIsImxpbmsiLCJhdHRycyIsImNsaWNrT3V0c2lkZUhhbmRsZXIiLCJzdG9wUHJvcGFnYXRpb24iLCJ0YXJnZXRQYXJlbnRzIiwiJCIsInRhcmdldCIsInBhcmVudHMiLCJpbnNpZGUiLCJpbmRleCIsIm9uIiwib3V0c2lkZSIsImJpbmQiLCJ1bmJpbmQiLCJmaWxscyIsImRlZmF1bHRGaWxsIiwicG9wdXBvbkhvdmVyIiwiaGlnaGxpZ2h0RmlsbENvbG9yIiwiaGlnaGxpZ2h0Qm9yZGVyQ29sb3IiLCJwYXNzd29yZElucHV0IiwiZmlsdGVyIiwiJHNjZSIsInRydXN0QXNIdG1sIiwiZnJhY3Rpb25TaXplIiwiaXNOYU4iLCJmYWN0b3J5IiwiQXV0aFRva2VuU3J2IiwiYWRkVG9rZW4iLCJnZXRUb2tlbiIsImhlYWRlcnMiLCJyZXF1ZXN0Iiwic3RvcmUiLCJzZXNzaW9uU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRUb2tlbiIsInNldEl0ZW0iLCJyZW1vdmVJdGVtIiwiUHJvbWlzZSIsImdldFVzZXJGcm9tU3RvcmFnZSIsIl91c2VyIiwiJGh0dHAiLCJJbmRleGVkREJTcnYiLCJjb3VudHJpZXNCeUFscGhhMyIsImRhdGFiYXNlIiwia2V5Q291bnRyaWVzIiwia2V5VmVyc2lvbiIsImluZGV4ZWREQkF2YWlsYWJsZSIsImxvYWRDb3VudHJpZXMiLCJjcmVhdGVEYXRhYmFzZSIsImdldEVtcHR5T2JqZWN0IiwiZ2V0SW50ZXJuYWxWZXJzaW9uIiwiZ2V0RXh0ZXJuYWxWZXJzaW9uIiwiZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5IiwibG9hZERhdGEiLCJvYmoiLCJ0b1VwcGVyQ2FzZSIsImZpcnN0TGV0dGVyIiwibmFtZSIsImdldENvdW50cmllc0Zyb21BUEkiLCJzdHJhdGVneSIsImludGVybmFsVmVyc2lvbiIsImV4dGVybmFsVmVyc2lvbiIsInB1dEl0ZW0iLCJnZXRDb3VudHJpZXNGcm9tREIiLCJfb2JqIiwicmV0cmlldmVJdGVtIiwiaXRlbSIsImdldFZlcnNpb25Gcm9tQVBJIiwidmVyc2lvbiIsImdldCIsImFkZCIsInBvc3QiLCJzdWNjZXNzIiwiJHRpbWVvdXQiLCJzZWxlY3RvciIsInF1ZXJ5U2VsZWN0b3IiLCJmb2N1cyIsImtleVBhdGgiLCJpbmRleGVkREIiLCJ3ZWJraXRJbmRleGVkREIiLCJtc0luZGV4ZWREQiIsIklEQktleVJhbmdlIiwid2Via2l0SURCS2V5UmFuZ2UiLCJJREJUcmFuc2FjdGlvbiIsIndlYmtpdElEQlRyYW5zYWN0aW9uIiwiUkVBRF9XUklURSIsIlJFQURfT05MWSIsImRiTmFtZSIsInN0b3JlTmFtZSIsIm9wZW4iLCJvbnVwZ3JhZGVuZWVkZWQiLCJlIiwiaWRiIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJvbnN1Y2Nlc3MiLCJvbmVycm9yIiwiZHJvcERhdGFiYXNlIiwiZGVsZXRlRGF0YWJhc2UiLCJhZGRJdGVtIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsInJlcXVlc3RBZGQiLCJwdXQiLCJpdGVtTmFtZSIsInJhbmdlIiwib25seSIsIm9wZW5DdXJzb3IiLCJjdXJzb3IiLCJyZXRyaWV2ZUl0ZW1zIiwiaXRlbXMiLCJsb2dJbmZvIiwibG9nIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJsb2dFcnJvciIsIkV2ZW50U3J2IiwiX2NvdW50cmllcyIsImNvdW50cmllc0xvYWRlZCIsImNyZWF0ZVF1aXoiLCJxdWl6VHlwZSIsImNyZWF0ZUNvdW50cnlRdWl6IiwiY291bnRyeVF1aXoiLCJmdWxsUG9pbnRzIiwiaGludE1heGltdW0iLCJoaW50Q29zdCIsImxhc3RRdWVzdGlvbkJvbnVzIiwicXVlc3Rpb25UeXBlcyIsInNlbGVjdGVkQ291bnRyaWVzIiwibnVtYmVyT2ZRdWVzdGlvbnMiLCJlYXN5Q291bnRyaWVzIiwibWVkaXVtQ291bnRyaWVzIiwiaGFyZENvdW50cmllcyIsImkiLCJjb3VudHJ5T2siLCJhcnJheVRvU2h1ZmZsZSIsInNwbGljZSIsInNodWZmbGVkQXJyYXkiLCJzaHVmZmxlIiwicXVlc3Rpb25UeXBlQXJyYXkiLCJqIiwic2h1ZmZsZWRRdWVzdGlvblR5cGVBcnJheSIsInFjbnQiLCJpZHgiLCJxdWVzdGlvblR5cGUiLCJnZXRRdWVzdGlvblRleHQiLCJnZXRRdWVzdGlvbklucHV0IiwidW5pdCIsImdldFF1ZXN0aW9uVW5pdCIsImdldFF1ZXN0aW9uQW5zd2VyIiwiZ2V0Q2hlY2tBbnN3ZXJMYW1iZGEiLCJnZXRRdWVzdGlvbkhpbnRzIiwiYWxwaGEyQ29kZSIsInRvTG9jYWxlTG93ZXJDYXNlIiwiY2FwaXRhbCIsImFsdFNwZWxsaW5ncyIsImNvcnJlY3QiLCJhcmVhIiwiYWxsb3dlZFNwZWxsaW5ncyIsInNwZWxsaW5nIiwiYm9udXMiLCJlcnJvclBlcmNlbnRhZ2UiLCJhYnMiLCJoaW50c1Bvc3NpYmxlIiwicHV0SGlnaHNjb3JlIiwiYXJyYXkiLCJ0ZW1wb3JhcnlWYWx1ZSIsInJhbmRvbUluZGV4IiwiY3VycmVudEluZGV4IiwiZ2V0VXNlckhpZ2hzY29yZSIsImdldE92ZXJhbGxIaWdoc2NvcmUiLCJwYXNzIiwiYm9keSJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsVUFBQUMsUUFBQUMsT0FBQSxZQUNBLFlBQ0EsYUFDQSxjQ0NJLGdCREFKLFNBQUFDLEdBQ0FBLEVBQUFDLGFBQUFDLEtBQUEscUJBSUFMLFVBQUFNLFNBQUEsYUFDQUMsWUFBQSxFQUNBQyxhQUFBLEVBRUFDLHlCQUFBLEVBQ0FDLHNCQUNBQyxFQUFBLHFCQUNBQyxFQUFBLHFCQUNBQyxFQUFBLHdCQUNBQyxFQUFBLGtCQUNBQyxFQUFBLGtCQUNBQyxFQUFBLHVCQUdBQyx3QkFDQSxXQUNBLGNBQ0EsWUFDQSxnQkFDQSxRQUNBLGVBQ0EsYUFDQSxjQUNBLE9BQ0EsU0FDQSxhQUNBLGtCQUNBLE9BQ0EsV0FDQSxhQUNBLGVBQ0EsUUFDQSxVQUNBLFNBQ0EsV0FJQWpCLFNBQUFrQixXQUFBLFdBQUEsYUFBQSxTQUFBLFNBQUEsVUFBQSxVQUFBLGFBQUEsVUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUVBTCxFQUFBTSxLQUNBQyxRQUNBQyxNQUFBLFdBQ0FDLFNBQUEsaURBQ0FDLE9BQUEsb0JBS0FSLEVBQUFTLFVBQ0FDLEtBQUEsU0FBQUMsR0FFQWIsRUFBQWEsS0FBQUEsRUFFQWIsRUFBQWMsV0FBQSxlQUdBVixFQUFBVyxPQUNBSCxLQUFBLFNBQUFJLEdB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QUFBLEVBQ0ExSCxlQUFBQSIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbWFnZWxsYW4gPSBhbmd1bGFyLm1vZHVsZShcIm1hZ2VsbGFuXCIsIFtcclxuICAgICd1aS5yb3V0ZXInLFxyXG4gICAgJ25nUHJvZ3Jlc3MnLFxyXG4gICAgJ25nQW5pbWF0ZSdcclxuXSwgZnVuY3Rpb24gY29uZmlnKCRodHRwUHJvdmlkZXIpIHtcclxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG59KTtcclxuXHJcbi8vIGRlZmluZSBhcHBsaWNhdGlvbiBjb25zdGFudHNcclxubWFnZWxsYW4uY29uc3RhbnQoXCJBcHBDb25maWdcIiwge1xyXG4gICAgXCJsb2cuaW5mb1wiOiB0cnVlLFxyXG4gICAgXCJsb2cuZXJyb3JcIjogdHJ1ZSxcclxuXHJcbiAgICBcInF1aXouY291bnRyeS5xdWVzdGlvbnNcIjogMyxcclxuICAgIFwicXVpei5jb3VudHJ5LnR5cGVzXCI6IHtcclxuICAgICAgICAxOiBcIkNBUElUQUxfT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDI6IFwiQ09VTlRSWV9PRl9DQVBJVEFMXCIsXHJcbiAgICAgICAgMzogXCJQT1BVTEFUSU9OX09GX0NPVU5UUllcIixcclxuICAgICAgICA0OiBcIkFSRUFfT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDU6IFwiRkxBR19PRl9DT1VOVFJZXCIsXHJcbiAgICAgICAgNjogXCJMT0NBVElPTl9PRl9DT1VOVFJZXCJcclxuICAgIH0sXHJcblxyXG4gICAgXCJzZXR0aW5ncy51c2VyLmNvbG9yc1wiOiBbXHJcbiAgICAgICAgJ3NvZnRfcmVkJyxcclxuICAgICAgICAndGh1bmRlcmJpcmQnLFxyXG4gICAgICAgICdvbGRfYnJpY2snLFxyXG4gICAgICAgICduZXdfeW9ya19waW5rJyxcclxuICAgICAgICAnc251ZmYnLFxyXG4gICAgICAgICdob25leV9mbG93ZXInLFxyXG4gICAgICAgICdzYW5fbWFyaW5vJyxcclxuICAgICAgICAnc2hha2VzcGVhcmUnLFxyXG4gICAgICAgICdtaW5nJyxcclxuICAgICAgICAnZ29zc2lwJyxcclxuICAgICAgICAnZXVjYWx5cHR1cycsXHJcbiAgICAgICAgJ21vdW50YWluX21lYWRvdycsXHJcbiAgICAgICAgJ2phZGUnLFxyXG4gICAgICAgICdjb25mZXR0aScsXHJcbiAgICAgICAgJ2NhbGlmb3JuaWEnLFxyXG4gICAgICAgICdidXJudF9vcmFuZ2UnLFxyXG4gICAgICAgICdqYWZmYScsXHJcbiAgICAgICAgJ2dhbGxlcnknLFxyXG4gICAgICAgICdlZHdhcmQnLFxyXG4gICAgICAgICdseW5jaCdcclxuICAgIF1cclxufSk7XHJcblxyXG5tYWdlbGxhbi5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsICRzdGF0ZSwgQXV0aFNydiwgVXNlclNydiwgQ291bnRyeVNydiwgUXVpelNydikge1xyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGNvbmZpZyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS5hcHAgPSB7XHJcbiAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgIHRpdGxlOiBcIk1hZ2VsbGFuXCIsXHJcbiAgICAgICAgICAgIHN1YnRpdGxlOiBcIlRlc3RlIGRlaW4gV2lzc2VuIMO8YmVyIGRpZSBMw6RuZGVyIHVuc2VyZXIgRXJkZVwiLFxyXG4gICAgICAgICAgICBhdXRob3I6IFwiTWljaGFlbCBTdGlmdGVyXCJcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEFwcCBpbml0aWFsaXphdGlvbiAtLS0tLS0tLS0tLS1cclxuICAgIEF1dGhTcnYuZ2V0VXNlcigpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICAgICAkc2NvcGUudXNlciA9IHVzZXI7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgndXNlci5sb2FkZWQnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAkc2NvcGUudXNlciA9IG51bGw7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLmlzUHJvZ3Jlc3NCYXJWaXNpYmxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuICRzdGF0ZS5pcygncXVpeicpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZ29Ub0hvbWUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgIH07XHJcblxyXG4gICAgJHNjb3BlLmdvVG9Ib21lID0gZ29Ub0hvbWU7XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gRXZlbnQgaGFuZGxpbmcgLS0tLS0tLS0tLS0tXHJcbiAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlRXJyb3InLCBmdW5jdGlvbihldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcywgZXJyb3IpIHtcclxuICAgICAgICBpZiAoZXJyb3IgPT09ICdOb3QgYXV0aG9yaXplZCcpIHtcclxuICAgICAgICAgICAgLy8gZ28gdG8gaG9tZSBwYWdlXHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS4kb24oJ2FwcC5sb2dpbicsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gc3RvcmUgdXNlciBvYmplY3QgaW4gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IGRhdGE7XHJcblxyXG4gICAgICAgIC8vIGFkZGl0aW9uYWxseSBzYXZlIGl0IGluIGF1dGggc2VydmljZVxyXG4gICAgICAgIEF1dGhTcnYuc2V0VXNlcihkYXRhKTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIHF1aXogcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ291dCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gcmVtb3ZlIHVzZXIgb2JqZWN0IGZyb20gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGFkZGl0aW9uYWxseSwgcmVtb3ZlIGl0IGZyb20gYXV0aCBzZXJ2aWNlXHJcbiAgICAgICAgQXV0aFNydi5jbGVhclVzZXIoKTtcclxuXHJcbiAgICAgICAgLy8gZ28gdG8gaG9tZSBwYWdlXHJcbiAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICB9KTtcclxufSk7IiwidmFyIG1hZ2VsbGFuID0gYW5ndWxhci5tb2R1bGUoXCJtYWdlbGxhblwiLCBbXHJcbiAgICAndWkucm91dGVyJyxcclxuICAgICduZ1Byb2dyZXNzJyxcclxuICAgICduZ0FuaW1hdGUnXHJcbl0sIFtcIiRodHRwUHJvdmlkZXJcIiwgZnVuY3Rpb24gY29uZmlnKCRodHRwUHJvdmlkZXIpIHtcclxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG59XSk7XHJcblxyXG4vLyBkZWZpbmUgYXBwbGljYXRpb24gY29uc3RhbnRzXHJcbm1hZ2VsbGFuLmNvbnN0YW50KFwiQXBwQ29uZmlnXCIsIHtcclxuICAgIFwibG9nLmluZm9cIjogdHJ1ZSxcclxuICAgIFwibG9nLmVycm9yXCI6IHRydWUsXHJcblxyXG4gICAgXCJxdWl6LmNvdW50cnkucXVlc3Rpb25zXCI6IDMsXHJcbiAgICBcInF1aXouY291bnRyeS50eXBlc1wiOiB7XHJcbiAgICAgICAgMTogXCJDQVBJVEFMX09GX0NPVU5UUllcIixcclxuICAgICAgICAyOiBcIkNPVU5UUllfT0ZfQ0FQSVRBTFwiLFxyXG4gICAgICAgIDM6IFwiUE9QVUxBVElPTl9PRl9DT1VOVFJZXCIsXHJcbiAgICAgICAgNDogXCJBUkVBX09GX0NPVU5UUllcIixcclxuICAgICAgICA1OiBcIkZMQUdfT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDY6IFwiTE9DQVRJT05fT0ZfQ09VTlRSWVwiXHJcbiAgICB9LFxyXG5cclxuICAgIFwic2V0dGluZ3MudXNlci5jb2xvcnNcIjogW1xyXG4gICAgICAgICdzb2Z0X3JlZCcsXHJcbiAgICAgICAgJ3RodW5kZXJiaXJkJyxcclxuICAgICAgICAnb2xkX2JyaWNrJyxcclxuICAgICAgICAnbmV3X3lvcmtfcGluaycsXHJcbiAgICAgICAgJ3NudWZmJyxcclxuICAgICAgICAnaG9uZXlfZmxvd2VyJyxcclxuICAgICAgICAnc2FuX21hcmlubycsXHJcbiAgICAgICAgJ3NoYWtlc3BlYXJlJyxcclxuICAgICAgICAnbWluZycsXHJcbiAgICAgICAgJ2dvc3NpcCcsXHJcbiAgICAgICAgJ2V1Y2FseXB0dXMnLFxyXG4gICAgICAgICdtb3VudGFpbl9tZWFkb3cnLFxyXG4gICAgICAgICdqYWRlJyxcclxuICAgICAgICAnY29uZmV0dGknLFxyXG4gICAgICAgICdjYWxpZm9ybmlhJyxcclxuICAgICAgICAnYnVybnRfb3JhbmdlJyxcclxuICAgICAgICAnamFmZmEnLFxyXG4gICAgICAgICdnYWxsZXJ5JyxcclxuICAgICAgICAnZWR3YXJkJyxcclxuICAgICAgICAnbHluY2gnXHJcbiAgICBdXHJcbn0pO1xyXG5cclxubWFnZWxsYW4uY29udHJvbGxlcihcIkFwcEN0cmxcIiwgW1wiJHJvb3RTY29wZVwiLCBcIiRzY29wZVwiLCBcIiRzdGF0ZVwiLCBcIkF1dGhTcnZcIiwgXCJVc2VyU3J2XCIsIFwiQ291bnRyeVNydlwiLCBcIlF1aXpTcnZcIiwgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkc3RhdGUsIEF1dGhTcnYsIFVzZXJTcnYsIENvdW50cnlTcnYsIFF1aXpTcnYpIHtcclxuICAgIC8vIC0tLS0tLS0tLS0tIEFwcCBjb25maWcgLS0tLS0tLS0tLS0tXHJcbiAgICAkc2NvcGUuYXBwID0ge1xyXG4gICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICB0aXRsZTogXCJNYWdlbGxhblwiLFxyXG4gICAgICAgICAgICBzdWJ0aXRsZTogXCJUZXN0ZSBkZWluIFdpc3NlbiDDvGJlciBkaWUgTMOkbmRlciB1bnNlcmVyIEVyZGVcIixcclxuICAgICAgICAgICAgYXV0aG9yOiBcIk1pY2hhZWwgU3RpZnRlclwiXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgaW5pdGlhbGl6YXRpb24gLS0tLS0tLS0tLS0tXHJcbiAgICBBdXRoU3J2LmdldFVzZXIoKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgLy8gc3RvcmUgdXNlciBvYmplY3QgaW4gc2NvcGVcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3VzZXIubG9hZGVkJyk7XHJcblxyXG4gICAgICAgICAgICAvLyBpbml0IGNvdW50cnkgc2VydmljZVxyXG4gICAgICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2NvdW50cmllcy5sb2FkZWQnLCBjb3VudHJpZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgIFF1aXpTcnYuc2V0Q291bnRyaWVzKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSBudWxsO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICRzY29wZS5pc1Byb2dyZXNzQmFyVmlzaWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiAkc3RhdGUuaXMoJ3F1aXonKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdvVG9Ib21lID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5nb1RvSG9tZSA9IGdvVG9Ib21lO1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEV2ZW50IGhhbmRsaW5nIC0tLS0tLS0tLS0tLVxyXG4gICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24oZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMsIGVycm9yKSB7XHJcbiAgICAgICAgaWYgKGVycm9yID09PSAnTm90IGF1dGhvcml6ZWQnKSB7XHJcbiAgICAgICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuJG9uKCdhcHAubG9naW4nLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHN0b3JlIHVzZXIgb2JqZWN0IGluIHNjb3BlXHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBkYXRhO1xyXG5cclxuICAgICAgICAvLyBhZGRpdGlvbmFsbHkgc2F2ZSBpdCBpbiBhdXRoIHNlcnZpY2VcclxuICAgICAgICBBdXRoU3J2LnNldFVzZXIoZGF0YSk7XHJcblxyXG4gICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgQ291bnRyeVNydi5pbml0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGNvdW50cmllcyBpbiBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgICAgIFF1aXpTcnYuc2V0Q291bnRyaWVzKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBnbyB0byBxdWl6IHBhZ2VcclxuICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS4kb24oJ2FwcC5sb2dvdXQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHJlbW92ZSB1c2VyIG9iamVjdCBmcm9tIHNjb3BlXHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBhZGRpdGlvbmFsbHksIHJlbW92ZSBpdCBmcm9tIGF1dGggc2VydmljZVxyXG4gICAgICAgIEF1dGhTcnYuY2xlYXJVc2VyKCk7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfSk7XHJcbn1dKTtcbi8vIG93biBjbGFzc2VzIGFuZCBmdW5jdGlvbnNcclxuXHJcbi8vIC0tLS0tLS0tLS0gTUFQIC0tLS0tLS0tLS1cclxudmFyIGNyZWF0ZU1hcCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIG1hcCA9IG5ldyBEYXRhbWFwKHtcclxuICAgICAgICBlbGVtZW50OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLWNvbnRhaW5lcicpLFxyXG4gICAgICAgIGdlb2dyYXBoeUNvbmZpZzoge1xyXG4gICAgICAgICAgICBoaWdobGlnaHRPbkhvdmVyOiB0cnVlLFxyXG4gICAgICAgICAgICBwb3B1cE9uSG92ZXI6IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVSVogLS0tLS0tLS0tLVxyXG52YXIgUXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gaW5kZXggb2YgY3VycmVudCBxdWVzdGlvblxyXG4gICAgdmFyIGN1cnJlbnRRdWVzdGlvbklkeCA9IG51bGw7XHJcblxyXG4gICAgLy8gYXJyYXkgY29udGFpbmluZyBhbGwgcXVlc3Rpb25zXHJcbiAgICB2YXIgcXVlc3Rpb25zID0gW107XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdGFydHMgdGhlIHF1aXouXHJcbiAgICAgKi9cclxuICAgIHRoaXMuc3RhcnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyBjaGVjayBpZiBxdWl6IGhhcyBxdWVzdGlvbnNcclxuICAgICAgICBpZiAocXVlc3Rpb25zLmxlbmd0aCA8PSAwKVxyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIkNhbm5vdCBzdGFydCBhIHF1aXogd2l0aG91dCBxdWVzdGlvbnNcIik7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLm5leHRRdWVzdGlvbigpO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmlzQWN0aXZlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzU3RhcnRlZCgpICYmICF0aGlzLmhhc0VuZGVkKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaGFzU3RhcnRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBjdXJyZW50UXVlc3Rpb25JZHggIT09IG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaGFzRW5kZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNTdGFydGVkKCkgJiYgY3VycmVudFF1ZXN0aW9uSWR4ID49IHF1ZXN0aW9ucy5sZW5ndGg7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuc3VibWl0dGVkID0gZmFsc2U7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IHF1ZXN0aW9uIHRvIHRoZSBxdWl6LlxyXG4gICAgICogVGhlIHBhcmFtZXRlciBtdXN0IGJlIGFuIHF1ZXN0aW9uIG9iamVjdC5cclxuICAgICAqIElmIG5vIHF1ZXN0aW9uIG9iamVjdCBpcyBwYXNzZWQgb3IgYW4gb2JqZWN0IHdpdGggbWlzc2luZyBwcm9wZXJ0aWVzLCBhbiBlcnJvciBpcyB0aHJvd24uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYWRkUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgIGlmIChxdWVzdGlvbiA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIk5vIHF1ZXN0aW9uIG9iamVjdCBwYXNzZWRcIik7XHJcblxyXG4gICAgICAgIHZhciB2YWxpZCA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGEgcXVlc3Rpb24gb2JqZWN0IG11c3QgY29udGFpbiBhbGwgdGhlc2UgcHJvcGVydGllc1xyXG4gICAgICAgIHZhciBuZWNlc3NhcnlQcm9wZXJ0aWVzID0gWydjb25maWcnLCAnaGludCcsICdzb2x1dGlvbicsICdhbnN3ZXInLCAncXVlc3Rpb24nLCAnZ2V0SW5mbycsICdpbmZvJywgJ3BvaW50cycsICdhbnN3ZXJlZCcsICdoaW50c0FsbG93ZWQnLCAnaGludHNSZW1haW5pbmcnXTtcclxuXHJcbiAgICAgICAgbmVjZXNzYXJ5UHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIGlmICghcXVlc3Rpb24uaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUXVlc3Rpb24gbXVzdCBoYXZlIHByb3BlcnR5ICdcIiArIHByb3BlcnR5ICsgXCInXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh2YWxpZCkge1xyXG4gICAgICAgICAgICBxdWVzdGlvbnMucHVzaChxdWVzdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG5leHQgcXVlc3Rpb24gb2YgdGhlIHF1aXouXHJcbiAgICAgKiBJZiB0aGUgcXVpeiBoYXMgZW5kZWQsIGl0IHJldHVybnMgbm90aGluZy5cclxuICAgICAqL1xyXG4gICAgdGhpcy5uZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uSWR4ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbklkeCA9IDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSWR4Kys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnNbY3VycmVudFF1ZXN0aW9uSWR4XTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5jdXJyZW50UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNBY3RpdmUoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnNbY3VycmVudFF1ZXN0aW9uSWR4XTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzU3RhcnRlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHRvdGFsUG9pbnRzID0gMDtcclxuXHJcbiAgICAgICAgcXVlc3Rpb25zLmZvckVhY2goZnVuY3Rpb24ocXVlc3Rpb24pIHtcclxuICAgICAgICAgICAgdmFyIHBvaW50cyA9IHF1ZXN0aW9uLnBvaW50cygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHBvaW50cyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0b3RhbFBvaW50cyArPSBwb2ludHM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRvdGFsUG9pbnRzO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChjdXJyZW50UXVlc3Rpb25JZHggPT09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICByZXR1cm4gY3VycmVudFF1ZXN0aW9uSWR4ICsgMTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXROdW1iZXJPZlF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnMubGVuZ3RoO1xyXG4gICAgfTtcclxufTtcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVFU1RJT04gLS0tLS0tLS0tLVxyXG52YXIgUXVlc3Rpb24gPSBmdW5jdGlvbihvcHRpb25zKSB7XHJcbiAgICAvLyBUZXh0IG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIHRleHQgPSBudWxsO1xyXG5cclxuICAgIC8vIEluZm8gb2JqZWN0IGZvciB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBpbmZvID0gbnVsbDtcclxuXHJcbiAgICAvLyBBbnN3ZXIgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgYW5zd2VyID0gbnVsbDtcclxuXHJcbiAgICAvLyBIaW50cyBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBoaW50cyA9IG51bGw7XHJcbiAgICB2YXIgaGludHNVc2VkID0gMDtcclxuXHJcbiAgICAvLyBMYW1iZGEgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIHRoZSBhbnN3ZXIgc3RhdHVzIG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGNoZWNrQW5zd2VyID0gbnVsbDtcclxuXHJcbiAgICAvLyBQb2ludHMgYXdhcmRlZCBmb3IgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgcG9pbnRzID0gbnVsbDtcclxuXHJcbiAgICAvLyBGbGFnIGluZGljYXRpbmcgd2hldGhlciBxdWVzdGlvbiBoYXMgYWxyZWFkeSBiZWVuIGFuc3dlcmVkXHJcbiAgICB2YXIgYW5zd2VyZWQgPSBmYWxzZTtcclxuXHJcbiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKG9wdHMpIHtcclxuICAgICAgICB0ZXh0ID0gb3B0cy50ZXh0O1xyXG4gICAgICAgIGluZm8gPSBvcHRzLmluZm8gfHwge307XHJcbiAgICAgICAgYW5zd2VyID0gb3B0cy5hbnN3ZXI7XHJcbiAgICAgICAgY2hlY2tBbnN3ZXIgPSBvcHRzLmNoZWNrQW5zd2VyIHx8IG51bGw7XHJcblxyXG4gICAgICAgIGhpbnRzID0gb3B0cy5oaW50cyB8fCB7XHJcbiAgICAgICAgICAgICAgICBhbGxvd2VkOiBmYWxzZSwgICAgIC8vIGlzIGEgaGludCBhbGxvd2VkP1xyXG4gICAgICAgICAgICAgICAgbWF4aW11bTogMCwgICAgICAgICAvLyBtYXhpbXVtIG51bWJlciBvZiBoaW50cyBmb3IgdGhpcyBxdWVzdGlvbiAoaXJyZWxldmFudCBpZiBhbGxvd2VkIGlzIHNldCB0byBmYWxzZSlcclxuICAgICAgICAgICAgICAgIGNvc3Q6IDAsICAgICAgICAgICAgLy8gbnVtYmVyIG9mIHBvaW50cyBzdWJ0cmFjdGVkIHBlciB1c2VkIGhpbnQgKGlycmVsZXZhbnQgaWYgYWxsb3dlZCBpcyBzZXQgdG8gZmFsc2UpXHJcbiAgICAgICAgICAgICAgICBnaXZlOiBudWxsICAgICAgICAgIC8vIGxhbWJkYSBmdW5jdGlvbiB0byBnaXZlIGEgaGludCBmb3IgYSBxdWVzdGlvblxyXG4gICAgICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICAgIGluaXQob3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jb25maWcgPSBmdW5jdGlvbihvcHRzKSB7XHJcbiAgICAgICAgaW5pdChvcHRzKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBxdWVzdGlvbiB0ZXh0LlxyXG4gICAgICovXHJcbiAgICB0aGlzLnF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQ7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgcXVlc3Rpb24gaW5mbyBvYmplY3QuXHJcbiAgICAgKiBBY3RzIGFzIGdldHRlciAod2l0aCBvbmx5IG9uZSBhcmd1bWVudCkgYW5kIHNldHRlciAod2l0aCB0d28gYXJndW1lbnRzKVxyXG4gICAgICovXHJcbiAgICB0aGlzLmluZm8gPSBmdW5jdGlvbihwcm9wLCB2YWx1ZSkge1xyXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIC8vIHNldHRlclxyXG4gICAgICAgICAgICBpbmZvW3Byb3BdID0gdmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gZ2V0dGVyXHJcbiAgICAgICAgICAgIHJldHVybiBpbmZvW3Byb3BdO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBlbnRpcmUgaW5mbyBvYmplY3QuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuZ2V0SW5mbyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBpbmZvO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIGNvcnJlY3QgYW5zd2VyIHRvIHRoZSBxdWVzdGlvbiBhZnRlciB0aGUgcXVlc3Rpb24gaGFzIGJlZW4gYW5zd2VyZWQuXHJcbiAgICAgKiBJZiB0aGUgcXVlc3Rpb24gaGFzIG5vdCBiZWVuIGFuc3dlcmVkIHlldCwgaXQgcmV0dXJucyBudWxsLlxyXG4gICAgICovXHJcbiAgICB0aGlzLnNvbHV0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGFuc3dlcmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhbnN3ZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGEgaGludCBmb3IgdGhlIHF1ZXN0aW9uLlxyXG4gICAgICogSWYgbm8gaGludHMgYXJlIGFsbG93ZWQsIG9yIHRoZSBtYXhpbXVtIG51bWJlciBvZiBoaW50cyBoYXZlIGJlZW4gdXNlZCwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCFoaW50cy5hbGxvd2VkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGhpbnRzLmFsbG93ZWQgJiYgIWhpbnRzLmdpdmUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGludHMgYWxsb3dlZCBidXQgbm8gZ2l2ZSBtZXRob2QgcGFzc2VkXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGhpbnRzVXNlZCA8IGhpbnRzLm1heGltdW0pIHtcclxuICAgICAgICAgICAgaGludHNVc2VkKys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gaGludHMuZ2l2ZShoaW50c1VzZWQsIGFuc3dlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3VibWl0cyBhbiBhbnN3ZXIgdG8gdGhlIHF1ZXN0aW9uLlxyXG4gICAgICogSWYgdGhlIHF1ZXN0aW9uIGhhcyBhbHJlYWR5IGJlZW4gYW5zd2VyZWQgb3Igbm8gY2hlY2tBbnN3ZXIgbGFtYmRhIGhhcyBiZWVuIHNldCwgdGhpcyBtZXRob2QgZG9lcyBub3RoaW5nLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmFuc3dlciA9IGZ1bmN0aW9uKHN1Ym1pdHRlZEFuc3dlcikge1xyXG4gICAgICAgIGlmIChhbnN3ZXJlZCB8fCFjaGVja0Fuc3dlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhbnN3ZXJlZCA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGNoZWNrQW5zd2VyIG1ldGhvZCBzaG91bGQgcmV0dXJuIHRoZSBzdGF0dXMgcmVzdWx0c1xyXG4gICAgICAgIHBvaW50cyA9IGNoZWNrQW5zd2VyKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBoaW50c1VzZWQsIGhpbnRzLmNvc3QsIGluZm8pO1xyXG5cclxuICAgICAgICAvLyBlbnN1cmUgdGhhdCBubyBuZWdhdGl2ZSBwb2ludHMgYXJlIGF3YXJkZWRcclxuICAgICAgICBwb2ludHMgPSBNYXRoLm1heCgwLCBwb2ludHMpO1xyXG5cclxuICAgICAgICAvLyBlbnN1cmUgdGhhdCBvbmx5IGludGVnZXIgdmFsdWVzIGFyZSBzYXZlZFxyXG4gICAgICAgIHBvaW50cyA9IE1hdGguZmxvb3IocG9pbnRzKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5wb2ludHMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoIWFuc3dlcmVkIHx8IHBvaW50cyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgc3RhdGUgb2YgdGhlIHF1ZXN0aW9uLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGFuc3dlcmVkO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiBoaW50cyBhcmUgYWxsb3dlZCBmb3IgdGhpcyBxdWVzdGlvbiwgZmFsc2UgaWYgbm90LlxyXG4gICAgICogSWYgaGludHMgaGF2ZSBub3QgYmVlbiBpbml0aWFsaXplZCB5ZXQsIG51bGwgaXMgcmV0dXJuZWQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaGludHNBbGxvd2VkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGhpbnRzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBoaW50cy5hbGxvd2VkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHJlbWFpbmluZyBoaW50cy5cclxuICAgICAqIElmIG5vIGhpbnRzIGFyZSBhbGxvd2VkIGZvciB0aGlzIHF1ZXN0aW9uLCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmhpbnRzUmVtYWluaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGFsbG93ZWQgPSB0aGlzLmhpbnRzQWxsb3dlZCgpO1xyXG5cclxuICAgICAgICBpZiAoYWxsb3dlZCA9PT0gbnVsbCB8fCBhbGxvd2VkID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBoaW50cy5tYXhpbXVtIC0gaGludHNVc2VkO1xyXG4gICAgfTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gKGluY2x1c2l2ZSkgYW5kIG1heCAoaW5jbHVzaXZlKVxyXG4gKiBVc2luZyBNYXRoLnJvdW5kKCkgd2lsbCBnaXZlIHlvdSBhIG5vbi11bmlmb3JtIGRpc3RyaWJ1dGlvbiFcclxuICovXHJcbnZhciBnZXRSYW5kb21JbnQgPSBmdW5jdGlvbihtaW4sIG1heCkge1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyB0aGUgdGV4dCBiZXR3ZWVuIHR3byBkZWxpbWl0aW5nIHRleHQgb2NjdXJyZW5jZXNcclxuICovXHJcbnZhciBnZXRTdHJpbmdCZXR3ZWVuID0gZnVuY3Rpb24odGV4dCwgZmlyc3RTdHJpbmcsIHNlY29uZFN0cmluZykge1xyXG4gICAgdmFyIGZpcnN0UG9zID0gdGV4dC5pbmRleE9mKGZpcnN0U3RyaW5nKTtcclxuICAgIHZhciBzZWNvbmRQb3MgPSB0ZXh0LmluZGV4T2Yoc2Vjb25kU3RyaW5nKTtcclxuXHJcbiAgICBpZiAoZmlyc3RQb3MgPj0gMCAmJiBzZWNvbmRQb3MgPj0gMCAmJiBzZWNvbmRQb3MgPiBmaXJzdFBvcykge1xyXG4gICAgICAgIHJldHVybiB0ZXh0LnN1YnN0cihmaXJzdFBvcyArIDEsIHNlY29uZFBvcyAtIGZpcnN0UG9zIC0gMSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn07XHJcblxyXG4vLyAtLS0tLS0tLS0tIFBBU1NXT1JEIFJFUVVJUkVNRU5UUyBWQUxJREFUT1IgLS0tLS0tLS0tLVxyXG52YXIgUGFzc3dvcmRSZXF1aXJlbWVudHNWYWxpZGF0b3IgPSBmdW5jdGlvbigpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAvLyBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cclxuICAgIHZhciBkZWZhdWx0Q29uZmlnID0ge1xyXG4gICAgICAgIG1pbkxlbmd0aDogOCxcclxuICAgICAgICBtYXhMZW5ndGg6IHVuZGVmaW5lZCxcclxuICAgICAgICBsb3dlcmNhc2VDaGFyczogMSxcclxuICAgICAgICB1cHBlcmNhc2VDaGFyczogMSxcclxuICAgICAgICBzcGVjaWFsQ2hhcnM6IDEsXHJcbiAgICAgICAgbnVtZXJpY0NoYXJzOiAxXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIHVzZWQgY29uZmlndXJhdGlvblxyXG4gICAgdmFyIGNvbmZpZ3VyYXRpb24gPSBudWxsO1xyXG5cclxuICAgIC8vIHBhc3N3b3JkIGlucHV0XHJcbiAgICB0aGlzLmlucHV0ID0gbnVsbDtcclxuXHJcbiAgICB0aGlzLmNoZWNrID0gZnVuY3Rpb24oX2lucHV0KSB7XHJcbiAgICAgICAgLy8gY2hlY2sgaWYgYW4gaW5wdXQgd2FzIHBhc3NlZFxyXG4gICAgICAgIGlmICh0eXBlb2YgX2lucHV0ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgbWFuZGF0b3J5IGlucHV0IHBhcmFtZXRlcicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gY2hlY2sgaWYgcGFzc2VkIGlucHV0IGlzIG9mIHR5cGUgXCJzdHJpbmdcIlxyXG4gICAgICAgIGlmICh0eXBlb2YgX2lucHV0ICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpcnN0IGlucHV0IHBhcmFtZXRlciBtdXN0IGJlIG9mIHR5cGUgXFxcInN0cmluZ1xcXCInKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHNldCBpbnB1dCB2YXJpYWJsZVxyXG4gICAgICAgIHRoaXMuaW5wdXQgPSBfaW5wdXQ7XHJcblxyXG4gICAgICAgIC8vIGFycmF5IGNvbnRhaW5pbmcgYWxsIGZhaWxlZCBjaGVja3NcclxuICAgICAgICB2YXIgZmFpbGVkQ2hlY2tzID0gW107XHJcblxyXG4gICAgICAgIC8vIGdldCBhbGwgc2V0IGNvbmZpZyBwcm9wZXJ0aWVzXHJcbiAgICAgICAgdmFyIGNvbmZpZ1Byb3BlcnRpZXMgPSBnZXRDb25maWdQcm9wZXJ0aWVzKCk7XHJcblxyXG4gICAgICAgIGNvbmZpZ1Byb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihjb25maWdQcm9wKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBwZXJmb3JtQ2hlY2soY29uZmlnUHJvcCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzdWx0ICE9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBmYWlsZWRDaGVja3MucHVzaChjb25maWdQcm9wKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyByZXR1cm4gcmVzdWx0XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcGFzc3dvcmRPazogZmFpbGVkQ2hlY2tzLmxlbmd0aCA9PT0gMCxcclxuICAgICAgICAgICAgZmFpbGVkQ2hlY2tzOiBmYWlsZWRDaGVja3NcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnNldENvbmZpZyA9IGZ1bmN0aW9uKF9jb25maWcpIHtcclxuICAgICAgICBjb25maWd1cmF0aW9uID0gX2NvbmZpZztcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRDb25maWcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gY29uZmlndXJhdGlvbiB8fCBkZWZhdWx0Q29uZmlnO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgaXNDb25maWdQcm9wZXJ0eVNldCA9IGZ1bmN0aW9uKHByb3ApIHtcclxuICAgICAgICByZXR1cm4gdHlwZW9mIHNlbGYuZ2V0Q29uZmlnKClbcHJvcF0gIT09ICd1bmRlZmluZWQnO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZ2V0Q29uZmlnUHJvcGVydGllcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhzZWxmLmdldENvbmZpZygpKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdldENvbmZpZ1Byb3BlcnR5ID0gZnVuY3Rpb24ocHJvcCkge1xyXG4gICAgICAgIHJldHVybiBzZWxmLmdldENvbmZpZygpW3Byb3BdO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgcGVyZm9ybUNoZWNrID0gZnVuY3Rpb24ocHJvcCkge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZi5pbnB1dCAhPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHByb3BlcnR5VmFsdWUgPSBnZXRDb25maWdQcm9wZXJ0eShwcm9wKTtcclxuXHJcbiAgICAgICAgaWYgKCFwcm9wZXJ0eVZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3dpdGNoIChwcm9wKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ21pbkxlbmd0aCc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5pbnB1dC5sZW5ndGggPj0gcHJvcGVydHlWYWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ21heExlbmd0aCc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5pbnB1dC5sZW5ndGggPD0gcHJvcGVydHlWYWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ2xvd2VyY2FzZUNoYXJzJzpcclxuICAgICAgICAgICAgICAgIHZhciBudW1Mb3dlciA9IHNlbGYuaW5wdXQubGVuZ3RoIC0gc2VsZi5pbnB1dC5yZXBsYWNlKC9bYS16XS9nLCAnJykubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1Mb3dlciA+PSBwcm9wZXJ0eVZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAndXBwZXJjYXNlQ2hhcnMnOlxyXG4gICAgICAgICAgICAgICAgdmFyIG51bVVwcGVyID0gc2VsZi5pbnB1dC5sZW5ndGggLSBzZWxmLmlucHV0LnJlcGxhY2UoL1tBLVpdL2csICcnKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bVVwcGVyID49IHByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdzcGVjaWFsQ2hhcnMnOlxyXG4gICAgICAgICAgICAgICAgdmFyIG51bVNwZWNpYWxzID0gc2VsZi5pbnB1dC5sZW5ndGggLSBzZWxmLmlucHV0LnJlcGxhY2UoL1shQMKnJCUmI14qXzo7LsKwLCtcIidgwrRcXHtcXH1cXChcXClcXFtcXF1cXC9cXFxcLV0vZywgJycpLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtU3BlY2lhbHMgPj0gcHJvcGVydHlWYWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ251bWVyaWNDaGFycyc6XHJcbiAgICAgICAgICAgICAgICB2YXIgbnVtTnVtYmVycyA9IHNlbGYuaW5wdXQubGVuZ3RoIC0gc2VsZi5pbnB1dC5yZXBsYWNlKC9bMC05XS9nLCAnJykubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1OdW1iZXJzID49IHByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59O1xyXG5cclxuUGFzc3dvcmRSZXF1aXJlbWVudHNWYWxpZGF0b3IuQ09ORklHX1BST1BFUlRJRVMgPSBbXHJcbiAgICAnbWluTGVuZ3RoJywgICAgICAgIC8vIG1pbmltdW0gbGVuZ3RoIG9mIHBhc3N3b3JkXHJcbiAgICAnbWF4TGVuZ3RoJywgICAgICAgIC8vIG1heGltdW0gbGVuZ3RoIG9mIHBhc3N3b3JkICh1bmRlZmluZWQgZm9yIG5vIG1heGltdW0gbGVuZ3RoKVxyXG4gICAgJ2xvd2VyY2FzZUNoYXJzJywgICAvLyBudW1iZXIgb2YgbWFuZGF0b3J5IGxvd2VyY2FzZSBjaGFyYWN0ZXJzXHJcbiAgICAndXBwZXJjYXNlQ2hhcnMnLCAgIC8vIG51bWJlciBvZiBtYW5kYXRvcnkgdXBwZXJjYXNlIGNoYXJhY3RlcnNcclxuICAgICdzcGVjaWFsQ2hhcnMnLCAgICAgLy8gbnVtYmVyIG9mIG1hbmRhdG9yeSBzcGVjaWFsIGNoYXJhY3RlcnNcclxuICAgICdudW1lcmljQ2hhcnMnICAgICAgIC8vIG51bWJlciBvZiBtYW5kYXRvcnkgbnVtYmVyIGNoYXJhY3RlcnNcclxuXTtcclxuXHJcbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuUXVlc3Rpb24gPSBRdWVzdGlvbjtcclxuICAgIG1vZHVsZS5leHBvcnRzLlF1aXogPSBRdWl6O1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuUGFzc3dvcmRSZXF1aXJlbWVudHNWYWxpZGF0b3IgPSBQYXNzd29yZFJlcXVpcmVtZW50c1ZhbGlkYXRvcjtcclxufVxuYW5ndWxhci5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb25maWcoW1wiJGxvY2F0aW9uUHJvdmlkZXJcIiwgXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAgICAgIC8vIGVuYWJsZSBIVE1MNSBwdXNoc3RhdGVcclxuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcblxyXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9ob21lJyk7XHJcblxyXG4gICAgICAgIHZhciBhdXRob3JpemUgPSBmdW5jdGlvbihBdXRoU3J2LCBMb2dTcnYsICRxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBBdXRoU3J2LmdldFVzZXIoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KCdOb3QgYXV0aG9yaXplZCcpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBhdXRob3JpemUuJGluamVjdCA9IFtcIkF1dGhTcnZcIiwgXCJMb2dTcnZcIiwgXCIkcVwiXTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hvbWUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvaG9tZS5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncXVpeicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9xdWl6JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3F1aXoucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdjb3VudHJpZXMnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvY291bnRyaWVzJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2NvdW50cmllcy5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2NvdW50cmllcy5kZXRhaWwnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvOmFscGhhM0NvZGUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvY291bnRyaWVzLWRldGFpbC5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2xvZ2luLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9nb3V0JyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dvdXRDdHJsJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3JlZ2lzdGVyLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdzZXR0aW5ncycsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9zZXR0aW5ncycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9zZXR0aW5ncy5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3Bhc3N3b3JkJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3Bhc3N3b3JkJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL3Bhc3N3b3JkLWNoYW5nZS5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3Jlc2V0Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3Bhc3N3b3JkL3Jlc2V0Lzp0b2tlbicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9wYXNzd29yZC1yZXNldC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnZm9yZ290Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3Bhc3N3b3JkL2ZvcmdvdCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9wYXNzd29yZC1mb3Jnb3QucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2Fib3V0Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2Fib3V0JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2Fib3V0LnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdoaWdoc2NvcmUnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvaGlnaHNjb3JlJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2hpZ2hzY29yZS5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhvcml6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2ZhcScsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9mYXEnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvZmFxLnBhcnRpYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IG51bGxcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdjb3VudHJpZXMtZGlmZmljdWx0eScsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9jb3VudHJpZXMtZGlmZmljdWx0eScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9jb3VudHJ5LWRpZmZpY3VsdHkucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdDb3VudHJpZXNDdHJsJywgW1wiJHNjb3BlXCIsIFwiQ291bnRyeVNydlwiLCBmdW5jdGlvbigkc2NvcGUsIENvdW50cnlTcnYpIHtcclxuICAgICAgICB2YXIgY291bnRyaWVzQnlMZXR0ZXIgPSBudWxsO1xyXG4gICAgICAgIHZhciBjb3VudHJ5S2V5cyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyID0gQ291bnRyeVNydi5nZXRDb3VudHJpZXNCeUxldHRlcigpO1xyXG4gICAgICAgICAgICBjb3VudHJ5S2V5cyA9IE9iamVjdC5rZXlzKGNvdW50cmllc0J5TGV0dGVyKS5zb3J0KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoISRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJ5S2V5cyA9IGNvdW50cnlLZXlzO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJpZXNCeUxldHRlciA9IGNvdW50cmllc0J5TGV0dGVyO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyeUtleXMgPSBjb3VudHJ5S2V5cztcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJpZXNCeUxldHRlciA9IGNvdW50cmllc0J5TGV0dGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKENvdW50cnlTcnYuYXJlQ291bnRyaWVzTG9hZGVkKCkpIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignY291bnRyaWVzLmxvYWRlZCcsIGZ1bmN0aW9uKCkgIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0NvdW50cnlEZXRhaWxDdHJsJywgW1wiJHNjb3BlXCIsIFwiQ291bnRyeVNydlwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBmdW5jdGlvbigkc2NvcGUsIENvdW50cnlTcnYsICRzdGF0ZVBhcmFtcykge1xyXG4gICAgICAgIHZhciBhbHBoYTNDb2RlID0gJHN0YXRlUGFyYW1zLmFscGhhM0NvZGU7XHJcblxyXG4gICAgICAgIGlmIChDb3VudHJ5U3J2LmFyZUNvdW50cmllc0xvYWRlZCgpKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5jb3VudHJ5ID0gQ291bnRyeVNydi5nZXRDb3VudHJ5QnlBbHBoYTMoYWxwaGEzQ29kZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdjb3VudHJpZXMubG9hZGVkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhM0NvZGUpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyeUZyb21TZXJ2aWNlID0gZnVuY3Rpb24oYWxwaGEzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTMpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5nZXRDb3VudHJ5RnJvbVNlcnZpY2UgPSBnZXRDb3VudHJ5RnJvbVNlcnZpY2U7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignQ291bnRyeURpZmZpY3VsdHlDdHJsJywgW1wiJHNjb3BlXCIsIFwiQ291bnRyeVNydlwiLCBmdW5jdGlvbigkc2NvcGUsIENvdW50cnlTcnYpIHtcclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgY291bnRyaWVzID0gQ291bnRyeVNydi5nZXRDb3VudHJpZXMoKTtcclxuICAgICAgICAgICAgdmFyIGRpZmZpY3VsdGllcyA9IHtcclxuICAgICAgICAgICAgICAgICdlYXN5JzogW10sXHJcbiAgICAgICAgICAgICAgICAnbWVkaXVtJzogW10sXHJcbiAgICAgICAgICAgICAgICAnaGFyZCc6IFtdLFxyXG4gICAgICAgICAgICAgICAgJ3VuYXNzaWduZWQnOiBbXVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIGRpZmZpY3VsdHlcclxuICAgICAgICAgICAgY291bnRyaWVzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGIucG9wdWxhdGlvbiAtIGEucG9wdWxhdGlvbjtcclxuICAgICAgICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbihjKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGRpZmZpY3VsdGllc1tjLmRpZmZpY3VsdHldLnB1c2goYyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGlmZmljdWx0aWVzID0gZGlmZmljdWx0aWVzO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRpZmZpY3VsdHlLZXlzID0gT2JqZWN0LmtleXMoZGlmZmljdWx0aWVzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRpZmZpY3VsdGllcyA9IGRpZmZpY3VsdGllcztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlmZmljdWx0eUtleXMgPSBPYmplY3Qua2V5cyhkaWZmaWN1bHRpZXMpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoQ291bnRyeVNydi5hcmVDb3VudHJpZXNMb2FkZWQoKSkge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdjb3VudHJpZXMubG9hZGVkJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0Ryb3Bkb3duQ3RybCcsIFtcIiRzY29wZVwiLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkc2NvcGUudG9nZ2xlRHJvcGRvd24gPSB0b2dnbGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuc2hvd0Ryb3Bkb3duID0gc2hvd0Ryb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5oaWRlRHJvcGRvd24gPSBoaWRlRHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmlzRHJvcGRvd25WaXNpYmxlID0gaXNEcm9wZG93blZpc2libGU7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ2NsaWNrLm91dHNpZGUnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBpZiAoaXNEcm9wZG93blZpc2libGUoKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGlkZURyb3Bkb3duKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVEcm9wZG93bigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gIXZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93RHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGlkZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0Ryb3Bkb3duVmlzaWJsZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZpc2libGU7XHJcbiAgICAgICAgfVxyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0ZhcUN0cmwnLCBbXCIkc2NvcGVcIiwgXCJMb2dTcnZcIiwgXCIkc3RhdGVQYXJhbXNcIiwgZnVuY3Rpb24oJHNjb3BlLCBMb2dTcnYsICRzdGF0ZVBhcmFtcykge1xyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gY2hlY2sgc3RhdGUgcGFyYW1zXHJcbiAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5hY3Rpb24pIHtcclxuICAgICAgICAgICAgdmFyIGFjdGlvbiA9ICRzdGF0ZVBhcmFtcy5hY3Rpb247XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKGFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAncmVnaXN0ZXIuc3VjY2Vzc2Z1bCc6XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0dyYXR1bGF0aW9uISBEaWUgQW5tZWxkdW5nIHdhciBlcmZvbGdyZWljaC4gSGVyemxpY2ggd2lsbGtvbW1lbiBiZWkgTWFnZWxsYW4uJ1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0ZvcmdvdEN0cmwnLCBbXCIkc2NvcGVcIiwgXCJVc2VyU3J2XCIsIFwiTG9nU3J2XCIsIFwiRm9jdXNTcnZcIiwgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2LCBMb2dTcnYsIEZvY3VzU3J2KSB7XHJcbiAgICAgICAgJHNjb3BlLnBhc3NPYmogPSB7fTtcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHt9O1xyXG5cclxuICAgICAgICB2YXIgZm9yZ290UGFzc3dvcmQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCEkc2NvcGUucGFzc09iai5lbWFpbCkge1xyXG4gICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnQWxsZSBGZWxkZXIgbcO8c3NlbiBhdXNnZWbDvGxsdCBzZWluJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFVzZXJTcnYuZm9yZ290UGFzc3dvcmQoe1xyXG4gICAgICAgICAgICAgICAgZW1haWw6ICRzY29wZS5wYXNzT2JqLmVtYWlsXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbGlkaXR5ID0gZGF0YS52YWxpZDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsaWRUZXh0ID0gdmFsaWRpdHkgIT09IHVuZGVmaW5lZCA/IFwiIERlciBMaW5rIGlzdCBcIiArIHZhbGlkaXR5ICsgXCIgU3R1bmRlbiBsYW5nIGfDvGx0aWcuXCIgOiBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ3N1Y2Nlc3MnLCAnRGFzIEUtTWFpbCB3dXJkZSBlcmZvbGdyZWljaCB2ZXJzYW5kdC4nICsgdmFsaWRUZXh0KTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyLm1lc3NhZ2UgPT09IFwiTm8gdXNlciB3aXRoIHRoaXMgZS1tYWlsIGFkZHJlc3MgZm91bmRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0VzIHd1cmRlIGtlaW4gQmVudXR6ZXIgbWl0IGRpZXNlciBFLU1haWwtQWRyZXNzZSBnZWZ1bmRlbicpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRNZXNzYWdlKCdlcnJvcicsICdCZWltIFZlcnNlbmRlbiBkZXMgTGlua3MgaXN0IGV0d2FzIHNjaGllZmdlZ2FuZ2VuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZWxlZ2F0ZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBmb3Jnb3RQYXNzd29yZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZXRNZXNzYWdlID0gZnVuY3Rpb24odHlwZSwgdGV4dCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLiQkcGhhc2UpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIEZvY3VzU3J2KCcjZW1haWwnKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmZvcmdvdFBhc3N3b3JkID0gZm9yZ290UGFzc3dvcmQ7XHJcbiAgICAgICAgJHNjb3BlLmRlbGVnYXRlU3VibWl0ID0gZGVsZWdhdGVTdWJtaXQ7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignSGlnaHNjb3JlQ3RybCcsIFtcIiRzY29wZVwiLCBcIlNjb3JlU3J2XCIsIFwiTG9nU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgU2NvcmVTcnYsIExvZ1Nydikge1xyXG4gICAgICAgICRzY29wZS5zY29yZUxpc3QgPSBbXTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmlzRGF0YUxvYWRpbmcgPSB0cnVlO1xyXG5cclxuICAgICAgICBTY29yZVNydi5nZXRIaWdoc2NvcmVMaXN0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNjb3JlTGlzdCA9IGNyZWF0ZVJhbmtpbmcobGlzdCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zY29yZUxpc3QgPSBjcmVhdGVSYW5raW5nKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNldExvYWRpbmdTdGF0ZShmYWxzZSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNldExvYWRpbmdTdGF0ZShmYWxzZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgc2V0TG9hZGluZ1N0YXRlID0gZnVuY3Rpb24oc3RhdGUpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNEYXRhTG9hZGluZyA9IHN0YXRlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNEYXRhTG9hZGluZyA9IHN0YXRlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaXNNeXNlbGYgPSBmdW5jdGlvbihpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnVzZXIuX2lkID09PSBpZDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlUmFua2luZyA9IGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgdmFyIHJhbmsgPSAwO1xyXG5cclxuICAgICAgICAgICAgdmFyIHByZXZpb3VzU2NvcmUgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGVudHJ5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXByZXZpb3VzU2NvcmUgfHwgZW50cnkuc2NvcmUgIT09IHByZXZpb3VzU2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICByYW5rKys7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGVudHJ5LnJhbmsgPSByYW5rICsgJy4nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHByZXZpb3VzU2NvcmUgPSBlbnRyeS5zY29yZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbGlzdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuaXNNeXNlbGYgPSBpc015c2VsZjtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBbXCIkc2NvcGVcIiwgXCJVc2VyU3J2XCIsIFwiRm9jdXNTcnZcIiwgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2LCBGb2N1c1Nydikge1xyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIFVzZXJTcnYubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ2luIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIuc3RhdHVzID09PSA0MDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnRmFsc2NoZXIgQmVudXR6ZXJuYW1lIG9kZXIgUGFzc3dvcnQnO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0JlaW0gRWlubG9nZ2VuIHNjaGVpbnQgZXR3YXMgc2NoaWVmIGdlZ2FuZ2VuIHp1IHNlaW4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGZvY3VzIHVzZXJuYW1lIGZpZWxkXHJcbiAgICAgICAgRm9jdXNTcnYoJyN1c2VybmFtZScpO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ291dEN0cmwnLCBbXCIkc2NvcGVcIiwgXCJVc2VyU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydikge1xyXG4gICAgICAgIFVzZXJTcnYubG9nb3V0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dvdXQgZXZlbnRcclxuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ291dCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdNYXBDdHJsJywgW1wiJHNjb3BlXCIsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG5cclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdQYXNzd29yZFJlcXVpcmVtZW50c0N0cmwnLCBbXCIkc2NvcGVcIiwgZnVuY3Rpb24oJHNjb3BlKSB7XHJcbiAgICAgICAgdmFyIHJlcXMgPSBbXHJcbiAgICAgICAgICAgIHsga2V5OiAnbWluTGVuZ3RoJywgZGVzY3JpcHRpb246ICdEYXMgUGFzc3dvcnQgbXVzcyB6dW1pbmRlc3QgOCBaZWljaGVuIGxhbmcgc2VpbicgfSxcclxuICAgICAgICAgICAgeyBrZXk6ICdsb3dlcmNhc2VDaGFycycsIGRlc2NyaXB0aW9uOiAnRGFzIFBhc3N3b3J0IG11c3MgenVtaW5kZXN0IGVpbmVuIEtsZWluYnVjaHN0YWJlbiBlbnRoYWx0ZW4nIH0sXHJcbiAgICAgICAgICAgIHsga2V5OiAndXBwZXJjYXNlQ2hhcnMnLCBkZXNjcmlwdGlvbjogJ0RhcyBQYXNzd29ydCBtdXNzIHp1bWluZGVzdCBlaW5lbiBHcm/Dn2J1Y2hzdGFiZW4gZW50aGFsdGVuJyB9LFxyXG4gICAgICAgICAgICB7IGtleTogJ251bWVyaWNDaGFycycsIGRlc2NyaXB0aW9uOiAnRGFzIFBhc3N3b3J0IG11c3MgenVtaW5kZXN0IGVpbmUgWmFobCBlbnRoYWx0ZW4nIH0sXHJcbiAgICAgICAgICAgIHsga2V5OiAnc3BlY2lhbENoYXJzJywgZGVzY3JpcHRpb246ICdEYXMgUGFzc3dvcnQgbXVzcyB6dW1pbmRlc3QgZWluIFNvbmRlcnplaWNoZW4gZW50aGFsdGVuJyB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgdmFyIHZhbGlkYXRvciA9IG5ldyBQYXNzd29yZFJlcXVpcmVtZW50c1ZhbGlkYXRvcigpO1xyXG5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdwYXNzd29yZElucHV0JywgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlLCBzY29wZSkge1xyXG4gICAgICAgICAgICB1cGRhdGVSZXF1aXJlbWVudHMobmV3VmFsdWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgc2V0U2NvcGVQcm9wZXJ0eSA9IGZ1bmN0aW9uKHByb3AsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICRzY29wZVtwcm9wXSA9IHZhbHVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVSZXF1aXJlbWVudHMgPSBmdW5jdGlvbihwYXNzd29yZCkge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gdmFsaWRhdG9yLmNoZWNrKHBhc3N3b3JkKTtcclxuXHJcbiAgICAgICAgICAgIHNldFNjb3BlUHJvcGVydHkoJ3JlcXVpcmVtZW50cycsIHJlcXMubWFwKGZ1bmN0aW9uKHJlcXVpcmVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiByZXF1aXJlbWVudC5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBmdWxmaWxsZWQ6IHJlc3VsdC5mYWlsZWRDaGVja3MuaW5kZXhPZihyZXF1aXJlbWVudC5rZXkpIDwgMFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICAgICAgc2V0U2NvcGVQcm9wZXJ0eSgncGFzc3dvcmRPaycsIHJlc3VsdC5wYXNzd29yZE9rKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBpbml0aWFsaXplIHBhc3N3b3JkT2sgcHJvcGVydHlcclxuICAgICAgICBzZXRTY29wZVByb3BlcnR5KCdwYXNzd29yZE9rJywgZmFsc2UpO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1Bhc3N3b3JkQ3RybCcsIFtcIiRzY29wZVwiLCBcIlVzZXJTcnZcIiwgXCJMb2dTcnZcIiwgXCJGb2N1c1NydlwiLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTcnYsIExvZ1NydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUucGFzc09iaiA9IHt9O1xyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0ge307XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVQYXNzd29yZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoISRzY29wZS5wYXNzT2JqLm9sZCB8fCAhJHNjb3BlLnBhc3NPYmoubmV3IHx8ICEkc2NvcGUucGFzc09iai5jb25maXJtYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0FsbGUgRmVsZGVyIG3DvHNzZW4gYXVzZ2Vmw7xsbHQgc2VpbicpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCRzY29wZS5wYXNzT2JqLm5ldyAhPT0gJHNjb3BlLnBhc3NPYmouY29uZmlybWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRNZXNzYWdlKCdlcnJvcicsICdEaWUgUGFzc3fDtnJ0ZXIgc3RpbW1lbiBuaWNodCDDvGJlcmVpbicpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgVXNlclNydi51cGRhdGVQYXNzd29yZCh7XHJcbiAgICAgICAgICAgICAgICBvbGQ6ICRzY29wZS5wYXNzT2JqLm9sZCxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiAkc2NvcGUucGFzc09iai5uZXdcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRNZXNzYWdlKCdzdWNjZXNzJywgJ0RhcyBuZXVlIFBhc3N3b3J0IHd1cmRlIGVyZm9sZ3JlaWNoIGdlc3BlaWNoZXJ0Jyk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVyci5tZXNzYWdlID09PSBcIk9sZCBwYXNzd29yZCBpbmNvcnJlY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0RhcyBhbHRlIFBhc3N3b3J0IGlzdCBuaWNodCBrb3JyZWt0Jyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVyci5tZXNzYWdlID09PSBcIlBhc3N3b3JkIGRvZXMgbm90IG1hdGNoIHJlcXVpcmVtZW50c1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnRGFzIFBhc3N3b3J0IGVudHNwcmljaHQgbmljaHQgZGVuIFNpY2hlcmhlaXRzcmljaHRsaW5pZW4nKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnRGFzIG5ldWUgUGFzc3dvcnQga29ubnRlIG5pY2h0IGdlc3BlaWNoZXJ0IHdlcmRlbicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGVsZWdhdGVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdXBkYXRlUGFzc3dvcmQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0TWVzc2FnZSA9IGZ1bmN0aW9uKHR5cGUsIHRleHQpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgRm9jdXNTcnYoJyNwYXNzd29yZC1jdXJyZW50Jyk7XHJcblxyXG4gICAgICAgICRzY29wZS51cGRhdGVQYXNzd29yZCA9IHVwZGF0ZVBhc3N3b3JkO1xyXG4gICAgICAgICRzY29wZS5kZWxlZ2F0ZVN1Ym1pdCA9IGRlbGVnYXRlU3VibWl0O1xyXG4gICAgfV0pO1xuXHJcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6RGlyZWN0aXZlQ29udHJvbGxlcicsIFtcIiRzY29wZVwiLCBcIlF1aXpTcnZcIiwgXCJMb2dTcnZcIiwgXCJGb2N1c1NydlwiLCBcIm5nUHJvZ3Jlc3NGYWN0b3J5XCIsIFwiJGZpbHRlclwiLCBmdW5jdGlvbigkc2NvcGUsIFF1aXpTcnYsIExvZ1NydiwgRm9jdXNTcnYsIG5nUHJvZ3Jlc3NGYWN0b3J5LCAkZmlsdGVyKSB7XHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uO1xyXG5cclxuICAgICAgICB2YXIgaW5pdEN0cmwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gUHJvZ3Jlc3MgYmFyIGluaXRpYWxpemF0aW9uXHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2JhciA9IG5nUHJvZ3Jlc3NGYWN0b3J5LmNyZWF0ZUluc3RhbmNlKCk7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRQYXJlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotcHJvZ3Jlc3MnKSk7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRBYnNvbHV0ZSgpO1xyXG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0Q29sb3IoXCIjMzM2ZTdiXCIpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmlzUmVzdWx0c1BhZ2VWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5hY2hpZXZlbWVudHMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gW107XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQgPSB7fTtcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gYWRkIG9wdGlvbnMgZm9yIG11bHRpcGxpZXIgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICRzY29wZS5tdWx0aXBsaWVyT3B0aW9ucyA9IFtcclxuICAgICAgICAgICAgICAgIHsgdmFsdWU6IDEsIGxhYmVsOiAnJyB9LFxyXG4gICAgICAgICAgICAgICAgeyB2YWx1ZTogMTAwMCwgbGFiZWw6ICdUc2QuJ30sXHJcbiAgICAgICAgICAgICAgICB7IHZhbHVlOiAxMDAwMDAwLCBsYWJlbDogJ01pby4nfVxyXG4gICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgcXVlc3Rpb24gPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVVaSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBnZXQgY3VycmVudCBxdWVzdGlvbiBmcm9tIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICBxdWVzdGlvbiA9IFF1aXpTcnYuZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBkZWxldGUgcHJldmlvdXMgaGludHNcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgaWYgKHF1ZXN0aW9uICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBtdWx0aXBsaWVycyBmb3IgcXVlc3Rpb25zIGNvbnRhaW5pbmcgbnVtYmVyc1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dCAmJiBxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQuaW5kZXhPZignbnVtYmVyJykgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXIuaGlnaCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IHsgdmFsdWU6IDEwMDAwMDAsIGxhYmVsOiAnTWlvLid9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXIubWVkaXVtJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyID0geyB2YWx1ZTogMTAwMCwgbGFiZWw6ICdUc2QuJ307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IHsgdmFsdWU6IDEsIGxhYmVsOiAnJyB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIHByb2dyZXNzIGJhclxyXG4gICAgICAgICAgICAgICAgdXBkYXRlUHJvZ3Jlc3NCYXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBmb2N1cyBhbnN3ZXIgaW5wdXRcclxuICAgICAgICAgICAgICAgIEZvY3VzU3J2KCcuYW5zd2VySW5wdXQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb247XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZW5kZXJRdWVzdGlvblRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlbmRlcihnZXRRdWVzdGlvbigpLnF1ZXN0aW9uKCksICdxdWVzdGlvbi1oaWdobGlnaHQnKSArICc/JztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25NZWRpYSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIXF1ZXN0aW9uIHx8ICFxdWVzdGlvbi5nZXRJbmZvKCkubWVkaWEpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5nZXRJbmZvKCkubWVkaWE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNob3dSZXN1bHRzUGFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoaWRlUmVzdWx0c1BhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzUmVzdWx0c1BhZ2VWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoaW50c0F2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVlc3Rpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmhpbnRzUmVtYWluaW5nKCkgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmhpbnRzUmVtYWluaW5nKCkgPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzdWJtaXRBbnN3ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIgJiYgIXF1ZXN0aW9uLmFuc3dlcmVkKCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRyYW5zZm9ybSBzdWJtaXR0ZWQgYW5zd2VyIHRvIFN0cmluZyBhbmQgdHJpbSBhbnkgd2hpdGVzcGFjZXMgYXQgdGhlIGJlZ2luIG9yIGVuZCBvZiB0aGUgYW5zd2VyXHJcbiAgICAgICAgICAgICAgICB2YXIgYW5zd2VyID0gU3RyaW5nKCRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIpLnRyaW0oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpZiBpdCBpcyBhIG51bWJlciBpbnB1dCwgcmVwbGFjZSAnLCcgd2l0aCAnLidcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQgJiYgcXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0LmluZGV4T2YoJ251bWJlcicpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5zd2VyID0gYW5zd2VyLnJlcGxhY2UoJywnLCAnLicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGlmIGEgbXVsdGlwbGllciBpcyBhdmFpbGFibGUsIGNhbGN1bGF0ZSBhbnN3ZXJcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuc3dlciAqPSAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllci52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQucG9pbnRzID0gcXVlc3Rpb24uYW5zd2VyKGFuc3dlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGZvY3VzXHJcbiAgICAgICAgICAgICAgICBpZiAoIXdhc0xhc3RRdWVzdGlvbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRm9jdXNTcnYoJyNidG5OZXh0UXVlc3Rpb24nKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRm9jdXNTcnYoJyNidG5Db250aW51ZUZpbmlzaGVkJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25BbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIVF1aXpTcnYuaXNRdWl6UnVubmluZygpIHx8IHF1ZXN0aW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5hbnN3ZXJlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBuZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5uZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgdXBkYXRlVWkoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVxdWVzdEhpbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBxdWVzdGlvbi5oaW50KCk7XHJcblxyXG4gICAgICAgICAgICBGb2N1c1NydignLmFuc3dlcklucHV0Jyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uKHRleHQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dFxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJbXCIsIFwiPHNwYW4gY2xhc3M9J1wiICsgY2xhc3NOYW1lICsgXCInPlwiKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJdXCIsIFwiPC9zcGFuPlwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZGxlS2V5UHJlc3MgPSBmdW5jdGlvbihrZXlFdmVudCkge1xyXG4gICAgICAgICAgICBpZiAoa2V5RXZlbnQud2hpY2ggPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHN1Ym1pdEFuc3dlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZVByb2dyZXNzQmFyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBwcm9ncmVzc1BlcmNlbnQgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKSAvIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpICogMTAwO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldChwcm9ncmVzc1BlcmNlbnQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB3YXNMYXN0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpID49IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwYXJzZUV2ZW50cyA9IGZ1bmN0aW9uKGV2ZW50cywgcGVyc29uYWxCZXN0LCBvdmVyYWxsQmVzdCkge1xyXG4gICAgICAgICAgICB2YXIgYWNoaWV2ZW1lbnRzID0gW107XHJcblxyXG4gICAgICAgICAgICB2YXIgc2hvd0Jlc3RzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZignb3ZlcmFsbF9iZXN0JykgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEdSBoYXN0IGVpbmVuIG5ldWVuIGFic29sdXRlbiBSZWtvcmQgZ2VzY2hhZmZ0ISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dCZXN0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ292ZXJhbGxfYmVzdF9lcXVhbGlzZWQnKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZGVuIGFrdHVlbGxlbiBhYnNvbHV0ZW4gUmVrb3JkIGVpbmdlc3RlbGx0ISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dCZXN0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ3BlcnNvbmFsX2Jlc3QnKSA+PSAwICYmIGV2ZW50cy5pbmRleE9mKCdvdmVyYWxsX2Jlc3QnKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBlaW5lbiBuZXVlbiBwZXJzw7ZubGljaGVuIFJla29yZCBnZXNjaGFmZnQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0Jlc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZigncGVyc29uYWxfYmVzdF9lcXVhbGlzZWQnKSA+PSAwICYmIGV2ZW50cy5pbmRleE9mKCdvdmVyYWxsX2Jlc3RfZXF1YWxpc2VkJykgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZ2xlaWNoIHZpZWxlIFB1bmt0ZSBnZXNjaGFmZnQgd2llIGJlaSBkZWluZW0gcGVyc8O2bmxpY2hlbiBSZWtvcmQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0Jlc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZignbmV3X2RhaWx5X2Jlc3QnKSA+PSAwICYmIGFjaGlldmVtZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBlaW5lbiBuZXVlbiBwZXJzw7ZubGljaGVuIFRhZ2VzcmVrb3JkIGdlc2NoYWZmdCEnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWNoaWV2ZW1lbnRzID0gYWNoaWV2ZW1lbnRzO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWNoaWV2ZW1lbnRzID0gYWNoaWV2ZW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChzaG93QmVzdHMgJiYgcGVyc29uYWxCZXN0ICYmIHBlcnNvbmFsQmVzdC5pZCAmJiBwZXJzb25hbEJlc3QuZGF0ZSAmJiBwZXJzb25hbEJlc3Quc2NvcmUgJiYgb3ZlcmFsbEJlc3QgJiYgb3ZlcmFsbEJlc3QuaWQgJiYgb3ZlcmFsbEJlc3QuZGF0ZSAmJiBvdmVyYWxsQmVzdC5zY29yZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJlc3RzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgb3ZlcmFsbEJlc3QudHlwZSA9ICdvdmVyYWxsJztcclxuICAgICAgICAgICAgICAgIGJlc3RzLnB1c2gob3ZlcmFsbEJlc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwZXJzb25hbEJlc3QuaWQgIT09IG92ZXJhbGxCZXN0LmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGVyc29uYWxCZXN0LnR5cGUgPSAncGVyc29uYWwnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiZXN0cy5wdXNoKHBlcnNvbmFsQmVzdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gYmVzdHM7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5iZXN0cyA9IGJlc3RzO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjb250aW51ZUZpbmlzaGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIHF1aXogaGFzIGVuZGVkLCBzZXQgcHJvZ3Jlc3MgYmFyIHRvIDBcclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldCgwKTtcclxuXHJcbiAgICAgICAgICAgIHNob3dSZXN1bHRzUGFnZSgpO1xyXG5cclxuICAgICAgICAgICAgbmV4dFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBjb25jbHVkZSB0aGUgcXVpeiBhbmQgd3JpdGUgcmVzdWx0IHRvIGRhdGFiYXNlXHJcbiAgICAgICAgICAgIFF1aXpTcnYuY29uY2x1ZGUoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnNlRXZlbnRzKGRhdGEuZXZlbnRzIHx8IFtdLCBkYXRhLnBlcnNvbmFsQmVzdCwgZGF0YS5vdmVyYWxsQmVzdCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEJlc3RUZXh0ID0gZnVuY3Rpb24oYmVzdCkge1xyXG4gICAgICAgICAgICB2YXIgdGV4dDtcclxuXHJcbiAgICAgICAgICAgIGlmIChiZXN0LnR5cGUgPT09ICdwZXJzb25hbCcpIHtcclxuICAgICAgICAgICAgICAgIC8vIHBlcnNvbmFsIGJlc3RcclxuICAgICAgICAgICAgICAgIHRleHQgPSBcIkRlaW4gcGVyc8O2bmxpY2hlciBSZWtvcmQgbGllZ3QgYmVpIDxzcGFuIGNsYXNzPSdib2xkJz57UE9JTlRTfSBQdW5rdGVuPC9zcGFuPiwgYXVmZ2VzdGVsbHQgYW0ge0RBVEV9LlwiO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gb3ZlcmFsbCBiZXN0XHJcbiAgICAgICAgICAgICAgICB2YXIgZnJvbU15c2VsZiA9IGJlc3QuaWQgPT09ICRzY29wZS51c2VyLl9pZDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZnJvbU15c2VsZikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQgPSBcIkR1IGjDpGx0c3QgZGVuIGFic29sdXRlbiBSZWtvcmQgbWl0IDxzcGFuIGNsYXNzPSdib2xkJz57UE9JTlRTfSBQdW5rdGVuPC9zcGFuPiwgYXVmZ2VzdGVsbHQgYW0ge0RBVEV9LlwiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gXCI8c3BhbiBjbGFzcz0naGlnaGxpZ2h0Jz57VVNFUk5BTUV9PC9zcGFuPiBow6RsdCBkZW4gYWJzb2x1dGVuIFJla29yZCBtaXQgPHNwYW4gY2xhc3M9J2JvbGQnPntQT0lOVFN9IFB1bmt0ZW48L3NwYW4+LCBhdWZnZXN0ZWxsdCBhbSB7REFURX0uXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoJ3tQT0lOVFN9JywgJGZpbHRlcignbnVtYmVyJykoYmVzdC5zY29yZSkpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgne0RBVEV9JywgZ2V0Rm9ybWF0dGVkRGF0ZShiZXN0LmRhdGUpKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoJ3tVU0VSTkFNRX0nLCBiZXN0LnVzZXJuYW1lKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Rm9ybWF0dGVkRGF0ZSA9IGZ1bmN0aW9uKGRhdGUpIHtcclxuICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHBhZChkYXRlLmdldERhdGUoKSwgJzAwJykgKyAnLicgKyBwYWQoZGF0ZS5nZXRNb250aCgpICsgMSwgJzAwJykgKyAnLicgKyAoZGF0ZS5nZXRZZWFyKCkgKyAxOTAwKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcGFkID0gZnVuY3Rpb24oc3RyLCBwYWRWYWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gU3RyaW5nKHBhZFZhbHVlICsgc3RyKS5zbGljZSgtcGFkVmFsdWUubGVuZ3RoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVzdGFydFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcXVpeiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ3F1aXoucmVzdGFydCcpO1xyXG5cclxuICAgICAgICAgICAgaW5pdEN0cmwoKTtcclxuXHJcbiAgICAgICAgICAgIHVwZGF0ZVVpKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGVudGVyTGlzdGVuZXIgPSBmdW5jdGlvbihrZXlQcmVzcywgZnVuYykge1xyXG4gICAgICAgICAgICBpZiAoa2V5UHJlc3Mud2hpY2ggPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoZnVuYykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ25leHRfcXVlc3Rpb24nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0UXVlc3Rpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NvbnRpbnVlX2ZpbmlzaGVkJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWVGaW5pc2hlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdxdWl6LnN0YXJ0JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgaGlkZVJlc3VsdHNQYWdlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgLy8gY29udHJvbGxlciBpcyBiZWluZyBkZXN0cm95ZWQgKGkuZS4gdXNlciBsZWF2ZXMgdGhlIHBhZ2UsIHNvIHdlIHRlbGwgdGhlIHF1aXogc2VydmljZSB0byBkaXNwb3NlIG9mIHRoZSBxdWl6IG9iamVjdFxyXG4gICAgICAgICAgICBpZiAoUXVpelNydi5oYXNRdWl6U3RhcnRlZCgpICYmIFF1aXpTcnYuaGFzUXVpekVuZGVkKCkpIHtcclxuICAgICAgICAgICAgICAgIFF1aXpTcnYuZGlzcG9zZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGluaXQgY29udHJvbGxlclxyXG4gICAgICAgIGluaXRDdHJsKCk7XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWxseSB1cGRhdGUgVUlcclxuICAgICAgICB1cGRhdGVVaSgpO1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb24gPSBnZXRRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyO1xyXG4gICAgICAgICRzY29wZS5yZW5kZXJRdWVzdGlvblRleHQgPSByZW5kZXJRdWVzdGlvblRleHQ7XHJcbiAgICAgICAgJHNjb3BlLnN1Ym1pdEFuc3dlciA9IHN1Ym1pdEFuc3dlcjtcclxuICAgICAgICAkc2NvcGUucXVlc3Rpb25BbnN3ZXJlZCA9IHF1ZXN0aW9uQW5zd2VyZWQ7XHJcbiAgICAgICAgJHNjb3BlLm5leHRRdWVzdGlvbiA9IG5leHRRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuaGFuZGxlS2V5UHJlc3MgPSBoYW5kbGVLZXlQcmVzcztcclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb25NZWRpYSA9IGdldFF1ZXN0aW9uTWVkaWE7XHJcbiAgICAgICAgJHNjb3BlLnJlcXVlc3RIaW50ID0gcmVxdWVzdEhpbnQ7XHJcbiAgICAgICAgJHNjb3BlLndhc0xhc3RRdWVzdGlvbiA9IHdhc0xhc3RRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuY29udGludWVGaW5pc2hlZCA9IGNvbnRpbnVlRmluaXNoZWQ7XHJcbiAgICAgICAgJHNjb3BlLmdldEJlc3RUZXh0ID0gZ2V0QmVzdFRleHQ7XHJcbiAgICAgICAgJHNjb3BlLnJlc3RhcnRRdWl6ID0gcmVzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmhpbnRzQXZhaWxhYmxlID0gaGludHNBdmFpbGFibGU7XHJcbiAgICAgICAgJHNjb3BlLmVudGVyTGlzdGVuZXIgPSBlbnRlckxpc3RlbmVyO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1F1aXpDdHJsJywgW1wiJHNjb3BlXCIsIFwiUXVpelNydlwiLCBcIkxvZ1NydlwiLCBmdW5jdGlvbigkc2NvcGUsIFF1aXpTcnYsIExvZ1Nydikge1xyXG5cclxuICAgICAgICB2YXIgc3RhcnRRdWl6ID0gZnVuY3Rpb24oY2IpIHtcclxuICAgICAgICAgICAgUXVpelNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYiAmJiB0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2IoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuaXNRdWl6UnVubmluZygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoYXNRdWl6U3RhcnRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5oYXNRdWl6U3RhcnRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoYXNRdWl6RW5kZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuaGFzUXVpekVuZGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFRvdGFsUG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldFRvdGFsUG9pbnRzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbigncXVpei5yZXN0YXJ0JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgUXVpelNydi5kaXNwb3NlKCk7XHJcblxyXG4gICAgICAgICAgICBzdGFydFF1aXooZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgncXVpei5zdGFydCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnN0YXJ0UXVpeiA9IHN0YXJ0UXVpejtcclxuICAgICAgICAkc2NvcGUuaXNRdWl6UnVubmluZyA9IGlzUXVpelJ1bm5pbmc7XHJcbiAgICAgICAgJHNjb3BlLmhhc1F1aXpTdGFydGVkID0gaGFzUXVpelN0YXJ0ZWQ7XHJcbiAgICAgICAgJHNjb3BlLmhhc1F1aXpFbmRlZCA9IGhhc1F1aXpFbmRlZDtcclxuICAgICAgICAkc2NvcGUuZ2V0VG90YWxQb2ludHMgPSBnZXRUb3RhbFBvaW50cztcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdSZWdpc3RlckN0cmwnLCBbXCIkc2NvcGVcIiwgXCJMb2dTcnZcIiwgXCJGb2N1c1NydlwiLCBcIlVzZXJTcnZcIiwgXCIkc3RhdGVcIiwgXCIkd2luZG93XCIsIGZ1bmN0aW9uKCRzY29wZSwgTG9nU3J2LCBGb2N1c1NydiwgVXNlclNydiwgJHN0YXRlLCAkd2luZG93KSB7XHJcbiAgICAgICAgLy8gbmV3IHVzZXIgb2JqZWN0XHJcbiAgICAgICAgJHNjb3BlLm5ld1VzZXIgPSB7fTtcclxuXHJcbiAgICAgICAgLy8gbWVzc2FnZSBvYmplY3RcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciByZWdpc3RlciA9IGZ1bmN0aW9uIChpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNWYWxpZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodmFsaWRhdGVCZWZvcmVTdWJtaXQoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gcGVyZm9ybSBhcGkgY2FsbFxyXG4gICAgICAgICAgICAgICAgVXNlclNydi5yZWdpc3Rlcigkc2NvcGUubmV3VXNlcilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHAgY29udHJvbGxlciBhYm91dCBsb2dpblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdCB0byBob21lIHBhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnZmFxJywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3JlZ2lzdGVyLnN1Y2Nlc3NmdWwnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0JlaSBkZXIgQW5tZWxkdW5nIHNjaGVpbnQgZXR3YXMgc2NoaWVmIGdlZ2FuZ2VuIHp1IHNlaW4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGVyci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdVc2VybmFtZSBhbHJlYWR5IGV4aXN0cyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnRGVyIEJlbnV0emVybmFtZSBpc3QgYmVyZWl0cyBpbiBWZXJ3ZW5kdW5nJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdFbWFpbCBhZGRyZXNzIGFscmVhZHkgZXhpc3RzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEaWUgRS1NYWlsLUFkcmVzc2UgaXN0IGJlcmVpdHMgaW4gVmVyd2VuZHVuZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnUGFzc3dvcmQgZG9lcyBub3QgbWF0Y2ggcmVxdWlyZW1lbnRzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEYXMgUGFzc3dvcnQgZW50c3ByaWNodCBuaWNodCBkZW4gU2ljaGVyaGVpdHNyaWNodGxpbmllbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdCZWkgZGVyIEFubWVsZHVuZyBzY2hlaW50IGV0d2FzIHNjaGllZiBnZWdhbmdlbiB6dSBzZWluJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbWVzc2FnZVRleHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdmFsaWRhdGVCZWZvcmVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHR3byBwYXNzd29yZHMgbWF0Y2hcclxuICAgICAgICAgICAgdmFyIHBhc3N3b3JkID0gJHNjb3BlLm5ld1VzZXIucGFzc3dvcmQ7XHJcbiAgICAgICAgICAgIHZhciBwYXNzd29yZDIgPSAkc2NvcGUubmV3VXNlci5wYXNzd29yZDI7XHJcblxyXG4gICAgICAgICAgICBpZiAoISRzY29wZS5uZXdVc2VyLnVzZXJuYW1lIHx8ICEkc2NvcGUubmV3VXNlci5lbWFpbCB8fCAhcGFzc3dvcmQgfHwgIXBhc3N3b3JkMikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnQWxsZSBGZWxkZXIgbcO8c3NlbiBhdXNnZWbDvGxsdCBzZWluJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXNzd29yZCA9PT0gXCJcIiB8fCBwYXNzd29yZDIgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0RpZSBQYXNzd8O2cnRlciBrw7ZubmVuIG5pY2h0IGxlZXIgc2VpbidcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFzc3dvcmQgIT09IHBhc3N3b3JkMikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRGllIFBhc3N3w7ZydGVyIHN0aW1tZW4gbmljaHQgw7xiZXJlaW4nXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gISRzY29wZS5tZXNzYWdlID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZWxlZ2F0ZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZWdpc3Rlcih0cnVlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZGVsZWdhdGVTdWJtaXQgPSBkZWxlZ2F0ZVN1Ym1pdDtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJlZ2lzdGVyID0gcmVnaXN0ZXI7XHJcblxyXG4gICAgICAgIC8vIGZvY3VzIHVzZXIgbmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCcjdXNlcm5hbWUnKTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdSZXNldEN0cmwnLCBbXCIkc2NvcGVcIiwgXCJVc2VyU3J2XCIsIFwiTG9nU3J2XCIsIFwiRm9jdXNTcnZcIiwgXCIkc3RhdGVQYXJhbXNcIiwgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2LCBMb2dTcnYsIEZvY3VzU3J2LCAkc3RhdGVQYXJhbXMpIHtcclxuICAgICAgICAkc2NvcGUucGFzc09iaiA9IHt9O1xyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0ge307XHJcblxyXG4gICAgICAgIHZhciB0b2tlbiA9ICRzdGF0ZVBhcmFtcy50b2tlbjtcclxuXHJcbiAgICAgICAgdmFyIHJlc2V0UGFzc3dvcmQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCEkc2NvcGUucGFzc09iai5uZXcgfHwgISRzY29wZS5wYXNzT2JqLmNvbmZpcm1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnQWxsZSBGZWxkZXIgbcO8c3NlbiBhdXNnZWbDvGxsdCBzZWluJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUucGFzc09iai5uZXcgIT09ICRzY29wZS5wYXNzT2JqLmNvbmZpcm1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnRGllIFBhc3N3w7ZydGVyIHN0aW1tZW4gbmljaHQgw7xiZXJlaW4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnS2VpbiBnw7xsdGlnZXIgWnVyw7xja3NldHplbi1MaW5rJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFVzZXJTcnYucmVzZXRQYXNzd29yZCh7XHJcbiAgICAgICAgICAgICAgICB0b2tlbjogdG9rZW4sXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogJHNjb3BlLnBhc3NPYmoubmV3XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnc3VjY2VzcycsICdEYXMgUGFzc3dvcnQgd3VyZGUgZXJmb2xncmVpY2ggZ2VzcGVpY2hlcnQnKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyLm1lc3NhZ2UgPT09IFwiSW52YWxpZCB0b2tlblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnRGVyIFp1csO8Y2tzZXR6ZW4tTGluayBpc3QgbGVpZGVyIG5pY2h0IG1laHIgZ8O8bHRpZycpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnIubWVzc2FnZSA9PT0gXCJQYXNzd29yZCBkb2VzIG5vdCBtYXRjaCByZXF1aXJlbWVudHNcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0RhcyBQYXNzd29ydCBlbnRzcHJpY2h0IG5pY2h0IGRlbiBTaWNoZXJoZWl0c3JpY2h0bGluaWVuJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0RhcyBuZXVlIFBhc3N3b3J0IGtvbm50ZSBuaWNodCBnZXNwZWljaGVydCB3ZXJkZW4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRlbGVnYXRlU3VibWl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJlc2V0UGFzc3dvcmQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0TWVzc2FnZSA9IGZ1bmN0aW9uKHR5cGUsIHRleHQpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBGb2N1c1NydignI3Bhc3N3b3JkLW5ldycpO1xyXG5cclxuICAgICAgICAkc2NvcGUucmVzZXRQYXNzd29yZCA9IHJlc2V0UGFzc3dvcmQ7XHJcbiAgICAgICAgJHNjb3BlLmRlbGVnYXRlU3VibWl0ID0gZGVsZWdhdGVTdWJtaXQ7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignU2V0dGluZ3NDdHJsJywgW1wiJHNjb3BlXCIsIFwiQXBwQ29uZmlnXCIsIFwiRm9jdXNTcnZcIiwgXCJMb2dTcnZcIiwgXCJVc2VyU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgQXBwQ29uZmlnLCBGb2N1c1NydiwgTG9nU3J2LCBVc2VyU3J2KSB7XHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gdXNlciBjb2xvdXJzXHJcbiAgICAgICAgICAgIHZhciBjb2xvcnMgPSBBcHBDb25maWdbJ3NldHRpbmdzLnVzZXIuY29sb3JzJ107XHJcblxyXG4gICAgICAgICAgICAvLyB1c2VyIG9iamVjdFxyXG4gICAgICAgICAgICAkc2NvcGUudXNlck9iaiA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAkc2NvcGUudXNlci51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIGVtYWlsOiAkc2NvcGUudXNlci5lbWFpbCxcclxuICAgICAgICAgICAgICAgIGNvbG9yOiAkc2NvcGUudXNlci5jb2xvclxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJDb2xvcnMgPSBjb2xvcnM7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2V0Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJPYmouY29sb3IgPSBuZXdDb2xvcjtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciB1cGRhdGVVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBVc2VyU3J2LnVwZGF0ZUJhc2ljKCRzY29wZS51c2VyT2JqKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgdXNlciBvYmplY3RcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXNlci51c2VybmFtZSA9ICRzY29wZS51c2VyT2JqLnVzZXJuYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmVtYWlsID0gJHNjb3BlLnVzZXJPYmouZW1haWw7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuY29sb3IgPSAkc2NvcGUudXNlck9iai5jb2xvcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRWluc3RlbGx1bmdlbiB3dXJkZW4gZXJmb2xncmVpY2ggZ2VzcGVpY2hlcnQnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoJ1VwZGF0ZSB1c2VyJywgZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGVyci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1VzZXJuYW1lIGFscmVhZHkgZXhpc3RzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RlciBCZW51dHplcm5hbWUgaXN0IGJlcmVpdHMgdmVyZ2ViZW4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdFbWFpbCBhZGRyZXNzIGFscmVhZHkgZXhpc3RzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RpZSBFLU1haWwtQWRyZXNzZSBpc3QgYmVyZWl0cyB2ZXJnZWJlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEaWUgRWluc3RlbGx1bmdlbiBrb25udGVuIG5pY2h0IGdlc3BlaWNoZXJ0IHdlcmRlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBkZWxlZ2F0ZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlVXNlcih0cnVlKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zZXRDb2xvciA9IHNldENvbG9yO1xyXG4gICAgICAgICAgICAkc2NvcGUudXBkYXRlVXNlciA9IHVwZGF0ZVVzZXI7XHJcbiAgICAgICAgICAgICRzY29wZS5kZWxlZ2F0ZVN1Ym1pdCA9IGRlbGVnYXRlU3VibWl0O1xyXG5cclxuICAgICAgICAgICAgLy8gZm9jdXMgdXNlcm5hbWUgZmllbGRcclxuICAgICAgICAgICAgRm9jdXNTcnYoJyN1c2VybmFtZScpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICgkc2NvcGUudXNlcikge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBvdGhlcndpc2UsIHdhaXQgZm9yIHVzZXIubG9hZGVkIGV2ZW50XHJcbiAgICAgICAgJHNjb3BlLiRvbigndXNlci5sb2FkZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZGlyZWN0aXZlKCdjbGlja091dHNpZGUnLCBbXCIkcGFyc2VcIiwgXCIkZG9jdW1lbnRcIiwgXCIkcm9vdFNjb3BlXCIsIGZ1bmN0aW9uKCRwYXJzZSwgJGRvY3VtZW50LCAkcm9vdFNjb3BlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgICRkb2N1bWVudC5iaW5kKCdjbGljaycsIGNsaWNrT3V0c2lkZUhhbmRsZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZCgncmVtb3ZlJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGRvY3VtZW50LnVuYmluZCgnY2xpY2snLCBjbGlja091dHNpZGVIYW5kbGVyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNsaWNrT3V0c2lkZUhhbmRsZXIoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldFBhcmVudHMgPSAkKGV2ZW50LnRhcmdldCkucGFyZW50cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbnNpZGUgPSB0YXJnZXRQYXJlbnRzLmluZGV4KCQoZWxlbWVudCkpICE9PSAtMTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb24gPSBldmVudC50YXJnZXQgPT09IGVsZW1lbnRbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG91dHNpZGUgPSAhaW5zaWRlICYmICFvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG91dHNpZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGljay5vdXRzaWRlJywgZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1dKVxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmRpcmVjdGl2ZSgnbWFwJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdidWlsZC92aWV3cy90ZW1wbGF0ZXMvbWFwLnRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTWFwQ3RybCcsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWFwID0gbmV3IERhdGFtYXAoe1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAtY29udGFpbmVyJyksXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsbHM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdEZpbGw6ICcjMjJhN2YwJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZ2VvZ3JhcGh5Q29uZmlnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodE9uSG92ZXI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVwb25Ib3ZlcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0RmlsbENvbG9yOiAnIzAxOTg3NScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodEJvcmRlckNvbG9yOiAncmdiYSgyMDAsIDI0NywgMTk3LCAwLjQpJ1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSlcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5kaXJlY3RpdmUoJ3Bhc3N3b3JkUmVxdWlyZW1lbnRzJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdidWlsZC92aWV3cy90ZW1wbGF0ZXMvcGFzc3dvcmQtcmVxdWlyZW1lbnRzLnRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnUGFzc3dvcmRSZXF1aXJlbWVudHNDdHJsJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkSW5wdXQ6ICdAYXR0cmlidXRlSW5wdXQnXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5kaXJlY3RpdmUoJ3F1aXonLCBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2J1aWxkL3ZpZXdzL3RlbXBsYXRlcy9xdWl6LWRpcmVjdGl2ZS50ZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgc2NvcGU6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdRdWl6RGlyZWN0aXZlQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSlcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5maWx0ZXIoJ3JlbmRlckh0bWwnLCBbXCIkc2NlXCIsIGZ1bmN0aW9uKCRzY2UpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbCh0ZXh0KTtcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZpbHRlcigndGV4dE9yTnVtYmVyJywgW1wiJGZpbHRlclwiLCBmdW5jdGlvbigkZmlsdGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0LCBmcmFjdGlvblNpemUpIHtcclxuICAgICAgICAgICAgZnJhY3Rpb25TaXplID0gZnJhY3Rpb25TaXplICE9PSB1bmRlZmluZWQgPyAwIDogZnJhY3Rpb25TaXplO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzTmFOKGlucHV0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ251bWJlcicpKGlucHV0LCBmcmFjdGlvblNpemUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIFtcIkF1dGhUb2tlblNydlwiLCBmdW5jdGlvbihBdXRoVG9rZW5TcnYpIHtcclxuICAgICAgICB2YXIgYWRkVG9rZW4gPSBmdW5jdGlvbihjb25maWcpIHtcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFRva2VuU3J2LmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snWC1BdXRoJ10gPSB0b2tlbjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0OiBhZGRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFRva2VuU3J2JywgW1wiJHdpbmRvd1wiLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZTtcclxuICAgICAgICB2YXIga2V5ID0gJ2F1dGgtdG9rZW4nO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0VG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnNldEl0ZW0oa2V5LCB0b2tlbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRUb2tlbjogZ2V0VG9rZW4sXHJcbiAgICAgICAgICAgIHNldFRva2VuOiBzZXRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFNydicsIFtcIlVzZXJTcnZcIiwgZnVuY3Rpb24oVXNlclNydikge1xyXG4gICAgICAgIHZhciB1c2VyID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHVzZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHVzZXIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBVc2VyU3J2LmdldFVzZXJGcm9tU3RvcmFnZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKF91c2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyID0gX3VzZXI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfdXNlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnTm90IGxvZ2dlZCBpbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNldFVzZXIgPSBmdW5jdGlvbihfdXNlcikge1xyXG4gICAgICAgICAgICB1c2VyID0gX3VzZXI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNsZWFyVXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB1c2VyID0gbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZXRVc2VyOiBzZXRVc2VyLFxyXG4gICAgICAgICAgICBnZXRVc2VyOiBnZXRVc2VyLFxyXG4gICAgICAgICAgICBjbGVhclVzZXI6IGNsZWFyVXNlclxyXG4gICAgICAgIH1cclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdDb3VudHJ5U3J2JywgW1wiJGh0dHBcIiwgXCJJbmRleGVkREJTcnZcIiwgXCJMb2dTcnZcIiwgZnVuY3Rpb24oJGh0dHAsIEluZGV4ZWREQlNydiwgTG9nU3J2KSB7XHJcbiAgICAgICAgLy8gQ291bnRyaWVzIGFycmF5XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUFscGhhMyA9IG51bGw7XHJcbiAgICAgICAgdmFyIGNvdW50cmllc0J5TGV0dGVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gSW5kZXhlZERCXHJcbiAgICAgICAgdmFyIGRhdGFiYXNlID0gJ21hZ2VsbGFuJztcclxuICAgICAgICB2YXIgc3RvcmUgPSAnY291bnRyeVN0b3JlJztcclxuICAgICAgICB2YXIga2V5Q291bnRyaWVzID0gJ2NvdW50cmllcyc7XHJcbiAgICAgICAgdmFyIGtleVZlcnNpb24gPSAndmVyc2lvbic7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREJBdmFpbGFibGUgPSBJbmRleGVkREJTcnYuaW5kZXhlZERCQXZhaWxhYmxlKCk7XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2FkQ291bnRyaWVzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvYWRDb3VudHJpZXMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgaW5kZXhlZERCIGlzIGF2YWlsYWJsZVxyXG4gICAgICAgICAgICBpZiAoaW5kZXhlZERCQXZhaWxhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGRhdGFiYXNlIGV4aXN0c1xyXG4gICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5jcmVhdGVEYXRhYmFzZShkYXRhYmFzZSwgc3RvcmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEVtcHR5T2JqZWN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRJbnRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEV4dGVybmFsVmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihsb2FkRGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXMgPSBvYmpbJ2NvdW50cmllcyddO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKFwibG9hZGVkIGNvdW50cmllcyBmcm9tXCIsIG9ialsnbG9hZFN0cmF0ZWd5J10udG9VcHBlckNhc2UoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkaXRpb25hbGx5IG1hcCBjb3VudHJpZXMgYnkgdmFyaW91cyBwcm9wZXJ0aWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUFscGhhMyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXIgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXMuZm9yRWFjaChmdW5jdGlvbihjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnkgYWxwaGEzIGNvZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUFscGhhM1tjWydhbHBoYTNDb2RlJ11dID0gYztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnkgbGV0dGVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpcnN0TGV0dGVyID0gY1snbmFtZSddLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGZpcnN0TGV0dGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ8OEJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TGV0dGVyID0gJ0EnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICfDlic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdExldHRlciA9ICdPJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnw5wnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RMZXR0ZXIgPSAnVSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnRyaWVzQnlMZXR0ZXJbZmlyc3RMZXR0ZXJdID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXJbZmlyc3RMZXR0ZXJdID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUxldHRlcltmaXJzdExldHRlcl0ucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhM0NvZGU6IGMuYWxwaGEzQ29kZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogYy5uYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihcImZhaWxlZCB0byBsb2FkIGNvdW50cmllc1wiLCBlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgbm90LCB3ZSBhbHdheXMgdHJ5IHRvIGRvd25sb2FkIGl0IGZyb20gdGhlIGNvdW50cnkgQVBJIGVuZHBvaW50XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q291bnRyaWVzRnJvbUFQSSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRldGVybWluZUxvYWRTdHJhdGVneSA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyYXRlZ3k7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGludGVybmFsVmVyc2lvbiA9IG9ialtcImludGVybmFsVmVyc2lvblwiXTtcclxuICAgICAgICAgICAgICAgIHZhciBleHRlcm5hbFZlcnNpb24gPSBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGludGVybmFsVmVyc2lvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2FwaSc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV4dGVybmFsVmVyc2lvbiA+IGludGVybmFsVmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2FwaSc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2RiJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBvYmpbJ2xvYWRTdHJhdGVneSddID0gc3RyYXRlZ3k7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9hZERhdGEgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0cmF0ZWd5ID0gb2JqWydsb2FkU3RyYXRlZ3knXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXBpJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q291bnRyaWVzRnJvbUFQSSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJjb3VudHJpZXNcIl0gPSBjb3VudHJpZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0b3JlIGNvdW50cmllcyBhbmQgdmVyc2lvbiBudW1iZXIgaW4gZGF0YWJhc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucHV0SXRlbShkYXRhYmFzZSwgc3RvcmUsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToga2V5Q291bnRyaWVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogIGNvdW50cmllc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucHV0SXRlbShkYXRhYmFzZSwgc3RvcmUsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToga2V5VmVyc2lvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9ialtcImV4dGVybmFsVmVyc2lvblwiXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGInOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDb3VudHJpZXNGcm9tREIob2JqKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oX29iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoX29iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdVbmtub3duIGxvYWQgc3RyYXRlZ3knKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEVtcHR5T2JqZWN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoe30pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0SW50ZXJuYWxWZXJzaW9uID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5yZXRyaWV2ZUl0ZW0oZGF0YWJhc2UsIHN0b3JlLCBrZXlWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdID0gaXRlbS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEV4dGVybmFsVmVyc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0VmVyc2lvbkZyb21BUEkoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialtcImV4dGVybmFsVmVyc2lvblwiXSA9IHZlcnNpb247XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzRnJvbURCID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5yZXRyaWV2ZUl0ZW0oZGF0YWJhc2UsIHN0b3JlLCBrZXlDb3VudHJpZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJjb3VudHJpZXNcIl0gPSBpdGVtLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNGcm9tQVBJID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9jb3VudHJpZXMnKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VmVyc2lvbkZyb21BUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdW50cmllcy92ZXJzaW9uJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEudmVyc2lvbiB8fCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cnlCeUFscGhhMyA9IGZ1bmN0aW9uKGFscGhhMykge1xyXG4gICAgICAgICAgICBpZiAoY291bnRyaWVzQnlBbHBoYTMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzQnlBbHBoYTNbYWxwaGEzXTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0J5TGV0dGVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChjb3VudHJpZXNCeUxldHRlciA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXNCeUxldHRlcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYXJlQ291bnRyaWVzTG9hZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXMgIT09IG51bGwgJiYgY291bnRyaWVzLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5pdDogaW5pdCxcclxuICAgICAgICAgICAgZ2V0Q291bnRyaWVzOiBnZXRDb3VudHJpZXMsXHJcbiAgICAgICAgICAgIGdldENvdW50cnlCeUFscGhhMzogZ2V0Q291bnRyeUJ5QWxwaGEzLFxyXG4gICAgICAgICAgICBnZXRDb3VudHJpZXNCeUxldHRlcjogZ2V0Q291bnRyaWVzQnlMZXR0ZXIsXHJcbiAgICAgICAgICAgIGFyZUNvdW50cmllc0xvYWRlZDogYXJlQ291bnRyaWVzTG9hZGVkXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdFdmVudFNydicsIFtcIiRodHRwXCIsIFwiTG9nU3J2XCIsIGZ1bmN0aW9uKCRodHRwLCBMb2dTcnYpIHtcclxuICAgICAgICB2YXIgYWRkID0gZnVuY3Rpb24obmFtZSkge1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL2V2ZW50L2FkZCcsIHtcclxuICAgICAgICAgICAgICAgIG5hbWU6IG5hbWVcclxuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBubyBuZWVkIHRvIHJlYWN0IHRvIHN1Y2Nlc3MgY2FzZVxyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcignZmFpbGVkIHRvIGFkZCBldmVudCcsIGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGFkZDogYWRkXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdGb2N1c1NydicsIFtcIiR0aW1lb3V0XCIsIFwiJHdpbmRvd1wiLCBmdW5jdGlvbigkdGltZW91dCwgJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzZWxlY3Rvcikge1xyXG4gICAgICAgICAgICAvLyB0aW1lb3V0IG1ha2VzIHN1cmUgdGhhdCBpcyBpbnZva2VkIGFmdGVyIGFueSBvdGhlciBldmVudCBoYXMgYmVlbiB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgIC8vIGUuZy4gY2xpY2sgZXZlbnRzIHRoYXQgbmVlZCB0byBydW4gYmVmb3JlIHRoZSBmb2N1cyBvclxyXG4gICAgICAgICAgICAvLyBpbnB1dHMgZWxlbWVudHMgdGhhdCBhcmUgaW4gYSBkaXNhYmxlZCBzdGF0ZSBidXQgYXJlIGVuYWJsZWQgd2hlbiB0aG9zZSBldmVudHNcclxuICAgICAgICAgICAgLy8gYXJlIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICR3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnSW5kZXhlZERCU3J2JywgW1wiJHdpbmRvd1wiLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIGtleVBhdGggPSAnbmFtZSc7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREIgPSAkd2luZG93LmluZGV4ZWREQiB8fCAkd2luZG93LndlYmtpdEluZGV4ZWREQiB8fCAkd2luZG93Lm1zSW5kZXhlZERCO1xyXG4gICAgICAgIHZhciBJREJLZXlSYW5nZSA9ICR3aW5kb3cuSURCS2V5UmFuZ2UgfHwgJHdpbmRvdy53ZWJraXRJREJLZXlSYW5nZTtcclxuXHJcbiAgICAgICAgdmFyIElEQlRyYW5zYWN0aW9uID0gJHdpbmRvdy5JREJUcmFuc2FjdGlvbiB8fCAkd2luZG93LndlYmtpdElEQlRyYW5zYWN0aW9uO1xyXG5cclxuICAgICAgICBpZiAoSURCVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSA9IElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgfHwgJ3JlYWR3cml0ZSc7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSA9IElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSB8fCAncmVhZG9ubHknO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5kZXhlZERCID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBlIGlzIGFuIGluc3RhbmNlIG9mIElEQlZlcnNpb25DaGFuZ2VFdmVudFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IGlkYi5jcmVhdGVPYmplY3RTdG9yZShzdG9yZU5hbWUsIHsga2V5UGF0aDoga2V5UGF0aCB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkLCB1cGRhdGUsIGRlbGV0ZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZHJvcERhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBzdWNjZXNzZnVsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3AgZmFpbGVkXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFkZEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLmFkZChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwdXRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5wdXQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW1OYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IElEQktleVJhbmdlLm9ubHkoaXRlbU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKHJhbmdlKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gY3Vyc29yLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW1zID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjcmVhdGVEYXRhYmFzZTogY3JlYXRlRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGRyb3BEYXRhYmFzZTogZHJvcERhdGFiYXNlLFxyXG4gICAgICAgICAgICBhZGRJdGVtOiBhZGRJdGVtLFxyXG4gICAgICAgICAgICBwdXRJdGVtOiBwdXRJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW06IHJldHJpZXZlSXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtczogcmV0cmlldmVJdGVtcyxcclxuICAgICAgICAgICAgaW5kZXhlZERCQXZhaWxhYmxlOiBpbmRleGVkREJBdmFpbGFibGVcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0xvZ1NydicsIFtcIkFwcENvbmZpZ1wiLCBmdW5jdGlvbihBcHBDb25maWcpIHtcclxuICAgICAgICB2YXIgbG9nSW5mbyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmluZm9cIl0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9nRXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKEFwcENvbmZpZ1tcImxvZy5lcnJvclwiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5mbzogbG9nSW5mbyxcclxuICAgICAgICAgICAgZXJyb3I6IGxvZ0Vycm9yXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdRdWl6U3J2JywgW1wiQXBwQ29uZmlnXCIsIFwiQ291bnRyeVNydlwiLCBcIlNjb3JlU3J2XCIsIFwiRXZlbnRTcnZcIiwgZnVuY3Rpb24oQXBwQ29uZmlnLCBDb3VudHJ5U3J2LCBTY29yZVNydiwgRXZlbnRTcnYpIHtcclxuICAgICAgICB2YXIgY291bnRyaWVzID0gbnVsbDtcclxuICAgICAgICB2YXIgY291bnRyaWVzQnlBbHBoYTMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgcXVpeiA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBzZXRDb3VudHJpZXMgPSBmdW5jdGlvbihfY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgIGNvdW50cmllcyA9IF9jb3VudHJpZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNvdW50cmllc0xvYWRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzICE9PSBudWxsICYmIGNvdW50cmllcy5sZW5ndGggPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY291bnRyaWVzTG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiQ291bnRyaWVzIGhhdmUgbm90IGJlZW4gbG9hZGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHF1aXogPSBjcmVhdGVRdWl6KCdjb3VudHJ5Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gYWRkIHF1aXogc3RhcnQgZXZlbnRcclxuICAgICAgICAgICAgICAgIEV2ZW50U3J2LmFkZCgncXVpei5zdGFydCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUocXVpei5zdGFydCgpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRpc3Bvc2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcXVpeiA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNTdGFydGVkKCkgJiYgIXF1aXouaGFzRW5kZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpelN0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNTdGFydGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVpeiA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6Lmhhc0VuZGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZVF1aXogPSBmdW5jdGlvbihxdWl6VHlwZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHF1aXpUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjb3VudHJ5JzpcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNvdW50cnlRdWl6KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlQ291bnRyeVF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGNvdW50cnlRdWl6ID0gbmV3IFF1aXooKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBmdWxsUG9pbnRzID0gMTAwO1xyXG4gICAgICAgICAgICB2YXIgaGludE1heGltdW0gPSAzO1xyXG4gICAgICAgICAgICB2YXIgaGludENvc3QgPSAyNTtcclxuXHJcbiAgICAgICAgICAgIHZhciBsYXN0UXVlc3Rpb25Cb251cyA9IDIuNTtcclxuXHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGVzID0gQXBwQ29uZmlnWydxdWl6LmNvdW50cnkudHlwZXMnXTtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZXNMZW5ndGggPSBPYmplY3Qua2V5cyhxdWVzdGlvblR5cGVzKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAvLyBzZWxlY3QgY291bnRyaWVzIGZvciBxdWVzdGlvbnNcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkQ291bnRyaWVzID0gW107XHJcbiAgICAgICAgICAgIHZhciBudW1iZXJPZlF1ZXN0aW9ucyA9IEFwcENvbmZpZ1sncXVpei5jb3VudHJ5LnF1ZXN0aW9ucyddO1xyXG5cclxuICAgICAgICAgICAgLy8gdGhlcmUgYXJlIGZpdmUgZWFzeSwgZml2ZSBtZWRpdW0gYW5kIGZpdmUgaGFyZCBxdWVzdGlvbnMgKGxhdGVyIHRvIGJlIHNodWZmbGVkIHJhbmRvbWx5KVxyXG4gICAgICAgICAgICAvLyB0aGUgMTZ0aCBhbmQgbGFzdCBxdWVzdGlvbiBpcyBhbHdheXMgYSBoYXJkIG9uZS5cclxuXHJcbiAgICAgICAgICAgIHZhciBlYXN5Q291bnRyaWVzID0gY291bnRyaWVzLmZpbHRlcihmdW5jdGlvbihjKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYy5kaWZmaWN1bHR5ID09PSAnZWFzeSc7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIG1lZGl1bUNvdW50cmllcyA9IGNvdW50cmllcy5maWx0ZXIoZnVuY3Rpb24oYykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGMuZGlmZmljdWx0eSA9PT0gJ21lZGl1bSc7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIGhhcmRDb3VudHJpZXMgPSBjb3VudHJpZXMuZmlsdGVyKGZ1bmN0aW9uKGMpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjLmRpZmZpY3VsdHkgPT09ICdoYXJkJztcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBzZWxlY3QgY291bnRyaWVzXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtYmVyT2ZRdWVzdGlvbnM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnlPayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnk7XHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKCFjb3VudHJ5T2spIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IDUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeSA9IGVhc3lDb3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIGVhc3lDb3VudHJpZXMubGVuZ3RoIC0gMSldO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnkgPSBtZWRpdW1Db3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIG1lZGl1bUNvdW50cmllcy5sZW5ndGggLSAxKV07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeSA9IGhhcmRDb3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIGhhcmRDb3VudHJpZXMubGVuZ3RoIC0gMSldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRyeU9rID0gc2VsZWN0ZWRDb3VudHJpZXMuaW5kZXhPZihjb3VudHJ5WydhbHBoYTNDb2RlJ10pIDwgMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENvdW50cmllcy5wdXNoKGNvdW50cnlbJ2FscGhhM0NvZGUnXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIHNodWZmbGUgYXJyYXkgKC0yIGJlY2F1c2Ugd2UgZG9uJ3Qgd2FudCB0byBzaHVmZmxlIHRoZSBsYXN0IGNvdW50cnkgKGl0IGhhcyB0byBzdGF5IGluIHBsYWNlKVxyXG4gICAgICAgICAgICB2YXIgYXJyYXlUb1NodWZmbGUgPSBzZWxlY3RlZENvdW50cmllcy5zcGxpY2UoMCwgc2VsZWN0ZWRDb3VudHJpZXMubGVuZ3RoIC0gMSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2h1ZmZsZWRBcnJheSA9IHNodWZmbGUoYXJyYXlUb1NodWZmbGUpO1xyXG5cclxuICAgICAgICAgICAgLy8gYWRkIGxhc3QgcXVlc3Rpb24gdG8gc2h1ZmZsZWQgYXJyYXlcclxuICAgICAgICAgICAgc2h1ZmZsZWRBcnJheS5wdXNoKHNlbGVjdGVkQ291bnRyaWVzW3NlbGVjdGVkQ291bnRyaWVzLmxlbmd0aCAtIDFdKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBxdWVzdGlvbiB0eXBlIGFycmF5XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGVBcnJheSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1iZXJPZlF1ZXN0aW9uczsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBxdWVzdGlvblR5cGVBcnJheS5wdXNoKDYpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvKmZvciAodmFyIGogPSAwOyBqIDwgbnVtYmVyT2ZRdWVzdGlvbnM7IGorKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGogPCAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25UeXBlQXJyYXkucHVzaCgxKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaiA8IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvblR5cGVBcnJheS5wdXNoKDIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChqIDwgOSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uVHlwZUFycmF5LnB1c2goMyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGogPCAxMikge1xyXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uVHlwZUFycmF5LnB1c2goNCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGogPCAxNSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uVHlwZUFycmF5LnB1c2goNSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBvbmUgcmFuZG9tIHF1ZXN0aW9uIGZvciB0aGUgbGFzdCBvbmVcclxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvblR5cGVBcnJheS5wdXNoKGdldFJhbmRvbUludCgxLCBxdWVzdGlvblR5cGVzTGVuZ3RoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgdmFyIHNodWZmbGVkUXVlc3Rpb25UeXBlQXJyYXkgPSBzaHVmZmxlKHF1ZXN0aW9uVHlwZUFycmF5KTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBxdWVzdGlvbnMgZm9yIHF1aXpcclxuICAgICAgICAgICAgdmFyIHFjbnQgPSAwO1xyXG4gICAgICAgICAgICBzaHVmZmxlZEFycmF5LmZvckVhY2goZnVuY3Rpb24oYWxwaGEzLCBpZHgpIHtcclxuICAgICAgICAgICAgICAgIHFjbnQrKztcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uVHlwZXNbc2h1ZmZsZWRRdWVzdGlvblR5cGVBcnJheVtpZHhdXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGdldFF1ZXN0aW9uVGV4dChxdWVzdGlvblR5cGUsIGNvdW50cnkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogcXVlc3Rpb25UeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IGNvdW50cnkuZGlmZmljdWx0eSxcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dDogZ2V0UXVlc3Rpb25JbnB1dChxdWVzdGlvblR5cGUpLFxyXG4gICAgICAgICAgICAgICAgICAgIHVuaXQ6IGdldFF1ZXN0aW9uVW5pdChxdWVzdGlvblR5cGUpXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdmFyIGFuc3dlciA9IGdldFF1ZXN0aW9uQW5zd2VyKHF1ZXN0aW9uVHlwZSwgY291bnRyeSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tBbnN3ZXIgPSBnZXRDaGVja0Fuc3dlckxhbWJkYShxdWVzdGlvblR5cGUsIGZ1bGxQb2ludHMsIGxhc3RRdWVzdGlvbkJvbnVzKTtcclxuICAgICAgICAgICAgICAgIHZhciBoaW50cyA9IGdldFF1ZXN0aW9uSGludHMocXVlc3Rpb25UeXBlLCBoaW50TWF4aW11bSwgaGludENvc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHRoZSBsYXN0IHF1ZXN0aW9uIGlzIHRoZSBib251cyBxdWVzdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKHFjbnQgPj0gbnVtYmVyT2ZRdWVzdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmZvWydib251cyddID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBhZGQgaW5mbyBmb3IgZmxhZyBvZiBjb3VudHJ5XHJcbiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnRkxBR19PRl9DT1VOVFJZJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm8ubWVkaWEgPSAnZmxhZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mby5hbHBoYTJDb2RlID0gY291bnRyeS5hbHBoYTJDb2RlLnRvTG9jYWxlTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gYWRkIGluZm8gZm9yIGxvY2F0aW9uIG9mIGNvdW50cnlcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdMT0NBVElPTl9PRl9DT1VOVFJZJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm8ubWVkaWEgPSAnbWFwJztcclxuICAgICAgICAgICAgICAgICAgICBpbmZvLmFscGhhMkNvZGUgPSBjb3VudHJ5LmFscGhhMkNvZGUudG9Mb2NhbGVMb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5UXVpei5hZGRRdWVzdGlvbihuZXcgUXVlc3Rpb24oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5mbzogaW5mbyxcclxuICAgICAgICAgICAgICAgICAgICBhbnN3ZXI6IGFuc3dlcixcclxuICAgICAgICAgICAgICAgICAgICBjaGVja0Fuc3dlcjogY2hlY2tBbnN3ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgaGludHM6IGhpbnRzXHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cnlRdWl6O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblRleHQgPSBmdW5jdGlvbih0eXBlLCBjb3VudHJ5KSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgaGVpw590IGRpZSBIYXVwdHN0YWR0IHZvbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIltcIiArIGNvdW50cnkuY2FwaXRhbCArIFwiXSBpc3QgZGllIEhhdXB0c3RhZHQgdm9uIHdlbGNoZW0gTGFuZFwiXHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgdmllbGUgTWVuc2NoZW4gbGViZW4gaW4gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgZ3Jvw58gaXN0IGRpZSBGbMOkY2hlIHZvbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldlbGNoZXMgTGFuZCBoYXQgZGllc2UgRmxhZ2dlXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnTE9DQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV28gYmVmaW5kZXQgc2ljaCBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uQW5zd2VyID0gZnVuY3Rpb24odHlwZSwgY291bnRyeSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFsdFNwZWxsaW5ncyA9IGNvdW50cnkuYWx0U3BlbGxpbmdzICE9PSB1bmRlZmluZWQgJiYgY291bnRyeS5hbHRTcGVsbGluZ3NbJ2NhcGl0YWwnXSAhPT0gdW5kZWZpbmVkID8gY291bnRyeS5hbHRTcGVsbGluZ3NbJ2NhcGl0YWwnXSA6IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5LmNhcGl0YWwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsdFNwZWxsaW5nczogYWx0U3BlbGxpbmdzXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWx0U3BlbGxpbmdzID0gY291bnRyeS5hbHRTcGVsbGluZ3MgIT09IHVuZGVmaW5lZCAmJiBjb3VudHJ5LmFsdFNwZWxsaW5nc1snbmFtZSddICE9PSB1bmRlZmluZWQgPyBjb3VudHJ5LmFsdFNwZWxsaW5nc1snbmFtZSddIDogW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWx0U3BlbGxpbmdzOiBhbHRTcGVsbGluZ3NcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5wb3B1bGF0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkuYXJlYVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnTE9DQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5hbHBoYTJDb2RlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uSW5wdXQgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ251bWJlci5oaWdoJztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbnVtYmVyLm1lZGl1bSc7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnTE9DQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdtYXAucG9pbnQnO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd0ZXh0LnN0YW5kYXJkJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblVuaXQgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2ttwrInO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdFaW53b2huZXInO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q2hlY2tBbnN3ZXJMYW1iZGEgPSBmdW5jdGlvbih0eXBlLCBmdWxsUG9pbnRzLCBsYXN0UXVlc3Rpb25Cb251cykge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0xPQ0FUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhbnN3ZXIsIHN1Ym1pdHRlZEFuc3dlciwgaGludHNVc2VkLCBoaW50Q29zdCwgaW5mbykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxsb3dlZFNwZWxsaW5ncztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbnN3ZXIuYWx0U3BlbGxpbmdzICYmIGFuc3dlci5hbHRTcGVsbGluZ3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFNwZWxsaW5ncyA9IGFuc3dlci5hbHRTcGVsbGluZ3MubWFwKGZ1bmN0aW9uKHNwZWxsaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNwZWxsaW5nLnRvTG9jYWxlTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRTcGVsbGluZ3MgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvcnJlY3QgPSBzdWJtaXR0ZWRBbnN3ZXIudG9Mb2NhbGVMb3dlckNhc2UoKSA9PT0gYW5zd2VyLmNvcnJlY3QudG9Mb2NhbGVMb3dlckNhc2UoKSB8fCAoYWxsb3dlZFNwZWxsaW5ncyAmJiBhbGxvd2VkU3BlbGxpbmdzLmluZGV4T2Yoc3VibWl0dGVkQW5zd2VyKSA+PSAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludHMgPSBjb3JyZWN0ID8gZnVsbFBvaW50cyA6IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBoaW50cyBhcmUgYWxsb3dlZCBhbmQgaGF2ZSBiZWVuIHVzZWQsIHN1YnRyYWN0IHRoZSBwb2ludHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpbnRzVXNlZCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAtPSAoaGludHNVc2VkICogaGludENvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBib251cyBwb2ludHMgZm9yIGxhc3QgcXVlc3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8gIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzICo9IGxhc3RRdWVzdGlvbkJvbnVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBoaW50c1VzZWQsIGhpbnRDb3N0LCBpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBwZXJjZW50YWdlIGRpZmZlcmVuY2UgZnJvbSBjb3JyZWN0IGFuc3dlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JQZXJjZW50YWdlID0gTWF0aC5hYnMoc3VibWl0dGVkQW5zd2VyIC0gYW5zd2VyLmNvcnJlY3QpIC8gYW5zd2VyLmNvcnJlY3QgKiAxMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDkwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSA5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA4MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDcwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDE2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDQwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAyMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDI1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMzApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaGludHMgYXJlIGFsbG93ZWQgYW5kIGhhdmUgYmVlbiB1c2VkLCBzdWJ0cmFjdCB0aGUgcG9pbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaW50c1VzZWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgLT0gKGhpbnRzVXNlZCAqIGhpbnRDb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYm9udXMgcG9pbnRzIGZvciBsYXN0IHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAqPSBsYXN0UXVlc3Rpb25Cb251cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uSGludHMgPSBmdW5jdGlvbih0eXBlLCBoaW50c1Bvc3NpYmxlLCBoaW50Q29zdCkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhpbXVtOiBoaW50c1Bvc3NpYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3N0OiBoaW50Q29zdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2l2ZTogZnVuY3Rpb24oaGludHNVc2VkLCBhbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhbnN3ZXIuY29ycmVjdC5zdWJzdHIoMCwgaGludHNVc2VkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZDogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0TnVtYmVyT2ZRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5jdXJyZW50UXVlc3Rpb24oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHF1aXoubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFRvdGFsUG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0VG90YWxQb2ludHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENvbmNsdWRlcyB0aGUgcXVpeiBhbmQgcHV0cyB0aGUgc2NvcmUgdG8gdGhlIEFQSSBlbmRwb2ludC5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgY29uY2x1ZGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1aXogIT09IG51bGwgJiYgcXVpei5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHF1aXouc3VibWl0dGVkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnUXVpeiBoYXMgYWxyZWFkeSBiZWVuIHN1Ym1pdHRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcXVpei5zdWJtaXR0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBTY29yZVNydi5wdXRIaWdoc2NvcmUocXVpei5nZXRUb3RhbFBvaW50cygpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgcXVpeiBmaW5pc2ggZXZlbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV2ZW50U3J2LmFkZCgncXVpei5maW5pc2gnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCgnTm8gcXVpeiBpcyBjdXJyZW50bHkgcnVubmluZycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTaHVmZmxlcyBhbiBhcnJheSByYW5kb21seVxyXG4gICAgICAgICAqIEBwYXJhbSBhcnJheSAgICAgdGhlIGFycmF5IHRvIGJlIHNodWZmbGVkXHJcbiAgICAgICAgICogQHJldHVybnMgeyp9ICAgICB0aGUgc2h1ZmZsZWQgYXJyYXlcclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgc2h1ZmZsZSA9IGZ1bmN0aW9uIChhcnJheSkge1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudEluZGV4ID0gYXJyYXkubGVuZ3RoLCB0ZW1wb3JhcnlWYWx1ZSwgcmFuZG9tSW5kZXg7XHJcblxyXG4gICAgICAgICAgICAvLyBXaGlsZSB0aGVyZSByZW1haW4gZWxlbWVudHMgdG8gc2h1ZmZsZS4uLlxyXG4gICAgICAgICAgICB3aGlsZSAoMCAhPT0gY3VycmVudEluZGV4KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUGljayBhIHJlbWFpbmluZyBlbGVtZW50Li4uXHJcbiAgICAgICAgICAgICAgICByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGN1cnJlbnRJbmRleCk7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50SW5kZXggLT0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBBbmQgc3dhcCBpdCB3aXRoIHRoZSBjdXJyZW50IGVsZW1lbnQuXHJcbiAgICAgICAgICAgICAgICB0ZW1wb3JhcnlWYWx1ZSA9IGFycmF5W2N1cnJlbnRJbmRleF07XHJcbiAgICAgICAgICAgICAgICBhcnJheVtjdXJyZW50SW5kZXhdID0gYXJyYXlbcmFuZG9tSW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgYXJyYXlbcmFuZG9tSW5kZXhdID0gdGVtcG9yYXJ5VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhcnJheTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBzZXRDb3VudHJpZXM6IHNldENvdW50cmllcyxcclxuICAgICAgICAgICAgaXNRdWl6UnVubmluZzogaXNRdWl6UnVubmluZyxcclxuICAgICAgICAgICAgaGFzUXVpelN0YXJ0ZWQ6IGhhc1F1aXpTdGFydGVkLFxyXG4gICAgICAgICAgICBoYXNRdWl6RW5kZWQ6IGhhc1F1aXpFbmRlZCxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyOiBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIsXHJcbiAgICAgICAgICAgIGdldE51bWJlck9mUXVpelF1ZXN0aW9uczogZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50UXVlc3Rpb246IGdldEN1cnJlbnRRdWVzdGlvbixcclxuICAgICAgICAgICAgbmV4dFF1ZXN0aW9uOiBuZXh0UXVlc3Rpb24sXHJcbiAgICAgICAgICAgIGdldFRvdGFsUG9pbnRzOiBnZXRUb3RhbFBvaW50cyxcclxuICAgICAgICAgICAgY29uY2x1ZGU6IGNvbmNsdWRlLFxyXG4gICAgICAgICAgICBkaXNwb3NlOiBkaXNwb3NlXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdTY29yZVNydicsIFtcIiRodHRwXCIsIGZ1bmN0aW9uKCRodHRwKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgZW50aXJlIGhpZ2hzY29yZSBsaXN0IGluIGFuIGFycmF5IGZyb20gdGhlIEFQSS5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgZ2V0SGlnaHNjb3JlTGlzdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvc2NvcmVzL2FsbCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgaGlnaHNjb3JlIG9iamVjdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIElmIHRoZSB1c2VyIGhhcyBubyByZXN1bHQgeWV0LCBhbiBlbXB0eSBvYmplY3QgaXMgcmV0dXJuZWQuXHJcbiAgICAgICAgICogUmV0dXJucyBhIHByb21pc2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGdldFVzZXJIaWdoc2NvcmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3Njb3Jlcy91c2VyJylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHNjb3JlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEZldGNoZXMgdGhlIGhpZ2hzY29yZSBvYmplY3QgZm9yIHRoZSBvdmVyYWxsIGhpZ2hzY29yZS5cclxuICAgICAgICAgKiBJZiB0aGVyZSBpcyBjdXJyZW50bHkgbm8gcmVzdWx0IHlldCwgYW4gZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkLlxyXG4gICAgICAgICAqIFJldHVybnMgYSBwcm9taXNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBnZXRPdmVyYWxsSGlnaHNjb3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9zY29yZXMvaGlnaCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oc2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzY29yZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBQdXRzIGEgaGlnaHNjb3JlIHJlc3VsdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIEBwYXJhbSBzY29yZSAgICAgTnVtYmVyIHdpdGggdGhlIGFjaGlldmVkIHNjb3JlLlxyXG4gICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBwdXRIaWdoc2NvcmUgPSBmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvc2NvcmVzJywgeyBzY29yZTogc2NvcmUgfSlcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRIaWdoc2NvcmVMaXN0OiBnZXRIaWdoc2NvcmVMaXN0LFxyXG4gICAgICAgICAgICBnZXRVc2VySGlnaHNjb3JlOiBnZXRVc2VySGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBnZXRPdmVyYWxsSGlnaHNjb3JlOiBnZXRPdmVyYWxsSGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBwdXRIaWdoc2NvcmU6IHB1dEhpZ2hzY29yZVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnVXNlclNydicsIFtcIiRodHRwXCIsIFwiQXV0aFRva2VuU3J2XCIsIFwiQXBwQ29uZmlnXCIsIGZ1bmN0aW9uKCRodHRwLCBBdXRoVG9rZW5TcnYsIEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VyJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXJGcm9tU3RvcmFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4odG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdG9rZW4sIHdlIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIHRva2VuIGluIHN0b3JhZ2VcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9uJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9rZW4gPSByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNhdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKHNlbGYudG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRVc2VyKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRva2VuIGxvY2FsbHlcclxuICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24obmV3VXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzZWxlY3QgYSByYW5kb20gY29sb3IgZm9yIHRoZSB1c2VyXHJcbiAgICAgICAgICAgICAgICB2YXIgY29sb3JzID0gQXBwQ29uZmlnWydzZXR0aW5ncy51c2VyLmNvbG9ycyddO1xyXG4gICAgICAgICAgICAgICAgbmV3VXNlci5jb2xvciA9IGNvbG9yc1tnZXRSYW5kb21JbnQoMCwgY29sb3JzLmxlbmd0aCAtIDEpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3VzZXInLCBuZXdVc2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW1tZWRpYXRlbHkgbG9nIHRoZSB1c2VyIGluXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luKG5ld1VzZXIudXNlcm5hbWUsIG5ld1VzZXIucGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pICA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZUJhc2ljID0gZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvdXNlci9iYXNpYycsIHVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlUGFzc3dvcmQgPSBmdW5jdGlvbihwYXNzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnB1dCgnL2FwaS91c2VyL3Bhc3N3b3JkJywgcGFzcylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVzZXRQYXNzd29yZCA9IGZ1bmN0aW9uKGJvZHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9wYXNzd29yZC9yZXNldCcsIGJvZHkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGZvcmdvdFBhc3N3b3JkID0gZnVuY3Rpb24oYm9keSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3Bhc3N3b3JkL2ZvcmdvdCcsIGJvZHkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0VXNlcjogZ2V0VXNlcixcclxuICAgICAgICAgICAgZ2V0VXNlckZyb21TdG9yYWdlOiBnZXRVc2VyRnJvbVN0b3JhZ2UsXHJcbiAgICAgICAgICAgIGxvZ2luOiBsb2dpbixcclxuICAgICAgICAgICAgbG9nb3V0OiBsb2dvdXQsXHJcbiAgICAgICAgICAgIHJlZ2lzdGVyOiByZWdpc3RlcixcclxuICAgICAgICAgICAgdXBkYXRlQmFzaWM6IHVwZGF0ZUJhc2ljLFxyXG4gICAgICAgICAgICB1cGRhdGVQYXNzd29yZDogdXBkYXRlUGFzc3dvcmQsXHJcbiAgICAgICAgICAgIHJlc2V0UGFzc3dvcmQ6IHJlc2V0UGFzc3dvcmQsXHJcbiAgICAgICAgICAgIGZvcmdvdFBhc3N3b3JkOiBmb3Jnb3RQYXNzd29yZFxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7IiwiLy8gb3duIGNsYXNzZXMgYW5kIGZ1bmN0aW9uc1xyXG5cclxuLy8gLS0tLS0tLS0tLSBNQVAgLS0tLS0tLS0tLVxyXG52YXIgY3JlYXRlTWFwID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgbWFwID0gbmV3IERhdGFtYXAoe1xyXG4gICAgICAgIGVsZW1lbnQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAtY29udGFpbmVyJyksXHJcbiAgICAgICAgZ2VvZ3JhcGh5Q29uZmlnOiB7XHJcbiAgICAgICAgICAgIGhpZ2hsaWdodE9uSG92ZXI6IHRydWUsXHJcbiAgICAgICAgICAgIHBvcHVwT25Ib3ZlcjogZmFsc2VcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVJWiAtLS0tLS0tLS0tXHJcbnZhciBRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBpbmRleCBvZiBjdXJyZW50IHF1ZXN0aW9uXHJcbiAgICB2YXIgY3VycmVudFF1ZXN0aW9uSWR4ID0gbnVsbDtcclxuXHJcbiAgICAvLyBhcnJheSBjb250YWluaW5nIGFsbCBxdWVzdGlvbnNcclxuICAgIHZhciBxdWVzdGlvbnMgPSBbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN0YXJ0cyB0aGUgcXVpei5cclxuICAgICAqL1xyXG4gICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIGNoZWNrIGlmIHF1aXogaGFzIHF1ZXN0aW9uc1xyXG4gICAgICAgIGlmIChxdWVzdGlvbnMubGVuZ3RoIDw9IDApXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHN0YXJ0IGEgcXVpeiB3aXRob3V0IHF1ZXN0aW9uc1wiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaXNBY3RpdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNTdGFydGVkKCkgJiYgIXRoaXMuaGFzRW5kZWQoKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbklkeCAhPT0gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhc1N0YXJ0ZWQoKSAmJiBjdXJyZW50UXVlc3Rpb25JZHggPj0gcXVlc3Rpb25zLmxlbmd0aDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5zdWJtaXR0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBuZXcgcXVlc3Rpb24gdG8gdGhlIHF1aXouXHJcbiAgICAgKiBUaGUgcGFyYW1ldGVyIG11c3QgYmUgYW4gcXVlc3Rpb24gb2JqZWN0LlxyXG4gICAgICogSWYgbm8gcXVlc3Rpb24gb2JqZWN0IGlzIHBhc3NlZCBvciBhbiBvYmplY3Qgd2l0aCBtaXNzaW5nIHByb3BlcnRpZXMsIGFuIGVycm9yIGlzIHRocm93bi5cclxuICAgICAqL1xyXG4gICAgdGhpcy5hZGRRdWVzdGlvbiA9IGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XHJcbiAgICAgICAgaWYgKHF1ZXN0aW9uID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiTm8gcXVlc3Rpb24gb2JqZWN0IHBhc3NlZFwiKTtcclxuXHJcbiAgICAgICAgdmFyIHZhbGlkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gYSBxdWVzdGlvbiBvYmplY3QgbXVzdCBjb250YWluIGFsbCB0aGVzZSBwcm9wZXJ0aWVzXHJcbiAgICAgICAgdmFyIG5lY2Vzc2FyeVByb3BlcnRpZXMgPSBbJ2NvbmZpZycsICdoaW50JywgJ3NvbHV0aW9uJywgJ2Fuc3dlcicsICdxdWVzdGlvbicsICdnZXRJbmZvJywgJ2luZm8nLCAncG9pbnRzJywgJ2Fuc3dlcmVkJywgJ2hpbnRzQWxsb3dlZCcsICdoaW50c1JlbWFpbmluZyddO1xyXG5cclxuICAgICAgICBuZWNlc3NhcnlQcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcGVydHkpIHtcclxuICAgICAgICAgICAgaWYgKCFxdWVzdGlvbi5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHtcclxuICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJRdWVzdGlvbiBtdXN0IGhhdmUgcHJvcGVydHkgJ1wiICsgcHJvcGVydHkgKyBcIidcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHZhbGlkKSB7XHJcbiAgICAgICAgICAgIHF1ZXN0aW9ucy5wdXNoKHF1ZXN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgbmV4dCBxdWVzdGlvbiBvZiB0aGUgcXVpei5cclxuICAgICAqIElmIHRoZSBxdWl6IGhhcyBlbmRlZCwgaXQgcmV0dXJucyBub3RoaW5nLlxyXG4gICAgICovXHJcbiAgICB0aGlzLm5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChjdXJyZW50UXVlc3Rpb25JZHggPT09IG51bGwpIHtcclxuICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSWR4ID0gMDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjdXJyZW50UXVlc3Rpb25JZHgrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmhhc0VuZGVkKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JZHhdO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmN1cnJlbnRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JZHhdO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldFRvdGFsUG9pbnRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5oYXNTdGFydGVkKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgdG90YWxQb2ludHMgPSAwO1xyXG5cclxuICAgICAgICBxdWVzdGlvbnMuZm9yRWFjaChmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgcG9pbnRzID0gcXVlc3Rpb24ucG9pbnRzKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocG9pbnRzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHRvdGFsUG9pbnRzICs9IHBvaW50cztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdG90YWxQb2ludHM7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRRdWVzdGlvbklkeCA9PT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIHJldHVybiBjdXJyZW50UXVlc3Rpb25JZHggKyAxO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldE51bWJlck9mUXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9ucy5sZW5ndGg7XHJcbiAgICB9O1xyXG59O1xyXG5cclxuLy8gLS0tLS0tLS0tLSBRVUVTVElPTiAtLS0tLS0tLS0tXHJcbnZhciBRdWVzdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgIC8vIFRleHQgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgdGV4dCA9IG51bGw7XHJcblxyXG4gICAgLy8gSW5mbyBvYmplY3QgZm9yIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGluZm8gPSBudWxsO1xyXG5cclxuICAgIC8vIEFuc3dlciBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBhbnN3ZXIgPSBudWxsO1xyXG5cclxuICAgIC8vIEhpbnRzIG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGhpbnRzID0gbnVsbDtcclxuICAgIHZhciBoaW50c1VzZWQgPSAwO1xyXG5cclxuICAgIC8vIExhbWJkYSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgdGhlIGFuc3dlciBzdGF0dXMgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgY2hlY2tBbnN3ZXIgPSBudWxsO1xyXG5cclxuICAgIC8vIFBvaW50cyBhd2FyZGVkIGZvciB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBwb2ludHMgPSBudWxsO1xyXG5cclxuICAgIC8vIEZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHF1ZXN0aW9uIGhhcyBhbHJlYWR5IGJlZW4gYW5zd2VyZWRcclxuICAgIHZhciBhbnN3ZXJlZCA9IGZhbHNlO1xyXG5cclxuICAgIHZhciBpbml0ID0gZnVuY3Rpb24ob3B0cykge1xyXG4gICAgICAgIHRleHQgPSBvcHRzLnRleHQ7XHJcbiAgICAgICAgaW5mbyA9IG9wdHMuaW5mbyB8fCB7fTtcclxuICAgICAgICBhbnN3ZXIgPSBvcHRzLmFuc3dlcjtcclxuICAgICAgICBjaGVja0Fuc3dlciA9IG9wdHMuY2hlY2tBbnN3ZXIgfHwgbnVsbDtcclxuXHJcbiAgICAgICAgaGludHMgPSBvcHRzLmhpbnRzIHx8IHtcclxuICAgICAgICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlLCAgICAgLy8gaXMgYSBoaW50IGFsbG93ZWQ/XHJcbiAgICAgICAgICAgICAgICBtYXhpbXVtOiAwLCAgICAgICAgIC8vIG1heGltdW0gbnVtYmVyIG9mIGhpbnRzIGZvciB0aGlzIHF1ZXN0aW9uIChpcnJlbGV2YW50IGlmIGFsbG93ZWQgaXMgc2V0IHRvIGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgY29zdDogMCwgICAgICAgICAgICAvLyBudW1iZXIgb2YgcG9pbnRzIHN1YnRyYWN0ZWQgcGVyIHVzZWQgaGludCAoaXJyZWxldmFudCBpZiBhbGxvd2VkIGlzIHNldCB0byBmYWxzZSlcclxuICAgICAgICAgICAgICAgIGdpdmU6IG51bGwgICAgICAgICAgLy8gbGFtYmRhIGZ1bmN0aW9uIHRvIGdpdmUgYSBoaW50IGZvciBhIHF1ZXN0aW9uXHJcbiAgICAgICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgaW5pdChvcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNvbmZpZyA9IGZ1bmN0aW9uKG9wdHMpIHtcclxuICAgICAgICBpbml0KG9wdHMpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHF1ZXN0aW9uIHRleHQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMucXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGV4dDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBxdWVzdGlvbiBpbmZvIG9iamVjdC5cclxuICAgICAqIEFjdHMgYXMgZ2V0dGVyICh3aXRoIG9ubHkgb25lIGFyZ3VtZW50KSBhbmQgc2V0dGVyICh3aXRoIHR3byBhcmd1bWVudHMpXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaW5mbyA9IGZ1bmN0aW9uKHByb3AsIHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgLy8gc2V0dGVyXHJcbiAgICAgICAgICAgIGluZm9bcHJvcF0gPSB2YWx1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBnZXR0ZXJcclxuICAgICAgICAgICAgcmV0dXJuIGluZm9bcHJvcF07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIGVudGlyZSBpbmZvIG9iamVjdC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5nZXRJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGluZm87XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgY29ycmVjdCBhbnN3ZXIgdG8gdGhlIHF1ZXN0aW9uIGFmdGVyIHRoZSBxdWVzdGlvbiBoYXMgYmVlbiBhbnN3ZXJlZC5cclxuICAgICAqIElmIHRoZSBxdWVzdGlvbiBoYXMgbm90IGJlZW4gYW5zd2VyZWQgeWV0LCBpdCByZXR1cm5zIG51bGwuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuc29sdXRpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoYW5zd2VyZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFuc3dlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgYSBoaW50IGZvciB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKiBJZiBubyBoaW50cyBhcmUgYWxsb3dlZCwgb3IgdGhlIG1heGltdW0gbnVtYmVyIG9mIGhpbnRzIGhhdmUgYmVlbiB1c2VkLCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmhpbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoIWhpbnRzLmFsbG93ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaGludHMuYWxsb3dlZCAmJiAhaGludHMuZ2l2ZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIaW50cyBhbGxvd2VkIGJ1dCBubyBnaXZlIG1ldGhvZCBwYXNzZWRcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaGludHNVc2VkIDwgaGludHMubWF4aW11bSkge1xyXG4gICAgICAgICAgICBoaW50c1VzZWQrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBoaW50cy5naXZlKGhpbnRzVXNlZCwgYW5zd2VyKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdWJtaXRzIGFuIGFuc3dlciB0byB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKiBJZiB0aGUgcXVlc3Rpb24gaGFzIGFscmVhZHkgYmVlbiBhbnN3ZXJlZCBvciBubyBjaGVja0Fuc3dlciBsYW1iZGEgaGFzIGJlZW4gc2V0LCB0aGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYW5zd2VyID0gZnVuY3Rpb24oc3VibWl0dGVkQW5zd2VyKSB7XHJcbiAgICAgICAgaWYgKGFuc3dlcmVkIHx8IWNoZWNrQW5zd2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFuc3dlcmVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gY2hlY2tBbnN3ZXIgbWV0aG9kIHNob3VsZCByZXR1cm4gdGhlIHN0YXR1cyByZXN1bHRzXHJcbiAgICAgICAgcG9pbnRzID0gY2hlY2tBbnN3ZXIoYW5zd2VyLCBzdWJtaXR0ZWRBbnN3ZXIsIGhpbnRzVXNlZCwgaGludHMuY29zdCwgaW5mbyk7XHJcblxyXG4gICAgICAgIC8vIGVuc3VyZSB0aGF0IG5vIG5lZ2F0aXZlIHBvaW50cyBhcmUgYXdhcmRlZFxyXG4gICAgICAgIHBvaW50cyA9IE1hdGgubWF4KDAsIHBvaW50cyk7XHJcblxyXG4gICAgICAgIC8vIGVuc3VyZSB0aGF0IG9ubHkgaW50ZWdlciB2YWx1ZXMgYXJlIHNhdmVkXHJcbiAgICAgICAgcG9pbnRzID0gTWF0aC5mbG9vcihwb2ludHMpO1xyXG5cclxuICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnBvaW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICghYW5zd2VyZWQgfHwgcG9pbnRzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBzdGF0ZSBvZiB0aGUgcXVlc3Rpb24uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gYW5zd2VyZWQ7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0cnVlIGlmIGhpbnRzIGFyZSBhbGxvd2VkIGZvciB0aGlzIHF1ZXN0aW9uLCBmYWxzZSBpZiBub3QuXHJcbiAgICAgKiBJZiBoaW50cyBoYXZlIG5vdCBiZWVuIGluaXRpYWxpemVkIHlldCwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50c0FsbG93ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoaGludHMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGhpbnRzLmFsbG93ZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgcmVtYWluaW5nIGhpbnRzLlxyXG4gICAgICogSWYgbm8gaGludHMgYXJlIGFsbG93ZWQgZm9yIHRoaXMgcXVlc3Rpb24sIG51bGwgaXMgcmV0dXJuZWQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaGludHNSZW1haW5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgYWxsb3dlZCA9IHRoaXMuaGludHNBbGxvd2VkKCk7XHJcblxyXG4gICAgICAgIGlmIChhbGxvd2VkID09PSBudWxsIHx8IGFsbG93ZWQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGhpbnRzLm1heGltdW0gLSBoaW50c1VzZWQ7XHJcbiAgICB9O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgYSByYW5kb20gaW50ZWdlciBiZXR3ZWVuIG1pbiAoaW5jbHVzaXZlKSBhbmQgbWF4IChpbmNsdXNpdmUpXHJcbiAqIFVzaW5nIE1hdGgucm91bmQoKSB3aWxsIGdpdmUgeW91IGEgbm9uLXVuaWZvcm0gZGlzdHJpYnV0aW9uIVxyXG4gKi9cclxudmFyIGdldFJhbmRvbUludCA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7XHJcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRoZSB0ZXh0IGJldHdlZW4gdHdvIGRlbGltaXRpbmcgdGV4dCBvY2N1cnJlbmNlc1xyXG4gKi9cclxudmFyIGdldFN0cmluZ0JldHdlZW4gPSBmdW5jdGlvbih0ZXh0LCBmaXJzdFN0cmluZywgc2Vjb25kU3RyaW5nKSB7XHJcbiAgICB2YXIgZmlyc3RQb3MgPSB0ZXh0LmluZGV4T2YoZmlyc3RTdHJpbmcpO1xyXG4gICAgdmFyIHNlY29uZFBvcyA9IHRleHQuaW5kZXhPZihzZWNvbmRTdHJpbmcpO1xyXG5cclxuICAgIGlmIChmaXJzdFBvcyA+PSAwICYmIHNlY29uZFBvcyA+PSAwICYmIHNlY29uZFBvcyA+IGZpcnN0UG9zKSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQuc3Vic3RyKGZpcnN0UG9zICsgMSwgc2Vjb25kUG9zIC0gZmlyc3RQb3MgLSAxKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxufTtcclxuXHJcbi8vIC0tLS0tLS0tLS0gUEFTU1dPUkQgUkVRVUlSRU1FTlRTIFZBTElEQVRPUiAtLS0tLS0tLS0tXHJcbnZhciBQYXNzd29yZFJlcXVpcmVtZW50c1ZhbGlkYXRvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIC8vIGRlZmF1bHQgY29uZmlndXJhdGlvblxyXG4gICAgdmFyIGRlZmF1bHRDb25maWcgPSB7XHJcbiAgICAgICAgbWluTGVuZ3RoOiA4LFxyXG4gICAgICAgIG1heExlbmd0aDogdW5kZWZpbmVkLFxyXG4gICAgICAgIGxvd2VyY2FzZUNoYXJzOiAxLFxyXG4gICAgICAgIHVwcGVyY2FzZUNoYXJzOiAxLFxyXG4gICAgICAgIHNwZWNpYWxDaGFyczogMSxcclxuICAgICAgICBudW1lcmljQ2hhcnM6IDFcclxuICAgIH07XHJcblxyXG4gICAgLy8gdXNlZCBjb25maWd1cmF0aW9uXHJcbiAgICB2YXIgY29uZmlndXJhdGlvbiA9IG51bGw7XHJcblxyXG4gICAgLy8gcGFzc3dvcmQgaW5wdXRcclxuICAgIHRoaXMuaW5wdXQgPSBudWxsO1xyXG5cclxuICAgIHRoaXMuY2hlY2sgPSBmdW5jdGlvbihfaW5wdXQpIHtcclxuICAgICAgICAvLyBjaGVjayBpZiBhbiBpbnB1dCB3YXMgcGFzc2VkXHJcbiAgICAgICAgaWYgKHR5cGVvZiBfaW5wdXQgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBtYW5kYXRvcnkgaW5wdXQgcGFyYW1ldGVyJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBjaGVjayBpZiBwYXNzZWQgaW5wdXQgaXMgb2YgdHlwZSBcInN0cmluZ1wiXHJcbiAgICAgICAgaWYgKHR5cGVvZiBfaW5wdXQgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmlyc3QgaW5wdXQgcGFyYW1ldGVyIG11c3QgYmUgb2YgdHlwZSBcXFwic3RyaW5nXFxcIicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gc2V0IGlucHV0IHZhcmlhYmxlXHJcbiAgICAgICAgdGhpcy5pbnB1dCA9IF9pbnB1dDtcclxuXHJcbiAgICAgICAgLy8gYXJyYXkgY29udGFpbmluZyBhbGwgZmFpbGVkIGNoZWNrc1xyXG4gICAgICAgIHZhciBmYWlsZWRDaGVja3MgPSBbXTtcclxuXHJcbiAgICAgICAgLy8gZ2V0IGFsbCBzZXQgY29uZmlnIHByb3BlcnRpZXNcclxuICAgICAgICB2YXIgY29uZmlnUHJvcGVydGllcyA9IGdldENvbmZpZ1Byb3BlcnRpZXMoKTtcclxuXHJcbiAgICAgICAgY29uZmlnUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKGNvbmZpZ1Byb3ApIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHBlcmZvcm1DaGVjayhjb25maWdQcm9wKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIGZhaWxlZENoZWNrcy5wdXNoKGNvbmZpZ1Byb3ApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIHJldHVybiByZXN1bHRcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBwYXNzd29yZE9rOiBmYWlsZWRDaGVja3MubGVuZ3RoID09PSAwLFxyXG4gICAgICAgICAgICBmYWlsZWRDaGVja3M6IGZhaWxlZENoZWNrc1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuc2V0Q29uZmlnID0gZnVuY3Rpb24oX2NvbmZpZykge1xyXG4gICAgICAgIGNvbmZpZ3VyYXRpb24gPSBfY29uZmlnO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldENvbmZpZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBjb25maWd1cmF0aW9uIHx8IGRlZmF1bHRDb25maWc7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBpc0NvbmZpZ1Byb3BlcnR5U2V0ID0gZnVuY3Rpb24ocHJvcCkge1xyXG4gICAgICAgIHJldHVybiB0eXBlb2Ygc2VsZi5nZXRDb25maWcoKVtwcm9wXSAhPT0gJ3VuZGVmaW5lZCc7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXRDb25maWdQcm9wZXJ0aWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHNlbGYuZ2V0Q29uZmlnKCkpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZ2V0Q29uZmlnUHJvcGVydHkgPSBmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0Q29uZmlnKClbcHJvcF07XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBwZXJmb3JtQ2hlY2sgPSBmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzZWxmLmlucHV0ICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgcHJvcGVydHlWYWx1ZSA9IGdldENvbmZpZ1Byb3BlcnR5KHByb3ApO1xyXG5cclxuICAgICAgICBpZiAoIXByb3BlcnR5VmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzd2l0Y2ggKHByb3ApIHtcclxuICAgICAgICAgICAgY2FzZSAnbWluTGVuZ3RoJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmlucHV0Lmxlbmd0aCA+PSBwcm9wZXJ0eVZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnbWF4TGVuZ3RoJzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmlucHV0Lmxlbmd0aCA8PSBwcm9wZXJ0eVZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnbG93ZXJjYXNlQ2hhcnMnOlxyXG4gICAgICAgICAgICAgICAgdmFyIG51bUxvd2VyID0gc2VsZi5pbnB1dC5sZW5ndGggLSBzZWxmLmlucHV0LnJlcGxhY2UoL1thLXpdL2csICcnKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bUxvd2VyID49IHByb3BlcnR5VmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICd1cHBlcmNhc2VDaGFycyc6XHJcbiAgICAgICAgICAgICAgICB2YXIgbnVtVXBwZXIgPSBzZWxmLmlucHV0Lmxlbmd0aCAtIHNlbGYuaW5wdXQucmVwbGFjZSgvW0EtWl0vZywgJycpLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtVXBwZXIgPj0gcHJvcGVydHlWYWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ3NwZWNpYWxDaGFycyc6XHJcbiAgICAgICAgICAgICAgICB2YXIgbnVtU3BlY2lhbHMgPSBzZWxmLmlucHV0Lmxlbmd0aCAtIHNlbGYuaW5wdXQucmVwbGFjZSgvWyFAwqckJSYjXipfOjsuwrAsK1wiJ2DCtFxce1xcfVxcKFxcKVxcW1xcXVxcL1xcXFwtXS9nLCAnJykubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBudW1TcGVjaWFscyA+PSBwcm9wZXJ0eVZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnbnVtZXJpY0NoYXJzJzpcclxuICAgICAgICAgICAgICAgIHZhciBudW1OdW1iZXJzID0gc2VsZi5pbnB1dC5sZW5ndGggLSBzZWxmLmlucHV0LnJlcGxhY2UoL1swLTldL2csICcnKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bU51bWJlcnMgPj0gcHJvcGVydHlWYWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn07XHJcblxyXG5QYXNzd29yZFJlcXVpcmVtZW50c1ZhbGlkYXRvci5DT05GSUdfUFJPUEVSVElFUyA9IFtcclxuICAgICdtaW5MZW5ndGgnLCAgICAgICAgLy8gbWluaW11bSBsZW5ndGggb2YgcGFzc3dvcmRcclxuICAgICdtYXhMZW5ndGgnLCAgICAgICAgLy8gbWF4aW11bSBsZW5ndGggb2YgcGFzc3dvcmQgKHVuZGVmaW5lZCBmb3Igbm8gbWF4aW11bSBsZW5ndGgpXHJcbiAgICAnbG93ZXJjYXNlQ2hhcnMnLCAgIC8vIG51bWJlciBvZiBtYW5kYXRvcnkgbG93ZXJjYXNlIGNoYXJhY3RlcnNcclxuICAgICd1cHBlcmNhc2VDaGFycycsICAgLy8gbnVtYmVyIG9mIG1hbmRhdG9yeSB1cHBlcmNhc2UgY2hhcmFjdGVyc1xyXG4gICAgJ3NwZWNpYWxDaGFycycsICAgICAvLyBudW1iZXIgb2YgbWFuZGF0b3J5IHNwZWNpYWwgY2hhcmFjdGVyc1xyXG4gICAgJ251bWVyaWNDaGFycycgICAgICAgLy8gbnVtYmVyIG9mIG1hbmRhdG9yeSBudW1iZXIgY2hhcmFjdGVyc1xyXG5dO1xyXG5cclxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cy5RdWVzdGlvbiA9IFF1ZXN0aW9uO1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuUXVpeiA9IFF1aXo7XHJcbiAgICBtb2R1bGUuZXhwb3J0cy5QYXNzd29yZFJlcXVpcmVtZW50c1ZhbGlkYXRvciA9IFBhc3N3b3JkUmVxdWlyZW1lbnRzVmFsaWRhdG9yO1xyXG59IiwiYW5ndWxhci5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb25maWcoZnVuY3Rpb24oJGxvY2F0aW9uUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgICAgICAvLyBlbmFibGUgSFRNTDUgcHVzaHN0YXRlXHJcbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG5cclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvaG9tZScpO1xyXG5cclxuICAgICAgICB2YXIgYXV0aG9yaXplID0gZnVuY3Rpb24oQXV0aFNydiwgTG9nU3J2LCAkcSkge1xyXG4gICAgICAgICAgICByZXR1cm4gQXV0aFNydi5nZXRVc2VyKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlcjtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdCgnTm90IGF1dGhvcml6ZWQnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnaG9tZScsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9ob21lJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2hvbWUucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3F1aXonLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvcXVpeicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9xdWl6LnBhcnRpYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogYXV0aG9yaXplXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnY291bnRyaWVzJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2NvdW50cmllcycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9jb3VudHJpZXMucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdjb3VudHJpZXMuZGV0YWlsJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnLzphbHBoYTNDb2RlJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2NvdW50cmllcy1kZXRhaWwucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9sb2dpbicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9sb2dpbi5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnbG9nb3V0Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ291dCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTG9nb3V0Q3RybCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdyZWdpc3RlcicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9yZWdpc3RlcicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9yZWdpc3Rlci5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnc2V0dGluZ3MnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvc2V0dGluZ3MnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvc2V0dGluZ3MucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdwYXNzd29yZCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9wYXNzd29yZCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9wYXNzd29yZC1jaGFuZ2UucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdyZXNldCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9wYXNzd29yZC9yZXNldC86dG9rZW4nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvcGFzc3dvcmQtcmVzZXQucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2ZvcmdvdCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9wYXNzd29yZC9mb3Jnb3QnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvcGFzc3dvcmQtZm9yZ290LnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdhYm91dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hYm91dCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9hYm91dC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnaGlnaHNjb3JlJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hpZ2hzY29yZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9oaWdoc2NvcmUucGFydGlhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRob3JpemVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdmYXEnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvZmFxJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2ZhcS5wYXJ0aWFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnY291bnRyaWVzLWRpZmZpY3VsdHknLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvY291bnRyaWVzLWRpZmZpY3VsdHknLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvY291bnRyeS1kaWZmaWN1bHR5LnBhcnRpYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogYXV0aG9yaXplXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignQ291bnRyaWVzQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgQ291bnRyeVNydikge1xyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUxldHRlciA9IG51bGw7XHJcbiAgICAgICAgdmFyIGNvdW50cnlLZXlzID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXIgPSBDb3VudHJ5U3J2LmdldENvdW50cmllc0J5TGV0dGVyKCk7XHJcbiAgICAgICAgICAgIGNvdW50cnlLZXlzID0gT2JqZWN0LmtleXMoY291bnRyaWVzQnlMZXR0ZXIpLnNvcnQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghJHNjb3BlLiQkcGhhc2UpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cnlLZXlzID0gY291bnRyeUtleXM7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cmllc0J5TGV0dGVyID0gY291bnRyaWVzQnlMZXR0ZXI7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb3VudHJ5S2V5cyA9IGNvdW50cnlLZXlzO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvdW50cmllc0J5TGV0dGVyID0gY291bnRyaWVzQnlMZXR0ZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoQ291bnRyeVNydi5hcmVDb3VudHJpZXNMb2FkZWQoKSkge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdjb3VudHJpZXMubG9hZGVkJywgZnVuY3Rpb24oKSAge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignQ291bnRyeURldGFpbEN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIENvdW50cnlTcnYsICRzdGF0ZVBhcmFtcykge1xyXG4gICAgICAgIHZhciBhbHBoYTNDb2RlID0gJHN0YXRlUGFyYW1zLmFscGhhM0NvZGU7XHJcblxyXG4gICAgICAgIGlmIChDb3VudHJ5U3J2LmFyZUNvdW50cmllc0xvYWRlZCgpKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5jb3VudHJ5ID0gQ291bnRyeVNydi5nZXRDb3VudHJ5QnlBbHBoYTMoYWxwaGEzQ29kZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdjb3VudHJpZXMubG9hZGVkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhM0NvZGUpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyeUZyb21TZXJ2aWNlID0gZnVuY3Rpb24oYWxwaGEzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTMpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5nZXRDb3VudHJ5RnJvbVNlcnZpY2UgPSBnZXRDb3VudHJ5RnJvbVNlcnZpY2U7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignQ291bnRyeURpZmZpY3VsdHlDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBDb3VudHJ5U3J2KSB7XHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGNvdW50cmllcyA9IENvdW50cnlTcnYuZ2V0Q291bnRyaWVzKCk7XHJcbiAgICAgICAgICAgIHZhciBkaWZmaWN1bHRpZXMgPSB7XHJcbiAgICAgICAgICAgICAgICAnZWFzeSc6IFtdLFxyXG4gICAgICAgICAgICAgICAgJ21lZGl1bSc6IFtdLFxyXG4gICAgICAgICAgICAgICAgJ2hhcmQnOiBbXSxcclxuICAgICAgICAgICAgICAgICd1bmFzc2lnbmVkJzogW11cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIC8vIGRldGVybWluZSBkaWZmaWN1bHR5XHJcbiAgICAgICAgICAgIGNvdW50cmllcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBiLnBvcHVsYXRpb24gLSBhLnBvcHVsYXRpb247XHJcbiAgICAgICAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24oYykge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBkaWZmaWN1bHRpZXNbYy5kaWZmaWN1bHR5XS5wdXNoKGMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRpZmZpY3VsdGllcyA9IGRpZmZpY3VsdGllcztcclxuICAgICAgICAgICAgICAgICRzY29wZS5kaWZmaWN1bHR5S2V5cyA9IE9iamVjdC5rZXlzKGRpZmZpY3VsdGllcyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kaWZmaWN1bHRpZXMgPSBkaWZmaWN1bHRpZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRpZmZpY3VsdHlLZXlzID0gT2JqZWN0LmtleXMoZGlmZmljdWx0aWVzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKENvdW50cnlTcnYuYXJlQ291bnRyaWVzTG9hZGVkKCkpIHtcclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignY291bnRyaWVzLmxvYWRlZCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdEcm9wZG93bkN0cmwnLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkc2NvcGUudG9nZ2xlRHJvcGRvd24gPSB0b2dnbGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuc2hvd0Ryb3Bkb3duID0gc2hvd0Ryb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5oaWRlRHJvcGRvd24gPSBoaWRlRHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmlzRHJvcGRvd25WaXNpYmxlID0gaXNEcm9wZG93blZpc2libGU7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ2NsaWNrLm91dHNpZGUnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBpZiAoaXNEcm9wZG93blZpc2libGUoKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGlkZURyb3Bkb3duKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVEcm9wZG93bigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gIXZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93RHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGlkZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0Ryb3Bkb3duVmlzaWJsZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZpc2libGU7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0ZhcUN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIExvZ1NydiwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBjaGVjayBzdGF0ZSBwYXJhbXNcclxuICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLmFjdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgYWN0aW9uID0gJHN0YXRlUGFyYW1zLmFjdGlvbjtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAoYWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdyZWdpc3Rlci5zdWNjZXNzZnVsJzpcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnR3JhdHVsYXRpb24hIERpZSBBbm1lbGR1bmcgd2FyIGVyZm9sZ3JlaWNoLiBIZXJ6bGljaCB3aWxsa29tbWVuIGJlaSBNYWdlbGxhbi4nXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignRm9yZ290Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgTG9nU3J2LCBGb2N1c1Nydikge1xyXG4gICAgICAgICRzY29wZS5wYXNzT2JqID0ge307XHJcbiAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7fTtcclxuXHJcbiAgICAgICAgdmFyIGZvcmdvdFBhc3N3b3JkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghJHNjb3BlLnBhc3NPYmouZW1haWwpIHtcclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0FsbGUgRmVsZGVyIG3DvHNzZW4gYXVzZ2Vmw7xsbHQgc2VpbicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBVc2VyU3J2LmZvcmdvdFBhc3N3b3JkKHtcclxuICAgICAgICAgICAgICAgIGVtYWlsOiAkc2NvcGUucGFzc09iai5lbWFpbFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZhciB2YWxpZGl0eSA9IGRhdGEudmFsaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHZhbGlkVGV4dCA9IHZhbGlkaXR5ICE9PSB1bmRlZmluZWQgPyBcIiBEZXIgTGluayBpc3QgXCIgKyB2YWxpZGl0eSArIFwiIFN0dW5kZW4gbGFuZyBnw7xsdGlnLlwiIDogXCJcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRNZXNzYWdlKCdzdWNjZXNzJywgJ0RhcyBFLU1haWwgd3VyZGUgZXJmb2xncmVpY2ggdmVyc2FuZHQuJyArIHZhbGlkVGV4dCk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVyci5tZXNzYWdlID09PSBcIk5vIHVzZXIgd2l0aCB0aGlzIGUtbWFpbCBhZGRyZXNzIGZvdW5kXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRNZXNzYWdlKCdlcnJvcicsICdFcyB3dXJkZSBrZWluIEJlbnV0emVyIG1pdCBkaWVzZXIgRS1NYWlsLUFkcmVzc2UgZ2VmdW5kZW4nKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnQmVpbSBWZXJzZW5kZW4gZGVzIExpbmtzIGlzdCBldHdhcyBzY2hpZWZnZWdhbmdlbicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGVsZWdhdGVTdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgZm9yZ290UGFzc3dvcmQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0TWVzc2FnZSA9IGZ1bmN0aW9uKHR5cGUsIHRleHQpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHRcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBGb2N1c1NydignI2VtYWlsJyk7XHJcblxyXG4gICAgICAgICRzY29wZS5mb3Jnb3RQYXNzd29yZCA9IGZvcmdvdFBhc3N3b3JkO1xyXG4gICAgICAgICRzY29wZS5kZWxlZ2F0ZVN1Ym1pdCA9IGRlbGVnYXRlU3VibWl0O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0hpZ2hzY29yZUN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFNjb3JlU3J2LCBMb2dTcnYpIHtcclxuICAgICAgICAkc2NvcGUuc2NvcmVMaXN0ID0gW107XHJcblxyXG4gICAgICAgICRzY29wZS5pc0RhdGFMb2FkaW5nID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgU2NvcmVTcnYuZ2V0SGlnaHNjb3JlTGlzdCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zY29yZUxpc3QgPSBjcmVhdGVSYW5raW5nKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2NvcmVMaXN0ID0gY3JlYXRlUmFua2luZyhsaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzZXRMb2FkaW5nU3RhdGUoZmFsc2UpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRMb2FkaW5nU3RhdGUoZmFsc2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIHNldExvYWRpbmdTdGF0ZSA9IGZ1bmN0aW9uKHN0YXRlKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzRGF0YUxvYWRpbmcgPSBzdGF0ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzRGF0YUxvYWRpbmcgPSBzdGF0ZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzTXlzZWxmID0gZnVuY3Rpb24oaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRzY29wZS51c2VyLl9pZCA9PT0gaWQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZVJhbmtpbmcgPSBmdW5jdGlvbihsaXN0KSB7XHJcbiAgICAgICAgICAgIHZhciByYW5rID0gMDtcclxuXHJcbiAgICAgICAgICAgIHZhciBwcmV2aW91c1Njb3JlID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGxpc3QuZm9yRWFjaChmdW5jdGlvbihlbnRyeSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFwcmV2aW91c1Njb3JlIHx8IGVudHJ5LnNjb3JlICE9PSBwcmV2aW91c1Njb3JlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmFuaysrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBlbnRyeS5yYW5rID0gcmFuayArICcuJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBwcmV2aW91c1Njb3JlID0gZW50cnkuc2NvcmU7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGxpc3Q7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmlzTXlzZWxmID0gaXNNeXNlbGY7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTG9naW5DdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2LCBGb2N1c1Nydikge1xyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIFVzZXJTcnYubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ2luIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZVRleHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIuc3RhdHVzID09PSA0MDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZVRleHQgPSAnRmFsc2NoZXIgQmVudXR6ZXJuYW1lIG9kZXIgUGFzc3dvcnQnO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0JlaW0gRWlubG9nZ2VuIHNjaGVpbnQgZXR3YXMgc2NoaWVmIGdlZ2FuZ2VuIHp1IHNlaW4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGZvY3VzIHVzZXJuYW1lIGZpZWxkXHJcbiAgICAgICAgRm9jdXNTcnYoJyN1c2VybmFtZScpO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ291dEN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTcnYpIHtcclxuICAgICAgICBVc2VyU3J2LmxvZ291dCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcGxpY2F0aW9uIGNvbnRyb2wgYWJvdXQgbG9nb3V0IGV2ZW50XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dvdXQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTWFwQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG5cclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdQYXNzd29yZFJlcXVpcmVtZW50c0N0cmwnLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICB2YXIgcmVxcyA9IFtcclxuICAgICAgICAgICAgeyBrZXk6ICdtaW5MZW5ndGgnLCBkZXNjcmlwdGlvbjogJ0RhcyBQYXNzd29ydCBtdXNzIHp1bWluZGVzdCA4IFplaWNoZW4gbGFuZyBzZWluJyB9LFxyXG4gICAgICAgICAgICB7IGtleTogJ2xvd2VyY2FzZUNoYXJzJywgZGVzY3JpcHRpb246ICdEYXMgUGFzc3dvcnQgbXVzcyB6dW1pbmRlc3QgZWluZW4gS2xlaW5idWNoc3RhYmVuIGVudGhhbHRlbicgfSxcclxuICAgICAgICAgICAgeyBrZXk6ICd1cHBlcmNhc2VDaGFycycsIGRlc2NyaXB0aW9uOiAnRGFzIFBhc3N3b3J0IG11c3MgenVtaW5kZXN0IGVpbmVuIEdyb8OfYnVjaHN0YWJlbiBlbnRoYWx0ZW4nIH0sXHJcbiAgICAgICAgICAgIHsga2V5OiAnbnVtZXJpY0NoYXJzJywgZGVzY3JpcHRpb246ICdEYXMgUGFzc3dvcnQgbXVzcyB6dW1pbmRlc3QgZWluZSBaYWhsIGVudGhhbHRlbicgfSxcclxuICAgICAgICAgICAgeyBrZXk6ICdzcGVjaWFsQ2hhcnMnLCBkZXNjcmlwdGlvbjogJ0RhcyBQYXNzd29ydCBtdXNzIHp1bWluZGVzdCBlaW4gU29uZGVyemVpY2hlbiBlbnRoYWx0ZW4nIH1cclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICB2YXIgdmFsaWRhdG9yID0gbmV3IFBhc3N3b3JkUmVxdWlyZW1lbnRzVmFsaWRhdG9yKCk7XHJcblxyXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3Bhc3N3b3JkSW5wdXQnLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUsIHNjb3BlKSB7XHJcbiAgICAgICAgICAgIHVwZGF0ZVJlcXVpcmVtZW50cyhuZXdWYWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBzZXRTY29wZVByb3BlcnR5ID0gZnVuY3Rpb24ocHJvcCwgdmFsdWUpIHtcclxuICAgICAgICAgICAgJHNjb3BlW3Byb3BdID0gdmFsdWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZVJlcXVpcmVtZW50cyA9IGZ1bmN0aW9uKHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB2YWxpZGF0b3IuY2hlY2socGFzc3dvcmQpO1xyXG5cclxuICAgICAgICAgICAgc2V0U2NvcGVQcm9wZXJ0eSgncmVxdWlyZW1lbnRzJywgcmVxcy5tYXAoZnVuY3Rpb24ocmVxdWlyZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHJlcXVpcmVtZW50LmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bGZpbGxlZDogcmVzdWx0LmZhaWxlZENoZWNrcy5pbmRleE9mKHJlcXVpcmVtZW50LmtleSkgPCAwXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgICAgICBzZXRTY29wZVByb3BlcnR5KCdwYXNzd29yZE9rJywgcmVzdWx0LnBhc3N3b3JkT2spO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWxpemUgcGFzc3dvcmRPayBwcm9wZXJ0eVxyXG4gICAgICAgIHNldFNjb3BlUHJvcGVydHkoJ3Bhc3N3b3JkT2snLCBmYWxzZSk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUGFzc3dvcmRDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2LCBMb2dTcnYsIEZvY3VzU3J2KSB7XHJcbiAgICAgICAgJHNjb3BlLnBhc3NPYmogPSB7fTtcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHt9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlUGFzc3dvcmQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCEkc2NvcGUucGFzc09iai5vbGQgfHwgISRzY29wZS5wYXNzT2JqLm5ldyB8fCAhJHNjb3BlLnBhc3NPYmouY29uZmlybWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRNZXNzYWdlKCdlcnJvcicsICdBbGxlIEZlbGRlciBtw7xzc2VuIGF1c2dlZsO8bGx0IHNlaW4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUucGFzc09iai5uZXcgIT09ICRzY29wZS5wYXNzT2JqLmNvbmZpcm1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnZXJyb3InLCAnRGllIFBhc3N3w7ZydGVyIHN0aW1tZW4gbmljaHQgw7xiZXJlaW4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFVzZXJTcnYudXBkYXRlUGFzc3dvcmQoe1xyXG4gICAgICAgICAgICAgICAgb2xkOiAkc2NvcGUucGFzc09iai5vbGQsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogJHNjb3BlLnBhc3NPYmoubmV3XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgc2V0TWVzc2FnZSgnc3VjY2VzcycsICdEYXMgbmV1ZSBQYXNzd29ydCB3dXJkZSBlcmZvbGdyZWljaCBnZXNwZWljaGVydCcpO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnIubWVzc2FnZSA9PT0gXCJPbGQgcGFzc3dvcmQgaW5jb3JyZWN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRNZXNzYWdlKCdlcnJvcicsICdEYXMgYWx0ZSBQYXNzd29ydCBpc3QgbmljaHQga29ycmVrdCcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnIubWVzc2FnZSA9PT0gXCJQYXNzd29yZCBkb2VzIG5vdCBtYXRjaCByZXF1aXJlbWVudHNcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0RhcyBQYXNzd29ydCBlbnRzcHJpY2h0IG5pY2h0IGRlbiBTaWNoZXJoZWl0c3JpY2h0bGluaWVuJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0RhcyBuZXVlIFBhc3N3b3J0IGtvbm50ZSBuaWNodCBnZXNwZWljaGVydCB3ZXJkZW4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRlbGVnYXRlU3VibWl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHVwZGF0ZVBhc3N3b3JkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNldE1lc3NhZ2UgPSBmdW5jdGlvbih0eXBlLCB0ZXh0KSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIEZvY3VzU3J2KCcjcGFzc3dvcmQtY3VycmVudCcpO1xyXG5cclxuICAgICAgICAkc2NvcGUudXBkYXRlUGFzc3dvcmQgPSB1cGRhdGVQYXNzd29yZDtcclxuICAgICAgICAkc2NvcGUuZGVsZWdhdGVTdWJtaXQgPSBkZWxlZ2F0ZVN1Ym1pdDtcclxuICAgIH0pOyIsIlxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUXVpekRpcmVjdGl2ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsIFF1aXpTcnYsIExvZ1NydiwgRm9jdXNTcnYsIG5nUHJvZ3Jlc3NGYWN0b3J5LCAkZmlsdGVyKSB7XHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uO1xyXG5cclxuICAgICAgICB2YXIgaW5pdEN0cmwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gUHJvZ3Jlc3MgYmFyIGluaXRpYWxpemF0aW9uXHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2JhciA9IG5nUHJvZ3Jlc3NGYWN0b3J5LmNyZWF0ZUluc3RhbmNlKCk7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRQYXJlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotcHJvZ3Jlc3MnKSk7XHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRBYnNvbHV0ZSgpO1xyXG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0Q29sb3IoXCIjMzM2ZTdiXCIpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmlzUmVzdWx0c1BhZ2VWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5hY2hpZXZlbWVudHMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gW107XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQgPSB7fTtcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gYWRkIG9wdGlvbnMgZm9yIG11bHRpcGxpZXIgc2VsZWN0aW9uXHJcbiAgICAgICAgICAgICRzY29wZS5tdWx0aXBsaWVyT3B0aW9ucyA9IFtcclxuICAgICAgICAgICAgICAgIHsgdmFsdWU6IDEsIGxhYmVsOiAnJyB9LFxyXG4gICAgICAgICAgICAgICAgeyB2YWx1ZTogMTAwMCwgbGFiZWw6ICdUc2QuJ30sXHJcbiAgICAgICAgICAgICAgICB7IHZhbHVlOiAxMDAwMDAwLCBsYWJlbDogJ01pby4nfVxyXG4gICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgcXVlc3Rpb24gPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVVaSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBnZXQgY3VycmVudCBxdWVzdGlvbiBmcm9tIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICBxdWVzdGlvbiA9IFF1aXpTcnYuZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBkZWxldGUgcHJldmlvdXMgaGludHNcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgaWYgKHF1ZXN0aW9uICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBtdWx0aXBsaWVycyBmb3IgcXVlc3Rpb25zIGNvbnRhaW5pbmcgbnVtYmVyc1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dCAmJiBxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQuaW5kZXhPZignbnVtYmVyJykgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHF1ZXN0aW9uLmdldEluZm8oKS5pbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXIuaGlnaCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IHsgdmFsdWU6IDEwMDAwMDAsIGxhYmVsOiAnTWlvLid9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdudW1iZXIubWVkaXVtJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5tdWx0aXBsaWVyID0geyB2YWx1ZTogMTAwMCwgbGFiZWw6ICdUc2QuJ307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IHsgdmFsdWU6IDEsIGxhYmVsOiAnJyB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIHByb2dyZXNzIGJhclxyXG4gICAgICAgICAgICAgICAgdXBkYXRlUHJvZ3Jlc3NCYXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBmb2N1cyBhbnN3ZXIgaW5wdXRcclxuICAgICAgICAgICAgICAgIEZvY3VzU3J2KCcuYW5zd2VySW5wdXQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb247XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZW5kZXJRdWVzdGlvblRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlbmRlcihnZXRRdWVzdGlvbigpLnF1ZXN0aW9uKCksICdxdWVzdGlvbi1oaWdobGlnaHQnKSArICc/JztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25NZWRpYSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIXF1ZXN0aW9uIHx8ICFxdWVzdGlvbi5nZXRJbmZvKCkubWVkaWEpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5nZXRJbmZvKCkubWVkaWE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNob3dSZXN1bHRzUGFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoaWRlUmVzdWx0c1BhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNSZXN1bHRzUGFnZVZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzUmVzdWx0c1BhZ2VWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoaW50c0F2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVlc3Rpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmhpbnRzUmVtYWluaW5nKCkgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmhpbnRzUmVtYWluaW5nKCkgPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzdWJtaXRBbnN3ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIgJiYgIXF1ZXN0aW9uLmFuc3dlcmVkKCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRyYW5zZm9ybSBzdWJtaXR0ZWQgYW5zd2VyIHRvIFN0cmluZyBhbmQgdHJpbSBhbnkgd2hpdGVzcGFjZXMgYXQgdGhlIGJlZ2luIG9yIGVuZCBvZiB0aGUgYW5zd2VyXHJcbiAgICAgICAgICAgICAgICB2YXIgYW5zd2VyID0gU3RyaW5nKCRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIpLnRyaW0oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpZiBpdCBpcyBhIG51bWJlciBpbnB1dCwgcmVwbGFjZSAnLCcgd2l0aCAnLidcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvbi5nZXRJbmZvKCkuaW5wdXQgJiYgcXVlc3Rpb24uZ2V0SW5mbygpLmlucHV0LmluZGV4T2YoJ251bWJlcicpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5zd2VyID0gYW5zd2VyLnJlcGxhY2UoJywnLCAnLicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGlmIGEgbXVsdGlwbGllciBpcyBhdmFpbGFibGUsIGNhbGN1bGF0ZSBhbnN3ZXJcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuc3dlciAqPSAkc2NvcGUuYW5zd2VySW5wdXQubXVsdGlwbGllci52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYW5zd2VySW5wdXQucG9pbnRzID0gcXVlc3Rpb24uYW5zd2VyKGFuc3dlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGZvY3VzXHJcbiAgICAgICAgICAgICAgICBpZiAoIXdhc0xhc3RRdWVzdGlvbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRm9jdXNTcnYoJyNidG5OZXh0UXVlc3Rpb24nKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRm9jdXNTcnYoJyNidG5Db250aW51ZUZpbmlzaGVkJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25BbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIVF1aXpTcnYuaXNRdWl6UnVubmluZygpIHx8IHF1ZXN0aW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5hbnN3ZXJlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBuZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5uZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hbnN3ZXJJbnB1dC5hbnN3ZXIgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgdXBkYXRlVWkoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVxdWVzdEhpbnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmhpbnQgPSBxdWVzdGlvbi5oaW50KCk7XHJcblxyXG4gICAgICAgICAgICBGb2N1c1NydignLmFuc3dlcklucHV0Jyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uKHRleHQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dFxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJbXCIsIFwiPHNwYW4gY2xhc3M9J1wiICsgY2xhc3NOYW1lICsgXCInPlwiKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJdXCIsIFwiPC9zcGFuPlwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZGxlS2V5UHJlc3MgPSBmdW5jdGlvbihrZXlFdmVudCkge1xyXG4gICAgICAgICAgICBpZiAoa2V5RXZlbnQud2hpY2ggPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHN1Ym1pdEFuc3dlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZVByb2dyZXNzQmFyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBwcm9ncmVzc1BlcmNlbnQgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKSAvIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpICogMTAwO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldChwcm9ncmVzc1BlcmNlbnQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB3YXNMYXN0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpID49IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwYXJzZUV2ZW50cyA9IGZ1bmN0aW9uKGV2ZW50cywgcGVyc29uYWxCZXN0LCBvdmVyYWxsQmVzdCkge1xyXG4gICAgICAgICAgICB2YXIgYWNoaWV2ZW1lbnRzID0gW107XHJcblxyXG4gICAgICAgICAgICB2YXIgc2hvd0Jlc3RzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZignb3ZlcmFsbF9iZXN0JykgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEdSBoYXN0IGVpbmVuIG5ldWVuIGFic29sdXRlbiBSZWtvcmQgZ2VzY2hhZmZ0ISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dCZXN0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ292ZXJhbGxfYmVzdF9lcXVhbGlzZWQnKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZGVuIGFrdHVlbGxlbiBhYnNvbHV0ZW4gUmVrb3JkIGVpbmdlc3RlbGx0ISdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNob3dCZXN0cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmluZGV4T2YoJ3BlcnNvbmFsX2Jlc3QnKSA+PSAwICYmIGV2ZW50cy5pbmRleE9mKCdvdmVyYWxsX2Jlc3QnKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBlaW5lbiBuZXVlbiBwZXJzw7ZubGljaGVuIFJla29yZCBnZXNjaGFmZnQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0Jlc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZigncGVyc29uYWxfYmVzdF9lcXVhbGlzZWQnKSA+PSAwICYmIGV2ZW50cy5pbmRleE9mKCdvdmVyYWxsX2Jlc3RfZXF1YWxpc2VkJykgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0R1IGhhc3QgZ2xlaWNoIHZpZWxlIFB1bmt0ZSBnZXNjaGFmZnQgd2llIGJlaSBkZWluZW0gcGVyc8O2bmxpY2hlbiBSZWtvcmQhJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2hvd0Jlc3RzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMuaW5kZXhPZignbmV3X2RhaWx5X2Jlc3QnKSA+PSAwICYmIGFjaGlldmVtZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGFjaGlldmVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRHUgaGFzdCBlaW5lbiBuZXVlbiBwZXJzw7ZubGljaGVuIFRhZ2VzcmVrb3JkIGdlc2NoYWZmdCEnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWNoaWV2ZW1lbnRzID0gYWNoaWV2ZW1lbnRzO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWNoaWV2ZW1lbnRzID0gYWNoaWV2ZW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChzaG93QmVzdHMgJiYgcGVyc29uYWxCZXN0ICYmIHBlcnNvbmFsQmVzdC5pZCAmJiBwZXJzb25hbEJlc3QuZGF0ZSAmJiBwZXJzb25hbEJlc3Quc2NvcmUgJiYgb3ZlcmFsbEJlc3QgJiYgb3ZlcmFsbEJlc3QuaWQgJiYgb3ZlcmFsbEJlc3QuZGF0ZSAmJiBvdmVyYWxsQmVzdC5zY29yZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJlc3RzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgb3ZlcmFsbEJlc3QudHlwZSA9ICdvdmVyYWxsJztcclxuICAgICAgICAgICAgICAgIGJlc3RzLnB1c2gob3ZlcmFsbEJlc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwZXJzb25hbEJlc3QuaWQgIT09IG92ZXJhbGxCZXN0LmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGVyc29uYWxCZXN0LnR5cGUgPSAncGVyc29uYWwnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiZXN0cy5wdXNoKHBlcnNvbmFsQmVzdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gYmVzdHM7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5iZXN0cyA9IGJlc3RzO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJlc3RzID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjb250aW51ZUZpbmlzaGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIHF1aXogaGFzIGVuZGVkLCBzZXQgcHJvZ3Jlc3MgYmFyIHRvIDBcclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldCgwKTtcclxuXHJcbiAgICAgICAgICAgIHNob3dSZXN1bHRzUGFnZSgpO1xyXG5cclxuICAgICAgICAgICAgbmV4dFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBjb25jbHVkZSB0aGUgcXVpeiBhbmQgd3JpdGUgcmVzdWx0IHRvIGRhdGFiYXNlXHJcbiAgICAgICAgICAgIFF1aXpTcnYuY29uY2x1ZGUoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnNlRXZlbnRzKGRhdGEuZXZlbnRzIHx8IFtdLCBkYXRhLnBlcnNvbmFsQmVzdCwgZGF0YS5vdmVyYWxsQmVzdCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEJlc3RUZXh0ID0gZnVuY3Rpb24oYmVzdCkge1xyXG4gICAgICAgICAgICB2YXIgdGV4dDtcclxuXHJcbiAgICAgICAgICAgIGlmIChiZXN0LnR5cGUgPT09ICdwZXJzb25hbCcpIHtcclxuICAgICAgICAgICAgICAgIC8vIHBlcnNvbmFsIGJlc3RcclxuICAgICAgICAgICAgICAgIHRleHQgPSBcIkRlaW4gcGVyc8O2bmxpY2hlciBSZWtvcmQgbGllZ3QgYmVpIDxzcGFuIGNsYXNzPSdib2xkJz57UE9JTlRTfSBQdW5rdGVuPC9zcGFuPiwgYXVmZ2VzdGVsbHQgYW0ge0RBVEV9LlwiO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gb3ZlcmFsbCBiZXN0XHJcbiAgICAgICAgICAgICAgICB2YXIgZnJvbU15c2VsZiA9IGJlc3QuaWQgPT09ICRzY29wZS51c2VyLl9pZDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZnJvbU15c2VsZikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQgPSBcIkR1IGjDpGx0c3QgZGVuIGFic29sdXRlbiBSZWtvcmQgbWl0IDxzcGFuIGNsYXNzPSdib2xkJz57UE9JTlRTfSBQdW5rdGVuPC9zcGFuPiwgYXVmZ2VzdGVsbHQgYW0ge0RBVEV9LlwiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gXCI8c3BhbiBjbGFzcz0naGlnaGxpZ2h0Jz57VVNFUk5BTUV9PC9zcGFuPiBow6RsdCBkZW4gYWJzb2x1dGVuIFJla29yZCBtaXQgPHNwYW4gY2xhc3M9J2JvbGQnPntQT0lOVFN9IFB1bmt0ZW48L3NwYW4+LCBhdWZnZXN0ZWxsdCBhbSB7REFURX0uXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoJ3tQT0lOVFN9JywgJGZpbHRlcignbnVtYmVyJykoYmVzdC5zY29yZSkpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgne0RBVEV9JywgZ2V0Rm9ybWF0dGVkRGF0ZShiZXN0LmRhdGUpKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoJ3tVU0VSTkFNRX0nLCBiZXN0LnVzZXJuYW1lKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Rm9ybWF0dGVkRGF0ZSA9IGZ1bmN0aW9uKGRhdGUpIHtcclxuICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHBhZChkYXRlLmdldERhdGUoKSwgJzAwJykgKyAnLicgKyBwYWQoZGF0ZS5nZXRNb250aCgpICsgMSwgJzAwJykgKyAnLicgKyAoZGF0ZS5nZXRZZWFyKCkgKyAxOTAwKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcGFkID0gZnVuY3Rpb24oc3RyLCBwYWRWYWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gU3RyaW5nKHBhZFZhbHVlICsgc3RyKS5zbGljZSgtcGFkVmFsdWUubGVuZ3RoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVzdGFydFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcXVpeiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ3F1aXoucmVzdGFydCcpO1xyXG5cclxuICAgICAgICAgICAgaW5pdEN0cmwoKTtcclxuXHJcbiAgICAgICAgICAgIHVwZGF0ZVVpKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGVudGVyTGlzdGVuZXIgPSBmdW5jdGlvbihrZXlQcmVzcywgZnVuYykge1xyXG4gICAgICAgICAgICBpZiAoa2V5UHJlc3Mud2hpY2ggPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoZnVuYykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ25leHRfcXVlc3Rpb24nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0UXVlc3Rpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NvbnRpbnVlX2ZpbmlzaGVkJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWVGaW5pc2hlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdxdWl6LnN0YXJ0JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgaGlkZVJlc3VsdHNQYWdlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgLy8gY29udHJvbGxlciBpcyBiZWluZyBkZXN0cm95ZWQgKGkuZS4gdXNlciBsZWF2ZXMgdGhlIHBhZ2UsIHNvIHdlIHRlbGwgdGhlIHF1aXogc2VydmljZSB0byBkaXNwb3NlIG9mIHRoZSBxdWl6IG9iamVjdFxyXG4gICAgICAgICAgICBpZiAoUXVpelNydi5oYXNRdWl6U3RhcnRlZCgpICYmIFF1aXpTcnYuaGFzUXVpekVuZGVkKCkpIHtcclxuICAgICAgICAgICAgICAgIFF1aXpTcnYuZGlzcG9zZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGluaXQgY29udHJvbGxlclxyXG4gICAgICAgIGluaXRDdHJsKCk7XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWxseSB1cGRhdGUgVUlcclxuICAgICAgICB1cGRhdGVVaSgpO1xyXG5cclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb24gPSBnZXRRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyO1xyXG4gICAgICAgICRzY29wZS5yZW5kZXJRdWVzdGlvblRleHQgPSByZW5kZXJRdWVzdGlvblRleHQ7XHJcbiAgICAgICAgJHNjb3BlLnN1Ym1pdEFuc3dlciA9IHN1Ym1pdEFuc3dlcjtcclxuICAgICAgICAkc2NvcGUucXVlc3Rpb25BbnN3ZXJlZCA9IHF1ZXN0aW9uQW5zd2VyZWQ7XHJcbiAgICAgICAgJHNjb3BlLm5leHRRdWVzdGlvbiA9IG5leHRRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuaGFuZGxlS2V5UHJlc3MgPSBoYW5kbGVLZXlQcmVzcztcclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb25NZWRpYSA9IGdldFF1ZXN0aW9uTWVkaWE7XHJcbiAgICAgICAgJHNjb3BlLnJlcXVlc3RIaW50ID0gcmVxdWVzdEhpbnQ7XHJcbiAgICAgICAgJHNjb3BlLndhc0xhc3RRdWVzdGlvbiA9IHdhc0xhc3RRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuY29udGludWVGaW5pc2hlZCA9IGNvbnRpbnVlRmluaXNoZWQ7XHJcbiAgICAgICAgJHNjb3BlLmdldEJlc3RUZXh0ID0gZ2V0QmVzdFRleHQ7XHJcbiAgICAgICAgJHNjb3BlLnJlc3RhcnRRdWl6ID0gcmVzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmhpbnRzQXZhaWxhYmxlID0gaGludHNBdmFpbGFibGU7XHJcbiAgICAgICAgJHNjb3BlLmVudGVyTGlzdGVuZXIgPSBlbnRlckxpc3RlbmVyO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1F1aXpDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBRdWl6U3J2LCBMb2dTcnYpIHtcclxuXHJcbiAgICAgICAgdmFyIHN0YXJ0UXVpeiA9IGZ1bmN0aW9uKGNiKSB7XHJcbiAgICAgICAgICAgIFF1aXpTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2IgJiYgdHlwZW9mIGNiID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpelN0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuaGFzUXVpelN0YXJ0ZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpekVuZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2Lmhhc1F1aXpFbmRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRUb3RhbFBvaW50cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXRUb3RhbFBvaW50cygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ3F1aXoucmVzdGFydCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIFF1aXpTcnYuZGlzcG9zZSgpO1xyXG5cclxuICAgICAgICAgICAgc3RhcnRRdWl6KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3F1aXouc3RhcnQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRzY29wZS5zdGFydFF1aXogPSBzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmlzUXVpelJ1bm5pbmcgPSBpc1F1aXpSdW5uaW5nO1xyXG4gICAgICAgICRzY29wZS5oYXNRdWl6U3RhcnRlZCA9IGhhc1F1aXpTdGFydGVkO1xyXG4gICAgICAgICRzY29wZS5oYXNRdWl6RW5kZWQgPSBoYXNRdWl6RW5kZWQ7XHJcbiAgICAgICAgJHNjb3BlLmdldFRvdGFsUG9pbnRzID0gZ2V0VG90YWxQb2ludHM7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUmVnaXN0ZXJDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBMb2dTcnYsIEZvY3VzU3J2LCBVc2VyU3J2LCAkc3RhdGUsICR3aW5kb3cpIHtcclxuICAgICAgICAvLyBuZXcgdXNlciBvYmplY3RcclxuICAgICAgICAkc2NvcGUubmV3VXNlciA9IHt9O1xyXG5cclxuICAgICAgICAvLyBtZXNzYWdlIG9iamVjdFxyXG4gICAgICAgICRzY29wZS5tZXNzYWdlID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24gKGlzVmFsaWQpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh2YWxpZGF0ZUJlZm9yZVN1Ym1pdCgpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBwZXJmb3JtIGFwaSBjYWxsXHJcbiAgICAgICAgICAgICAgICBVc2VyU3J2LnJlZ2lzdGVyKCRzY29wZS5uZXdVc2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcCBjb250cm9sbGVyIGFib3V0IGxvZ2luXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dpbicsIHJlc3BvbnNlLmRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdmYXEnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncmVnaXN0ZXIuc3VjY2Vzc2Z1bCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnQmVpIGRlciBBbm1lbGR1bmcgc2NoZWludCBldHdhcyBzY2hpZWYgZ2VnYW5nZW4genUgc2VpbidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlVGV4dDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZXJyLm1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1VzZXJuYW1lIGFscmVhZHkgZXhpc3RzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEZXIgQmVudXR6ZXJuYW1lIGlzdCBiZXJlaXRzIGluIFZlcndlbmR1bmcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0VtYWlsIGFkZHJlc3MgYWxyZWFkeSBleGlzdHMnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RpZSBFLU1haWwtQWRyZXNzZSBpc3QgYmVyZWl0cyBpbiBWZXJ3ZW5kdW5nJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdQYXNzd29yZCBkb2VzIG5vdCBtYXRjaCByZXF1aXJlbWVudHMnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RhcyBQYXNzd29ydCBlbnRzcHJpY2h0IG5pY2h0IGRlbiBTaWNoZXJoZWl0c3JpY2h0bGluaWVuJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0JlaSBkZXIgQW5tZWxkdW5nIHNjaGVpbnQgZXR3YXMgc2NoaWVmIGdlZ2FuZ2VuIHp1IHNlaW4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISRzY29wZS4kJHBoYXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogbWVzc2FnZVRleHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB2YWxpZGF0ZUJlZm9yZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgdHdvIHBhc3N3b3JkcyBtYXRjaFxyXG4gICAgICAgICAgICB2YXIgcGFzc3dvcmQgPSAkc2NvcGUubmV3VXNlci5wYXNzd29yZDtcclxuICAgICAgICAgICAgdmFyIHBhc3N3b3JkMiA9ICRzY29wZS5uZXdVc2VyLnBhc3N3b3JkMjtcclxuXHJcbiAgICAgICAgICAgIGlmICghJHNjb3BlLm5ld1VzZXIudXNlcm5hbWUgfHwgISRzY29wZS5uZXdVc2VyLmVtYWlsIHx8ICFwYXNzd29yZCB8fCAhcGFzc3dvcmQyKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdBbGxlIEZlbGRlciBtw7xzc2VuIGF1c2dlZsO8bGx0IHNlaW4nXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhc3N3b3JkID09PSBcIlwiIHx8IHBhc3N3b3JkMiA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRGllIFBhc3N3w7ZydGVyIGvDtm5uZW4gbmljaHQgbGVlciBzZWluJ1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXNzd29yZCAhPT0gcGFzc3dvcmQyKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEaWUgUGFzc3fDtnJ0ZXIgc3RpbW1lbiBuaWNodCDDvGJlcmVpbidcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiAhJHNjb3BlLm1lc3NhZ2UgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRlbGVnYXRlU3VibWl0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJlZ2lzdGVyKHRydWUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5kZWxlZ2F0ZVN1Ym1pdCA9IGRlbGVnYXRlU3VibWl0O1xyXG5cclxuICAgICAgICAkc2NvcGUucmVnaXN0ZXIgPSByZWdpc3RlcjtcclxuXHJcbiAgICAgICAgLy8gZm9jdXMgdXNlciBuYW1lIGZpZWxkXHJcbiAgICAgICAgRm9jdXNTcnYoJyN1c2VybmFtZScpO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1Jlc2V0Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgTG9nU3J2LCBGb2N1c1NydiwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAgICAgJHNjb3BlLnBhc3NPYmogPSB7fTtcclxuICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHt9O1xyXG5cclxuICAgICAgICB2YXIgdG9rZW4gPSAkc3RhdGVQYXJhbXMudG9rZW47XHJcblxyXG4gICAgICAgIHZhciByZXNldFBhc3N3b3JkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghJHNjb3BlLnBhc3NPYmoubmV3IHx8ICEkc2NvcGUucGFzc09iai5jb25maXJtYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0FsbGUgRmVsZGVyIG3DvHNzZW4gYXVzZ2Vmw7xsbHQgc2VpbicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnBhc3NPYmoubmV3ICE9PSAkc2NvcGUucGFzc09iai5jb25maXJtYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0RpZSBQYXNzd8O2cnRlciBzdGltbWVuIG5pY2h0IMO8YmVyZWluJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0tlaW4gZ8O8bHRpZ2VyIFp1csO8Y2tzZXR6ZW4tTGluaycpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBVc2VyU3J2LnJlc2V0UGFzc3dvcmQoe1xyXG4gICAgICAgICAgICAgICAgdG9rZW46IHRva2VuLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICRzY29wZS5wYXNzT2JqLm5ld1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ3N1Y2Nlc3MnLCAnRGFzIFBhc3N3b3J0IHd1cmRlIGVyZm9sZ3JlaWNoIGdlc3BlaWNoZXJ0Jyk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVyci5tZXNzYWdlID09PSBcIkludmFsaWQgdG9rZW5cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldE1lc3NhZ2UoJ2Vycm9yJywgJ0RlciBadXLDvGNrc2V0emVuLUxpbmsgaXN0IGxlaWRlciBuaWNodCBtZWhyIGfDvGx0aWcnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyLm1lc3NhZ2UgPT09IFwiUGFzc3dvcmQgZG9lcyBub3QgbWF0Y2ggcmVxdWlyZW1lbnRzXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRNZXNzYWdlKCdlcnJvcicsICdEYXMgUGFzc3dvcnQgZW50c3ByaWNodCBuaWNodCBkZW4gU2ljaGVyaGVpdHNyaWNodGxpbmllbicpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRNZXNzYWdlKCdlcnJvcicsICdEYXMgbmV1ZSBQYXNzd29ydCBrb25udGUgbmljaHQgZ2VzcGVpY2hlcnQgd2VyZGVuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZWxlZ2F0ZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXNldFBhc3N3b3JkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNldE1lc3NhZ2UgPSBmdW5jdGlvbih0eXBlLCB0ZXh0KSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuJCRwaGFzZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgRm9jdXNTcnYoJyNwYXNzd29yZC1uZXcnKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJlc2V0UGFzc3dvcmQgPSByZXNldFBhc3N3b3JkO1xyXG4gICAgICAgICRzY29wZS5kZWxlZ2F0ZVN1Ym1pdCA9IGRlbGVnYXRlU3VibWl0O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1NldHRpbmdzQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgQXBwQ29uZmlnLCBGb2N1c1NydiwgTG9nU3J2LCBVc2VyU3J2KSB7XHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgLy8gdXNlciBjb2xvdXJzXHJcbiAgICAgICAgICAgIHZhciBjb2xvcnMgPSBBcHBDb25maWdbJ3NldHRpbmdzLnVzZXIuY29sb3JzJ107XHJcblxyXG4gICAgICAgICAgICAvLyB1c2VyIG9iamVjdFxyXG4gICAgICAgICAgICAkc2NvcGUudXNlck9iaiA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAkc2NvcGUudXNlci51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIGVtYWlsOiAkc2NvcGUudXNlci5lbWFpbCxcclxuICAgICAgICAgICAgICAgIGNvbG9yOiAkc2NvcGUudXNlci5jb2xvclxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJDb2xvcnMgPSBjb2xvcnM7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2V0Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJPYmouY29sb3IgPSBuZXdDb2xvcjtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciB1cGRhdGVVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBVc2VyU3J2LnVwZGF0ZUJhc2ljKCRzY29wZS51c2VyT2JqKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgdXNlciBvYmplY3RcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXNlci51c2VybmFtZSA9ICRzY29wZS51c2VyT2JqLnVzZXJuYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyLmVtYWlsID0gJHNjb3BlLnVzZXJPYmouZW1haWw7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXIuY29sb3IgPSAkc2NvcGUudXNlck9iai5jb2xvcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1lc3NhZ2UgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnRWluc3RlbGx1bmdlbiB3dXJkZW4gZXJmb2xncmVpY2ggZ2VzcGVpY2hlcnQnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoJ1VwZGF0ZSB1c2VyJywgZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VUZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGVyci5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1VzZXJuYW1lIGFscmVhZHkgZXhpc3RzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RlciBCZW51dHplcm5hbWUgaXN0IGJlcmVpdHMgdmVyZ2ViZW4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdFbWFpbCBhZGRyZXNzIGFscmVhZHkgZXhpc3RzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VUZXh0ID0gJ0RpZSBFLU1haWwtQWRyZXNzZSBpc3QgYmVyZWl0cyB2ZXJnZWJlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlVGV4dCA9ICdEaWUgRWluc3RlbGx1bmdlbiBrb25udGVuIG5pY2h0IGdlc3BlaWNoZXJ0IHdlcmRlbic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Vycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2VUZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBkZWxlZ2F0ZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlVXNlcih0cnVlKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zZXRDb2xvciA9IHNldENvbG9yO1xyXG4gICAgICAgICAgICAkc2NvcGUudXBkYXRlVXNlciA9IHVwZGF0ZVVzZXI7XHJcbiAgICAgICAgICAgICRzY29wZS5kZWxlZ2F0ZVN1Ym1pdCA9IGRlbGVnYXRlU3VibWl0O1xyXG5cclxuICAgICAgICAgICAgLy8gZm9jdXMgdXNlcm5hbWUgZmllbGRcclxuICAgICAgICAgICAgRm9jdXNTcnYoJyN1c2VybmFtZScpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICgkc2NvcGUudXNlcikge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBvdGhlcndpc2UsIHdhaXQgZm9yIHVzZXIubG9hZGVkIGV2ZW50XHJcbiAgICAgICAgJHNjb3BlLiRvbigndXNlci5sb2FkZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZGlyZWN0aXZlKCdjbGlja091dHNpZGUnLCBmdW5jdGlvbigkcGFyc2UsICRkb2N1bWVudCwgJHJvb3RTY29wZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkZG9jdW1lbnQuYmluZCgnY2xpY2snLCBjbGlja091dHNpZGVIYW5kbGVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmJpbmQoJ3JlbW92ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRkb2N1bWVudC51bmJpbmQoJ2NsaWNrJywgY2xpY2tPdXRzaWRlSGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjbGlja091dHNpZGVIYW5kbGVyKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXRQYXJlbnRzID0gJChldmVudC50YXJnZXQpLnBhcmVudHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5zaWRlID0gdGFyZ2V0UGFyZW50cy5pbmRleCgkKGVsZW1lbnQpKSAhPT0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uID0gZXZlbnQudGFyZ2V0ID09PSBlbGVtZW50WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvdXRzaWRlID0gIWluc2lkZSAmJiAhb247XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvdXRzaWRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpY2sub3V0c2lkZScsIGV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5kaXJlY3RpdmUoJ21hcCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYnVpbGQvdmlld3MvdGVtcGxhdGVzL21hcC50ZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ01hcEN0cmwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hcCA9IG5ldyBEYXRhbWFwKHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLWNvbnRhaW5lcicpLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGxzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRGaWxsOiAnIzIyYTdmMCdcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGdlb2dyYXBoeUNvbmZpZzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRPbkhvdmVyOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3B1cG9uSG92ZXI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodEZpbGxDb2xvcjogJyMwMTk4NzUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRCb3JkZXJDb2xvcjogJ3JnYmEoMjAwLCAyNDcsIDE5NywgMC40KSdcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmRpcmVjdGl2ZSgncGFzc3dvcmRSZXF1aXJlbWVudHMnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2J1aWxkL3ZpZXdzL3RlbXBsYXRlcy9wYXNzd29yZC1yZXF1aXJlbWVudHMudGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdQYXNzd29yZFJlcXVpcmVtZW50c0N0cmwnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmRJbnB1dDogJ0BhdHRyaWJ1dGVJbnB1dCdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5kaXJlY3RpdmUoJ3F1aXonLCBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2J1aWxkL3ZpZXdzL3RlbXBsYXRlcy9xdWl6LWRpcmVjdGl2ZS50ZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgc2NvcGU6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdRdWl6RGlyZWN0aXZlQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSkiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmlsdGVyKCdyZW5kZXJIdG1sJywgZnVuY3Rpb24oJHNjZSkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0ZXh0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKHRleHQpO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmlsdGVyKCd0ZXh0T3JOdW1iZXInLCBmdW5jdGlvbigkZmlsdGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0LCBmcmFjdGlvblNpemUpIHtcclxuICAgICAgICAgICAgZnJhY3Rpb25TaXplID0gZnJhY3Rpb25TaXplICE9PSB1bmRlZmluZWQgPyAwIDogZnJhY3Rpb25TaXplO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzTmFOKGlucHV0KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ251bWJlcicpKGlucHV0LCBmcmFjdGlvblNpemUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIGZ1bmN0aW9uKEF1dGhUb2tlblNydikge1xyXG4gICAgICAgIHZhciBhZGRUb2tlbiA9IGZ1bmN0aW9uKGNvbmZpZykge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydYLUF1dGgnXSA9IHRva2VuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGFkZFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdBdXRoVG9rZW5TcnYnLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZTtcclxuICAgICAgICB2YXIga2V5ID0gJ2F1dGgtdG9rZW4nO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0VG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnNldEl0ZW0oa2V5LCB0b2tlbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRUb2tlbjogZ2V0VG9rZW4sXHJcbiAgICAgICAgICAgIHNldFRva2VuOiBzZXRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFNydicsIGZ1bmN0aW9uKFVzZXJTcnYpIHtcclxuICAgICAgICB2YXIgdXNlciA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBnZXRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICh1c2VyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh1c2VyKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXNlclNydi5nZXRVc2VyRnJvbVN0b3JhZ2UoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihfdXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlciA9IF91c2VyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoX3VzZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ05vdCBsb2dnZWQgaW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZXRVc2VyID0gZnVuY3Rpb24oX3VzZXIpIHtcclxuICAgICAgICAgICAgdXNlciA9IF91c2VyO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjbGVhclVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdXNlciA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2V0VXNlcjogc2V0VXNlcixcclxuICAgICAgICAgICAgZ2V0VXNlcjogZ2V0VXNlcixcclxuICAgICAgICAgICAgY2xlYXJVc2VyOiBjbGVhclVzZXJcclxuICAgICAgICB9XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQ291bnRyeVNydicsIGZ1bmN0aW9uKCRodHRwLCBJbmRleGVkREJTcnYsIExvZ1Nydikge1xyXG4gICAgICAgIC8vIENvdW50cmllcyBhcnJheVxyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgY291bnRyaWVzQnlBbHBoYTMgPSBudWxsO1xyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUxldHRlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIEluZGV4ZWREQlxyXG4gICAgICAgIHZhciBkYXRhYmFzZSA9ICdtYWdlbGxhbic7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJ2NvdW50cnlTdG9yZSc7XHJcbiAgICAgICAgdmFyIGtleUNvdW50cmllcyA9ICdjb3VudHJpZXMnO1xyXG4gICAgICAgIHZhciBrZXlWZXJzaW9uID0gJ3ZlcnNpb24nO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gSW5kZXhlZERCU3J2LmluZGV4ZWREQkF2YWlsYWJsZSgpO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZENvdW50cmllcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkQ291bnRyaWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGluZGV4ZWREQiBpcyBhdmFpbGFibGVcclxuICAgICAgICAgICAgaWYgKGluZGV4ZWREQkF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBkYXRhYmFzZSBleGlzdHNcclxuICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYuY3JlYXRlRGF0YWJhc2UoZGF0YWJhc2UsIHN0b3JlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFbXB0eU9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0SW50ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFeHRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGRldGVybWluZUxvYWRTdHJhdGVneSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obG9hZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzID0gb2JqWydjb3VudHJpZXMnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbyhcImxvYWRlZCBjb3VudHJpZXMgZnJvbVwiLCBvYmpbJ2xvYWRTdHJhdGVneSddLnRvVXBwZXJDYXNlKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZGl0aW9uYWxseSBtYXAgY291bnRyaWVzIGJ5IHZhcmlvdXMgcHJvcGVydGllc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlBbHBoYTMgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzLmZvckVhY2goZnVuY3Rpb24oYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ5IGFscGhhMyBjb2RlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlBbHBoYTNbY1snYWxwaGEzQ29kZSddXSA9IGM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ5IGxldHRlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaXJzdExldHRlciA9IGNbJ25hbWUnXS5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChmaXJzdExldHRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICfDhCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdExldHRlciA9ICdBJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnw5YnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RMZXR0ZXIgPSAnTyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ8OcJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TGV0dGVyID0gJ1UnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50cmllc0J5TGV0dGVyW2ZpcnN0TGV0dGVyXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllc0J5TGV0dGVyW2ZpcnN0TGV0dGVyXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlMZXR0ZXJbZmlyc3RMZXR0ZXJdLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHBoYTNDb2RlOiBjLmFscGhhM0NvZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGMubmFtZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoXCJmYWlsZWQgdG8gbG9hZCBjb3VudHJpZXNcIiwgZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCwgd2UgYWx3YXlzIHRyeSB0byBkb3dubG9hZCBpdCBmcm9tIHRoZSBjb3VudHJ5IEFQSSBlbmRwb2ludFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldENvdW50cmllc0Zyb21BUEkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZXRlcm1pbmVMb2FkU3RyYXRlZ3kgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBpbnRlcm5hbFZlcnNpb24gPSBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl07XHJcbiAgICAgICAgICAgICAgICB2YXIgZXh0ZXJuYWxWZXJzaW9uID0gb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpbnRlcm5hbFZlcnNpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChleHRlcm5hbFZlcnNpb24gPiBpbnRlcm5hbFZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdkYic7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqWydsb2FkU3RyYXRlZ3knXSA9IHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvYWREYXRhID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneSA9IG9ialsnbG9hZFN0cmF0ZWd5J107XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChzdHJhdGVneSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FwaSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21BUEkoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gY291bnRyaWVzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBjb3VudHJpZXMgYW5kIHZlcnNpb24gbnVtYmVyIGluIGRhdGFiYXNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleUNvdW50cmllcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICBjb3VudHJpZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleVZlcnNpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RiJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q291bnRyaWVzRnJvbURCKG9iailcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKF9vYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF9vYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnVW5rbm93biBsb2FkIHN0cmF0ZWd5Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFbXB0eU9iamVjdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHt9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEludGVybmFsVmVyc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5VmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFeHRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldFZlcnNpb25Gcm9tQVBJKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl0gPSB2ZXJzaW9uO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21EQiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5Q291bnRyaWVzKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gaXRlbS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFZlcnNpb25Gcm9tQVBJID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9jb3VudHJpZXMvdmVyc2lvbicpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhLnZlcnNpb24gfHwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJ5QnlBbHBoYTMgPSBmdW5jdGlvbihhbHBoYTMpIHtcclxuICAgICAgICAgICAgaWYgKGNvdW50cmllc0J5QWxwaGEzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllc0J5QWxwaGEzW2FscGhhM107XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNCeUxldHRlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoY291bnRyaWVzQnlMZXR0ZXIgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzQnlMZXR0ZXI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFyZUNvdW50cmllc0xvYWRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzICE9PSBudWxsICYmIGNvdW50cmllcy5sZW5ndGggPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXQsXHJcbiAgICAgICAgICAgIGdldENvdW50cmllczogZ2V0Q291bnRyaWVzLFxyXG4gICAgICAgICAgICBnZXRDb3VudHJ5QnlBbHBoYTM6IGdldENvdW50cnlCeUFscGhhMyxcclxuICAgICAgICAgICAgZ2V0Q291bnRyaWVzQnlMZXR0ZXI6IGdldENvdW50cmllc0J5TGV0dGVyLFxyXG4gICAgICAgICAgICBhcmVDb3VudHJpZXNMb2FkZWQ6IGFyZUNvdW50cmllc0xvYWRlZFxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnRXZlbnRTcnYnLCBmdW5jdGlvbigkaHR0cCwgTG9nU3J2KSB7XHJcbiAgICAgICAgdmFyIGFkZCA9IGZ1bmN0aW9uKG5hbWUpIHtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9ldmVudC9hZGQnLCB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lXHJcbiAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgLy8gbm8gbmVlZCB0byByZWFjdCB0byBzdWNjZXNzIGNhc2VcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoJ2ZhaWxlZCB0byBhZGQgZXZlbnQnLCBlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhZGQ6IGFkZFxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnRm9jdXNTcnYnLCBmdW5jdGlvbigkdGltZW91dCwgJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihzZWxlY3Rvcikge1xyXG4gICAgICAgICAgICAvLyB0aW1lb3V0IG1ha2VzIHN1cmUgdGhhdCBpcyBpbnZva2VkIGFmdGVyIGFueSBvdGhlciBldmVudCBoYXMgYmVlbiB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgIC8vIGUuZy4gY2xpY2sgZXZlbnRzIHRoYXQgbmVlZCB0byBydW4gYmVmb3JlIHRoZSBmb2N1cyBvclxyXG4gICAgICAgICAgICAvLyBpbnB1dHMgZWxlbWVudHMgdGhhdCBhcmUgaW4gYSBkaXNhYmxlZCBzdGF0ZSBidXQgYXJlIGVuYWJsZWQgd2hlbiB0aG9zZSBldmVudHNcclxuICAgICAgICAgICAgLy8gYXJlIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICR3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnSW5kZXhlZERCU3J2JywgZnVuY3Rpb24oJHdpbmRvdykge1xyXG4gICAgICAgIHZhciBrZXlQYXRoID0gJ25hbWUnO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCID0gJHdpbmRvdy5pbmRleGVkREIgfHwgJHdpbmRvdy53ZWJraXRJbmRleGVkREIgfHwgJHdpbmRvdy5tc0luZGV4ZWREQjtcclxuICAgICAgICB2YXIgSURCS2V5UmFuZ2UgPSAkd2luZG93LklEQktleVJhbmdlIHx8ICR3aW5kb3cud2Via2l0SURCS2V5UmFuZ2U7XHJcblxyXG4gICAgICAgIHZhciBJREJUcmFuc2FjdGlvbiA9ICR3aW5kb3cuSURCVHJhbnNhY3Rpb24gfHwgJHdpbmRvdy53ZWJraXRJREJUcmFuc2FjdGlvbjtcclxuXHJcbiAgICAgICAgaWYgKElEQlRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgPSBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFIHx8ICdyZWFkd3JpdGUnO1xyXG4gICAgICAgICAgICBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkgPSBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkgfHwgJ3JlYWRvbmx5JztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREJBdmFpbGFibGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGluZGV4ZWREQiA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlRGF0YWJhc2UgPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZSBpcyBhbiBpbnN0YW5jZSBvZiBJREJWZXJzaW9uQ2hhbmdlRXZlbnRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSBpZGIuY3JlYXRlT2JqZWN0U3RvcmUoc3RvcmVOYW1lLCB7IGtleVBhdGg6IGtleVBhdGggfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCwgdXBkYXRlLCBkZWxldGVcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIGVycm9yXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRyb3BEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3Agc3VjY2Vzc2Z1bFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkcm9wIGZhaWxlZFxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBhZGRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5hZGQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcHV0SXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0QWRkID0gc3RvcmUucHV0KGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJldHJpZXZlSXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBJREJLZXlSYW5nZS5vbmx5KGl0ZW1OYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUub3BlbkN1cnNvcihyYW5nZSkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGN1cnNvci52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtcyA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUub3BlbkN1cnNvcigpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY3JlYXRlRGF0YWJhc2U6IGNyZWF0ZURhdGFiYXNlLFxyXG4gICAgICAgICAgICBkcm9wRGF0YWJhc2U6IGRyb3BEYXRhYmFzZSxcclxuICAgICAgICAgICAgYWRkSXRlbTogYWRkSXRlbSxcclxuICAgICAgICAgICAgcHV0SXRlbTogcHV0SXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtOiByZXRyaWV2ZUl0ZW0sXHJcbiAgICAgICAgICAgIHJldHJpZXZlSXRlbXM6IHJldHJpZXZlSXRlbXMsXHJcbiAgICAgICAgICAgIGluZGV4ZWREQkF2YWlsYWJsZTogaW5kZXhlZERCQXZhaWxhYmxlXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdMb2dTcnYnLCBmdW5jdGlvbihBcHBDb25maWcpIHtcclxuICAgICAgICB2YXIgbG9nSW5mbyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmluZm9cIl0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9nRXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKEFwcENvbmZpZ1tcImxvZy5lcnJvclwiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5mbzogbG9nSW5mbyxcclxuICAgICAgICAgICAgZXJyb3I6IGxvZ0Vycm9yXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdRdWl6U3J2JywgZnVuY3Rpb24oQXBwQ29uZmlnLCBDb3VudHJ5U3J2LCBTY29yZVNydiwgRXZlbnRTcnYpIHtcclxuICAgICAgICB2YXIgY291bnRyaWVzID0gbnVsbDtcclxuICAgICAgICB2YXIgY291bnRyaWVzQnlBbHBoYTMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgcXVpeiA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBzZXRDb3VudHJpZXMgPSBmdW5jdGlvbihfY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgIGNvdW50cmllcyA9IF9jb3VudHJpZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNvdW50cmllc0xvYWRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzICE9PSBudWxsICYmIGNvdW50cmllcy5sZW5ndGggPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY291bnRyaWVzTG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiQ291bnRyaWVzIGhhdmUgbm90IGJlZW4gbG9hZGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHF1aXogPSBjcmVhdGVRdWl6KCdjb3VudHJ5Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gYWRkIHF1aXogc3RhcnQgZXZlbnRcclxuICAgICAgICAgICAgICAgIEV2ZW50U3J2LmFkZCgncXVpei5zdGFydCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUocXVpei5zdGFydCgpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRpc3Bvc2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcXVpeiA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNTdGFydGVkKCkgJiYgIXF1aXouaGFzRW5kZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFzUXVpelN0YXJ0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1aXogPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5oYXNTdGFydGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhc1F1aXpFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVpeiA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6Lmhhc0VuZGVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZVF1aXogPSBmdW5jdGlvbihxdWl6VHlwZSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHF1aXpUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjb3VudHJ5JzpcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUNvdW50cnlRdWl6KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlQ291bnRyeVF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGNvdW50cnlRdWl6ID0gbmV3IFF1aXooKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBmdWxsUG9pbnRzID0gMTAwO1xyXG4gICAgICAgICAgICB2YXIgaGludE1heGltdW0gPSAzO1xyXG4gICAgICAgICAgICB2YXIgaGludENvc3QgPSAyNTtcclxuXHJcbiAgICAgICAgICAgIHZhciBsYXN0UXVlc3Rpb25Cb251cyA9IDIuNTtcclxuXHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGVzID0gQXBwQ29uZmlnWydxdWl6LmNvdW50cnkudHlwZXMnXTtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZXNMZW5ndGggPSBPYmplY3Qua2V5cyhxdWVzdGlvblR5cGVzKS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAvLyBzZWxlY3QgY291bnRyaWVzIGZvciBxdWVzdGlvbnNcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkQ291bnRyaWVzID0gW107XHJcbiAgICAgICAgICAgIHZhciBudW1iZXJPZlF1ZXN0aW9ucyA9IEFwcENvbmZpZ1sncXVpei5jb3VudHJ5LnF1ZXN0aW9ucyddO1xyXG5cclxuICAgICAgICAgICAgLy8gdGhlcmUgYXJlIGZpdmUgZWFzeSwgZml2ZSBtZWRpdW0gYW5kIGZpdmUgaGFyZCBxdWVzdGlvbnMgKGxhdGVyIHRvIGJlIHNodWZmbGVkIHJhbmRvbWx5KVxyXG4gICAgICAgICAgICAvLyB0aGUgMTZ0aCBhbmQgbGFzdCBxdWVzdGlvbiBpcyBhbHdheXMgYSBoYXJkIG9uZS5cclxuXHJcbiAgICAgICAgICAgIHZhciBlYXN5Q291bnRyaWVzID0gY291bnRyaWVzLmZpbHRlcihmdW5jdGlvbihjKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYy5kaWZmaWN1bHR5ID09PSAnZWFzeSc7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIG1lZGl1bUNvdW50cmllcyA9IGNvdW50cmllcy5maWx0ZXIoZnVuY3Rpb24oYykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGMuZGlmZmljdWx0eSA9PT0gJ21lZGl1bSc7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIGhhcmRDb3VudHJpZXMgPSBjb3VudHJpZXMuZmlsdGVyKGZ1bmN0aW9uKGMpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjLmRpZmZpY3VsdHkgPT09ICdoYXJkJztcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBzZWxlY3QgY291bnRyaWVzXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtYmVyT2ZRdWVzdGlvbnM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnlPayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnk7XHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKCFjb3VudHJ5T2spIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IDUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeSA9IGVhc3lDb3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIGVhc3lDb3VudHJpZXMubGVuZ3RoIC0gMSldO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA8IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnkgPSBtZWRpdW1Db3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIG1lZGl1bUNvdW50cmllcy5sZW5ndGggLSAxKV07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeSA9IGhhcmRDb3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIGhhcmRDb3VudHJpZXMubGVuZ3RoIC0gMSldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRyeU9rID0gc2VsZWN0ZWRDb3VudHJpZXMuaW5kZXhPZihjb3VudHJ5WydhbHBoYTNDb2RlJ10pIDwgMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENvdW50cmllcy5wdXNoKGNvdW50cnlbJ2FscGhhM0NvZGUnXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIHNodWZmbGUgYXJyYXkgKC0yIGJlY2F1c2Ugd2UgZG9uJ3Qgd2FudCB0byBzaHVmZmxlIHRoZSBsYXN0IGNvdW50cnkgKGl0IGhhcyB0byBzdGF5IGluIHBsYWNlKVxyXG4gICAgICAgICAgICB2YXIgYXJyYXlUb1NodWZmbGUgPSBzZWxlY3RlZENvdW50cmllcy5zcGxpY2UoMCwgc2VsZWN0ZWRDb3VudHJpZXMubGVuZ3RoIC0gMSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2h1ZmZsZWRBcnJheSA9IHNodWZmbGUoYXJyYXlUb1NodWZmbGUpO1xyXG5cclxuICAgICAgICAgICAgLy8gYWRkIGxhc3QgcXVlc3Rpb24gdG8gc2h1ZmZsZWQgYXJyYXlcclxuICAgICAgICAgICAgc2h1ZmZsZWRBcnJheS5wdXNoKHNlbGVjdGVkQ291bnRyaWVzW3NlbGVjdGVkQ291bnRyaWVzLmxlbmd0aCAtIDFdKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBxdWVzdGlvbiB0eXBlIGFycmF5XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGVBcnJheSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1iZXJPZlF1ZXN0aW9uczsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBxdWVzdGlvblR5cGVBcnJheS5wdXNoKDYpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvKmZvciAodmFyIGogPSAwOyBqIDwgbnVtYmVyT2ZRdWVzdGlvbnM7IGorKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGogPCAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25UeXBlQXJyYXkucHVzaCgxKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaiA8IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvblR5cGVBcnJheS5wdXNoKDIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChqIDwgOSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uVHlwZUFycmF5LnB1c2goMyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGogPCAxMikge1xyXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uVHlwZUFycmF5LnB1c2goNCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGogPCAxNSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uVHlwZUFycmF5LnB1c2goNSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBvbmUgcmFuZG9tIHF1ZXN0aW9uIGZvciB0aGUgbGFzdCBvbmVcclxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvblR5cGVBcnJheS5wdXNoKGdldFJhbmRvbUludCgxLCBxdWVzdGlvblR5cGVzTGVuZ3RoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgdmFyIHNodWZmbGVkUXVlc3Rpb25UeXBlQXJyYXkgPSBzaHVmZmxlKHF1ZXN0aW9uVHlwZUFycmF5KTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNyZWF0ZSBxdWVzdGlvbnMgZm9yIHF1aXpcclxuICAgICAgICAgICAgdmFyIHFjbnQgPSAwO1xyXG4gICAgICAgICAgICBzaHVmZmxlZEFycmF5LmZvckVhY2goZnVuY3Rpb24oYWxwaGEzLCBpZHgpIHtcclxuICAgICAgICAgICAgICAgIHFjbnQrKztcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uVHlwZXNbc2h1ZmZsZWRRdWVzdGlvblR5cGVBcnJheVtpZHhdXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IGdldFF1ZXN0aW9uVGV4dChxdWVzdGlvblR5cGUsIGNvdW50cnkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogcXVlc3Rpb25UeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IGNvdW50cnkuZGlmZmljdWx0eSxcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dDogZ2V0UXVlc3Rpb25JbnB1dChxdWVzdGlvblR5cGUpLFxyXG4gICAgICAgICAgICAgICAgICAgIHVuaXQ6IGdldFF1ZXN0aW9uVW5pdChxdWVzdGlvblR5cGUpXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdmFyIGFuc3dlciA9IGdldFF1ZXN0aW9uQW5zd2VyKHF1ZXN0aW9uVHlwZSwgY291bnRyeSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tBbnN3ZXIgPSBnZXRDaGVja0Fuc3dlckxhbWJkYShxdWVzdGlvblR5cGUsIGZ1bGxQb2ludHMsIGxhc3RRdWVzdGlvbkJvbnVzKTtcclxuICAgICAgICAgICAgICAgIHZhciBoaW50cyA9IGdldFF1ZXN0aW9uSGludHMocXVlc3Rpb25UeXBlLCBoaW50TWF4aW11bSwgaGludENvc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHRoZSBsYXN0IHF1ZXN0aW9uIGlzIHRoZSBib251cyBxdWVzdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKHFjbnQgPj0gbnVtYmVyT2ZRdWVzdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmZvWydib251cyddID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBhZGQgaW5mbyBmb3IgZmxhZyBvZiBjb3VudHJ5XHJcbiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnRkxBR19PRl9DT1VOVFJZJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm8ubWVkaWEgPSAnZmxhZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mby5hbHBoYTJDb2RlID0gY291bnRyeS5hbHBoYTJDb2RlLnRvTG9jYWxlTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gYWRkIGluZm8gZm9yIGxvY2F0aW9uIG9mIGNvdW50cnlcclxuICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdMT0NBVElPTl9PRl9DT1VOVFJZJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm8ubWVkaWEgPSAnbWFwJztcclxuICAgICAgICAgICAgICAgICAgICBpbmZvLmFscGhhMkNvZGUgPSBjb3VudHJ5LmFscGhhMkNvZGUudG9Mb2NhbGVMb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5UXVpei5hZGRRdWVzdGlvbihuZXcgUXVlc3Rpb24oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5mbzogaW5mbyxcclxuICAgICAgICAgICAgICAgICAgICBhbnN3ZXI6IGFuc3dlcixcclxuICAgICAgICAgICAgICAgICAgICBjaGVja0Fuc3dlcjogY2hlY2tBbnN3ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgaGludHM6IGhpbnRzXHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cnlRdWl6O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblRleHQgPSBmdW5jdGlvbih0eXBlLCBjb3VudHJ5KSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgaGVpw590IGRpZSBIYXVwdHN0YWR0IHZvbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIltcIiArIGNvdW50cnkuY2FwaXRhbCArIFwiXSBpc3QgZGllIEhhdXB0c3RhZHQgdm9uIHdlbGNoZW0gTGFuZFwiXHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgdmllbGUgTWVuc2NoZW4gbGViZW4gaW4gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgZ3Jvw58gaXN0IGRpZSBGbMOkY2hlIHZvbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdGTEFHX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldlbGNoZXMgTGFuZCBoYXQgZGllc2UgRmxhZ2dlXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnTE9DQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV28gYmVmaW5kZXQgc2ljaCBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uQW5zd2VyID0gZnVuY3Rpb24odHlwZSwgY291bnRyeSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFsdFNwZWxsaW5ncyA9IGNvdW50cnkuYWx0U3BlbGxpbmdzICE9PSB1bmRlZmluZWQgJiYgY291bnRyeS5hbHRTcGVsbGluZ3NbJ2NhcGl0YWwnXSAhPT0gdW5kZWZpbmVkID8gY291bnRyeS5hbHRTcGVsbGluZ3NbJ2NhcGl0YWwnXSA6IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5LmNhcGl0YWwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsdFNwZWxsaW5nczogYWx0U3BlbGxpbmdzXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWx0U3BlbGxpbmdzID0gY291bnRyeS5hbHRTcGVsbGluZ3MgIT09IHVuZGVmaW5lZCAmJiBjb3VudHJ5LmFsdFNwZWxsaW5nc1snbmFtZSddICE9PSB1bmRlZmluZWQgPyBjb3VudHJ5LmFsdFNwZWxsaW5nc1snbmFtZSddIDogW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWx0U3BlbGxpbmdzOiBhbHRTcGVsbGluZ3NcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5wb3B1bGF0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkuYXJlYVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnTE9DQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5hbHBoYTJDb2RlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uSW5wdXQgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ251bWJlci5oaWdoJztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbnVtYmVyLm1lZGl1bSc7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnTE9DQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdtYXAucG9pbnQnO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd0ZXh0LnN0YW5kYXJkJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblVuaXQgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2ttwrInO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdFaW53b2huZXInO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q2hlY2tBbnN3ZXJMYW1iZGEgPSBmdW5jdGlvbih0eXBlLCBmdWxsUG9pbnRzLCBsYXN0UXVlc3Rpb25Cb251cykge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0xPQ0FUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhbnN3ZXIsIHN1Ym1pdHRlZEFuc3dlciwgaGludHNVc2VkLCBoaW50Q29zdCwgaW5mbykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxsb3dlZFNwZWxsaW5ncztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbnN3ZXIuYWx0U3BlbGxpbmdzICYmIGFuc3dlci5hbHRTcGVsbGluZ3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFNwZWxsaW5ncyA9IGFuc3dlci5hbHRTcGVsbGluZ3MubWFwKGZ1bmN0aW9uKHNwZWxsaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNwZWxsaW5nLnRvTG9jYWxlTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWRTcGVsbGluZ3MgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvcnJlY3QgPSBzdWJtaXR0ZWRBbnN3ZXIudG9Mb2NhbGVMb3dlckNhc2UoKSA9PT0gYW5zd2VyLmNvcnJlY3QudG9Mb2NhbGVMb3dlckNhc2UoKSB8fCAoYWxsb3dlZFNwZWxsaW5ncyAmJiBhbGxvd2VkU3BlbGxpbmdzLmluZGV4T2Yoc3VibWl0dGVkQW5zd2VyKSA+PSAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludHMgPSBjb3JyZWN0ID8gZnVsbFBvaW50cyA6IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBoaW50cyBhcmUgYWxsb3dlZCBhbmQgaGF2ZSBiZWVuIHVzZWQsIHN1YnRyYWN0IHRoZSBwb2ludHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpbnRzVXNlZCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAtPSAoaGludHNVc2VkICogaGludENvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBib251cyBwb2ludHMgZm9yIGxhc3QgcXVlc3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8gIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzICo9IGxhc3RRdWVzdGlvbkJvbnVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBoaW50c1VzZWQsIGhpbnRDb3N0LCBpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBwZXJjZW50YWdlIGRpZmZlcmVuY2UgZnJvbSBjb3JyZWN0IGFuc3dlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JQZXJjZW50YWdlID0gTWF0aC5hYnMoc3VibWl0dGVkQW5zd2VyIC0gYW5zd2VyLmNvcnJlY3QpIC8gYW5zd2VyLmNvcnJlY3QgKiAxMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDkwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSA5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA4MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDcwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDE2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDQwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAyMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDI1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMzApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgaGludHMgYXJlIGFsbG93ZWQgYW5kIGhhdmUgYmVlbiB1c2VkLCBzdWJ0cmFjdCB0aGUgcG9pbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoaW50c1VzZWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgLT0gKGhpbnRzVXNlZCAqIGhpbnRDb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYm9udXMgcG9pbnRzIGZvciBsYXN0IHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyAqPSBsYXN0UXVlc3Rpb25Cb251cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uSGludHMgPSBmdW5jdGlvbih0eXBlLCBoaW50c1Bvc3NpYmxlLCBoaW50Q29zdCkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnRkxBR19PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhpbXVtOiBoaW50c1Bvc3NpYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3N0OiBoaW50Q29zdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2l2ZTogZnVuY3Rpb24oaGludHNVc2VkLCBhbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhbnN3ZXIuY29ycmVjdC5zdWJzdHIoMCwgaGludHNVc2VkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZDogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0TnVtYmVyT2ZRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5jdXJyZW50UXVlc3Rpb24oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHF1aXoubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFRvdGFsUG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0VG90YWxQb2ludHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENvbmNsdWRlcyB0aGUgcXVpeiBhbmQgcHV0cyB0aGUgc2NvcmUgdG8gdGhlIEFQSSBlbmRwb2ludC5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgY29uY2x1ZGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHF1aXogIT09IG51bGwgJiYgcXVpei5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHF1aXouc3VibWl0dGVkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnUXVpeiBoYXMgYWxyZWFkeSBiZWVuIHN1Ym1pdHRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcXVpei5zdWJtaXR0ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBTY29yZVNydi5wdXRIaWdoc2NvcmUocXVpei5nZXRUb3RhbFBvaW50cygpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgcXVpeiBmaW5pc2ggZXZlbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV2ZW50U3J2LmFkZCgncXVpei5maW5pc2gnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCgnTm8gcXVpeiBpcyBjdXJyZW50bHkgcnVubmluZycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTaHVmZmxlcyBhbiBhcnJheSByYW5kb21seVxyXG4gICAgICAgICAqIEBwYXJhbSBhcnJheSAgICAgdGhlIGFycmF5IHRvIGJlIHNodWZmbGVkXHJcbiAgICAgICAgICogQHJldHVybnMgeyp9ICAgICB0aGUgc2h1ZmZsZWQgYXJyYXlcclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgc2h1ZmZsZSA9IGZ1bmN0aW9uIChhcnJheSkge1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudEluZGV4ID0gYXJyYXkubGVuZ3RoLCB0ZW1wb3JhcnlWYWx1ZSwgcmFuZG9tSW5kZXg7XHJcblxyXG4gICAgICAgICAgICAvLyBXaGlsZSB0aGVyZSByZW1haW4gZWxlbWVudHMgdG8gc2h1ZmZsZS4uLlxyXG4gICAgICAgICAgICB3aGlsZSAoMCAhPT0gY3VycmVudEluZGV4KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUGljayBhIHJlbWFpbmluZyBlbGVtZW50Li4uXHJcbiAgICAgICAgICAgICAgICByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGN1cnJlbnRJbmRleCk7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50SW5kZXggLT0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBBbmQgc3dhcCBpdCB3aXRoIHRoZSBjdXJyZW50IGVsZW1lbnQuXHJcbiAgICAgICAgICAgICAgICB0ZW1wb3JhcnlWYWx1ZSA9IGFycmF5W2N1cnJlbnRJbmRleF07XHJcbiAgICAgICAgICAgICAgICBhcnJheVtjdXJyZW50SW5kZXhdID0gYXJyYXlbcmFuZG9tSW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgYXJyYXlbcmFuZG9tSW5kZXhdID0gdGVtcG9yYXJ5VmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhcnJheTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBzZXRDb3VudHJpZXM6IHNldENvdW50cmllcyxcclxuICAgICAgICAgICAgaXNRdWl6UnVubmluZzogaXNRdWl6UnVubmluZyxcclxuICAgICAgICAgICAgaGFzUXVpelN0YXJ0ZWQ6IGhhc1F1aXpTdGFydGVkLFxyXG4gICAgICAgICAgICBoYXNRdWl6RW5kZWQ6IGhhc1F1aXpFbmRlZCxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyOiBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIsXHJcbiAgICAgICAgICAgIGdldE51bWJlck9mUXVpelF1ZXN0aW9uczogZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50UXVlc3Rpb246IGdldEN1cnJlbnRRdWVzdGlvbixcclxuICAgICAgICAgICAgbmV4dFF1ZXN0aW9uOiBuZXh0UXVlc3Rpb24sXHJcbiAgICAgICAgICAgIGdldFRvdGFsUG9pbnRzOiBnZXRUb3RhbFBvaW50cyxcclxuICAgICAgICAgICAgY29uY2x1ZGU6IGNvbmNsdWRlLFxyXG4gICAgICAgICAgICBkaXNwb3NlOiBkaXNwb3NlXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdTY29yZVNydicsIGZ1bmN0aW9uKCRodHRwKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgZW50aXJlIGhpZ2hzY29yZSBsaXN0IGluIGFuIGFycmF5IGZyb20gdGhlIEFQSS5cclxuICAgICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgZ2V0SGlnaHNjb3JlTGlzdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvc2NvcmVzL2FsbCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGxpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmV0Y2hlcyB0aGUgaGlnaHNjb3JlIG9iamVjdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIElmIHRoZSB1c2VyIGhhcyBubyByZXN1bHQgeWV0LCBhbiBlbXB0eSBvYmplY3QgaXMgcmV0dXJuZWQuXHJcbiAgICAgICAgICogUmV0dXJucyBhIHByb21pc2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGdldFVzZXJIaWdoc2NvcmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL3Njb3Jlcy91c2VyJylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHNjb3JlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEZldGNoZXMgdGhlIGhpZ2hzY29yZSBvYmplY3QgZm9yIHRoZSBvdmVyYWxsIGhpZ2hzY29yZS5cclxuICAgICAgICAgKiBJZiB0aGVyZSBpcyBjdXJyZW50bHkgbm8gcmVzdWx0IHlldCwgYW4gZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkLlxyXG4gICAgICAgICAqIFJldHVybnMgYSBwcm9taXNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBnZXRPdmVyYWxsSGlnaHNjb3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9zY29yZXMvaGlnaCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oc2NvcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzY29yZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBQdXRzIGEgaGlnaHNjb3JlIHJlc3VsdCBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyLlxyXG4gICAgICAgICAqIEBwYXJhbSBzY29yZSAgICAgTnVtYmVyIHdpdGggdGhlIGFjaGlldmVkIHNjb3JlLlxyXG4gICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBwdXRIaWdoc2NvcmUgPSBmdW5jdGlvbihzY29yZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvc2NvcmVzJywgeyBzY29yZTogc2NvcmUgfSlcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRIaWdoc2NvcmVMaXN0OiBnZXRIaWdoc2NvcmVMaXN0LFxyXG4gICAgICAgICAgICBnZXRVc2VySGlnaHNjb3JlOiBnZXRVc2VySGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBnZXRPdmVyYWxsSGlnaHNjb3JlOiBnZXRPdmVyYWxsSGlnaHNjb3JlLFxyXG4gICAgICAgICAgICBwdXRIaWdoc2NvcmU6IHB1dEhpZ2hzY29yZVxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnVXNlclNydicsIGZ1bmN0aW9uKCRodHRwLCBBdXRoVG9rZW5TcnYsIEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VyJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXJGcm9tU3RvcmFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4odG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdG9rZW4sIHdlIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIHRva2VuIGluIHN0b3JhZ2VcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9uJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9rZW4gPSByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNhdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKHNlbGYudG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRVc2VyKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRva2VuIGxvY2FsbHlcclxuICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlZ2lzdGVyID0gZnVuY3Rpb24obmV3VXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzZWxlY3QgYSByYW5kb20gY29sb3IgZm9yIHRoZSB1c2VyXHJcbiAgICAgICAgICAgICAgICB2YXIgY29sb3JzID0gQXBwQ29uZmlnWydzZXR0aW5ncy51c2VyLmNvbG9ycyddO1xyXG4gICAgICAgICAgICAgICAgbmV3VXNlci5jb2xvciA9IGNvbG9yc1tnZXRSYW5kb21JbnQoMCwgY29sb3JzLmxlbmd0aCAtIDEpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3VzZXInLCBuZXdVc2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW1tZWRpYXRlbHkgbG9nIHRoZSB1c2VyIGluXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luKG5ld1VzZXIudXNlcm5hbWUsIG5ld1VzZXIucGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pICA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHVwZGF0ZUJhc2ljID0gZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvdXNlci9iYXNpYycsIHVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlUGFzc3dvcmQgPSBmdW5jdGlvbihwYXNzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnB1dCgnL2FwaS91c2VyL3Bhc3N3b3JkJywgcGFzcylcclxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmVzZXRQYXNzd29yZCA9IGZ1bmN0aW9uKGJvZHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9wYXNzd29yZC9yZXNldCcsIGJvZHkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGZvcmdvdFBhc3N3b3JkID0gZnVuY3Rpb24oYm9keSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL3Bhc3N3b3JkL2ZvcmdvdCcsIGJvZHkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0VXNlcjogZ2V0VXNlcixcclxuICAgICAgICAgICAgZ2V0VXNlckZyb21TdG9yYWdlOiBnZXRVc2VyRnJvbVN0b3JhZ2UsXHJcbiAgICAgICAgICAgIGxvZ2luOiBsb2dpbixcclxuICAgICAgICAgICAgbG9nb3V0OiBsb2dvdXQsXHJcbiAgICAgICAgICAgIHJlZ2lzdGVyOiByZWdpc3RlcixcclxuICAgICAgICAgICAgdXBkYXRlQmFzaWM6IHVwZGF0ZUJhc2ljLFxyXG4gICAgICAgICAgICB1cGRhdGVQYXNzd29yZDogdXBkYXRlUGFzc3dvcmQsXHJcbiAgICAgICAgICAgIHJlc2V0UGFzc3dvcmQ6IHJlc2V0UGFzc3dvcmQsXHJcbiAgICAgICAgICAgIGZvcmdvdFBhc3N3b3JkOiBmb3Jnb3RQYXNzd29yZFxyXG4gICAgICAgIH07XHJcbiAgICB9KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
