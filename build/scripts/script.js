var magellan=angular.module("magellan",["ui.router"],["$httpProvider",function(n){n.interceptors.push("AuthInterceptor")}]);magellan.constant("AppConfig",{"log.info":!0,"log.error":!0,"quiz.questions.number":5}),magellan.controller("AppCtrl",["$scope","$state","UserSrv","CountrySrv","QuizSrv",function(n,t,e,r,o){n.app={config:{title:"Magellan",subtitle:"Test your knowledge about the countries of our world",author:"Michael Stifter"}},e.getUserFromStorage().then(function(t){n.user=t,r.init().then(function(t){n.$broadcast("countries.loaded",t),o.setCountries(t)})})["catch"](function(n){}),n.$on("app.login",function(e,u){n.user=u,r.init().then(function(t){n.$broadcast("countries.loaded",t),o.setCountries(t)}),t.go("quiz")}),n.$on("app.logout",function(e,r){n.user=null,t.go("home")})}]),angular.module("magellan").factory("AuthTokenSrv",["$window",function(n){var t=n.sessionStorage,e="auth-token",r=function(){return t.getItem(e)},o=function(n){n?t.setItem(e,n):t.removeItem(e)};return{getToken:r,setToken:o}}]),angular.module("magellan").factory("AuthInterceptor",["AuthTokenSrv",function(n){var t=function(t){var e=n.getToken();return e&&(t.headers=t.headers||{},t.headers["X-Auth"]=e),t};return{request:t}}]),angular.module("magellan").factory("CountrySrv",["$http","IndexedDBSrv","LogSrv",function(n,t,e){var r=null,o="magellan",u="countryStore",i="countries",a="version",s=t.indexedDBAvailable(),c=function(){return l()},l=function(){return s?new Promise(function(n,i){t.createDatabase(o,u).then(d).then(m).then(p).then(f).then(g).then(function(t){r=t.countries,e.info("loaded countries from",t.loadStrategy.toUpperCase()),n(r)})["catch"](function(n){e.error("failed to load countries",n),i(n)})}):v()},f=function(n){return new Promise(function(t,e){var r,o=n.internalVersion,u=n.externalVersion;r=null===o?"api":u>o?"api":"db",n.loadStrategy=r,t(n)})},g=function(n){return new Promise(function(e,r){var s=n.loadStrategy;switch(s){case"api":v().then(function(r){n.countries=r,t.putItem(o,u,{name:i,value:r}),t.putItem(o,u,{name:a,value:n.externalVersion}),e(n)})["catch"](function(n){r(n)});break;case"db":h(n).then(function(n){e(n)})["catch"](function(n){r(n)});break;default:r("Unknown load strategy")}})},d=function(){return new Promise(function(n,t){n({})})},m=function(n){return new Promise(function(e,r){t.retrieveItem(o,u,a).then(function(t){n.internalVersion=t.value,e(n)})["catch"](function(t){n.internalVersion=null,e(n)})})},p=function(n){return w().then(function(t){return n.externalVersion=t,n})},h=function(n){return new Promise(function(e,r){t.retrieveItem(o,u,i).then(function(t){n.countries=t.value,e(n)})["catch"](function(n){e(null)})})},v=function(){return new Promise(function(t,e){n.get("/api/countries").then(function(n){t(n.data)})["catch"](function(n){e(n)})})},w=function(){return new Promise(function(t,e){n.get("/api/countries/version").then(function(n){t(n.data.version||0)})["catch"](function(n){t(0)})})};return{init:c}}]),angular.module("magellan").controller("DropdownCtrl",["$scope",function(n){function t(){u=!u}function e(){u=!0}function r(){u=!1}function o(){return u}var u=!1;n.toggleDropdown=t,n.showDropdown=e,n.hideDropdown=r,n.isDropdownVisible=o}]),angular.module("magellan").factory("FocusSrv",["$timeout","$window",function(n,t){return function(e){n(function(){var n=t.document.getElementById(e);n&&n.focus()})}}]),angular.module("magellan").factory("IndexedDBSrv",["$window",function(n){var t="name",e=n.indexedDB||n.webkitIndexedDB||n.msIndexedDB,r=n.IDBKeyRange||n.webkitIDBKeyRange,o=n.IDBTransaction||n.webkitIDBTransaction;o&&(o.READ_WRITE=o.READ_WRITE||"readwrite",o.READ_ONLY=o.READ_ONLY||"readonly");var u=function(){return!!e},i=function(n,r){return new Promise(function(o,u){var i=e.open(n);i.onupgradeneeded=function(n){var e=n.target.result;e.createObjectStore(r,{keyPath:t})},i.onsuccess=function(n){o(n)},i.onerror=function(n){u(n)}})},a=function(n){return new Promise(function(t,r){var o=e.deleteDatabase(n);o.onsuccess=function(n){t(n)},o.onerror=function(n){r(n)}})},s=function(n,t,r){return new Promise(function(u,i){var a=e.open(n);a.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_WRITE),s=a.objectStore(t),c=s.add(r);c.onsuccess=function(n){u(n)},c.onerror=function(n){i(n)}}})},c=function(n,t,r){return new Promise(function(u,i){var a=e.open(n);a.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_WRITE),s=a.objectStore(t),c=s.put(r);c.onsuccess=function(n){u(n)},c.onerror=function(n){i(n)}}})},l=function(n,t,u){return new Promise(function(i,a){var s=null,c=e.open(n);c.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_ONLY),c=a.objectStore(t),l=r.only(u);c.openCursor(l).onsuccess=function(n){var t=n.target.result;t?(s=t.value,t["continue"]()):i(s)}},c.onerror=function(n){a(n)}})},f=function(n,t){return new Promise(function(r,u){var i=[],a=e.open(n);a.onsuccess=function(n){var e=n.target.result,u=e.transaction(t,o.READ_ONLY),a=u.objectStore(t);a.openCursor().onsuccess=function(n){var t=n.target.result;t?(i.push(t.value),t["continue"]()):r(i)}},a.onerror=function(n){u(n)}})};return{createDatabase:i,dropDatabase:a,addItem:s,putItem:c,retrieveItem:l,retrieveItems:f,indexedDBAvailable:u}}]),angular.module("magellan").factory("LogSrv",["AppConfig",function(n){var t=function(){n["log.info"]&&console.log.apply(console,arguments)},e=function(){n["log.error"]&&console.error.apply(console,arguments)};return{info:t,error:e}}]),angular.module("magellan").controller("LoginCtrl",["$scope","UserSrv","FocusSrv",function(n,t,e){n.login=function(e,r){t.login(e,r).then(function(t){n.$emit("app.login",t.data)})["catch"](function(n){console.error(n)})},e("username")}]),angular.module("magellan").controller("LogoutCtrl",["$scope","UserSrv",function(n,t){t.logout().then(function(){n.$emit("app.logout")})}]);var Quiz=function(){var n=[],t=!0;this.addQuestion=function(t){n.push(t)},this.getQuestions=function(){return n},this.isActive=function(){return t}},Question=function(n){n=n||{},this.type=n.type||this.getRandomType(),this.country=n.country||null,this.state=n.state||this.states.NOT_ANSWERED};Question.prototype.states={NOT_ANSWERED:1,CORRECT:2,INCORRECT:3},Question.prototype.types={CAPITAL_OF_COUNTRY:"capital-of-country",COUNTRY_OF_CAPITAL:"country-of-capital",INHABITANTS_OF_COUNTRY:"inhabitants-of-country"},Question.prototype.getRandomType=function(){var n=Object.keys(this.types);return this.types[n[getRandomInt(0,n.length-1)]]};var getRandomInt=function(n,t){return Math.floor(Math.random()*(t-n+1))+n},getStringBetween=function(n,t,e){var r=n.indexOf(t),o=n.indexOf(e);return r>=0&&o>=0&&o>r?n.substr(r+1,o-r-1):null};angular.module("magellan").controller("QuizCtrl",["$scope","QuizSrv","LogSrv","FocusSrv",function(n,t,e,r){var o=function(){t.init().then(function(){r("answer")})["catch"](function(n){e.error("Could not start quiz",n)})},u=function(){return t.isQuizRunning()},i=function(){return t.getCurrentQuestionNumber()},a=function(){return t.getNumberOfQuizQuestions()},s=function(){return f(t.getQuestionText(),"question-highlight")+"?"},c=function(){return f(t.getAnswerText(),"answer-highlight-"+t.getAnswerStatus())},l=function(){return t.questionAnswered()},f=function(n,t){return n.replace("[","<span class='"+t+"'>").replace("]","</span>")},g=function(n){n&&t.submitAnswer(n)},l=function(){return t.questionAnswered()},d=function(){n.qu.answer="",t.nextQuestion(),r("answer")},m=function(t){13==t.which&&g(n.qu.answer)};n.startQuiz=o,n.isQuizRunning=u,n.getCurrentQuestionNumber=i,n.getNumberOfQuizQuestions=a,n.getQuestionText=s,n.getAnswerText=c,n.submitAnswer=g,n.questionAnswered=l,n.nextQuestion=d,n.handleKeyPress=m,n.qu={answer:""}}]),angular.module("magellan").factory("QuizSrv",["AppConfig","LogSrv",function(n,t){var e=null,r=null,o=null,u=function(){return new Promise(function(t,e){s()||e("Countries not loaded"),null!==r&&r.isActive()===!0&&e("A quiz is currently being played"),r=new Quiz;for(var u=0;u<n["quiz.questions.number"];u++)r.addQuestion(new Question({country:a()}));o=0,t()})},i=function(n){e=n},a=function(){return e[getRandomInt(0,e.length-1)]},s=function(){return null!==e&&e.length>0},c=function(){return null!==r},l=function(){return r.getQuestions()[o]},f=function(){return null!==o?o+1:null},g=function(){return null!==r?r.getQuestions().length:null},d=function(n){var t=l(),e=p(t);t.state=n===e?t.states.CORRECT:t.states.INCORRECT},m=function(){var n=l();switch(n.type){case n.types.CAPITAL_OF_COUNTRY:return"Wie hei√üt die Hauptstadt von ["+(n.country.translations.de||n.country.name)+"]";case n.types.COUNTRY_OF_CAPITAL:return"["+n.country.capital+"] ist die Hauptstadt von welchem Land";case n.types.INHABITANTS_OF_COUNTRY:return"Wie viele Einwohner hat ["+(n.country.translations.de||n.country.name)+"]";default:t.error("Unknown question type",n.type)}},p=function(n){if(n&&n.type)switch(n.type){case n.types.CAPITAL_OF_COUNTRY:return n.country.capital;case n.types.COUNTRY_OF_CAPITAL:return n.country.translations.de||n.country.name;case n.types.INHABITANTS_OF_COUNTRY:return n.country.population;default:return t.error("Unknown question type",n.type),null}},h=function(){var n=l(),t=n.state;switch(t){case n.states.CORRECT:return"correct";case n.states.INCORRECT:return"incorrect";default:return null}},v=function(){var n=l();return n.state!==n.states.NOT_ANSWERED},w=function(){var n=l();return"["+p(n)+"]"},y=function(){f()+1<=g()&&o++};return{init:u,setCountries:i,isQuizRunning:c,getCurrentQuestionNumber:f,getNumberOfQuizQuestions:g,getQuestionText:m,getAnswerStatus:h,getAnswerText:w,submitAnswer:d,questionAnswered:v,nextQuestion:y}}]),angular.module("magellan").filter("renderHtml",["$sce",function(n){return n.trustAsHtml}]),angular.module("magellan").config(["$locationProvider","$stateProvider","$urlRouterProvider",function(n,t,e){n.html5Mode(!0),e.otherwise("/home"),t.state("home",{url:"/home",templateUrl:"/build/views/home.partial.html"}).state("quiz",{url:"/quiz",templateUrl:"/build/views/quiz.partial.html"}).state("login",{url:"/login",templateUrl:"/build/views/login.partial.html"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}).state("register",{url:"/register",templateUrl:"/build/views/register.partial.html"}).state("about",{url:"/about",templateUrl:"/build/views/about.partial.html"})}]),angular.module("magellan").factory("UserSrv",["$http","AuthTokenSrv",function(n,t){var e=this,r=function(){return n.get("/api/user")},o=function(){return new Promise(function(n,e){var o=t.getToken();o?(t.setToken(o),r().then(function(t){n(t.data)})["catch"](function(n){e(n)})):e("No token in storage")})},u=function(o,u){return n.post("/api/session",{username:o,password:u}).then(function(n){return e.token=n.data,t.setToken(e.token),r()})},i=function(){return new Promise(function(n,r){e.token=null,t.setToken(),n()})};return{getUser:r,getUserFromStorage:o,login:u,logout:i}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjcmlwdC5qcyIsImF1dGgtdG9rZW4uc2VydmljZS5qcyIsImF1dGguaW50ZXJjZXB0b3IuanMiLCJjb3VudHJ5LnNlcnZpY2UuanMiLCJkcm9wZG93bi5jdHJsLmpzIiwiZm9jdXMuc2VydmljZS5qcyIsImluZGV4ZWQtZGIuc2VydmljZS5qcyIsImxvZy5zZXJ2aWNlLmpzIiwibG9naW4uY3RybC5qcyIsImxvZ291dC5jdHJsLmpzIiwibW9kZWxzLmpzIiwicXVpei5jdHJsLmpzIiwicXVpei5zZXJ2aWNlLmpzIiwicmVuZGVySHRtbC5maWx0ZXIuanMiLCJyb3V0ZXMuanMiLCJ1c2VyLnNlcnZpY2UuanMiXSwibmFtZXMiOlsibWFnZWxsYW4iLCJhbmd1bGFyIiwibW9kdWxlIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCJjb25zdGFudCIsImxvZy5pbmZvIiwibG9nLmVycm9yIiwicXVpei5xdWVzdGlvbnMubnVtYmVyIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRzdGF0ZSIsIlVzZXJTcnYiLCJDb3VudHJ5U3J2IiwiUXVpelNydiIsImFwcCIsImNvbmZpZyIsInRpdGxlIiwic3VidGl0bGUiLCJhdXRob3IiLCJnZXRVc2VyRnJvbVN0b3JhZ2UiLCJ0aGVuIiwidXNlciIsImluaXQiLCJjb3VudHJpZXMiLCIkYnJvYWRjYXN0Iiwic2V0Q291bnRyaWVzIiwiZXJyIiwiJG9uIiwiZXZlbnQiLCJkYXRhIiwiZ28iLCJmYWN0b3J5IiwiJHdpbmRvdyIsInN0b3JlIiwic2Vzc2lvblN0b3JhZ2UiLCJrZXkiLCJnZXRUb2tlbiIsImdldEl0ZW0iLCJzZXRUb2tlbiIsInRva2VuIiwic2V0SXRlbSIsInJlbW92ZUl0ZW0iLCJBdXRoVG9rZW5TcnYiLCJhZGRUb2tlbiIsImhlYWRlcnMiLCJyZXF1ZXN0IiwiJGh0dHAiLCJJbmRleGVkREJTcnYiLCJMb2dTcnYiLCJkYXRhYmFzZSIsImtleUNvdW50cmllcyIsImtleVZlcnNpb24iLCJpbmRleGVkREJBdmFpbGFibGUiLCJsb2FkQ291bnRyaWVzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjcmVhdGVEYXRhYmFzZSIsImdldEVtcHR5T2JqZWN0IiwiZ2V0SW50ZXJuYWxWZXJzaW9uIiwiZ2V0RXh0ZXJuYWxWZXJzaW9uIiwiZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5IiwibG9hZERhdGEiLCJvYmoiLCJpbmZvIiwidG9VcHBlckNhc2UiLCJlcnJvciIsImdldENvdW50cmllc0Zyb21BUEkiLCJzdHJhdGVneSIsImludGVybmFsVmVyc2lvbiIsImV4dGVybmFsVmVyc2lvbiIsInB1dEl0ZW0iLCJuYW1lIiwidmFsdWUiLCJnZXRDb3VudHJpZXNGcm9tREIiLCJfb2JqIiwicmV0cmlldmVJdGVtIiwiaXRlbSIsImdldFZlcnNpb25Gcm9tQVBJIiwidmVyc2lvbiIsImdldCIsInJlc3BvbnNlIiwidG9nZ2xlRHJvcGRvd24iLCJ2aXNpYmxlIiwic2hvd0Ryb3Bkb3duIiwiaGlkZURyb3Bkb3duIiwiaXNEcm9wZG93blZpc2libGUiLCIkdGltZW91dCIsImlkIiwiZWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJmb2N1cyIsImtleVBhdGgiLCJpbmRleGVkREIiLCJ3ZWJraXRJbmRleGVkREIiLCJtc0luZGV4ZWREQiIsIklEQktleVJhbmdlIiwid2Via2l0SURCS2V5UmFuZ2UiLCJJREJUcmFuc2FjdGlvbiIsIndlYmtpdElEQlRyYW5zYWN0aW9uIiwiUkVBRF9XUklURSIsIlJFQURfT05MWSIsImRiTmFtZSIsInN0b3JlTmFtZSIsIm9wZW4iLCJvbnVwZ3JhZGVuZWVkZWQiLCJlIiwiaWRiIiwidGFyZ2V0IiwicmVzdWx0IiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJvbnN1Y2Nlc3MiLCJvbmVycm9yIiwiZHJvcERhdGFiYXNlIiwiZGVsZXRlRGF0YWJhc2UiLCJhZGRJdGVtIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsInJlcXVlc3RBZGQiLCJhZGQiLCJwdXQiLCJpdGVtTmFtZSIsInJhbmdlIiwib25seSIsIm9wZW5DdXJzb3IiLCJjdXJzb3IiLCJyZXRyaWV2ZUl0ZW1zIiwiaXRlbXMiLCJBcHBDb25maWciLCJsb2dJbmZvIiwiY29uc29sZSIsImxvZyIsImFwcGx5IiwiYXJndW1lbnRzIiwibG9nRXJyb3IiLCJGb2N1c1NydiIsImxvZ2luIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsIiRlbWl0IiwibG9nb3V0IiwiUXVpeiIsInF1ZXN0aW9ucyIsImFjdGl2ZSIsInRoaXMiLCJhZGRRdWVzdGlvbiIsInF1ZXN0aW9uIiwiZ2V0UXVlc3Rpb25zIiwiaXNBY3RpdmUiLCJRdWVzdGlvbiIsIm9wdGlvbnMiLCJ0eXBlIiwiZ2V0UmFuZG9tVHlwZSIsImNvdW50cnkiLCJzdGF0ZSIsInN0YXRlcyIsIk5PVF9BTlNXRVJFRCIsInByb3RvdHlwZSIsIkNPUlJFQ1QiLCJJTkNPUlJFQ1QiLCJ0eXBlcyIsIkNBUElUQUxfT0ZfQ09VTlRSWSIsIkNPVU5UUllfT0ZfQ0FQSVRBTCIsIklOSEFCSVRBTlRTX09GX0NPVU5UUlkiLCJPYmplY3QiLCJrZXlzIiwiZ2V0UmFuZG9tSW50IiwibGVuZ3RoIiwibWluIiwibWF4IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZ2V0U3RyaW5nQmV0d2VlbiIsInRleHQiLCJmaXJzdFN0cmluZyIsInNlY29uZFN0cmluZyIsImZpcnN0UG9zIiwiaW5kZXhPZiIsInNlY29uZFBvcyIsInN1YnN0ciIsInN0YXJ0UXVpeiIsImlzUXVpelJ1bm5pbmciLCJnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIiLCJnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMiLCJnZXRRdWVzdGlvblRleHQiLCJyZW5kZXJRdWVzdGlvbiIsImdldEFuc3dlclRleHQiLCJnZXRBbnN3ZXJTdGF0dXMiLCJxdWVzdGlvbkFuc3dlcmVkIiwiY2xhc3NOYW1lIiwicmVwbGFjZSIsInN1Ym1pdEFuc3dlciIsImFuc3dlciIsIm5leHRRdWVzdGlvbiIsInF1IiwiaGFuZGxlS2V5UHJlc3MiLCJrZXlFdmVudCIsIndoaWNoIiwicXVpeiIsImN1cnJlbnRRdWVzdGlvbk5vIiwiY291bnRyaWVzTG9hZGVkIiwiaSIsImdldFJhbmRvbUNvdW50cnkiLCJfY291bnRyaWVzIiwiZ2V0Q3VycmVudFF1ZXN0aW9uIiwiY29ycmVjdEFuc3dlciIsImdldEFuc3dlclRvUXVlc3Rpb24iLCJ0cmFuc2xhdGlvbnMiLCJkZSIsImNhcGl0YWwiLCJwb3B1bGF0aW9uIiwiZmlsdGVyIiwiJHNjZSIsInRydXN0QXNIdG1sIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsImh0bWw1TW9kZSIsIm90aGVyd2lzZSIsInVybCIsInRlbXBsYXRlVXJsIiwic2VsZiIsImdldFVzZXIiLCJwb3N0Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxVQUFBQyxRQUFBQyxPQUFBLFlBQ0EsY0NDSSxnQkRBSixTQUFBQyxHQUNBQSxFQUFBQyxhQUFBQyxLQUFBLHFCQUlBTCxVQUFBTSxTQUFBLGFBQ0FDLFlBQUEsRUFDQUMsYUFBQSxFQUVBQyx3QkFBQSxJQUdBVCxTQUFBVSxXQUFBLFdBQUEsU0FBQSxTQUFBLFVBQUEsYUFBQSxVQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFKLEVBQUFLLEtBQ0FDLFFBQ0FDLE1BQUEsV0FDQUMsU0FBQSx1REFDQUMsT0FBQSxvQkFLQVAsRUFBQVEscUJBQ0FDLEtBQUEsU0FBQUMsR0FFQVosRUFBQVksS0FBQUEsRUFHQVQsRUFBQVUsT0FDQUYsS0FBQSxTQUFBRyxHQUNBZCxFQUFBZSxXQUFBLG1CQUFBRCxHQUdBVixFQUFBWSxhQUFBRixPQVhBWixTQWNBLFNBQUFlLE1BS0FqQixFQUFBa0IsSUFBQSxZQUFBLFNBQUFDLEVBQUFDLEdBRUFwQixFQUFBWSxLQUFBUSxFQUdBakIsRUFBQVUsT0FDQUYsS0FBQSxTQUFBRyxHQUNBZCxFQUFBZSxXQUFBLG1CQUFBRCxHQUdBVixF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c291cmNlc0NvbnRlbnQiOlsidmFyIG1hZ2VsbGFuID0gYW5ndWxhci5tb2R1bGUoXCJtYWdlbGxhblwiLCBbXHJcbiAgICAndWkucm91dGVyJ1xyXG5dLCBmdW5jdGlvbiBjb25maWcoJGh0dHBQcm92aWRlcikge1xyXG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXV0aEludGVyY2VwdG9yJyk7XHJcbn0pO1xyXG5cclxuLy8gZGVmaW5lIGFwcGxpY2F0aW9uIGNvbnN0YW50c1xyXG5tYWdlbGxhbi5jb25zdGFudChcIkFwcENvbmZpZ1wiLCB7XHJcbiAgICBcImxvZy5pbmZvXCI6IHRydWUsXHJcbiAgICBcImxvZy5lcnJvclwiOiB0cnVlLFxyXG5cclxuICAgIFwicXVpei5xdWVzdGlvbnMubnVtYmVyXCI6IDVcclxufSk7XHJcblxyXG5tYWdlbGxhbi5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgVXNlclNydiwgQ291bnRyeVNydiwgUXVpelNydikge1xyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGNvbmZpZyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS5hcHAgPSB7XHJcbiAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgIHRpdGxlOiBcIk1hZ2VsbGFuXCIsXHJcbiAgICAgICAgICAgIHN1YnRpdGxlOiBcIlRlc3QgeW91ciBrbm93bGVkZ2UgYWJvdXQgdGhlIGNvdW50cmllcyBvZiBvdXIgd29ybGRcIixcclxuICAgICAgICAgICAgYXV0aG9yOiBcIk1pY2hhZWwgU3RpZnRlclwiXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgaW5pdGlhbGl6YXRpb24gLS0tLS0tLS0tLS0tXHJcbiAgICBVc2VyU3J2LmdldFVzZXJGcm9tU3RvcmFnZSgpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICAgICAkc2NvcGUudXNlciA9IHVzZXI7XHJcblxyXG4gICAgICAgICAgICAvLyBpbml0IGNvdW50cnkgc2VydmljZVxyXG4gICAgICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2NvdW50cmllcy5sb2FkZWQnLCBjb3VudHJpZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgIFF1aXpTcnYuc2V0Q291bnRyaWVzKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgLy8gdGhlIG9ubHkgZXJyb3IgdGhhdCBjYW4gb2NjdXIgaXMgdGhhdCB0aGVyZSBpcyBubyB0b2tlbiBpbiBzdG9yYWdlLCB3ZSBkbyBub3QgbmVlZCB0byByZWFjdCB0byB0aGF0XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gRXZlbnQgaGFuZGxpbmcgLS0tLS0tLS0tLS0tXHJcbiAgICAkc2NvcGUuJG9uKCdhcHAubG9naW4nLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHN0b3JlIHVzZXIgb2JqZWN0IGluIHNjb3BlXHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBkYXRhO1xyXG5cclxuICAgICAgICAvLyBpbml0IGNvdW50cnkgc2VydmljZVxyXG4gICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2NvdW50cmllcy5sb2FkZWQnLCBjb3VudHJpZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICBRdWl6U3J2LnNldENvdW50cmllcyhjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gZ28gdG8gcXVpeiBwYWdlXHJcbiAgICAgICAgJHN0YXRlLmdvKCdxdWl6Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuJG9uKCdhcHAubG9nb3V0JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyByZW1vdmUgdXNlciBvYmplY3QgZnJvbSBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gZ28gdG8gaG9tZSBwYWdlXHJcbiAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICB9KTtcclxufSk7IiwidmFyIG1hZ2VsbGFuID0gYW5ndWxhci5tb2R1bGUoXCJtYWdlbGxhblwiLCBbXHJcbiAgICAndWkucm91dGVyJ1xyXG5dLCBbXCIkaHR0cFByb3ZpZGVyXCIsIGZ1bmN0aW9uIGNvbmZpZygkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBdXRoSW50ZXJjZXB0b3InKTtcclxufV0pO1xyXG5cclxuLy8gZGVmaW5lIGFwcGxpY2F0aW9uIGNvbnN0YW50c1xyXG5tYWdlbGxhbi5jb25zdGFudChcIkFwcENvbmZpZ1wiLCB7XHJcbiAgICBcImxvZy5pbmZvXCI6IHRydWUsXHJcbiAgICBcImxvZy5lcnJvclwiOiB0cnVlLFxyXG5cclxuICAgIFwicXVpei5xdWVzdGlvbnMubnVtYmVyXCI6IDVcclxufSk7XHJcblxyXG5tYWdlbGxhbi5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBbXCIkc2NvcGVcIiwgXCIkc3RhdGVcIiwgXCJVc2VyU3J2XCIsIFwiQ291bnRyeVNydlwiLCBcIlF1aXpTcnZcIiwgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIFVzZXJTcnYsIENvdW50cnlTcnYsIFF1aXpTcnYpIHtcclxuICAgIC8vIC0tLS0tLS0tLS0tIEFwcCBjb25maWcgLS0tLS0tLS0tLS0tXHJcbiAgICAkc2NvcGUuYXBwID0ge1xyXG4gICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICB0aXRsZTogXCJNYWdlbGxhblwiLFxyXG4gICAgICAgICAgICBzdWJ0aXRsZTogXCJUZXN0IHlvdXIga25vd2xlZGdlIGFib3V0IHRoZSBjb3VudHJpZXMgb2Ygb3VyIHdvcmxkXCIsXHJcbiAgICAgICAgICAgIGF1dGhvcjogXCJNaWNoYWVsIFN0aWZ0ZXJcIlxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGluaXRpYWxpemF0aW9uIC0tLS0tLS0tLS0tLVxyXG4gICAgVXNlclNydi5nZXRVc2VyRnJvbVN0b3JhZ2UoKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgLy8gc3RvcmUgdXNlciBvYmplY3QgaW4gc2NvcGVcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xyXG5cclxuICAgICAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICAgICAgQ291bnRyeVNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGNvdW50cmllcyBpbiBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICBRdWl6U3J2LnNldENvdW50cmllcyhjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgIC8vIHRoZSBvbmx5IGVycm9yIHRoYXQgY2FuIG9jY3VyIGlzIHRoYXQgdGhlcmUgaXMgbm8gdG9rZW4gaW4gc3RvcmFnZSwgd2UgZG8gbm90IG5lZWQgdG8gcmVhY3QgdG8gdGhhdFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEV2ZW50IGhhbmRsaW5nIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ2luJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIHF1aXogcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygncXVpeicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ291dCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gcmVtb3ZlIHVzZXIgb2JqZWN0IGZyb20gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfSk7XHJcbn1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdBdXRoVG9rZW5TcnYnLCBbXCIkd2luZG93XCIsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcclxuICAgICAgICB2YXIgc3RvcmUgPSAkd2luZG93LnNlc3Npb25TdG9yYWdlO1xyXG4gICAgICAgIHZhciBrZXkgPSAnYXV0aC10b2tlbic7XHJcblxyXG4gICAgICAgIHZhciBnZXRUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0SXRlbShrZXkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZXRUb2tlbiA9IGZ1bmN0aW9uKHRva2VuKSB7XHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUuc2V0SXRlbShrZXksIHRva2VuKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFRva2VuOiBnZXRUb2tlbixcclxuICAgICAgICAgICAgc2V0VG9rZW46IHNldFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdBdXRoSW50ZXJjZXB0b3InLCBbXCJBdXRoVG9rZW5TcnZcIiwgZnVuY3Rpb24oQXV0aFRva2VuU3J2KSB7XHJcbiAgICAgICAgdmFyIGFkZFRva2VuID0gZnVuY3Rpb24oY29uZmlnKSB7XHJcbiAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhUb2tlblNydi5nZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycyA9IGNvbmZpZy5oZWFkZXJzIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ1gtQXV0aCddID0gdG9rZW47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb25maWc7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVxdWVzdDogYWRkVG9rZW5cclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0NvdW50cnlTcnYnLCBbXCIkaHR0cFwiLCBcIkluZGV4ZWREQlNydlwiLCBcIkxvZ1NydlwiLCBmdW5jdGlvbigkaHR0cCwgSW5kZXhlZERCU3J2LCBMb2dTcnYpIHtcclxuICAgICAgICAvLyBDb3VudHJpZXMgYXJyYXlcclxuICAgICAgICB2YXIgY291bnRyaWVzID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gSW5kZXhlZERCXHJcbiAgICAgICAgdmFyIGRhdGFiYXNlID0gJ21hZ2VsbGFuJztcclxuICAgICAgICB2YXIgc3RvcmUgPSAnY291bnRyeVN0b3JlJztcclxuICAgICAgICB2YXIga2V5Q291bnRyaWVzID0gJ2NvdW50cmllcyc7XHJcbiAgICAgICAgdmFyIGtleVZlcnNpb24gPSAndmVyc2lvbic7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREJBdmFpbGFibGUgPSBJbmRleGVkREJTcnYuaW5kZXhlZERCQXZhaWxhYmxlKCk7XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2FkQ291bnRyaWVzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvYWRDb3VudHJpZXMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgaW5kZXhlZERCIGlzIGF2YWlsYWJsZVxyXG4gICAgICAgICAgICBpZiAoaW5kZXhlZERCQXZhaWxhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGRhdGFiYXNlIGV4aXN0c1xyXG4gICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5jcmVhdGVEYXRhYmFzZShkYXRhYmFzZSwgc3RvcmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEVtcHR5T2JqZWN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRJbnRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEV4dGVybmFsVmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihsb2FkRGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXMgPSBvYmpbJ2NvdW50cmllcyddO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKFwibG9hZGVkIGNvdW50cmllcyBmcm9tXCIsIG9ialsnbG9hZFN0cmF0ZWd5J10udG9VcHBlckNhc2UoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoXCJmYWlsZWQgdG8gbG9hZCBjb3VudHJpZXNcIiwgZXJyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCwgd2UgYWx3YXlzIHRyeSB0byBkb3dubG9hZCBpdCBmcm9tIHRoZSBjb3VudHJ5IEFQSSBlbmRwb2ludFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldENvdW50cmllc0Zyb21BUEkoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkZXRlcm1pbmVMb2FkU3RyYXRlZ3kgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBpbnRlcm5hbFZlcnNpb24gPSBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl07XHJcbiAgICAgICAgICAgICAgICB2YXIgZXh0ZXJuYWxWZXJzaW9uID0gb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpbnRlcm5hbFZlcnNpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChleHRlcm5hbFZlcnNpb24gPiBpbnRlcm5hbFZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdhcGknO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzdHJhdGVneSA9ICdkYic7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgb2JqWydsb2FkU3RyYXRlZ3knXSA9IHN0cmF0ZWd5O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvYWREYXRhID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneSA9IG9ialsnbG9hZFN0cmF0ZWd5J107XHJcblxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChzdHJhdGVneSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FwaSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21BUEkoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gY291bnRyaWVzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yZSBjb3VudHJpZXMgYW5kIHZlcnNpb24gbnVtYmVyIGluIGRhdGFiYXNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleUNvdW50cmllcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICBjb3VudHJpZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnB1dEl0ZW0oZGF0YWJhc2UsIHN0b3JlLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleVZlcnNpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RiJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q291bnRyaWVzRnJvbURCKG9iailcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKF9vYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF9vYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnVW5rbm93biBsb2FkIHN0cmF0ZWd5Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFbXB0eU9iamVjdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHt9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEludGVybmFsVmVyc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5VmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImludGVybmFsVmVyc2lvblwiXSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRFeHRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldFZlcnNpb25Gcm9tQVBJKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl0gPSB2ZXJzaW9uO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21EQiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucmV0cmlldmVJdGVtKGRhdGFiYXNlLCBzdG9yZSwga2V5Q291bnRyaWVzKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiY291bnRyaWVzXCJdID0gaXRlbS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFZlcnNpb25Gcm9tQVBJID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9jb3VudHJpZXMvdmVyc2lvbicpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhLnZlcnNpb24gfHwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXRcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0Ryb3Bkb3duQ3RybCcsIFtcIiRzY29wZVwiLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkc2NvcGUudG9nZ2xlRHJvcGRvd24gPSB0b2dnbGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuc2hvd0Ryb3Bkb3duID0gc2hvd0Ryb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5oaWRlRHJvcGRvd24gPSBoaWRlRHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmlzRHJvcGRvd25WaXNpYmxlID0gaXNEcm9wZG93blZpc2libGU7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gIXZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93RHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGlkZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0Ryb3Bkb3duVmlzaWJsZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZpc2libGU7XHJcbiAgICAgICAgfVxyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0ZvY3VzU3J2JywgW1wiJHRpbWVvdXRcIiwgXCIkd2luZG93XCIsIGZ1bmN0aW9uKCR0aW1lb3V0LCAkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGlkKSB7XHJcbiAgICAgICAgICAgIC8vIHRpbWVvdXQgbWFrZXMgc3VyZSB0aGF0IGlzIGludm9rZWQgYWZ0ZXIgYW55IG90aGVyIGV2ZW50IGhhcyBiZWVuIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgLy8gZS5nLiBjbGljayBldmVudHMgdGhhdCBuZWVkIHRvIHJ1biBiZWZvcmUgdGhlIGZvY3VzIG9yXHJcbiAgICAgICAgICAgIC8vIGlucHV0cyBlbGVtZW50cyB0aGF0IGFyZSBpbiBhIGRpc2FibGVkIHN0YXRlIGJ1dCBhcmUgZW5hYmxlZCB3aGVuIHRob3NlIGV2ZW50c1xyXG4gICAgICAgICAgICAvLyBhcmUgdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJHdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnSW5kZXhlZERCU3J2JywgW1wiJHdpbmRvd1wiLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIGtleVBhdGggPSAnbmFtZSc7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREIgPSAkd2luZG93LmluZGV4ZWREQiB8fCAkd2luZG93LndlYmtpdEluZGV4ZWREQiB8fCAkd2luZG93Lm1zSW5kZXhlZERCO1xyXG4gICAgICAgIHZhciBJREJLZXlSYW5nZSA9ICR3aW5kb3cuSURCS2V5UmFuZ2UgfHwgJHdpbmRvdy53ZWJraXRJREJLZXlSYW5nZTtcclxuXHJcbiAgICAgICAgdmFyIElEQlRyYW5zYWN0aW9uID0gJHdpbmRvdy5JREJUcmFuc2FjdGlvbiB8fCAkd2luZG93LndlYmtpdElEQlRyYW5zYWN0aW9uO1xyXG5cclxuICAgICAgICBpZiAoSURCVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSA9IElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgfHwgJ3JlYWR3cml0ZSc7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSA9IElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSB8fCAncmVhZG9ubHknO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5kZXhlZERCID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBlIGlzIGFuIGluc3RhbmNlIG9mIElEQlZlcnNpb25DaGFuZ2VFdmVudFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IGlkYi5jcmVhdGVPYmplY3RTdG9yZShzdG9yZU5hbWUsIHsga2V5UGF0aDoga2V5UGF0aCB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkLCB1cGRhdGUsIGRlbGV0ZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZHJvcERhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBzdWNjZXNzZnVsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3AgZmFpbGVkXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFkZEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLmFkZChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwdXRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5wdXQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW1OYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IElEQktleVJhbmdlLm9ubHkoaXRlbU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKHJhbmdlKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gY3Vyc29yLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW1zID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjcmVhdGVEYXRhYmFzZTogY3JlYXRlRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGRyb3BEYXRhYmFzZTogZHJvcERhdGFiYXNlLFxyXG4gICAgICAgICAgICBhZGRJdGVtOiBhZGRJdGVtLFxyXG4gICAgICAgICAgICBwdXRJdGVtOiBwdXRJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW06IHJldHJpZXZlSXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtczogcmV0cmlldmVJdGVtcyxcclxuICAgICAgICAgICAgaW5kZXhlZERCQXZhaWxhYmxlOiBpbmRleGVkREJBdmFpbGFibGVcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0xvZ1NydicsIFtcIkFwcENvbmZpZ1wiLCBmdW5jdGlvbihBcHBDb25maWcpIHtcclxuICAgICAgICB2YXIgbG9nSW5mbyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmluZm9cIl0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9nRXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKEFwcENvbmZpZ1tcImxvZy5lcnJvclwiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5mbzogbG9nSW5mbyxcclxuICAgICAgICAgICAgZXJyb3I6IGxvZ0Vycm9yXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBbXCIkc2NvcGVcIiwgXCJVc2VyU3J2XCIsIFwiRm9jdXNTcnZcIiwgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2LCBGb2N1c1Nydikge1xyXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICBVc2VyU3J2LmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcGxpY2F0aW9uIGNvbnRyb2wgYWJvdXQgbG9naW4gZXZlbnRcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dpbicsIHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IG5vdGlmeSB1c2VyIGFib3V0IGVycm9yIGluIGxvZ2luIHByb2Nlc3NcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGZvY3VzIHVzZXJuYW1lIGZpZWxkXHJcbiAgICAgICAgRm9jdXNTcnYoJ3VzZXJuYW1lJyk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTG9nb3V0Q3RybCcsIFtcIiRzY29wZVwiLCBcIlVzZXJTcnZcIiwgZnVuY3Rpb24oJHNjb3BlLCBVc2VyU3J2KSB7XHJcbiAgICAgICAgVXNlclNydi5sb2dvdXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ291dCBldmVudFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9nb3V0Jyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfV0pO1xuLy8gb3duIGNsYXNzZXMgYW5kIGZ1bmN0aW9uc1xyXG5cclxuLy8gLS0tLS0tLS0tLSBRVUlaIC0tLS0tLS0tLS1cclxudmFyIFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgIC8vIHF1ZXN0aW9ucyBhcnJheVxyXG4gICAgdmFyIHF1ZXN0aW9ucyA9IFtdO1xyXG5cclxuICAgIC8vIGZsYWcgaW5kaWNhdGluZyBpZiBxdWl6IGlzIGN1cnJlbnRseSBhY3RpdmVcclxuICAgIHZhciBhY3RpdmUgPSB0cnVlO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHF1ZXN0aW9uIHRvIHRoZSBxdWVzdGlvbnMgYXJyYXlcclxuICAgICAqIEBwYXJhbSBxdWVzdGlvblxyXG4gICAgICovXHJcbiAgICB0aGlzLmFkZFF1ZXN0aW9uID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcclxuICAgICAgICBxdWVzdGlvbnMucHVzaChxdWVzdGlvbik7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0UXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHF1ZXN0aW9ucztcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5pc0FjdGl2ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBhY3RpdmU7XHJcbiAgICB9O1xyXG59O1xyXG5cclxuLy8gLS0tLS0tLS0tLSBRVUVTVElPTiAtLS0tLS0tLS0tXHJcbnZhciBRdWVzdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG5cclxuICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZSB8fCB0aGlzLmdldFJhbmRvbVR5cGUoKTtcclxuICAgIHRoaXMuY291bnRyeSA9IG9wdGlvbnMuY291bnRyeSB8fCBudWxsO1xyXG4gICAgdGhpcy5zdGF0ZSA9IG9wdGlvbnMuc3RhdGUgfHwgdGhpcy5zdGF0ZXMuTk9UX0FOU1dFUkVEO1xyXG59O1xyXG5cclxuUXVlc3Rpb24ucHJvdG90eXBlLnN0YXRlcyA9IHtcclxuICAgIFwiTk9UX0FOU1dFUkVEXCI6IDEsXHJcbiAgICBcIkNPUlJFQ1RcIjogMixcclxuICAgIFwiSU5DT1JSRUNUXCI6IDNcclxufTtcclxuXHJcblF1ZXN0aW9uLnByb3RvdHlwZS50eXBlcyA9IHtcclxuICAgIFwiQ0FQSVRBTF9PRl9DT1VOVFJZXCI6IFwiY2FwaXRhbC1vZi1jb3VudHJ5XCIsXHJcbiAgICBcIkNPVU5UUllfT0ZfQ0FQSVRBTFwiOiBcImNvdW50cnktb2YtY2FwaXRhbFwiLFxyXG4gICAgXCJJTkhBQklUQU5UU19PRl9DT1VOVFJZXCI6IFwiaW5oYWJpdGFudHMtb2YtY291bnRyeVwiXHJcbn07XHJcblxyXG5RdWVzdGlvbi5wcm90b3R5cGUuZ2V0UmFuZG9tVHlwZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHR5cGVzID0gT2JqZWN0LmtleXModGhpcy50eXBlcyk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMudHlwZXNbdHlwZXNbZ2V0UmFuZG9tSW50KDAsIHR5cGVzLmxlbmd0aCAtIDEpXV07XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyBhIHJhbmRvbSBpbnRlZ2VyIGJldHdlZW4gbWluIChpbmNsdXNpdmUpIGFuZCBtYXggKGluY2x1c2l2ZSlcclxuICogVXNpbmcgTWF0aC5yb3VuZCgpIHdpbGwgZ2l2ZSB5b3UgYSBub24tdW5pZm9ybSBkaXN0cmlidXRpb24hXHJcbiAqL1xyXG52YXIgZ2V0UmFuZG9tSW50ID0gZnVuY3Rpb24obWluLCBtYXgpIHtcclxuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgdGhlIHRleHQgYmV0d2VlbiB0d28gZGVsaW1pdGluZyB0ZXh0IG9jY3VycmVuY2VzXHJcbiAqL1xyXG52YXIgZ2V0U3RyaW5nQmV0d2VlbiA9IGZ1bmN0aW9uKHRleHQsIGZpcnN0U3RyaW5nLCBzZWNvbmRTdHJpbmcpIHtcclxuICAgIHZhciBmaXJzdFBvcyA9IHRleHQuaW5kZXhPZihmaXJzdFN0cmluZyk7XHJcbiAgICB2YXIgc2Vjb25kUG9zID0gdGV4dC5pbmRleE9mKHNlY29uZFN0cmluZyk7XHJcblxyXG4gICAgaWYgKGZpcnN0UG9zID49IDAgJiYgc2Vjb25kUG9zID49IDAgJiYgc2Vjb25kUG9zID4gZmlyc3RQb3MpIHtcclxuICAgICAgICByZXR1cm4gdGV4dC5zdWJzdHIoZmlyc3RQb3MgKyAxLCBzZWNvbmRQb3MgLSBmaXJzdFBvcyAtIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG59O1xyXG5cbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6Q3RybCcsIFtcIiRzY29wZVwiLCBcIlF1aXpTcnZcIiwgXCJMb2dTcnZcIiwgXCJGb2N1c1NydlwiLCBmdW5jdGlvbigkc2NvcGUsIFF1aXpTcnYsIExvZ1NydiwgRm9jdXNTcnYpIHtcclxuXHJcbiAgICAgICAgdmFyIHN0YXJ0UXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBRdWl6U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRm9jdXNTcnYoJ2Fuc3dlcicpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoXCJDb3VsZCBub3Qgc3RhcnQgcXVpelwiLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuaXNRdWl6UnVubmluZygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25UZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJRdWVzdGlvbihRdWl6U3J2LmdldFF1ZXN0aW9uVGV4dCgpLCBcInF1ZXN0aW9uLWhpZ2hsaWdodFwiKSArIFwiP1wiO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRBbnN3ZXJUZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJRdWVzdGlvbihRdWl6U3J2LmdldEFuc3dlclRleHQoKSwgXCJhbnN3ZXItaGlnaGxpZ2h0LVwiICsgUXVpelNydi5nZXRBbnN3ZXJTdGF0dXMoKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uQW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYucXVlc3Rpb25BbnN3ZXJlZCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHJlbmRlclF1ZXN0aW9uID0gZnVuY3Rpb24odGV4dCwgY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIltcIiwgXCI8c3BhbiBjbGFzcz0nXCIgKyBjbGFzc05hbWUgKyBcIic+XCIpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIl1cIiwgXCI8L3NwYW4+XCIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzdWJtaXRBbnN3ZXIgPSBmdW5jdGlvbihhbnN3ZXIpIHtcclxuICAgICAgICAgICAgaWYgKGFuc3dlcikge1xyXG4gICAgICAgICAgICAgICAgUXVpelNydi5zdWJtaXRBbnN3ZXIoYW5zd2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbkFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LnF1ZXN0aW9uQW5zd2VyZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5xdS5hbnN3ZXIgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgUXVpelNydi5uZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIEZvY3VzU3J2KCdhbnN3ZXInKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZGxlS2V5UHJlc3MgPSBmdW5jdGlvbihrZXlFdmVudCkge1xyXG4gICAgICAgICAgICBpZiAoa2V5RXZlbnQud2hpY2ggPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHN1Ym1pdEFuc3dlcigkc2NvcGUucXUuYW5zd2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zdGFydFF1aXogPSBzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmlzUXVpelJ1bm5pbmcgPSBpc1F1aXpSdW5uaW5nO1xyXG4gICAgICAgICRzY29wZS5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI7XHJcbiAgICAgICAgJHNjb3BlLmdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucztcclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb25UZXh0ID0gZ2V0UXVlc3Rpb25UZXh0O1xyXG4gICAgICAgICRzY29wZS5nZXRBbnN3ZXJUZXh0ID0gZ2V0QW5zd2VyVGV4dDtcclxuICAgICAgICAkc2NvcGUuc3VibWl0QW5zd2VyID0gc3VibWl0QW5zd2VyO1xyXG4gICAgICAgICRzY29wZS5xdWVzdGlvbkFuc3dlcmVkID0gcXVlc3Rpb25BbnN3ZXJlZDtcclxuICAgICAgICAkc2NvcGUubmV4dFF1ZXN0aW9uID0gbmV4dFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5oYW5kbGVLZXlQcmVzcyA9IGhhbmRsZUtleVByZXNzO1xyXG5cclxuICAgICAgICAkc2NvcGUucXUgPSB7XHJcbiAgICAgICAgICAgIGFuc3dlcjogXCJcIlxyXG4gICAgICAgIH07XHJcblxyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1F1aXpTcnYnLCBbXCJBcHBDb25maWdcIiwgXCJMb2dTcnZcIiwgZnVuY3Rpb24oQXBwQ29uZmlnLCBMb2dTcnYpIHtcclxuICAgICAgICB2YXIgY291bnRyaWVzID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHF1aXogPSBudWxsO1xyXG4gICAgICAgIHZhciBjdXJyZW50UXVlc3Rpb25ObyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY291bnRyaWVzTG9hZGVkKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJDb3VudHJpZXMgbm90IGxvYWRlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocXVpeiAhPT0gbnVsbCAmJiBxdWl6LmlzQWN0aXZlKCkgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJBIHF1aXogaXMgY3VycmVudGx5IGJlaW5nIHBsYXllZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgcXVpeiBvYmplY3RcclxuICAgICAgICAgICAgICAgIHF1aXogPSBuZXcgUXVpeigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQXBwQ29uZmlnWydxdWl6LnF1ZXN0aW9ucy5udW1iZXInXTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcXVpei5hZGRRdWVzdGlvbihuZXcgUXVlc3Rpb24oe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJ5OiBnZXRSYW5kb21Db3VudHJ5KClcclxuICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uTm8gPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNldENvdW50cmllcyA9IGZ1bmN0aW9uKF9jb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgY291bnRyaWVzID0gX2NvdW50cmllcztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UmFuZG9tQ291bnRyeSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzW2dldFJhbmRvbUludCgwLCBjb3VudHJpZXMubGVuZ3RoIC0gMSldO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjb3VudHJpZXNMb2FkZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllcyAhPT0gbnVsbCAmJiBjb3VudHJpZXMubGVuZ3RoID4gMDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaXNRdWl6UnVubmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcXVpeiAhPT0gbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmdldFF1ZXN0aW9ucygpW2N1cnJlbnRRdWVzdGlvbk5vXTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50UXVlc3Rpb25ObyAhPT0gbnVsbCA/IGN1cnJlbnRRdWVzdGlvbk5vICsgMSA6IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcXVpeiAhPT0gbnVsbCA/IHF1aXouZ2V0UXVlc3Rpb25zKCkubGVuZ3RoIDogbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc3VibWl0QW5zd2VyID0gZnVuY3Rpb24oYW5zd2VyKSB7XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbiA9IGdldEN1cnJlbnRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNvcnJlY3RBbnN3ZXIgPSBnZXRBbnN3ZXJUb1F1ZXN0aW9uKHF1ZXN0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIHF1ZXN0aW9uLnN0YXRlID0gYW5zd2VyID09PSBjb3JyZWN0QW5zd2VyID8gcXVlc3Rpb24uc3RhdGVzLkNPUlJFQ1QgOiBxdWVzdGlvbi5zdGF0ZXMuSU5DT1JSRUNUO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKHF1ZXN0aW9uLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuQ0FQSVRBTF9PRl9DT1VOVFJZOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldpZSBoZWnDn3QgZGllIEhhdXB0c3RhZHQgdm9uIFtcIiArIChxdWVzdGlvbi5jb3VudHJ5LnRyYW5zbGF0aW9ucy5kZSB8fCBxdWVzdGlvbi5jb3VudHJ5Lm5hbWUpICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5DT1VOVFJZX09GX0NBUElUQUw6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiW1wiICsgcXVlc3Rpb24uY291bnRyeS5jYXBpdGFsICsgXCJdIGlzdCBkaWUgSGF1cHRzdGFkdCB2b24gd2VsY2hlbSBMYW5kXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5JTkhBQklUQU5UU19PRl9DT1VOVFJZOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldpZSB2aWVsZSBFaW53b2huZXIgaGF0IFtcIiArIChxdWVzdGlvbi5jb3VudHJ5LnRyYW5zbGF0aW9ucy5kZSB8fCBxdWVzdGlvbi5jb3VudHJ5Lm5hbWUpICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoXCJVbmtub3duIHF1ZXN0aW9uIHR5cGVcIiwgcXVlc3Rpb24udHlwZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QW5zd2VyVG9RdWVzdGlvbiA9IGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XHJcbiAgICAgICAgICAgIGlmICghcXVlc3Rpb24gfHwgIXF1ZXN0aW9uLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChxdWVzdGlvbi50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnR5cGVzLkNBUElUQUxfT0ZfQ09VTlRSWTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uY291bnRyeS5jYXBpdGFsO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuQ09VTlRSWV9PRl9DQVBJVEFMOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5jb3VudHJ5LnRyYW5zbGF0aW9ucy5kZSB8fCBxdWVzdGlvbi5jb3VudHJ5Lm5hbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5JTkhBQklUQU5UU19PRl9DT1VOVFJZOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5jb3VudHJ5LnBvcHVsYXRpb247XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoXCJVbmtub3duIHF1ZXN0aW9uIHR5cGVcIiwgcXVlc3Rpb24udHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QW5zd2VyU3RhdHVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbiA9IGdldEN1cnJlbnRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHN0YXRlID0gcXVlc3Rpb24uc3RhdGU7XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKHN0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnN0YXRlcy5DT1JSRUNUOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImNvcnJlY3RcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnN0YXRlcy5JTkNPUlJFQ1Q6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiaW5jb3JyZWN0XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbkFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbiA9IGdldEN1cnJlbnRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLnN0YXRlICE9PSBxdWVzdGlvbi5zdGF0ZXMuTk9UX0FOU1dFUkVEO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRBbnN3ZXJUZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbiA9IGdldEN1cnJlbnRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIFwiW1wiICsgZ2V0QW5zd2VyVG9RdWVzdGlvbihxdWVzdGlvbikgKyBcIl1cIjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKSArIDEgPD0gZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCkpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbk5vKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBzZXRDb3VudHJpZXM6IHNldENvdW50cmllcyxcclxuICAgICAgICAgICAgaXNRdWl6UnVubmluZzogaXNRdWl6UnVubmluZyxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyOiBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIsXHJcbiAgICAgICAgICAgIGdldE51bWJlck9mUXVpelF1ZXN0aW9uczogZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zLFxyXG4gICAgICAgICAgICBnZXRRdWVzdGlvblRleHQ6IGdldFF1ZXN0aW9uVGV4dCxcclxuICAgICAgICAgICAgZ2V0QW5zd2VyU3RhdHVzOiBnZXRBbnN3ZXJTdGF0dXMsXHJcbiAgICAgICAgICAgIGdldEFuc3dlclRleHQ6IGdldEFuc3dlclRleHQsXHJcbiAgICAgICAgICAgIHN1Ym1pdEFuc3dlcjogc3VibWl0QW5zd2VyLFxyXG4gICAgICAgICAgICBxdWVzdGlvbkFuc3dlcmVkOiBxdWVzdGlvbkFuc3dlcmVkLFxyXG4gICAgICAgICAgICBuZXh0UXVlc3Rpb246IG5leHRRdWVzdGlvblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmlsdGVyKCdyZW5kZXJIdG1sJywgW1wiJHNjZVwiLCBmdW5jdGlvbigkc2NlKSB7XHJcbiAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWw7XHJcbiAgICB9XSk7XG5hbmd1bGFyLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbmZpZyhbXCIkbG9jYXRpb25Qcm92aWRlclwiLCBcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbiAgICAgICAgLy8gZW5hYmxlIEhUTUw1IHB1c2hzdGF0ZVxyXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2hvbWUnKTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hvbWUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvaG9tZS5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncXVpeicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9xdWl6JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3F1aXoucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL2xvZ2luLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9nb3V0JyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dvdXRDdHJsJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3JlZ2lzdGVyLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdhYm91dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hYm91dCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9hYm91dC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1VzZXJTcnYnLCBbXCIkaHR0cFwiLCBcIkF1dGhUb2tlblNydlwiLCBmdW5jdGlvbigkaHR0cCwgQXV0aFRva2VuU3J2KSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXInKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlckZyb21TdG9yYWdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhUb2tlblNydi5nZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbih0b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGdldFVzZXIoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBubyB0b2tlbiwgd2UgcmVqZWN0IHRoZSBwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gdG9rZW4gaW4gc3RvcmFnZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb24nLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IHJlc3BvbnNlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2F2ZSB0b2tlbiBsb2NhbGx5XHJcbiAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4oc2VsZi50b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFVzZXIoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnRva2VuID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyByZW1vdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRVc2VyOiBnZXRVc2VyLFxyXG4gICAgICAgICAgICBnZXRVc2VyRnJvbVN0b3JhZ2U6IGdldFVzZXJGcm9tU3RvcmFnZSxcclxuICAgICAgICAgICAgbG9naW46IGxvZ2luLFxyXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dFxyXG4gICAgICAgIH1cclxuICAgIH1dKTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFRva2VuU3J2JywgZnVuY3Rpb24oJHdpbmRvdykge1xyXG4gICAgICAgIHZhciBzdG9yZSA9ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2U7XHJcbiAgICAgICAgdmFyIGtleSA9ICdhdXRoLXRva2VuJztcclxuXHJcbiAgICAgICAgdmFyIGdldFRva2VuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNldFRva2VuID0gZnVuY3Rpb24odG9rZW4pIHtcclxuICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5zZXRJdGVtKGtleSwgdG9rZW4pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUucmVtb3ZlSXRlbShrZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0VG9rZW46IGdldFRva2VuLFxyXG4gICAgICAgICAgICBzZXRUb2tlbjogc2V0VG9rZW5cclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIGZ1bmN0aW9uKEF1dGhUb2tlblNydikge1xyXG4gICAgICAgIHZhciBhZGRUb2tlbiA9IGZ1bmN0aW9uKGNvbmZpZykge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydYLUF1dGgnXSA9IHRva2VuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGFkZFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdDb3VudHJ5U3J2JywgZnVuY3Rpb24oJGh0dHAsIEluZGV4ZWREQlNydiwgTG9nU3J2KSB7XHJcbiAgICAgICAgLy8gQ291bnRyaWVzIGFycmF5XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIEluZGV4ZWREQlxyXG4gICAgICAgIHZhciBkYXRhYmFzZSA9ICdtYWdlbGxhbic7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJ2NvdW50cnlTdG9yZSc7XHJcbiAgICAgICAgdmFyIGtleUNvdW50cmllcyA9ICdjb3VudHJpZXMnO1xyXG4gICAgICAgIHZhciBrZXlWZXJzaW9uID0gJ3ZlcnNpb24nO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gSW5kZXhlZERCU3J2LmluZGV4ZWREQkF2YWlsYWJsZSgpO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZENvdW50cmllcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkQ291bnRyaWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGluZGV4ZWREQiBpcyBhdmFpbGFibGVcclxuICAgICAgICAgICAgaWYgKGluZGV4ZWREQkF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBkYXRhYmFzZSBleGlzdHNcclxuICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYuY3JlYXRlRGF0YWJhc2UoZGF0YWJhc2UsIHN0b3JlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFbXB0eU9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0SW50ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFeHRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGRldGVybWluZUxvYWRTdHJhdGVneSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obG9hZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzID0gb2JqWydjb3VudHJpZXMnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbyhcImxvYWRlZCBjb3VudHJpZXMgZnJvbVwiLCBvYmpbJ2xvYWRTdHJhdGVneSddLnRvVXBwZXJDYXNlKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiZmFpbGVkIHRvIGxvYWQgY291bnRyaWVzXCIsIGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBub3QsIHdlIGFsd2F5cyB0cnkgdG8gZG93bmxvYWQgaXQgZnJvbSB0aGUgY291bnRyeSBBUEkgZW5kcG9pbnRcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRDb3VudHJpZXNGcm9tQVBJKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5ID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaW50ZXJuYWxWZXJzaW9uID0gb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGV4dGVybmFsVmVyc2lvbiA9IG9ialtcImV4dGVybmFsVmVyc2lvblwiXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaW50ZXJuYWxWZXJzaW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ZXJuYWxWZXJzaW9uID4gaW50ZXJuYWxWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnZGInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIG9ialsnbG9hZFN0cmF0ZWd5J10gPSBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkRGF0YSA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyYXRlZ3kgPSBvYmpbJ2xvYWRTdHJhdGVneSddO1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdhcGknOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDb3VudHJpZXNGcm9tQVBJKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGNvdW50cmllcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmUgY291bnRyaWVzIGFuZCB2ZXJzaW9uIG51bWJlciBpbiBkYXRhYmFzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlDb3VudHJpZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAgY291bnRyaWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlWZXJzaW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdkYic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21EQihvYmopXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihfb2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfb2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ1Vua25vd24gbG9hZCBzdHJhdGVneScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RW1wdHlPYmplY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7fSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRJbnRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleVZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBpdGVtLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0ZXJuYWxWZXJzaW9uID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRWZXJzaW9uRnJvbUFQSSgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbih2ZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdID0gdmVyc2lvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNGcm9tREIgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleUNvdW50cmllcylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21BUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdW50cmllcycpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRWZXJzaW9uRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzL3ZlcnNpb24nKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YS52ZXJzaW9uIHx8IDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdEcm9wZG93bkN0cmwnLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkc2NvcGUudG9nZ2xlRHJvcGRvd24gPSB0b2dnbGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuc2hvd0Ryb3Bkb3duID0gc2hvd0Ryb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5oaWRlRHJvcGRvd24gPSBoaWRlRHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmlzRHJvcGRvd25WaXNpYmxlID0gaXNEcm9wZG93blZpc2libGU7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gIXZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93RHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGlkZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0Ryb3Bkb3duVmlzaWJsZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZpc2libGU7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0ZvY3VzU3J2JywgZnVuY3Rpb24oJHRpbWVvdXQsICR3aW5kb3cpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaWQpIHtcclxuICAgICAgICAgICAgLy8gdGltZW91dCBtYWtlcyBzdXJlIHRoYXQgaXMgaW52b2tlZCBhZnRlciBhbnkgb3RoZXIgZXZlbnQgaGFzIGJlZW4gdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAvLyBlLmcuIGNsaWNrIGV2ZW50cyB0aGF0IG5lZWQgdG8gcnVuIGJlZm9yZSB0aGUgZm9jdXMgb3JcclxuICAgICAgICAgICAgLy8gaW5wdXRzIGVsZW1lbnRzIHRoYXQgYXJlIGluIGEgZGlzYWJsZWQgc3RhdGUgYnV0IGFyZSBlbmFibGVkIHdoZW4gdGhvc2UgZXZlbnRzXHJcbiAgICAgICAgICAgIC8vIGFyZSB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdJbmRleGVkREJTcnYnLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIGtleVBhdGggPSAnbmFtZSc7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREIgPSAkd2luZG93LmluZGV4ZWREQiB8fCAkd2luZG93LndlYmtpdEluZGV4ZWREQiB8fCAkd2luZG93Lm1zSW5kZXhlZERCO1xyXG4gICAgICAgIHZhciBJREJLZXlSYW5nZSA9ICR3aW5kb3cuSURCS2V5UmFuZ2UgfHwgJHdpbmRvdy53ZWJraXRJREJLZXlSYW5nZTtcclxuXHJcbiAgICAgICAgdmFyIElEQlRyYW5zYWN0aW9uID0gJHdpbmRvdy5JREJUcmFuc2FjdGlvbiB8fCAkd2luZG93LndlYmtpdElEQlRyYW5zYWN0aW9uO1xyXG5cclxuICAgICAgICBpZiAoSURCVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSA9IElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgfHwgJ3JlYWR3cml0ZSc7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSA9IElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSB8fCAncmVhZG9ubHknO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5kZXhlZERCID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBlIGlzIGFuIGluc3RhbmNlIG9mIElEQlZlcnNpb25DaGFuZ2VFdmVudFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IGlkYi5jcmVhdGVPYmplY3RTdG9yZShzdG9yZU5hbWUsIHsga2V5UGF0aDoga2V5UGF0aCB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkLCB1cGRhdGUsIGRlbGV0ZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZHJvcERhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBzdWNjZXNzZnVsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3AgZmFpbGVkXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFkZEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLmFkZChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwdXRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5wdXQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW1OYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IElEQktleVJhbmdlLm9ubHkoaXRlbU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKHJhbmdlKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gY3Vyc29yLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW1zID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjcmVhdGVEYXRhYmFzZTogY3JlYXRlRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGRyb3BEYXRhYmFzZTogZHJvcERhdGFiYXNlLFxyXG4gICAgICAgICAgICBhZGRJdGVtOiBhZGRJdGVtLFxyXG4gICAgICAgICAgICBwdXRJdGVtOiBwdXRJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW06IHJldHJpZXZlSXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtczogcmV0cmlldmVJdGVtcyxcclxuICAgICAgICAgICAgaW5kZXhlZERCQXZhaWxhYmxlOiBpbmRleGVkREJBdmFpbGFibGVcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0xvZ1NydicsIGZ1bmN0aW9uKEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBsb2dJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuaW5mb1wiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dFcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmVycm9yXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbmZvOiBsb2dJbmZvLFxyXG4gICAgICAgICAgICBlcnJvcjogbG9nRXJyb3JcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgVXNlclNydi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ2luIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBub3RpZnkgdXNlciBhYm91dCBlcnJvciBpbiBsb2dpbiBwcm9jZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCd1c2VybmFtZScpO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ291dEN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTcnYpIHtcclxuICAgICAgICBVc2VyU3J2LmxvZ291dCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcGxpY2F0aW9uIGNvbnRyb2wgYWJvdXQgbG9nb3V0IGV2ZW50XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dvdXQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9KTsiLCIvLyBvd24gY2xhc3NlcyBhbmQgZnVuY3Rpb25zXHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVSVogLS0tLS0tLS0tLVxyXG52YXIgUXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gcXVlc3Rpb25zIGFycmF5XHJcbiAgICB2YXIgcXVlc3Rpb25zID0gW107XHJcblxyXG4gICAgLy8gZmxhZyBpbmRpY2F0aW5nIGlmIHF1aXogaXMgY3VycmVudGx5IGFjdGl2ZVxyXG4gICAgdmFyIGFjdGl2ZSA9IHRydWU7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgcXVlc3Rpb24gdG8gdGhlIHF1ZXN0aW9ucyBhcnJheVxyXG4gICAgICogQHBhcmFtIHF1ZXN0aW9uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYWRkUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgIHF1ZXN0aW9ucy5wdXNoKHF1ZXN0aW9uKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmlzQWN0aXZlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGFjdGl2ZTtcclxuICAgIH07XHJcbn07XHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVRVNUSU9OIC0tLS0tLS0tLS1cclxudmFyIFF1ZXN0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlIHx8IHRoaXMuZ2V0UmFuZG9tVHlwZSgpO1xyXG4gICAgdGhpcy5jb3VudHJ5ID0gb3B0aW9ucy5jb3VudHJ5IHx8IG51bGw7XHJcbiAgICB0aGlzLnN0YXRlID0gb3B0aW9ucy5zdGF0ZSB8fCB0aGlzLnN0YXRlcy5OT1RfQU5TV0VSRUQ7XHJcbn07XHJcblxyXG5RdWVzdGlvbi5wcm90b3R5cGUuc3RhdGVzID0ge1xyXG4gICAgXCJOT1RfQU5TV0VSRURcIjogMSxcclxuICAgIFwiQ09SUkVDVFwiOiAyLFxyXG4gICAgXCJJTkNPUlJFQ1RcIjogM1xyXG59O1xyXG5cclxuUXVlc3Rpb24ucHJvdG90eXBlLnR5cGVzID0ge1xyXG4gICAgXCJDQVBJVEFMX09GX0NPVU5UUllcIjogXCJjYXBpdGFsLW9mLWNvdW50cnlcIixcclxuICAgIFwiQ09VTlRSWV9PRl9DQVBJVEFMXCI6IFwiY291bnRyeS1vZi1jYXBpdGFsXCIsXHJcbiAgICBcIklOSEFCSVRBTlRTX09GX0NPVU5UUllcIjogXCJpbmhhYml0YW50cy1vZi1jb3VudHJ5XCJcclxufTtcclxuXHJcblF1ZXN0aW9uLnByb3RvdHlwZS5nZXRSYW5kb21UeXBlID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgdHlwZXMgPSBPYmplY3Qua2V5cyh0aGlzLnR5cGVzKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy50eXBlc1t0eXBlc1tnZXRSYW5kb21JbnQoMCwgdHlwZXMubGVuZ3RoIC0gMSldXTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gKGluY2x1c2l2ZSkgYW5kIG1heCAoaW5jbHVzaXZlKVxyXG4gKiBVc2luZyBNYXRoLnJvdW5kKCkgd2lsbCBnaXZlIHlvdSBhIG5vbi11bmlmb3JtIGRpc3RyaWJ1dGlvbiFcclxuICovXHJcbnZhciBnZXRSYW5kb21JbnQgPSBmdW5jdGlvbihtaW4sIG1heCkge1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyB0aGUgdGV4dCBiZXR3ZWVuIHR3byBkZWxpbWl0aW5nIHRleHQgb2NjdXJyZW5jZXNcclxuICovXHJcbnZhciBnZXRTdHJpbmdCZXR3ZWVuID0gZnVuY3Rpb24odGV4dCwgZmlyc3RTdHJpbmcsIHNlY29uZFN0cmluZykge1xyXG4gICAgdmFyIGZpcnN0UG9zID0gdGV4dC5pbmRleE9mKGZpcnN0U3RyaW5nKTtcclxuICAgIHZhciBzZWNvbmRQb3MgPSB0ZXh0LmluZGV4T2Yoc2Vjb25kU3RyaW5nKTtcclxuXHJcbiAgICBpZiAoZmlyc3RQb3MgPj0gMCAmJiBzZWNvbmRQb3MgPj0gMCAmJiBzZWNvbmRQb3MgPiBmaXJzdFBvcykge1xyXG4gICAgICAgIHJldHVybiB0ZXh0LnN1YnN0cihmaXJzdFBvcyArIDEsIHNlY29uZFBvcyAtIGZpcnN0UG9zIC0gMSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn07XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2LCBGb2N1c1Nydikge1xyXG5cclxuICAgICAgICB2YXIgc3RhcnRRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIFF1aXpTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBGb2N1c1NydignYW5zd2VyJyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihcIkNvdWxkIG5vdCBzdGFydCBxdWl6XCIsIGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaXNRdWl6UnVubmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5pc1F1aXpSdW5uaW5nKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvblRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlbmRlclF1ZXN0aW9uKFF1aXpTcnYuZ2V0UXVlc3Rpb25UZXh0KCksIFwicXVlc3Rpb24taGlnaGxpZ2h0XCIpICsgXCI/XCI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEFuc3dlclRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlbmRlclF1ZXN0aW9uKFF1aXpTcnYuZ2V0QW5zd2VyVGV4dCgpLCBcImFuc3dlci1oaWdobGlnaHQtXCIgKyBRdWl6U3J2LmdldEFuc3dlclN0YXR1cygpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25BbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5xdWVzdGlvbkFuc3dlcmVkKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgcmVuZGVyUXVlc3Rpb24gPSBmdW5jdGlvbih0ZXh0LCBjbGFzc05hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRleHRcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwiW1wiLCBcIjxzcGFuIGNsYXNzPSdcIiArIGNsYXNzTmFtZSArIFwiJz5cIilcclxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwiXVwiLCBcIjwvc3Bhbj5cIik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHN1Ym1pdEFuc3dlciA9IGZ1bmN0aW9uKGFuc3dlcikge1xyXG4gICAgICAgICAgICBpZiAoYW5zd2VyKSB7XHJcbiAgICAgICAgICAgICAgICBRdWl6U3J2LnN1Ym1pdEFuc3dlcihhbnN3ZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uQW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYucXVlc3Rpb25BbnN3ZXJlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBuZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnF1LmFuc3dlciA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICBRdWl6U3J2Lm5leHRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgRm9jdXNTcnYoJ2Fuc3dlcicpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoYW5kbGVLZXlQcmVzcyA9IGZ1bmN0aW9uKGtleUV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChrZXlFdmVudC53aGljaCA9PSAxMykge1xyXG4gICAgICAgICAgICAgICAgc3VibWl0QW5zd2VyKCRzY29wZS5xdS5hbnN3ZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnN0YXJ0UXVpeiA9IHN0YXJ0UXVpejtcclxuICAgICAgICAkc2NvcGUuaXNRdWl6UnVubmluZyA9IGlzUXVpelJ1bm5pbmc7XHJcbiAgICAgICAgJHNjb3BlLmdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcjtcclxuICAgICAgICAkc2NvcGUuZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zID0gZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zO1xyXG4gICAgICAgICRzY29wZS5nZXRRdWVzdGlvblRleHQgPSBnZXRRdWVzdGlvblRleHQ7XHJcbiAgICAgICAgJHNjb3BlLmdldEFuc3dlclRleHQgPSBnZXRBbnN3ZXJUZXh0O1xyXG4gICAgICAgICRzY29wZS5zdWJtaXRBbnN3ZXIgPSBzdWJtaXRBbnN3ZXI7XHJcbiAgICAgICAgJHNjb3BlLnF1ZXN0aW9uQW5zd2VyZWQgPSBxdWVzdGlvbkFuc3dlcmVkO1xyXG4gICAgICAgICRzY29wZS5uZXh0UXVlc3Rpb24gPSBuZXh0UXVlc3Rpb247XHJcbiAgICAgICAgJHNjb3BlLmhhbmRsZUtleVByZXNzID0gaGFuZGxlS2V5UHJlc3M7XHJcblxyXG4gICAgICAgICRzY29wZS5xdSA9IHtcclxuICAgICAgICAgICAgYW5zd2VyOiBcIlwiXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnUXVpelNydicsIGZ1bmN0aW9uKEFwcENvbmZpZywgTG9nU3J2KSB7XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBxdWl6ID0gbnVsbDtcclxuICAgICAgICB2YXIgY3VycmVudFF1ZXN0aW9uTm8gPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNvdW50cmllc0xvYWRlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiQ291bnRyaWVzIG5vdCBsb2FkZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHF1aXogIT09IG51bGwgJiYgcXVpei5pc0FjdGl2ZSgpID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiQSBxdWl6IGlzIGN1cnJlbnRseSBiZWluZyBwbGF5ZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIHF1aXogb2JqZWN0XHJcbiAgICAgICAgICAgICAgICBxdWl6ID0gbmV3IFF1aXooKTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IEFwcENvbmZpZ1sncXVpei5xdWVzdGlvbnMubnVtYmVyJ107IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHF1aXouYWRkUXVlc3Rpb24obmV3IFF1ZXN0aW9uKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeTogZ2V0UmFuZG9tQ291bnRyeSgpXHJcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbk5vID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZXRDb3VudHJpZXMgPSBmdW5jdGlvbihfY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgIGNvdW50cmllcyA9IF9jb3VudHJpZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFJhbmRvbUNvdW50cnkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllc1tnZXRSYW5kb21JbnQoMCwgY291bnRyaWVzLmxlbmd0aCAtIDEpXTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY291bnRyaWVzTG9hZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXMgIT09IG51bGwgJiYgY291bnRyaWVzLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHF1aXogIT09IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5nZXRRdWVzdGlvbnMoKVtjdXJyZW50UXVlc3Rpb25Ob107XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFF1ZXN0aW9uTm8gIT09IG51bGwgPyBjdXJyZW50UXVlc3Rpb25ObyArIDEgOiBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHF1aXogIT09IG51bGwgPyBxdWl6LmdldFF1ZXN0aW9ucygpLmxlbmd0aCA6IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHN1Ym1pdEFuc3dlciA9IGZ1bmN0aW9uKGFuc3dlcikge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBjb3JyZWN0QW5zd2VyID0gZ2V0QW5zd2VyVG9RdWVzdGlvbihxdWVzdGlvbik7XHJcblxyXG4gICAgICAgICAgICBxdWVzdGlvbi5zdGF0ZSA9IGFuc3dlciA9PT0gY29ycmVjdEFuc3dlciA/IHF1ZXN0aW9uLnN0YXRlcy5DT1JSRUNUIDogcXVlc3Rpb24uc3RhdGVzLklOQ09SUkVDVDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25UZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbiA9IGdldEN1cnJlbnRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChxdWVzdGlvbi50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnR5cGVzLkNBUElUQUxfT0ZfQ09VTlRSWTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgaGVpw590IGRpZSBIYXVwdHN0YWR0IHZvbiBbXCIgKyAocXVlc3Rpb24uY291bnRyeS50cmFuc2xhdGlvbnMuZGUgfHwgcXVlc3Rpb24uY291bnRyeS5uYW1lKSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuQ09VTlRSWV9PRl9DQVBJVEFMOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIltcIiArIHF1ZXN0aW9uLmNvdW50cnkuY2FwaXRhbCArIFwiXSBpc3QgZGllIEhhdXB0c3RhZHQgdm9uIHdlbGNoZW0gTGFuZFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuSU5IQUJJVEFOVFNfT0ZfQ09VTlRSWTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgdmllbGUgRWlud29obmVyIGhhdCBbXCIgKyAocXVlc3Rpb24uY291bnRyeS50cmFuc2xhdGlvbnMuZGUgfHwgcXVlc3Rpb24uY291bnRyeS5uYW1lKSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiVW5rbm93biBxdWVzdGlvbiB0eXBlXCIsIHF1ZXN0aW9uLnR5cGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEFuc3dlclRvUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgICAgICBpZiAoIXF1ZXN0aW9uIHx8ICFxdWVzdGlvbi50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAocXVlc3Rpb24udHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5DQVBJVEFMX09GX0NPVU5UUlk6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmNvdW50cnkuY2FwaXRhbDtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnR5cGVzLkNPVU5UUllfT0ZfQ0FQSVRBTDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uY291bnRyeS50cmFuc2xhdGlvbnMuZGUgfHwgcXVlc3Rpb24uY291bnRyeS5uYW1lO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuSU5IQUJJVEFOVFNfT0ZfQ09VTlRSWTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uY291bnRyeS5wb3B1bGF0aW9uO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiVW5rbm93biBxdWVzdGlvbiB0eXBlXCIsIHF1ZXN0aW9uLnR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEFuc3dlclN0YXR1cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHF1ZXN0aW9uLnN0YXRlO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChzdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi5zdGF0ZXMuQ09SUkVDVDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJjb3JyZWN0XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi5zdGF0ZXMuSU5DT1JSRUNUOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImluY29ycmVjdFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25BbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5zdGF0ZSAhPT0gcXVlc3Rpb24uc3RhdGVzLk5PVF9BTlNXRVJFRDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QW5zd2VyVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBcIltcIiArIGdldEFuc3dlclRvUXVlc3Rpb24ocXVlc3Rpb24pICsgXCJdXCI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCkgKyAxIDw9IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50UXVlc3Rpb25ObysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5pdDogaW5pdCxcclxuICAgICAgICAgICAgc2V0Q291bnRyaWVzOiBzZXRDb3VudHJpZXMsXHJcbiAgICAgICAgICAgIGlzUXVpelJ1bm5pbmc6IGlzUXVpelJ1bm5pbmcsXHJcbiAgICAgICAgICAgIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcjogZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyLFxyXG4gICAgICAgICAgICBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnM6IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyxcclxuICAgICAgICAgICAgZ2V0UXVlc3Rpb25UZXh0OiBnZXRRdWVzdGlvblRleHQsXHJcbiAgICAgICAgICAgIGdldEFuc3dlclN0YXR1czogZ2V0QW5zd2VyU3RhdHVzLFxyXG4gICAgICAgICAgICBnZXRBbnN3ZXJUZXh0OiBnZXRBbnN3ZXJUZXh0LFxyXG4gICAgICAgICAgICBzdWJtaXRBbnN3ZXI6IHN1Ym1pdEFuc3dlcixcclxuICAgICAgICAgICAgcXVlc3Rpb25BbnN3ZXJlZDogcXVlc3Rpb25BbnN3ZXJlZCxcclxuICAgICAgICAgICAgbmV4dFF1ZXN0aW9uOiBuZXh0UXVlc3Rpb25cclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZpbHRlcigncmVuZGVySHRtbCcsIGZ1bmN0aW9uKCRzY2UpIHtcclxuICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbDtcclxuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbiAgICAgICAgLy8gZW5hYmxlIEhUTUw1IHB1c2hzdGF0ZVxyXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2hvbWUnKTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hvbWUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvaG9tZS5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncXVpeicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9xdWl6JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3F1aXoucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL2xvZ2luLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9nb3V0JyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dvdXRDdHJsJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3JlZ2lzdGVyLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdhYm91dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hYm91dCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9hYm91dC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1VzZXJTcnYnLCBmdW5jdGlvbigkaHR0cCwgQXV0aFRva2VuU3J2KSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXInKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlckZyb21TdG9yYWdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhUb2tlblNydi5nZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbih0b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGdldFVzZXIoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBubyB0b2tlbiwgd2UgcmVqZWN0IHRoZSBwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gdG9rZW4gaW4gc3RvcmFnZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb24nLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IHJlc3BvbnNlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2F2ZSB0b2tlbiBsb2NhbGx5XHJcbiAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4oc2VsZi50b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFVzZXIoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnRva2VuID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyByZW1vdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRVc2VyOiBnZXRVc2VyLFxyXG4gICAgICAgICAgICBnZXRVc2VyRnJvbVN0b3JhZ2U6IGdldFVzZXJGcm9tU3RvcmFnZSxcclxuICAgICAgICAgICAgbG9naW46IGxvZ2luLFxyXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dFxyXG4gICAgICAgIH1cclxuICAgIH0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
