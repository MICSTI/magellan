var magellan=angular.module("magellan",["ui.router","ngProgress"],["$httpProvider",function(n){n.interceptors.push("AuthInterceptor")}]);magellan.constant("AppConfig",{"log.info":!0,"log.error":!0,"quiz.country.questions":16,"quiz.country.types":{1:"CAPITAL_OF_COUNTRY",2:"COUNTRY_OF_CAPITAL",3:"POPULATION_OF_COUNTRY",4:"AREA_OF_COUNTRY"}}),magellan.controller("AppCtrl",["$scope","$state","UserSrv","CountrySrv","QuizSrv",function(n,t,e,r,o){n.app={config:{title:"Magellan",subtitle:"Test your knowledge about the countries of our world",author:"Michael Stifter"}},e.getUserFromStorage().then(function(t){n.user=t,r.init().then(function(t){n.$broadcast("countries.loaded",t),o.setCountries(t)})})["catch"](function(n){}),n.isProgressBarVisible=function(){return t.is("quiz")},n.$on("app.login",function(e,u){n.user=u,r.init().then(function(t){n.$broadcast("countries.loaded",t),o.setCountries(t)}),t.go("quiz")}),n.$on("app.logout",function(e,r){n.user=null,t.go("home")})}]);var Quiz=function(){var n=null,t=[];this.start=function(){if(t.length<=0)throw Error("Cannot start a quiz without questions");return this.nextQuestion()},this.isActive=function(){return this.hasStarted()&&!this.hasEnded()},this.hasStarted=function(){return null!==n},this.hasEnded=function(){return this.hasStarted()&&n>=t.length},this.addQuestion=function(n){if(void 0===n)throw Error("No question object passed");var e=!0,r=["config","hint","solution","answer","question","getInfo","info","points","answered","hintsAllowed","hintsRemaining"];r.forEach(function(t){if(!n.hasOwnProperty(t))throw e=!1,new Error("Question must have property '"+t+"'")}),e&&t.push(n)},this.nextQuestion=function(){return null===n?n=0:n++,this.hasEnded()?this.isActive():t[n]},this.currentQuestion=function(){return this.isActive()?t[n]:null},this.getTotalPoints=function(){if(!this.hasStarted())return null;var n=0;return t.forEach(function(t){var e=t.points();void 0!==e&&(n+=e)}),n},this.getCurrentQuestionNumber=function(){return null===n?null:n+1},this.getNumberOfQuestions=function(){return t.length}},Question=function(n){var t=null,e=null,r=null,o=null,u=0,i=null,a=null,s=!1,l=function(n){t=n.text,e=n.info||{},r=n.answer,i=n.checkAnswer||null,o=n.hints||{allowed:!1,maximum:0,cost:0,give:null}};n&&l(n),this.config=function(n){l(n)},this.question=function(){return t},this.info=function(n,t){return void 0===t?e[n]:void(e[n]=t)},this.getInfo=function(){return e},this.solution=function(){return s?r:null},this.hint=function(){if(!o.allowed||u>=o.maximum)return null;if(o.allowed&&!o.give)throw new Error("Hints allowed but no give method passed");return u++,o.give(u,r)},this.answer=function(n){if(!s&&i)return s=!0,a=i(r,n,e),o.allowed&&u>0&&(a-=u*o.cost),Math.max(0,a)},this.points=function(){if(s&&null!==a)return a},this.answered=function(){return s},this.hintsAllowed=function(){return null!==o?o.allowed:null},this.hintsRemaining=function(){var n=this.hintsAllowed();return null===n||n===!1?null:o.maximum-u}},getRandomInt=function(n,t){return Math.floor(Math.random()*(t-n+1))+n},getStringBetween=function(n,t,e){var r=n.indexOf(t),o=n.indexOf(e);return r>=0&&o>=0&&o>r?n.substr(r+1,o-r-1):null};"undefined"!=typeof module&&module.exports&&(module.exports.Question=Question,module.exports.Quiz=Quiz),angular.module("magellan").config(["$locationProvider","$stateProvider","$urlRouterProvider",function(n,t,e){n.html5Mode(!0),e.otherwise("/home"),t.state("home",{url:"/home",templateUrl:"/build/views/partials/home.partial.html"}).state("quiz",{url:"/quiz",templateUrl:"/build/views/partials/quiz.partial.html"}).state("login",{url:"/login",templateUrl:"/build/views/partials/login.partial.html"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}).state("register",{url:"/register",templateUrl:"/build/views/partials/register.partial.html"}).state("about",{url:"/about",templateUrl:"/build/views/partials/about.partial.html"})}]),angular.module("magellan").controller("DropdownCtrl",["$scope",function(n){function t(){u=!u}function e(){u=!0}function r(){u=!1}function o(){return u}var u=!1;n.toggleDropdown=t,n.showDropdown=e,n.hideDropdown=r,n.isDropdownVisible=o,n.handleClickOutside=function(n){console.log("CLICKED OUTSIDE")}}]),angular.module("magellan").controller("LoginCtrl",["$scope","UserSrv","FocusSrv",function(n,t,e){n.login=function(e,r){t.login(e,r).then(function(t){n.$emit("app.login",t.data)})["catch"](function(n){console.error(n)})},e("username")}]),angular.module("magellan").controller("LogoutCtrl",["$scope","UserSrv",function(n,t){t.logout().then(function(){n.$emit("app.logout")})}]),angular.module("magellan").controller("QuizCtrl",["$scope","QuizSrv","LogSrv","FocusSrv","ngProgressFactory",function(n,t,e,r,o){n.progressbar=o.createInstance(),n.progressbar.setParent(document.getElementById("quiz-progress")),n.progressbar.setAbsolute(),n.progressbar.setColor("#336e7b");var u=null,i=function(){t.init().then(function(){e.info("Quiz started"),a()})["catch"](function(n){e.error(n)})},a=function(){u=t.getCurrentQuestion(),r("answer")},s=function(n,t){return n.replace("[","<span class='"+t+"'>").replace("]","</span>")},l=function(n){n&&(console.log(u.answer(n)),r("btnNextQuestion"))},c=function(t){13==t.which&&l(n.answerObj.answer)},f=function(){return t.isQuizRunning()},d=function(){return t.getCurrentQuestionNumber()},g=function(){return t.getNumberOfQuizQuestions()},h=function(){return!(!f()||null===u)&&u.answered()},m=function(){return null===u?null:s(u.question(),"question-highlight")+"?"},p=function(){return null===u?null:u.solution().correct},v=function(){t.nextQuestion(),n.answerObj.answer="",a()};n.startQuiz=i,n.isQuizRunning=f,n.getCurrentQuestionNumber=d,n.getNumberOfQuizQuestions=g,n.getQuestionText=m,n.getAnswerText=p,n.handleKeyPress=c,n.submitAnswer=l,n.questionAnswered=h,n.nextQuestion=v,n.answerObj={answer:""},a()}]),angular.module("magellan").filter("renderHtml",["$sce",function(n){return function(t){return n.trustAsHtml(t)}}]),angular.module("magellan").factory("AuthInterceptor",["AuthTokenSrv",function(n){var t=function(t){var e=n.getToken();return e&&(t.headers=t.headers||{},t.headers["X-Auth"]=e),t};return{request:t}}]),angular.module("magellan").factory("AuthTokenSrv",["$window",function(n){var t=n.sessionStorage,e="auth-token",r=function(){return t.getItem(e)},o=function(n){n?t.setItem(e,n):t.removeItem(e)};return{getToken:r,setToken:o}}]),angular.module("magellan").factory("CountrySrv",["$http","IndexedDBSrv","LogSrv",function(n,t,e){var r=null,o=null,u="magellan",i="countryStore",a="countries",s="version",l=t.indexedDBAvailable(),c=function(){return f()},f=function(){return l?new Promise(function(n,a){t.createDatabase(u,i).then(h).then(m).then(p).then(d).then(g).then(function(t){r=t.countries,e.info("loaded countries from",t.loadStrategy.toUpperCase()),o={},r.forEach(function(n){o[n.alpha3Code]=n}),n(r)})["catch"](function(n){e.error("failed to load countries",n),a(n)})}):w()},d=function(n){return new Promise(function(t,e){var r,o=n.internalVersion,u=n.externalVersion;r=null===o?"api":u>o?"api":"db",n.loadStrategy=r,t(n)})},g=function(n){return new Promise(function(e,r){var o=n.loadStrategy;switch(o){case"api":w().then(function(r){n.countries=r,t.putItem(u,i,{name:a,value:r}),t.putItem(u,i,{name:s,value:n.externalVersion}),e(n)})["catch"](function(n){r(n)});break;case"db":v(n).then(function(n){e(n)})["catch"](function(n){r(n)});break;default:r("Unknown load strategy")}})},h=function(){return new Promise(function(n,t){n({})})},m=function(n){return new Promise(function(e,r){t.retrieveItem(u,i,s).then(function(t){n.internalVersion=t.value,e(n)})["catch"](function(t){n.internalVersion=null,e(n)})})},p=function(n){return O().then(function(t){return n.externalVersion=t,n})},v=function(n){return new Promise(function(e,r){t.retrieveItem(u,i,a).then(function(t){n.countries=t.value,e(n)})["catch"](function(n){e(null)})})},w=function(){return new Promise(function(t,e){n.get("/api/countries").then(function(n){t(n.data)})["catch"](function(n){e(n)})})},O=function(){return new Promise(function(t,e){n.get("/api/countries/version").then(function(n){t(n.data.version||0)})["catch"](function(n){t(0)})})},A=function(n){return null===o?null:o[n]};return{init:c,getCountryByAlpha3:A}}]),angular.module("magellan").factory("FocusSrv",["$timeout","$window",function(n,t){return function(e){n(function(){var n=t.document.getElementById(e);n&&n.focus()})}}]),angular.module("magellan").factory("IndexedDBSrv",["$window",function(n){var t="name",e=n.indexedDB||n.webkitIndexedDB||n.msIndexedDB,r=n.IDBKeyRange||n.webkitIDBKeyRange,o=n.IDBTransaction||n.webkitIDBTransaction;o&&(o.READ_WRITE=o.READ_WRITE||"readwrite",o.READ_ONLY=o.READ_ONLY||"readonly");var u=function(){return!!e},i=function(n,r){return new Promise(function(o,u){var i=e.open(n);i.onupgradeneeded=function(n){var e=n.target.result;e.createObjectStore(r,{keyPath:t})},i.onsuccess=function(n){o(n)},i.onerror=function(n){u(n)}})},a=function(n){return new Promise(function(t,r){var o=e.deleteDatabase(n);o.onsuccess=function(n){t(n)},o.onerror=function(n){r(n)}})},s=function(n,t,r){return new Promise(function(u,i){var a=e.open(n);a.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_WRITE),s=a.objectStore(t),l=s.add(r);l.onsuccess=function(n){u(n)},l.onerror=function(n){i(n)}}})},l=function(n,t,r){return new Promise(function(u,i){var a=e.open(n);a.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_WRITE),s=a.objectStore(t),l=s.put(r);l.onsuccess=function(n){u(n)},l.onerror=function(n){i(n)}}})},c=function(n,t,u){return new Promise(function(i,a){var s=null,l=e.open(n);l.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_ONLY),l=a.objectStore(t),c=r.only(u);l.openCursor(c).onsuccess=function(n){var t=n.target.result;t?(s=t.value,t["continue"]()):i(s)}},l.onerror=function(n){a(n)}})},f=function(n,t){return new Promise(function(r,u){var i=[],a=e.open(n);a.onsuccess=function(n){var e=n.target.result,u=e.transaction(t,o.READ_ONLY),a=u.objectStore(t);a.openCursor().onsuccess=function(n){var t=n.target.result;t?(i.push(t.value),t["continue"]()):r(i)}},a.onerror=function(n){u(n)}})};return{createDatabase:i,dropDatabase:a,addItem:s,putItem:l,retrieveItem:c,retrieveItems:f,indexedDBAvailable:u}}]),angular.module("magellan").factory("LogSrv",["AppConfig",function(n){var t=function(){n["log.info"]&&console.log.apply(console,arguments)},e=function(){n["log.error"]&&console.error.apply(console,arguments)};return{info:t,error:e}}]),angular.module("magellan").factory("QuizSrv",["AppConfig","CountrySrv","LogSrv",function(n,t,e){var r=null,o=null,u=function(n){r=n},i=function(){return null!==r&&r.length>0},a=function(){return new Promise(function(n,t){i||t("Countries have not been loaded"),o=l("country"),n(o.start())})},s=function(){return null!==o&&o.hasStarted()},l=function(n){switch(n){case"country":default:return c()}},c=function(){for(var e=new Quiz,o=100,u=3,i=25,a=2.5,s=n["quiz.country.types"],l=Object.keys(s).length,c=[],m=n["quiz.country.questions"],p=0;p<m;p++){for(var v=!1;!v;){var w=r[getRandomInt(0,r.length-1)];v=c.indexOf(w.alpha3Code)<0}c.push(w.alpha3Code)}var O=0;return c.forEach(function(n){O++;var r=t.getCountryByAlpha3(n),c=s[getRandomInt(0,l-1)],p=f(c,r),v={type:c},w=d(c,r),A=g(c,o,a),b=h(c,u,i);O>=m&&(v.bonus=!0),e.addQuestion(new Question({text:p,info:v,answer:w,checkAnswer:A,hints:b}))}),e},f=function(n,t){switch(n){case"CAPITAL_OF_COUNTRY":return"Wie heißt die Hauptstadt von ["+t.name+"]";case"COUNTRY_OF_CAPITAL":return"["+t.capital+"] ist die Hauptstadt von welchem Land";case"POPULATION_OF_COUNTRY":return"Wie viele Menschen leben in ["+t.name+"]";case"AREA_OF_COUNTRY":return"Wie groß ist die Fläche von ["+t.name+"]";default:return"?"}},d=function(n,t){switch(n){case"CAPITAL_OF_COUNTRY":var e=void 0!==t.altSpellings&&void 0!==t.altSpellings.capital?t.altSpellings.capital:[];return{correct:t.capital,altSpellings:e};case"COUNTRY_OF_CAPITAL":var e=void 0!==t.altSpellings&&void 0!==t.altSpellings.name?t.altSpellings.name:[];return{correct:t.name,altSpellings:e};case"POPULATION_OF_COUNTRY":return{correct:t.population};case"AREA_OF_COUNTRY":return{correct:t.area};default:return"?"}},g=function(n,t,e){switch(n){case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":return function(n,r,o){var u=r===n.correct||n.altSpellings&&n.altSpellings.indexOf(r)>=0,i=u?t:0;return void 0!==o&&void 0!==o.bonus&&o.bonus===!0&&(i*=e),i};case"POPULATION_OF_COUNTRY":case"AREA_OF_COUNTRY":return function(n,t,r){var o,u=Math.abs(t-n.correct)/n.correct*100;return o=u<=3?100:u<=6?90:u<=9?80:u<=12?70:u<=14?60:u<=16?50:u<=18?40:u<=20?30:u<=25?20:u<=30?10:0,void 0!==r&&void 0!==r.bonus&&r.bonus===!0&&(o*=e),o};default:return"?"}},h=function(n,t,e){switch(n){case"CAPITAL_OF_COUNTRY":case"COUNTRY_OF_CAPITAL":return{allowed:!0,maximum:t,cost:e,give:function(n,t){return t.correct.substr(0,n)}};case"POPULATION_OF_COUNTRY":case"AREA_OF_COUNTRY":return{allowed:!1};default:return"?"}},m=function(){return s()?o.getCurrentQuestionNumber():null},p=function(){return s()?o.getNumberOfQuestions():null},v=function(){return s()?o.currentQuestion():null},w=function(){s()&&o.nextQuestion()};return{init:a,setCountries:u,isQuizRunning:s,getCurrentQuestionNumber:m,getNumberOfQuizQuestions:p,getCurrentQuestion:v,nextQuestion:w}}]),angular.module("magellan").factory("UserSrv",["$http","AuthTokenSrv",function(n,t){var e=this,r=function(){return n.get("/api/user")},o=function(){return new Promise(function(n,e){var o=t.getToken();o?(t.setToken(o),r().then(function(t){n(t.data)})["catch"](function(n){e(n)})):e("No token in storage")})},u=function(o,u){return n.post("/api/session",{username:o,password:u}).then(function(n){return e.token=n.data,t.setToken(e.token),r()})},i=function(){return new Promise(function(n,r){e.token=null,t.setToken(),n()})};return{getUser:r,getUserFromStorage:o,login:u,logout:i}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjcmlwdC5qcyIsIm1vZGVscy5qcyIsInJvdXRlcy5qcyIsImNvbnRyb2xsZXJzL2Ryb3Bkb3duLmN0cmwuanMiLCJjb250cm9sbGVycy9sb2dpbi5jdHJsLmpzIiwiY29udHJvbGxlcnMvbG9nb3V0LmN0cmwuanMiLCJjb250cm9sbGVycy9xdWl6LmN0cmwuanMiLCJmaWx0ZXJzL3JlbmRlckh0bWwuZmlsdGVyLmpzIiwiaW50ZXJjZXB0b3JzL2F1dGguaW50ZXJjZXB0b3IuanMiLCJzZXJ2aWNlcy9hdXRoLXRva2VuLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9jb3VudHJ5LnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9mb2N1cy5zZXJ2aWNlLmpzIiwic2VydmljZXMvaW5kZXhlZC1kYi5zZXJ2aWNlLmpzIiwic2VydmljZXMvbG9nLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9xdWl6LnNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyLnNlcnZpY2UuanMiXSwibmFtZXMiOlsibWFnZWxsYW4iLCJhbmd1bGFyIiwibW9kdWxlIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCJjb25zdGFudCIsImxvZy5pbmZvIiwibG9nLmVycm9yIiwicXVpei5jb3VudHJ5LnF1ZXN0aW9ucyIsInF1aXouY291bnRyeS50eXBlcyIsIjEiLCIyIiwiMyIsIjQiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJHN0YXRlIiwiVXNlclNydiIsIkNvdW50cnlTcnYiLCJRdWl6U3J2IiwiYXBwIiwiY29uZmlnIiwidGl0bGUiLCJzdWJ0aXRsZSIsImF1dGhvciIsImdldFVzZXJGcm9tU3RvcmFnZSIsInRoZW4iLCJ1c2VyIiwiaW5pdCIsImNvdW50cmllcyIsIiRicm9hZGNhc3QiLCJzZXRDb3VudHJpZXMiLCJlcnIiLCJpc1Byb2dyZXNzQmFyVmlzaWJsZSIsImlzIiwiJG9uIiwiZXZlbnQiLCJkYXRhIiwiZ28iLCJRdWl6IiwiY3VycmVudFF1ZXN0aW9uSWR4IiwicXVlc3Rpb25zIiwidGhpcyIsInN0YXJ0IiwibGVuZ3RoIiwiRXJyb3IiLCJuZXh0UXVlc3Rpb24iLCJpc0FjdGl2ZSIsImhhc1N0YXJ0ZWQiLCJoYXNFbmRlZCIsImFkZFF1ZXN0aW9uIiwicXVlc3Rpb24iLCJ1bmRlZmluZWQiLCJ2YWxpZCIsIm5lY2Vzc2FyeVByb3BlcnRpZXMiLCJmb3JFYWNoIiwicHJvcGVydHkiLCJoYXNPd25Qcm9wZXJ0eSIsImN1cnJlbnRRdWVzdGlvbiIsImdldFRvdGFsUG9pbnRzIiwidG90YWxQb2ludHMiLCJwb2ludHMiLCJnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIiLCJnZXROdW1iZXJPZlF1ZXN0aW9ucyIsIlF1ZXN0aW9uIiwib3B0aW9ucyIsInRleHQiLCJpbmZvIiwiYW5zd2VyIiwiaGludHMiLCJoaW50c1VzZWQiLCJjaGVja0Fuc3dlciIsImFuc3dlcmVkIiwib3B0cyIsImFsbG93ZWQiLCJtYXhpbXVtIiwiY29zdCIsImdpdmUiLCJwcm9wIiwidmFsdWUiLCJnZXRJbmZvIiwic29sdXRpb24iLCJoaW50Iiwic3VibWl0dGVkQW5zd2VyIiwiTWF0aCIsIm1heCIsImhpbnRzQWxsb3dlZCIsImhpbnRzUmVtYWluaW5nIiwiZ2V0UmFuZG9tSW50IiwibWluIiwiZmxvb3IiLCJyYW5kb20iLCJnZXRTdHJpbmdCZXR3ZWVuIiwiZmlyc3RTdHJpbmciLCJzZWNvbmRTdHJpbmciLCJmaXJzdFBvcyIsImluZGV4T2YiLCJzZWNvbmRQb3MiLCJzdWJzdHIiLCJleHBvcnRzIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsImh0bWw1TW9kZSIsIm90aGVyd2lzZSIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJ0b2dnbGVEcm9wZG93biIsInZpc2libGUiLCJzaG93RHJvcGRvd24iLCJoaWRlRHJvcGRvd24iLCJpc0Ryb3Bkb3duVmlzaWJsZSIsImhhbmRsZUNsaWNrT3V0c2lkZSIsImNvbnNvbGUiLCJsb2ciLCJGb2N1c1NydiIsImxvZ2luIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInJlc3BvbnNlIiwiJGVtaXQiLCJlcnJvciIsImxvZ291dCIsIkxvZ1NydiIsIm5nUHJvZ3Jlc3NGYWN0b3J5IiwicHJvZ3Jlc3NiYXIiLCJjcmVhdGVJbnN0YW5jZSIsInNldFBhcmVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJzZXRBYnNvbHV0ZSIsInNldENvbG9yIiwic3RhcnRRdWl6IiwidXBkYXRlUXVlc3Rpb24iLCJnZXRDdXJyZW50UXVlc3Rpb24iLCJyZW5kZXJRdWVzdGlvbiIsImNsYXNzTmFtZSIsInJlcGxhY2UiLCJzdWJtaXRBbnN3ZXIiLCJoYW5kbGVLZXlQcmVzcyIsImtleUV2ZW50Iiwid2hpY2giLCJhbnN3ZXJPYmoiLCJpc1F1aXpSdW5uaW5nIiwiZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zIiwicXVlc3Rpb25BbnN3ZXJlZCIsImdldFF1ZXN0aW9uVGV4dCIsImdldEFuc3dlclRleHQiLCJjb3JyZWN0IiwiZmlsdGVyIiwiJHNjZSIsInRydXN0QXNIdG1sIiwiZmFjdG9yeSIsIkF1dGhUb2tlblNydiIsImFkZFRva2VuIiwidG9rZW4iLCJnZXRUb2tlbiIsImhlYWRlcnMiLCJyZXF1ZXN0IiwiJHdpbmRvdyIsInN0b3JlIiwic2Vzc2lvblN0b3JhZ2UiLCJrZXkiLCJnZXRJdGVtIiwic2V0VG9rZW4iLCJzZXRJdGVtIiwicmVtb3ZlSXRlbSIsIiRodHRwIiwiSW5kZXhlZERCU3J2IiwiY291bnRyaWVzQnlBbHBoYTMiLCJkYXRhYmFzZSIsImtleUNvdW50cmllcyIsImtleVZlcnNpb24iLCJpbmRleGVkREJBdmFpbGFibGUiLCJsb2FkQ291bnRyaWVzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjcmVhdGVEYXRhYmFzZSIsImdldEVtcHR5T2JqZWN0IiwiZ2V0SW50ZXJuYWxWZXJzaW9uIiwiZ2V0RXh0ZXJuYWxWZXJzaW9uIiwiZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5IiwibG9hZERhdGEiLCJvYmoiLCJ0b1VwcGVyQ2FzZSIsImMiLCJnZXRDb3VudHJpZXNGcm9tQVBJIiwic3RyYXRlZ3kiLCJpbnRlcm5hbFZlcnNpb24iLCJleHRlcm5hbFZlcnNpb24iLCJwdXRJdGVtIiwibmFtZSIsImdldENvdW50cmllc0Zyb21EQiIsIl9vYmoiLCJyZXRyaWV2ZUl0ZW0iLCJpdGVtIiwiZ2V0VmVyc2lvbkZyb21BUEkiLCJ2ZXJzaW9uIiwiZ2V0IiwiZ2V0Q291bnRyeUJ5QWxwaGEzIiwiYWxwaGEzIiwiJHRpbWVvdXQiLCJpZCIsImVsZW1lbnQiLCJmb2N1cyIsImtleVBhdGgiLCJpbmRleGVkREIiLCJ3ZWJraXRJbmRleGVkREIiLCJtc0luZGV4ZWREQiIsIklEQktleVJhbmdlIiwid2Via2l0SURCS2V5UmFuZ2UiLCJJREJUcmFuc2FjdGlvbiIsIndlYmtpdElEQlRyYW5zYWN0aW9uIiwiUkVBRF9XUklURSIsIlJFQURfT05MWSIsImRiTmFtZSIsInN0b3JlTmFtZSIsIm9wZW4iLCJvbnVwZ3JhZGVuZWVkZWQiLCJlIiwiaWRiIiwidGFyZ2V0IiwicmVzdWx0IiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJvbnN1Y2Nlc3MiLCJvbmVycm9yIiwiZHJvcERhdGFiYXNlIiwiZGVsZXRlRGF0YWJhc2UiLCJhZGRJdGVtIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsInJlcXVlc3RBZGQiLCJhZGQiLCJwdXQiLCJpdGVtTmFtZSIsInJhbmdlIiwib25seSIsIm9wZW5DdXJzb3IiLCJjdXJzb3IiLCJyZXRyaWV2ZUl0ZW1zIiwiaXRlbXMiLCJBcHBDb25maWciLCJsb2dJbmZvIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJsb2dFcnJvciIsInF1aXoiLCJfY291bnRyaWVzIiwiY291bnRyaWVzTG9hZGVkIiwiY3JlYXRlUXVpeiIsInF1aXpUeXBlIiwiY3JlYXRlQ291bnRyeVF1aXoiLCJjb3VudHJ5UXVpeiIsImZ1bGxQb2ludHMiLCJoaW50TWF4aW11bSIsImhpbnRDb3N0IiwibGFzdFF1ZXN0aW9uQm9udXMiLCJxdWVzdGlvblR5cGVzIiwicXVlc3Rpb25UeXBlc0xlbmd0aCIsIk9iamVjdCIsImtleXMiLCJzZWxlY3RlZENvdW50cmllcyIsIm51bWJlck9mUXVlc3Rpb25zIiwiaSIsImNvdW50cnlPayIsImNvdW50cnkiLCJxY250IiwicXVlc3Rpb25UeXBlIiwidHlwZSIsImdldFF1ZXN0aW9uQW5zd2VyIiwiZ2V0Q2hlY2tBbnN3ZXJMYW1iZGEiLCJnZXRRdWVzdGlvbkhpbnRzIiwiY2FwaXRhbCIsImFsdFNwZWxsaW5ncyIsInBvcHVsYXRpb24iLCJhcmVhIiwiYm9udXMiLCJlcnJvclBlcmNlbnRhZ2UiLCJhYnMiLCJoaW50c1Bvc3NpYmxlIiwic2VsZiIsImdldFVzZXIiLCJwb3N0Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxVQUFBQyxRQUFBQyxPQUFBLFlBQ0EsWUFDQSxlQ0NJLGdCREFKLFNBQUFDLEdBQ0FBLEVBQUFDLGFBQUFDLEtBQUEscUJBSUFMLFVBQUFNLFNBQUEsYUFDQUMsWUFBQSxFQUNBQyxhQUFBLEVBRUFDLHlCQUFBLEdBQ0FDLHNCQUNBQyxFQUFBLHFCQUNBQyxFQUFBLHFCQUNBQyxFQUFBLHdCQUNBQyxFQUFBLHFCQUlBZCxTQUFBZSxXQUFBLFdBQUEsU0FBQSxTQUFBLFVBQUEsYUFBQSxVQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFKLEVBQUFLLEtBQ0FDLFFBQ0FDLE1BQUEsV0FDQUMsU0FBQSx1REFDQUMsT0FBQSxvQkFLQVAsRUFBQVEscUJBQ0FDLEtBQUEsU0FBQUMsR0FFQVosRUFBQVksS0FBQUEsRUFHQVQsRUFBQVUsT0FDQUYsS0FBQSxTQUFBRyxHQUNBZCxFQUFBZSxXQUFBLG1CQUFBRCxHQUdBVixFQUFBWSxhQUFBRixPQVhBWixTQWNBLFNBQUFlLE1BSUFqQixFQUFBa0IscUJBQUEsV0FDQSxNQUFBakIsR0FBQWtCLEdBQUEsU0FJQW5CLEVBQUFvQixJQUFBLFlBQUEsU0FBQUMsRUFBQUMsR0FFQXRC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QUlBa0osRUFBQSwwQkFLQTdELEVBQUEsU0FBQUMsRUFBQUMsR0FDQSxNQUFBaUQsR0FBQW9ILEtBQUEsZ0JBQ0F0SyxTQUFBQSxFQUNBQyxTQUFBQSxJQUNBN0YsS0FBQSxTQUFBOEYsR0FNQSxNQUxBa0ssR0FBQTlILE1BQUFwQyxFQUFBbkYsS0FHQXFILEVBQUFXLFNBQUFxSCxFQUFBOUgsT0FFQStILE9BSUFoSyxFQUFBLFdBQ0EsTUFBQSxJQUFBcUQsU0FBQSxTQUFBQyxFQUFBQyxHQUNBd0csRUFBQTlILE1BQUEsS0FHQUYsRUFBQVcsV0FFQVksTUFJQSxRQUNBMEcsUUFBQUEsRUFDQWxRLG1CQUFBQSxFQUNBNEYsTUFBQUEsRUFDQU0sT0FBQUEiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIG1hZ2VsbGFuID0gYW5ndWxhci5tb2R1bGUoXCJtYWdlbGxhblwiLCBbXHJcbiAgICAndWkucm91dGVyJyxcclxuICAgICduZ1Byb2dyZXNzJ1xyXG5dLCBmdW5jdGlvbiBjb25maWcoJGh0dHBQcm92aWRlcikge1xyXG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXV0aEludGVyY2VwdG9yJyk7XHJcbn0pO1xyXG5cclxuLy8gZGVmaW5lIGFwcGxpY2F0aW9uIGNvbnN0YW50c1xyXG5tYWdlbGxhbi5jb25zdGFudChcIkFwcENvbmZpZ1wiLCB7XHJcbiAgICBcImxvZy5pbmZvXCI6IHRydWUsXHJcbiAgICBcImxvZy5lcnJvclwiOiB0cnVlLFxyXG5cclxuICAgIFwicXVpei5jb3VudHJ5LnF1ZXN0aW9uc1wiOiAxNixcclxuICAgIFwicXVpei5jb3VudHJ5LnR5cGVzXCI6IHtcclxuICAgICAgICAxOiBcIkNBUElUQUxfT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDI6IFwiQ09VTlRSWV9PRl9DQVBJVEFMXCIsXHJcbiAgICAgICAgMzogXCJQT1BVTEFUSU9OX09GX0NPVU5UUllcIixcclxuICAgICAgICA0OiBcIkFSRUFfT0ZfQ09VTlRSWVwiXHJcbiAgICB9XHJcbn0pO1xyXG5cclxubWFnZWxsYW4uY29udHJvbGxlcihcIkFwcEN0cmxcIiwgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIFVzZXJTcnYsIENvdW50cnlTcnYsIFF1aXpTcnYpIHtcclxuICAgIC8vIC0tLS0tLS0tLS0tIEFwcCBjb25maWcgLS0tLS0tLS0tLS0tXHJcbiAgICAkc2NvcGUuYXBwID0ge1xyXG4gICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICB0aXRsZTogXCJNYWdlbGxhblwiLFxyXG4gICAgICAgICAgICBzdWJ0aXRsZTogXCJUZXN0IHlvdXIga25vd2xlZGdlIGFib3V0IHRoZSBjb3VudHJpZXMgb2Ygb3VyIHdvcmxkXCIsXHJcbiAgICAgICAgICAgIGF1dGhvcjogXCJNaWNoYWVsIFN0aWZ0ZXJcIlxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGluaXRpYWxpemF0aW9uIC0tLS0tLS0tLS0tLVxyXG4gICAgVXNlclNydi5nZXRVc2VyRnJvbVN0b3JhZ2UoKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgLy8gc3RvcmUgdXNlciBvYmplY3QgaW4gc2NvcGVcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xyXG5cclxuICAgICAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICAgICAgQ291bnRyeVNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGNvdW50cmllcyBpbiBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICBRdWl6U3J2LnNldENvdW50cmllcyhjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgIC8vIHRoZSBvbmx5IGVycm9yIHRoYXQgY2FuIG9jY3VyIGlzIHRoYXQgdGhlcmUgaXMgbm8gdG9rZW4gaW4gc3RvcmFnZSwgd2UgZG8gbm90IG5lZWQgdG8gcmVhY3QgdG8gdGhhdFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICRzY29wZS5pc1Byb2dyZXNzQmFyVmlzaWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiAkc3RhdGUuaXMoJ3F1aXonKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gRXZlbnQgaGFuZGxpbmcgLS0tLS0tLS0tLS0tXHJcbiAgICAkc2NvcGUuJG9uKCdhcHAubG9naW4nLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHN0b3JlIHVzZXIgb2JqZWN0IGluIHNjb3BlXHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBkYXRhO1xyXG5cclxuICAgICAgICAvLyBpbml0IGNvdW50cnkgc2VydmljZVxyXG4gICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2NvdW50cmllcy5sb2FkZWQnLCBjb3VudHJpZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICBRdWl6U3J2LnNldENvdW50cmllcyhjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gZ28gdG8gcXVpeiBwYWdlXHJcbiAgICAgICAgJHN0YXRlLmdvKCdxdWl6Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuJG9uKCdhcHAubG9nb3V0JywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyByZW1vdmUgdXNlciBvYmplY3QgZnJvbSBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gZ28gdG8gaG9tZSBwYWdlXHJcbiAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XHJcbiAgICB9KTtcclxufSk7IiwidmFyIG1hZ2VsbGFuID0gYW5ndWxhci5tb2R1bGUoXCJtYWdlbGxhblwiLCBbXHJcbiAgICAndWkucm91dGVyJyxcclxuICAgICduZ1Byb2dyZXNzJ1xyXG5dLCBbXCIkaHR0cFByb3ZpZGVyXCIsIGZ1bmN0aW9uIGNvbmZpZygkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdBdXRoSW50ZXJjZXB0b3InKTtcclxufV0pO1xyXG5cclxuLy8gZGVmaW5lIGFwcGxpY2F0aW9uIGNvbnN0YW50c1xyXG5tYWdlbGxhbi5jb25zdGFudChcIkFwcENvbmZpZ1wiLCB7XHJcbiAgICBcImxvZy5pbmZvXCI6IHRydWUsXHJcbiAgICBcImxvZy5lcnJvclwiOiB0cnVlLFxyXG5cclxuICAgIFwicXVpei5jb3VudHJ5LnF1ZXN0aW9uc1wiOiAxNixcclxuICAgIFwicXVpei5jb3VudHJ5LnR5cGVzXCI6IHtcclxuICAgICAgICAxOiBcIkNBUElUQUxfT0ZfQ09VTlRSWVwiLFxyXG4gICAgICAgIDI6IFwiQ09VTlRSWV9PRl9DQVBJVEFMXCIsXHJcbiAgICAgICAgMzogXCJQT1BVTEFUSU9OX09GX0NPVU5UUllcIixcclxuICAgICAgICA0OiBcIkFSRUFfT0ZfQ09VTlRSWVwiXHJcbiAgICB9XHJcbn0pO1xyXG5cclxubWFnZWxsYW4uY29udHJvbGxlcihcIkFwcEN0cmxcIiwgW1wiJHNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiVXNlclNydlwiLCBcIkNvdW50cnlTcnZcIiwgXCJRdWl6U3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBVc2VyU3J2LCBDb3VudHJ5U3J2LCBRdWl6U3J2KSB7XHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgY29uZmlnIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLmFwcCA9IHtcclxuICAgICAgICBjb25maWc6IHtcclxuICAgICAgICAgICAgdGl0bGU6IFwiTWFnZWxsYW5cIixcclxuICAgICAgICAgICAgc3VidGl0bGU6IFwiVGVzdCB5b3VyIGtub3dsZWRnZSBhYm91dCB0aGUgY291bnRyaWVzIG9mIG91ciB3b3JsZFwiLFxyXG4gICAgICAgICAgICBhdXRob3I6IFwiTWljaGFlbCBTdGlmdGVyXCJcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEFwcCBpbml0aWFsaXphdGlvbiAtLS0tLS0tLS0tLS1cclxuICAgIFVzZXJTcnYuZ2V0VXNlckZyb21TdG9yYWdlKClcclxuICAgICAgICAudGhlbihmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICAgIC8vIHN0b3JlIHVzZXIgb2JqZWN0IGluIHNjb3BlXHJcbiAgICAgICAgICAgICRzY29wZS51c2VyID0gdXNlcjtcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAvLyB0aGUgb25seSBlcnJvciB0aGF0IGNhbiBvY2N1ciBpcyB0aGF0IHRoZXJlIGlzIG5vIHRva2VuIGluIHN0b3JhZ2UsIHdlIGRvIG5vdCBuZWVkIHRvIHJlYWN0IHRvIHRoYXRcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUuaXNQcm9ncmVzc0JhclZpc2libGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gJHN0YXRlLmlzKCdxdWl6Jyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEV2ZW50IGhhbmRsaW5nIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ2luJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIHF1aXogcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygncXVpeicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ291dCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gcmVtb3ZlIHVzZXIgb2JqZWN0IGZyb20gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfSk7XHJcbn1dKTtcbi8vIG93biBjbGFzc2VzIGFuZCBmdW5jdGlvbnNcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVJWiAtLS0tLS0tLS0tXHJcbnZhciBRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBpbmRleCBvZiBjdXJyZW50IHF1ZXN0aW9uXHJcbiAgICB2YXIgY3VycmVudFF1ZXN0aW9uSWR4ID0gbnVsbDtcclxuXHJcbiAgICAvLyBhcnJheSBjb250YWluaW5nIGFsbCBxdWVzdGlvbnNcclxuICAgIHZhciBxdWVzdGlvbnMgPSBbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN0YXJ0cyB0aGUgcXVpei5cclxuICAgICAqL1xyXG4gICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIGNoZWNrIGlmIHF1aXogaGFzIHF1ZXN0aW9uc1xyXG4gICAgICAgIGlmIChxdWVzdGlvbnMubGVuZ3RoIDw9IDApXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHN0YXJ0IGEgcXVpeiB3aXRob3V0IHF1ZXN0aW9uc1wiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaXNBY3RpdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNTdGFydGVkKCkgJiYgIXRoaXMuaGFzRW5kZWQoKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbklkeCAhPT0gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhc1N0YXJ0ZWQoKSAmJiBjdXJyZW50UXVlc3Rpb25JZHggPj0gcXVlc3Rpb25zLmxlbmd0aDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IHF1ZXN0aW9uIHRvIHRoZSBxdWl6LlxyXG4gICAgICogVGhlIHBhcmFtZXRlciBtdXN0IGJlIGFuIHF1ZXN0aW9uIG9iamVjdC5cclxuICAgICAqIElmIG5vIHF1ZXN0aW9uIG9iamVjdCBpcyBwYXNzZWQgb3IgYW4gb2JqZWN0IHdpdGggbWlzc2luZyBwcm9wZXJ0aWVzLCBhbiBlcnJvciBpcyB0aHJvd24uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYWRkUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgIGlmIChxdWVzdGlvbiA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIk5vIHF1ZXN0aW9uIG9iamVjdCBwYXNzZWRcIik7XHJcblxyXG4gICAgICAgIHZhciB2YWxpZCA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGEgcXVlc3Rpb24gb2JqZWN0IG11c3QgY29udGFpbiBhbGwgdGhlc2UgcHJvcGVydGllc1xyXG4gICAgICAgIHZhciBuZWNlc3NhcnlQcm9wZXJ0aWVzID0gWydjb25maWcnLCAnaGludCcsICdzb2x1dGlvbicsICdhbnN3ZXInLCAncXVlc3Rpb24nLCAnZ2V0SW5mbycsICdpbmZvJywgJ3BvaW50cycsICdhbnN3ZXJlZCcsICdoaW50c0FsbG93ZWQnLCAnaGludHNSZW1haW5pbmcnXTtcclxuXHJcbiAgICAgICAgbmVjZXNzYXJ5UHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIGlmICghcXVlc3Rpb24uaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUXVlc3Rpb24gbXVzdCBoYXZlIHByb3BlcnR5ICdcIiArIHByb3BlcnR5ICsgXCInXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh2YWxpZCkge1xyXG4gICAgICAgICAgICBxdWVzdGlvbnMucHVzaChxdWVzdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG5leHQgcXVlc3Rpb24gb2YgdGhlIHF1aXouXHJcbiAgICAgKiBJZiB0aGUgcXVpeiBoYXMgZW5kZWQsIGl0IHJldHVybnMgbm90aGluZy5cclxuICAgICAqL1xyXG4gICAgdGhpcy5uZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uSWR4ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbklkeCA9IDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSWR4Kys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzQWN0aXZlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbklkeF07XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuY3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzQWN0aXZlKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbklkeF07XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0VG90YWxQb2ludHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmhhc1N0YXJ0ZWQoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciB0b3RhbFBvaW50cyA9IDA7XHJcblxyXG4gICAgICAgIHF1ZXN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBwb2ludHMgPSBxdWVzdGlvbi5wb2ludHMoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwb2ludHMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdG90YWxQb2ludHMgKz0gcG9pbnRzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0b3RhbFBvaW50cztcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uSWR4ID09PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbklkeCArIDE7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0TnVtYmVyT2ZRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zLmxlbmd0aDtcclxuICAgIH07XHJcbn07XHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVRVNUSU9OIC0tLS0tLS0tLS1cclxudmFyIFF1ZXN0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG4gICAgLy8gVGV4dCBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciB0ZXh0ID0gbnVsbDtcclxuXHJcbiAgICAvLyBJbmZvIG9iamVjdCBmb3IgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgaW5mbyA9IG51bGw7XHJcblxyXG4gICAgLy8gQW5zd2VyIG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGFuc3dlciA9IG51bGw7XHJcblxyXG4gICAgLy8gSGludHMgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgaGludHMgPSBudWxsO1xyXG4gICAgdmFyIGhpbnRzVXNlZCA9IDA7XHJcblxyXG4gICAgLy8gTGFtYmRhIGZ1bmN0aW9uIHRvIGRldGVybWluZSB0aGUgYW5zd2VyIHN0YXR1cyBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBjaGVja0Fuc3dlciA9IG51bGw7XHJcblxyXG4gICAgLy8gUG9pbnRzIGF3YXJkZWQgZm9yIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIHBvaW50cyA9IG51bGw7XHJcblxyXG4gICAgLy8gRmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgcXVlc3Rpb24gaGFzIGFscmVhZHkgYmVlbiBhbnN3ZXJlZFxyXG4gICAgdmFyIGFuc3dlcmVkID0gZmFsc2U7XHJcblxyXG4gICAgdmFyIGluaXQgPSBmdW5jdGlvbihvcHRzKSB7XHJcbiAgICAgICAgdGV4dCA9IG9wdHMudGV4dDtcclxuICAgICAgICBpbmZvID0gb3B0cy5pbmZvIHx8IHt9O1xyXG4gICAgICAgIGFuc3dlciA9IG9wdHMuYW5zd2VyO1xyXG4gICAgICAgIGNoZWNrQW5zd2VyID0gb3B0cy5jaGVja0Fuc3dlciB8fCBudWxsO1xyXG5cclxuICAgICAgICBoaW50cyA9IG9wdHMuaGludHMgfHwge1xyXG4gICAgICAgICAgICAgICAgYWxsb3dlZDogZmFsc2UsICAgICAvLyBpcyBhIGhpbnQgYWxsb3dlZD9cclxuICAgICAgICAgICAgICAgIG1heGltdW06IDAsICAgICAgICAgLy8gbWF4aW11bSBudW1iZXIgb2YgaGludHMgZm9yIHRoaXMgcXVlc3Rpb24gKGlycmVsZXZhbnQgaWYgYWxsb3dlZCBpcyBzZXQgdG8gZmFsc2UpXHJcbiAgICAgICAgICAgICAgICBjb3N0OiAwLCAgICAgICAgICAgIC8vIG51bWJlciBvZiBwb2ludHMgc3VidHJhY3RlZCBwZXIgdXNlZCBoaW50IChpcnJlbGV2YW50IGlmIGFsbG93ZWQgaXMgc2V0IHRvIGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgZ2l2ZTogbnVsbCAgICAgICAgICAvLyBsYW1iZGEgZnVuY3Rpb24gdG8gZ2l2ZSBhIGhpbnQgZm9yIGEgcXVlc3Rpb25cclxuICAgICAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgICBpbml0KG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY29uZmlnID0gZnVuY3Rpb24ob3B0cykge1xyXG4gICAgICAgIGluaXQob3B0cyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgcXVlc3Rpb24gdGV4dC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5xdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0ZXh0O1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHF1ZXN0aW9uIGluZm8gb2JqZWN0LlxyXG4gICAgICogQWN0cyBhcyBnZXR0ZXIgKHdpdGggb25seSBvbmUgYXJndW1lbnQpIGFuZCBzZXR0ZXIgKHdpdGggdHdvIGFyZ3VtZW50cylcclxuICAgICAqL1xyXG4gICAgdGhpcy5pbmZvID0gZnVuY3Rpb24ocHJvcCwgdmFsdWUpIHtcclxuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAvLyBzZXR0ZXJcclxuICAgICAgICAgICAgaW5mb1twcm9wXSA9IHZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGdldHRlclxyXG4gICAgICAgICAgICByZXR1cm4gaW5mb1twcm9wXTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgZW50aXJlIGluZm8gb2JqZWN0LlxyXG4gICAgICovXHJcbiAgICB0aGlzLmdldEluZm8gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gaW5mbztcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBjb3JyZWN0IGFuc3dlciB0byB0aGUgcXVlc3Rpb24gYWZ0ZXIgdGhlIHF1ZXN0aW9uIGhhcyBiZWVuIGFuc3dlcmVkLlxyXG4gICAgICogSWYgdGhlIHF1ZXN0aW9uIGhhcyBub3QgYmVlbiBhbnN3ZXJlZCB5ZXQsIGl0IHJldHVybnMgbnVsbC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5zb2x1dGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChhbnN3ZXJlZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYW5zd2VyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIGhpbnQgZm9yIHRoZSBxdWVzdGlvbi5cclxuICAgICAqIElmIG5vIGhpbnRzIGFyZSBhbGxvd2VkLCBvciB0aGUgbWF4aW11bSBudW1iZXIgb2YgaGludHMgaGF2ZSBiZWVuIHVzZWQsIG51bGwgaXMgcmV0dXJuZWQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaGludCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICghaGludHMuYWxsb3dlZCB8fCBoaW50c1VzZWQgPj0gaGludHMubWF4aW11bSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChoaW50cy5hbGxvd2VkICYmICFoaW50cy5naXZlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhpbnRzIGFsbG93ZWQgYnV0IG5vIGdpdmUgbWV0aG9kIHBhc3NlZFwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGhpbnRzVXNlZCsrO1xyXG5cclxuICAgICAgICByZXR1cm4gaGludHMuZ2l2ZShoaW50c1VzZWQsIGFuc3dlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3VibWl0cyBhbiBhbnN3ZXIgdG8gdGhlIHF1ZXN0aW9uLlxyXG4gICAgICogSWYgdGhlIHF1ZXN0aW9uIGhhcyBhbHJlYWR5IGJlZW4gYW5zd2VyZWQgb3Igbm8gY2hlY2tBbnN3ZXIgbGFtYmRhIGhhcyBiZWVuIHNldCwgdGhpcyBtZXRob2QgZG9lcyBub3RoaW5nLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmFuc3dlciA9IGZ1bmN0aW9uKHN1Ym1pdHRlZEFuc3dlcikge1xyXG4gICAgICAgIGlmIChhbnN3ZXJlZCB8fCFjaGVja0Fuc3dlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhbnN3ZXJlZCA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGNoZWNrQW5zd2VyIG1ldGhvZCBzaG91bGQgcmV0dXJuIHRoZSBzdGF0dXMgcmVzdWx0c1xyXG4gICAgICAgIHBvaW50cyA9IGNoZWNrQW5zd2VyKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBpbmZvKTtcclxuXHJcbiAgICAgICAgLy8gaWYgaGludHMgYXJlIGFsbG93ZWQgYW5kIGhhdmUgYmVlbiB1c2VkLCBzdWJ0cmFjdCB0aGUgcG9pbnRzXHJcbiAgICAgICAgaWYgKGhpbnRzLmFsbG93ZWQgJiYgaGludHNVc2VkID4gMCkge1xyXG4gICAgICAgICAgICBwb2ludHMgLT0gKGhpbnRzVXNlZCAqIGhpbnRzLmNvc3QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZW5zdXJlIHRoYXQgbm8gbmVnYXRpdmUgcG9pbnRzIGFyZSBhd2FyZGVkXHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIHBvaW50cyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCFhbnN3ZXJlZCB8fCBwb2ludHMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHN0YXRlIG9mIHRoZSBxdWVzdGlvbi5cclxuICAgICAqL1xyXG4gICAgdGhpcy5hbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBhbnN3ZXJlZDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgaGludHMgYXJlIGFsbG93ZWQgZm9yIHRoaXMgcXVlc3Rpb24sIGZhbHNlIGlmIG5vdC5cclxuICAgICAqIElmIGhpbnRzIGhhdmUgbm90IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmhpbnRzQWxsb3dlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaGludHMuYWxsb3dlZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiByZW1haW5pbmcgaGludHMuXHJcbiAgICAgKiBJZiBubyBoaW50cyBhcmUgYWxsb3dlZCBmb3IgdGhpcyBxdWVzdGlvbiwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50c1JlbWFpbmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhbGxvd2VkID0gdGhpcy5oaW50c0FsbG93ZWQoKTtcclxuXHJcbiAgICAgICAgaWYgKGFsbG93ZWQgPT09IG51bGwgfHwgYWxsb3dlZCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gaGludHMubWF4aW11bSAtIGhpbnRzVXNlZDtcclxuICAgIH07XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyBhIHJhbmRvbSBpbnRlZ2VyIGJldHdlZW4gbWluIChpbmNsdXNpdmUpIGFuZCBtYXggKGluY2x1c2l2ZSlcclxuICogVXNpbmcgTWF0aC5yb3VuZCgpIHdpbGwgZ2l2ZSB5b3UgYSBub24tdW5pZm9ybSBkaXN0cmlidXRpb24hXHJcbiAqL1xyXG52YXIgZ2V0UmFuZG9tSW50ID0gZnVuY3Rpb24obWluLCBtYXgpIHtcclxuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgdGhlIHRleHQgYmV0d2VlbiB0d28gZGVsaW1pdGluZyB0ZXh0IG9jY3VycmVuY2VzXHJcbiAqL1xyXG52YXIgZ2V0U3RyaW5nQmV0d2VlbiA9IGZ1bmN0aW9uKHRleHQsIGZpcnN0U3RyaW5nLCBzZWNvbmRTdHJpbmcpIHtcclxuICAgIHZhciBmaXJzdFBvcyA9IHRleHQuaW5kZXhPZihmaXJzdFN0cmluZyk7XHJcbiAgICB2YXIgc2Vjb25kUG9zID0gdGV4dC5pbmRleE9mKHNlY29uZFN0cmluZyk7XHJcblxyXG4gICAgaWYgKGZpcnN0UG9zID49IDAgJiYgc2Vjb25kUG9zID49IDAgJiYgc2Vjb25kUG9zID4gZmlyc3RQb3MpIHtcclxuICAgICAgICByZXR1cm4gdGV4dC5zdWJzdHIoZmlyc3RQb3MgKyAxLCBzZWNvbmRQb3MgLSBmaXJzdFBvcyAtIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cy5RdWVzdGlvbiA9IFF1ZXN0aW9uO1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuUXVpeiA9IFF1aXo7XHJcbn1cbmFuZ3VsYXIubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29uZmlnKFtcIiRsb2NhdGlvblByb3ZpZGVyXCIsIFwiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgZnVuY3Rpb24oJGxvY2F0aW9uUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgICAgICAvLyBlbmFibGUgSFRNTDUgcHVzaHN0YXRlXHJcbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG5cclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvaG9tZScpO1xyXG5cclxuICAgICAgICAkc3RhdGVQcm92aWRlclxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hvbWUnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvaG9tZScsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9ob21lLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdxdWl6Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3F1aXonLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvcXVpei5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvbG9naW4ucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ291dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9sb2dvdXQnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ291dEN0cmwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncmVnaXN0ZXInLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvcmVnaXN0ZXInLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvcmVnaXN0ZXIucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2Fib3V0Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2Fib3V0JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2Fib3V0LnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignRHJvcGRvd25DdHJsJywgW1wiJHNjb3BlXCIsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG4gICAgICAgIHZhciB2aXNpYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICRzY29wZS50b2dnbGVEcm9wZG93biA9IHRvZ2dsZURyb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5zaG93RHJvcGRvd24gPSBzaG93RHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmhpZGVEcm9wZG93biA9IGhpZGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuaXNEcm9wZG93blZpc2libGUgPSBpc0Ryb3Bkb3duVmlzaWJsZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmhhbmRsZUNsaWNrT3V0c2lkZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ0xJQ0tFRCBPVVRTSURFXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSAhdmlzaWJsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dEcm9wZG93bigpIHtcclxuICAgICAgICAgICAgdmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoaWRlRHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzRHJvcGRvd25WaXNpYmxlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmlzaWJsZTtcclxuICAgICAgICB9XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTG9naW5DdHJsJywgW1wiJHNjb3BlXCIsIFwiVXNlclNydlwiLCBcIkZvY3VzU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgVXNlclNydi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ2luIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBub3RpZnkgdXNlciBhYm91dCBlcnJvciBpbiBsb2dpbiBwcm9jZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCd1c2VybmFtZScpO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ291dEN0cmwnLCBbXCIkc2NvcGVcIiwgXCJVc2VyU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydikge1xyXG4gICAgICAgIFVzZXJTcnYubG9nb3V0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dvdXQgZXZlbnRcclxuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ291dCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6Q3RybCcsIFtcIiRzY29wZVwiLCBcIlF1aXpTcnZcIiwgXCJMb2dTcnZcIiwgXCJGb2N1c1NydlwiLCBcIm5nUHJvZ3Jlc3NGYWN0b3J5XCIsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2LCBGb2N1c1NydiwgbmdQcm9ncmVzc0ZhY3RvcnkpIHtcclxuXHJcbiAgICAgICAgLy8gUHJvZ3Jlc3MgYmFyIGluaXRpYWxpemF0aW9uXHJcbiAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyID0gbmdQcm9ncmVzc0ZhY3RvcnkuY3JlYXRlSW5zdGFuY2UoKTtcclxuICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0UGFyZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXByb2dyZXNzJykpO1xyXG4gICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRBYnNvbHV0ZSgpO1xyXG4gICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXRDb2xvcihcIiMzMzZlN2JcIik7XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbiA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBzdGFydFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5pbmZvKFwiUXVpeiBzdGFydGVkXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVRdWVzdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB1cGRhdGVRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBxdWVzdGlvbiA9IFF1aXpTcnYuZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICBGb2N1c1NydignYW5zd2VyJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJlbmRlclF1ZXN0aW9uID0gZnVuY3Rpb24odGV4dCwgY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIltcIiwgXCI8c3BhbiBjbGFzcz0nXCIgKyBjbGFzc05hbWUgKyBcIic+XCIpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIl1cIiwgXCI8L3NwYW4+XCIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzdWJtaXRBbnN3ZXIgPSBmdW5jdGlvbihzdWJtaXR0ZWRBbnN3ZXIpIHtcclxuICAgICAgICAgICAgaWYgKHN1Ym1pdHRlZEFuc3dlcikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocXVlc3Rpb24uYW5zd2VyKHN1Ym1pdHRlZEFuc3dlcikpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNldCBwcm9ncmVzcyBiYXJcclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLnByb2dyZXNzYmFyLnNldCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNldCBmb2N1cyB0byBuZXh0IHF1ZXN0aW9uIGJ1dHRvblxyXG4gICAgICAgICAgICAgICAgRm9jdXNTcnYoJ2J0bk5leHRRdWVzdGlvbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhbmRsZUtleVByZXNzID0gZnVuY3Rpb24oa2V5RXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGtleUV2ZW50LndoaWNoID09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJtaXRBbnN3ZXIoJHNjb3BlLmFuc3dlck9iai5hbnN3ZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuaXNRdWl6UnVubmluZygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25BbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSB8fCBxdWVzdGlvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uYW5zd2VyZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25UZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWVzdGlvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJRdWVzdGlvbihxdWVzdGlvbi5xdWVzdGlvbigpLCAncXVlc3Rpb24taGlnaGxpZ2h0JykgKyBcIj9cIjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QW5zd2VyVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVlc3Rpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uc29sdXRpb24oKS5jb3JyZWN0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBuZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5uZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hbnN3ZXJPYmouYW5zd2VyID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgIHVwZGF0ZVF1ZXN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnN0YXJ0UXVpeiA9IHN0YXJ0UXVpejtcclxuICAgICAgICAkc2NvcGUuaXNRdWl6UnVubmluZyA9IGlzUXVpelJ1bm5pbmc7XHJcbiAgICAgICAgJHNjb3BlLmdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcjtcclxuICAgICAgICAkc2NvcGUuZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zID0gZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zO1xyXG4gICAgICAgICRzY29wZS5nZXRRdWVzdGlvblRleHQgPSBnZXRRdWVzdGlvblRleHQ7XHJcbiAgICAgICAgJHNjb3BlLmdldEFuc3dlclRleHQgPSBnZXRBbnN3ZXJUZXh0O1xyXG4gICAgICAgICRzY29wZS5oYW5kbGVLZXlQcmVzcyA9IGhhbmRsZUtleVByZXNzO1xyXG4gICAgICAgICRzY29wZS5zdWJtaXRBbnN3ZXIgPSBzdWJtaXRBbnN3ZXI7XHJcbiAgICAgICAgJHNjb3BlLnF1ZXN0aW9uQW5zd2VyZWQgPSBxdWVzdGlvbkFuc3dlcmVkO1xyXG4gICAgICAgICRzY29wZS5uZXh0UXVlc3Rpb24gPSBuZXh0UXVlc3Rpb247XHJcblxyXG4gICAgICAgICRzY29wZS5hbnN3ZXJPYmogPSB7XHJcbiAgICAgICAgICAgIGFuc3dlcjogXCJcIlxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWxseSB0cnkgdG8gdXBkYXRlIHF1ZXN0aW9uXHJcbiAgICAgICAgdXBkYXRlUXVlc3Rpb24oKTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5maWx0ZXIoJ3JlbmRlckh0bWwnLCBbXCIkc2NlXCIsIGZ1bmN0aW9uKCRzY2UpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbCh0ZXh0KTtcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIFtcIkF1dGhUb2tlblNydlwiLCBmdW5jdGlvbihBdXRoVG9rZW5TcnYpIHtcclxuICAgICAgICB2YXIgYWRkVG9rZW4gPSBmdW5jdGlvbihjb25maWcpIHtcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFRva2VuU3J2LmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snWC1BdXRoJ10gPSB0b2tlbjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0OiBhZGRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFRva2VuU3J2JywgW1wiJHdpbmRvd1wiLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZTtcclxuICAgICAgICB2YXIga2V5ID0gJ2F1dGgtdG9rZW4nO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0VG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnNldEl0ZW0oa2V5LCB0b2tlbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRUb2tlbjogZ2V0VG9rZW4sXHJcbiAgICAgICAgICAgIHNldFRva2VuOiBzZXRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQ291bnRyeVNydicsIFtcIiRodHRwXCIsIFwiSW5kZXhlZERCU3J2XCIsIFwiTG9nU3J2XCIsIGZ1bmN0aW9uKCRodHRwLCBJbmRleGVkREJTcnYsIExvZ1Nydikge1xyXG4gICAgICAgIC8vIENvdW50cmllcyBhcnJheVxyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgY291bnRyaWVzQnlBbHBoYTMgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBJbmRleGVkREJcclxuICAgICAgICB2YXIgZGF0YWJhc2UgPSAnbWFnZWxsYW4nO1xyXG4gICAgICAgIHZhciBzdG9yZSA9ICdjb3VudHJ5U3RvcmUnO1xyXG4gICAgICAgIHZhciBrZXlDb3VudHJpZXMgPSAnY291bnRyaWVzJztcclxuICAgICAgICB2YXIga2V5VmVyc2lvbiA9ICd2ZXJzaW9uJztcclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IEluZGV4ZWREQlNydi5pbmRleGVkREJBdmFpbGFibGUoKTtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvYWRDb3VudHJpZXMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9hZENvdW50cmllcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBjaGVjayBpZiBpbmRleGVkREIgaXMgYXZhaWxhYmxlXHJcbiAgICAgICAgICAgIGlmIChpbmRleGVkREJBdmFpbGFibGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgZGF0YWJhc2UgZXhpc3RzXHJcbiAgICAgICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LmNyZWF0ZURhdGFiYXNlKGRhdGFiYXNlLCBzdG9yZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0RW1wdHlPYmplY3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldEludGVybmFsVmVyc2lvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0RXh0ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihkZXRlcm1pbmVMb2FkU3RyYXRlZ3kpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGxvYWREYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllcyA9IG9ialsnY291bnRyaWVzJ107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmluZm8oXCJsb2FkZWQgY291bnRyaWVzIGZyb21cIiwgb2JqWydsb2FkU3RyYXRlZ3knXS50b1VwcGVyQ2FzZSgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGRpdGlvbmFsbHkgbWFwIGNvdW50cmllcyBieSBhbHBoYTMgY29kZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlBbHBoYTMgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXMuZm9yRWFjaChmdW5jdGlvbihjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzQnlBbHBoYTNbY1snYWxwaGEzQ29kZSddXSA9IGM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihcImZhaWxlZCB0byBsb2FkIGNvdW50cmllc1wiLCBlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgbm90LCB3ZSBhbHdheXMgdHJ5IHRvIGRvd25sb2FkIGl0IGZyb20gdGhlIGNvdW50cnkgQVBJIGVuZHBvaW50XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q291bnRyaWVzRnJvbUFQSSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRldGVybWluZUxvYWRTdHJhdGVneSA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyYXRlZ3k7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGludGVybmFsVmVyc2lvbiA9IG9ialtcImludGVybmFsVmVyc2lvblwiXTtcclxuICAgICAgICAgICAgICAgIHZhciBleHRlcm5hbFZlcnNpb24gPSBvYmpbXCJleHRlcm5hbFZlcnNpb25cIl07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGludGVybmFsVmVyc2lvbiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2FwaSc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV4dGVybmFsVmVyc2lvbiA+IGludGVybmFsVmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2FwaSc7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5ID0gJ2RiJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBvYmpbJ2xvYWRTdHJhdGVneSddID0gc3RyYXRlZ3k7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9hZERhdGEgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0cmF0ZWd5ID0gb2JqWydsb2FkU3RyYXRlZ3knXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0cmF0ZWd5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXBpJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q291bnRyaWVzRnJvbUFQSSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJjb3VudHJpZXNcIl0gPSBjb3VudHJpZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0b3JlIGNvdW50cmllcyBhbmQgdmVyc2lvbiBudW1iZXIgaW4gZGF0YWJhc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucHV0SXRlbShkYXRhYmFzZSwgc3RvcmUsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToga2V5Q291bnRyaWVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogIGNvdW50cmllc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYucHV0SXRlbShkYXRhYmFzZSwgc3RvcmUsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZToga2V5VmVyc2lvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9ialtcImV4dGVybmFsVmVyc2lvblwiXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGInOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDb3VudHJpZXNGcm9tREIob2JqKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oX29iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoX29iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdVbmtub3duIGxvYWQgc3RyYXRlZ3knKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEVtcHR5T2JqZWN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoe30pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0SW50ZXJuYWxWZXJzaW9uID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5yZXRyaWV2ZUl0ZW0oZGF0YWJhc2UsIHN0b3JlLCBrZXlWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdID0gaXRlbS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEV4dGVybmFsVmVyc2lvbiA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0VmVyc2lvbkZyb21BUEkoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialtcImV4dGVybmFsVmVyc2lvblwiXSA9IHZlcnNpb247XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyaWVzRnJvbURCID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5yZXRyaWV2ZUl0ZW0oZGF0YWJhc2UsIHN0b3JlLCBrZXlDb3VudHJpZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJjb3VudHJpZXNcIl0gPSBpdGVtLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNGcm9tQVBJID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgICRodHRwLmdldCgnL2FwaS9jb3VudHJpZXMnKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VmVyc2lvbkZyb21BUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdW50cmllcy92ZXJzaW9uJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEudmVyc2lvbiB8fCAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cnlCeUFscGhhMyA9IGZ1bmN0aW9uKGFscGhhMykge1xyXG4gICAgICAgICAgICBpZiAoY291bnRyaWVzQnlBbHBoYTMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzQnlBbHBoYTNbYWxwaGEzXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXQsXHJcbiAgICAgICAgICAgIGdldENvdW50cnlCeUFscGhhMzogZ2V0Q291bnRyeUJ5QWxwaGEzXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdGb2N1c1NydicsIFtcIiR0aW1lb3V0XCIsIFwiJHdpbmRvd1wiLCBmdW5jdGlvbigkdGltZW91dCwgJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihpZCkge1xyXG4gICAgICAgICAgICAvLyB0aW1lb3V0IG1ha2VzIHN1cmUgdGhhdCBpcyBpbnZva2VkIGFmdGVyIGFueSBvdGhlciBldmVudCBoYXMgYmVlbiB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgIC8vIGUuZy4gY2xpY2sgZXZlbnRzIHRoYXQgbmVlZCB0byBydW4gYmVmb3JlIHRoZSBmb2N1cyBvclxyXG4gICAgICAgICAgICAvLyBpbnB1dHMgZWxlbWVudHMgdGhhdCBhcmUgaW4gYSBkaXNhYmxlZCBzdGF0ZSBidXQgYXJlIGVuYWJsZWQgd2hlbiB0aG9zZSBldmVudHNcclxuICAgICAgICAgICAgLy8gYXJlIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICR3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0luZGV4ZWREQlNydicsIFtcIiR3aW5kb3dcIiwgZnVuY3Rpb24oJHdpbmRvdykge1xyXG4gICAgICAgIHZhciBrZXlQYXRoID0gJ25hbWUnO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCID0gJHdpbmRvdy5pbmRleGVkREIgfHwgJHdpbmRvdy53ZWJraXRJbmRleGVkREIgfHwgJHdpbmRvdy5tc0luZGV4ZWREQjtcclxuICAgICAgICB2YXIgSURCS2V5UmFuZ2UgPSAkd2luZG93LklEQktleVJhbmdlIHx8ICR3aW5kb3cud2Via2l0SURCS2V5UmFuZ2U7XHJcblxyXG4gICAgICAgIHZhciBJREJUcmFuc2FjdGlvbiA9ICR3aW5kb3cuSURCVHJhbnNhY3Rpb24gfHwgJHdpbmRvdy53ZWJraXRJREJUcmFuc2FjdGlvbjtcclxuXHJcbiAgICAgICAgaWYgKElEQlRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgPSBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFIHx8ICdyZWFkd3JpdGUnO1xyXG4gICAgICAgICAgICBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkgPSBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkgfHwgJ3JlYWRvbmx5JztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREJBdmFpbGFibGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGluZGV4ZWREQiA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlRGF0YWJhc2UgPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZSBpcyBhbiBpbnN0YW5jZSBvZiBJREJWZXJzaW9uQ2hhbmdlRXZlbnRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSBpZGIuY3JlYXRlT2JqZWN0U3RvcmUoc3RvcmVOYW1lLCB7IGtleVBhdGg6IGtleVBhdGggfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCwgdXBkYXRlLCBkZWxldGVcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIGVycm9yXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRyb3BEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3Agc3VjY2Vzc2Z1bFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkcm9wIGZhaWxlZFxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBhZGRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5hZGQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcHV0SXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0QWRkID0gc3RvcmUucHV0KGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJldHJpZXZlSXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBJREJLZXlSYW5nZS5vbmx5KGl0ZW1OYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUub3BlbkN1cnNvcihyYW5nZSkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGN1cnNvci52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtcyA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUub3BlbkN1cnNvcigpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY3JlYXRlRGF0YWJhc2U6IGNyZWF0ZURhdGFiYXNlLFxyXG4gICAgICAgICAgICBkcm9wRGF0YWJhc2U6IGRyb3BEYXRhYmFzZSxcclxuICAgICAgICAgICAgYWRkSXRlbTogYWRkSXRlbSxcclxuICAgICAgICAgICAgcHV0SXRlbTogcHV0SXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtOiByZXRyaWV2ZUl0ZW0sXHJcbiAgICAgICAgICAgIHJldHJpZXZlSXRlbXM6IHJldHJpZXZlSXRlbXMsXHJcbiAgICAgICAgICAgIGluZGV4ZWREQkF2YWlsYWJsZTogaW5kZXhlZERCQXZhaWxhYmxlXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdMb2dTcnYnLCBbXCJBcHBDb25maWdcIiwgZnVuY3Rpb24oQXBwQ29uZmlnKSB7XHJcbiAgICAgICAgdmFyIGxvZ0luZm8gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKEFwcENvbmZpZ1tcImxvZy5pbmZvXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ0Vycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuZXJyb3JcIl0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluZm86IGxvZ0luZm8sXHJcbiAgICAgICAgICAgIGVycm9yOiBsb2dFcnJvclxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnUXVpelNydicsIFtcIkFwcENvbmZpZ1wiLCBcIkNvdW50cnlTcnZcIiwgXCJMb2dTcnZcIiwgZnVuY3Rpb24oQXBwQ29uZmlnLCBDb3VudHJ5U3J2LCBMb2dTcnYpIHtcclxuICAgICAgICB2YXIgY291bnRyaWVzID0gbnVsbDtcclxuICAgICAgICB2YXIgY291bnRyaWVzQnlBbHBoYTMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgcXVpeiA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBzZXRDb3VudHJpZXMgPSBmdW5jdGlvbihfY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgIGNvdW50cmllcyA9IF9jb3VudHJpZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNvdW50cmllc0xvYWRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzICE9PSBudWxsICYmIGNvdW50cmllcy5sZW5ndGggPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY291bnRyaWVzTG9hZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiQ291bnRyaWVzIGhhdmUgbm90IGJlZW4gbG9hZGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHF1aXogPSBjcmVhdGVRdWl6KCdjb3VudHJ5Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShxdWl6LnN0YXJ0KCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaXNRdWl6UnVubmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVpeiA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6Lmhhc1N0YXJ0ZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlUXVpeiA9IGZ1bmN0aW9uKHF1aXpUeXBlKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAocXVpelR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NvdW50cnknOlxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlQ291bnRyeVF1aXooKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVDb3VudHJ5UXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgY291bnRyeVF1aXogPSBuZXcgUXVpeigpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGZ1bGxQb2ludHMgPSAxMDA7XHJcbiAgICAgICAgICAgIHZhciBoaW50TWF4aW11bSA9IDM7XHJcbiAgICAgICAgICAgIHZhciBoaW50Q29zdCA9IDI1O1xyXG5cclxuICAgICAgICAgICAgdmFyIGxhc3RRdWVzdGlvbkJvbnVzID0gMi41O1xyXG5cclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZXMgPSBBcHBDb25maWdbJ3F1aXouY291bnRyeS50eXBlcyddO1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25UeXBlc0xlbmd0aCA9IE9iamVjdC5rZXlzKHF1ZXN0aW9uVHlwZXMpLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIC8vIHNlbGVjdCBjb3VudHJpZXMgZm9yIHF1ZXN0aW9uc1xyXG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRDb3VudHJpZXMgPSBbXTtcclxuICAgICAgICAgICAgdmFyIG51bWJlck9mUXVlc3Rpb25zID0gQXBwQ29uZmlnWydxdWl6LmNvdW50cnkucXVlc3Rpb25zJ107XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bWJlck9mUXVlc3Rpb25zOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb3VudHJ5T2sgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoIWNvdW50cnlPaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb3VudHJ5ID0gY291bnRyaWVzW2dldFJhbmRvbUludCgwLCBjb3VudHJpZXMubGVuZ3RoIC0gMSldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb3VudHJ5T2sgPSBzZWxlY3RlZENvdW50cmllcy5pbmRleE9mKGNvdW50cnlbJ2FscGhhM0NvZGUnXSkgPCAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ291bnRyaWVzLnB1c2goY291bnRyeVsnYWxwaGEzQ29kZSddKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gY3JlYXRlIHF1ZXN0aW9ucyBmb3IgcXVpelxyXG4gICAgICAgICAgICB2YXIgcWNudCA9IDA7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkQ291bnRyaWVzLmZvckVhY2goZnVuY3Rpb24oYWxwaGEzKSB7XHJcbiAgICAgICAgICAgICAgICBxY250Kys7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnkgPSBDb3VudHJ5U3J2LmdldENvdW50cnlCeUFscGhhMyhhbHBoYTMpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGUgPSBxdWVzdGlvblR5cGVzW2dldFJhbmRvbUludCgwLCBxdWVzdGlvblR5cGVzTGVuZ3RoIC0gMSldO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gZ2V0UXVlc3Rpb25UZXh0KHF1ZXN0aW9uVHlwZSwgY291bnRyeSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBxdWVzdGlvblR5cGVcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5zd2VyID0gZ2V0UXVlc3Rpb25BbnN3ZXIocXVlc3Rpb25UeXBlLCBjb3VudHJ5KTtcclxuICAgICAgICAgICAgICAgIHZhciBjaGVja0Fuc3dlciA9IGdldENoZWNrQW5zd2VyTGFtYmRhKHF1ZXN0aW9uVHlwZSwgZnVsbFBvaW50cywgbGFzdFF1ZXN0aW9uQm9udXMpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhpbnRzID0gZ2V0UXVlc3Rpb25IaW50cyhxdWVzdGlvblR5cGUsIGhpbnRNYXhpbXVtLCBoaW50Q29zdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gdGhlIGxhc3QgcXVlc3Rpb24gaXMgdGhlIGJvbnVzIHF1ZXN0aW9uXHJcbiAgICAgICAgICAgICAgICBpZiAocWNudCA+PSBudW1iZXJPZlF1ZXN0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm9bJ2JvbnVzJ10gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvdW50cnlRdWl6LmFkZFF1ZXN0aW9uKG5ldyBRdWVzdGlvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dCxcclxuICAgICAgICAgICAgICAgICAgICBpbmZvOiBpbmZvLFxyXG4gICAgICAgICAgICAgICAgICAgIGFuc3dlcjogYW5zd2VyLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrQW5zd2VyOiBjaGVja0Fuc3dlcixcclxuICAgICAgICAgICAgICAgICAgICBoaW50czogaGludHNcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyeVF1aXo7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uVGV4dCA9IGZ1bmN0aW9uKHR5cGUsIGNvdW50cnkpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldpZSBoZWnDn3QgZGllIEhhdXB0c3RhZHQgdm9uIFtcIiArIGNvdW50cnkubmFtZSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiW1wiICsgY291bnRyeS5jYXBpdGFsICsgXCJdIGlzdCBkaWUgSGF1cHRzdGFkdCB2b24gd2VsY2hlbSBMYW5kXCJcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldpZSB2aWVsZSBNZW5zY2hlbiBsZWJlbiBpbiBbXCIgKyBjb3VudHJ5Lm5hbWUgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIldpZSBncm/DnyBpc3QgZGllIEZsw6RjaGUgdm9uIFtcIiArIGNvdW50cnkubmFtZSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25BbnN3ZXIgPSBmdW5jdGlvbih0eXBlLCBjb3VudHJ5KSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWx0U3BlbGxpbmdzID0gY291bnRyeS5hbHRTcGVsbGluZ3MgIT09IHVuZGVmaW5lZCAmJiBjb3VudHJ5LmFsdFNwZWxsaW5nc1snY2FwaXRhbCddICE9PSB1bmRlZmluZWQgPyBjb3VudHJ5LmFsdFNwZWxsaW5nc1snY2FwaXRhbCddIDogW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkuY2FwaXRhbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWx0U3BlbGxpbmdzOiBhbHRTcGVsbGluZ3NcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFsdFNwZWxsaW5ncyA9IGNvdW50cnkuYWx0U3BlbGxpbmdzICE9PSB1bmRlZmluZWQgJiYgY291bnRyeS5hbHRTcGVsbGluZ3NbJ25hbWUnXSAhPT0gdW5kZWZpbmVkID8gY291bnRyeS5hbHRTcGVsbGluZ3NbJ25hbWUnXSA6IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5Lm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsdFNwZWxsaW5nczogYWx0U3BlbGxpbmdzXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkucG9wdWxhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0OiBjb3VudHJ5LmFyZWFcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q2hlY2tBbnN3ZXJMYW1iZGEgPSBmdW5jdGlvbih0eXBlLCBmdWxsUG9pbnRzLCBsYXN0UXVlc3Rpb25Cb251cykge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDT1VOVFJZX09GX0NBUElUQUwnOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihhbnN3ZXIsIHN1Ym1pdHRlZEFuc3dlciwgaW5mbykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29ycmVjdCA9IHN1Ym1pdHRlZEFuc3dlciA9PT0gYW5zd2VyLmNvcnJlY3QgfHwgKGFuc3dlci5hbHRTcGVsbGluZ3MgJiYgYW5zd2VyLmFsdFNwZWxsaW5ncy5pbmRleE9mKHN1Ym1pdHRlZEFuc3dlcikgPj0gMCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzID0gY29ycmVjdCA/IGZ1bGxQb2ludHMgOiAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8gIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzICo9IGxhc3RRdWVzdGlvbkJvbnVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBwZXJjZW50YWdlIGRpZmZlcmVuY2UgZnJvbSBjb3JyZWN0IGFuc3dlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JQZXJjZW50YWdlID0gTWF0aC5hYnMoc3VibWl0dGVkQW5zd2VyIC0gYW5zd2VyLmNvcnJlY3QpIC8gYW5zd2VyLmNvcnJlY3QgKiAxMDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnRzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDkwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSA5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA4MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDcwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDE2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA1MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDQwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAyMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDI1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMzApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8gIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzICE9PSB1bmRlZmluZWQgJiYgaW5mby5ib251cyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzICo9IGxhc3RRdWVzdGlvbkJvbnVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI/XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25IaW50cyA9IGZ1bmN0aW9uKHR5cGUsIGhpbnRzUG9zc2libGUsIGhpbnRDb3N0KSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4aW11bTogaGludHNQb3NzaWJsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29zdDogaGludENvc3QsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdpdmU6IGZ1bmN0aW9uKGhpbnRzVXNlZCwgYW5zd2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYW5zd2VyLmNvcnJlY3Quc3Vic3RyKDAsIGhpbnRzVXNlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93ZWQ6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1F1aXpSdW5uaW5nKCkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1F1aXpSdW5uaW5nKCkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6LmdldE51bWJlck9mUXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouY3VycmVudFF1ZXN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBxdWl6Lm5leHRRdWVzdGlvbigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXQsXHJcbiAgICAgICAgICAgIHNldENvdW50cmllczogc2V0Q291bnRyaWVzLFxyXG4gICAgICAgICAgICBpc1F1aXpSdW5uaW5nOiBpc1F1aXpSdW5uaW5nLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI6IGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcixcclxuICAgICAgICAgICAgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zOiBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMsXHJcbiAgICAgICAgICAgIGdldEN1cnJlbnRRdWVzdGlvbjogZ2V0Q3VycmVudFF1ZXN0aW9uLFxyXG4gICAgICAgICAgICBuZXh0UXVlc3Rpb246IG5leHRRdWVzdGlvblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnVXNlclNydicsIFtcIiRodHRwXCIsIFwiQXV0aFRva2VuU3J2XCIsIGZ1bmN0aW9uKCRodHRwLCBBdXRoVG9rZW5TcnYpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBnZXRVc2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcicpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRVc2VyRnJvbVN0b3JhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRva2VuID0gQXV0aFRva2VuU3J2LmdldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKHRva2VuKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0VXNlcigpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIHRva2VuLCB3ZSByZWplY3QgdGhlIHByb21pc2VcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJObyB0b2tlbiBpbiBzdG9yYWdlXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvc2Vzc2lvbicsIHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnRva2VuID0gcmVzcG9uc2UuZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzYXZlIHRva2VuIGxvY2FsbHlcclxuICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbihzZWxmLnRva2VuKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VXNlcigpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbG9nb3V0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9rZW4gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSB0b2tlbiBsb2NhbGx5XHJcbiAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFVzZXI6IGdldFVzZXIsXHJcbiAgICAgICAgICAgIGdldFVzZXJGcm9tU3RvcmFnZTogZ2V0VXNlckZyb21TdG9yYWdlLFxyXG4gICAgICAgICAgICBsb2dpbjogbG9naW4sXHJcbiAgICAgICAgICAgIGxvZ291dDogbG9nb3V0XHJcbiAgICAgICAgfVxyXG4gICAgfV0pOyIsIi8vIG93biBjbGFzc2VzIGFuZCBmdW5jdGlvbnNcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVJWiAtLS0tLS0tLS0tXHJcbnZhciBRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBpbmRleCBvZiBjdXJyZW50IHF1ZXN0aW9uXHJcbiAgICB2YXIgY3VycmVudFF1ZXN0aW9uSWR4ID0gbnVsbDtcclxuXHJcbiAgICAvLyBhcnJheSBjb250YWluaW5nIGFsbCBxdWVzdGlvbnNcclxuICAgIHZhciBxdWVzdGlvbnMgPSBbXTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFN0YXJ0cyB0aGUgcXVpei5cclxuICAgICAqL1xyXG4gICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIGNoZWNrIGlmIHF1aXogaGFzIHF1ZXN0aW9uc1xyXG4gICAgICAgIGlmIChxdWVzdGlvbnMubGVuZ3RoIDw9IDApXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHN0YXJ0IGEgcXVpeiB3aXRob3V0IHF1ZXN0aW9uc1wiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaXNBY3RpdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oYXNTdGFydGVkKCkgJiYgIXRoaXMuaGFzRW5kZWQoKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNTdGFydGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbklkeCAhPT0gbnVsbDtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5oYXNFbmRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhc1N0YXJ0ZWQoKSAmJiBjdXJyZW50UXVlc3Rpb25JZHggPj0gcXVlc3Rpb25zLmxlbmd0aDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgbmV3IHF1ZXN0aW9uIHRvIHRoZSBxdWl6LlxyXG4gICAgICogVGhlIHBhcmFtZXRlciBtdXN0IGJlIGFuIHF1ZXN0aW9uIG9iamVjdC5cclxuICAgICAqIElmIG5vIHF1ZXN0aW9uIG9iamVjdCBpcyBwYXNzZWQgb3IgYW4gb2JqZWN0IHdpdGggbWlzc2luZyBwcm9wZXJ0aWVzLCBhbiBlcnJvciBpcyB0aHJvd24uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYWRkUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgIGlmIChxdWVzdGlvbiA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihcIk5vIHF1ZXN0aW9uIG9iamVjdCBwYXNzZWRcIik7XHJcblxyXG4gICAgICAgIHZhciB2YWxpZCA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGEgcXVlc3Rpb24gb2JqZWN0IG11c3QgY29udGFpbiBhbGwgdGhlc2UgcHJvcGVydGllc1xyXG4gICAgICAgIHZhciBuZWNlc3NhcnlQcm9wZXJ0aWVzID0gWydjb25maWcnLCAnaGludCcsICdzb2x1dGlvbicsICdhbnN3ZXInLCAncXVlc3Rpb24nLCAnZ2V0SW5mbycsICdpbmZvJywgJ3BvaW50cycsICdhbnN3ZXJlZCcsICdoaW50c0FsbG93ZWQnLCAnaGludHNSZW1haW5pbmcnXTtcclxuXHJcbiAgICAgICAgbmVjZXNzYXJ5UHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIGlmICghcXVlc3Rpb24uaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUXVlc3Rpb24gbXVzdCBoYXZlIHByb3BlcnR5ICdcIiArIHByb3BlcnR5ICsgXCInXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh2YWxpZCkge1xyXG4gICAgICAgICAgICBxdWVzdGlvbnMucHVzaChxdWVzdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG5leHQgcXVlc3Rpb24gb2YgdGhlIHF1aXouXHJcbiAgICAgKiBJZiB0aGUgcXVpeiBoYXMgZW5kZWQsIGl0IHJldHVybnMgbm90aGluZy5cclxuICAgICAqL1xyXG4gICAgdGhpcy5uZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uSWR4ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbklkeCA9IDA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSWR4Kys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5oYXNFbmRlZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzQWN0aXZlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbklkeF07XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuY3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzQWN0aXZlKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbklkeF07XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0VG90YWxQb2ludHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmhhc1N0YXJ0ZWQoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciB0b3RhbFBvaW50cyA9IDA7XHJcblxyXG4gICAgICAgIHF1ZXN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBwb2ludHMgPSBxdWVzdGlvbi5wb2ludHMoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwb2ludHMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdG90YWxQb2ludHMgKz0gcG9pbnRzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0b3RhbFBvaW50cztcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoY3VycmVudFF1ZXN0aW9uSWR4ID09PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbklkeCArIDE7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2V0TnVtYmVyT2ZRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zLmxlbmd0aDtcclxuICAgIH07XHJcbn07XHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVRVNUSU9OIC0tLS0tLS0tLS1cclxudmFyIFF1ZXN0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG4gICAgLy8gVGV4dCBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciB0ZXh0ID0gbnVsbDtcclxuXHJcbiAgICAvLyBJbmZvIG9iamVjdCBmb3IgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgaW5mbyA9IG51bGw7XHJcblxyXG4gICAgLy8gQW5zd2VyIG9mIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIGFuc3dlciA9IG51bGw7XHJcblxyXG4gICAgLy8gSGludHMgb2YgdGhlIHF1ZXN0aW9uXHJcbiAgICB2YXIgaGludHMgPSBudWxsO1xyXG4gICAgdmFyIGhpbnRzVXNlZCA9IDA7XHJcblxyXG4gICAgLy8gTGFtYmRhIGZ1bmN0aW9uIHRvIGRldGVybWluZSB0aGUgYW5zd2VyIHN0YXR1cyBvZiB0aGUgcXVlc3Rpb25cclxuICAgIHZhciBjaGVja0Fuc3dlciA9IG51bGw7XHJcblxyXG4gICAgLy8gUG9pbnRzIGF3YXJkZWQgZm9yIHRoZSBxdWVzdGlvblxyXG4gICAgdmFyIHBvaW50cyA9IG51bGw7XHJcblxyXG4gICAgLy8gRmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgcXVlc3Rpb24gaGFzIGFscmVhZHkgYmVlbiBhbnN3ZXJlZFxyXG4gICAgdmFyIGFuc3dlcmVkID0gZmFsc2U7XHJcblxyXG4gICAgdmFyIGluaXQgPSBmdW5jdGlvbihvcHRzKSB7XHJcbiAgICAgICAgdGV4dCA9IG9wdHMudGV4dDtcclxuICAgICAgICBpbmZvID0gb3B0cy5pbmZvIHx8IHt9O1xyXG4gICAgICAgIGFuc3dlciA9IG9wdHMuYW5zd2VyO1xyXG4gICAgICAgIGNoZWNrQW5zd2VyID0gb3B0cy5jaGVja0Fuc3dlciB8fCBudWxsO1xyXG5cclxuICAgICAgICBoaW50cyA9IG9wdHMuaGludHMgfHwge1xyXG4gICAgICAgICAgICAgICAgYWxsb3dlZDogZmFsc2UsICAgICAvLyBpcyBhIGhpbnQgYWxsb3dlZD9cclxuICAgICAgICAgICAgICAgIG1heGltdW06IDAsICAgICAgICAgLy8gbWF4aW11bSBudW1iZXIgb2YgaGludHMgZm9yIHRoaXMgcXVlc3Rpb24gKGlycmVsZXZhbnQgaWYgYWxsb3dlZCBpcyBzZXQgdG8gZmFsc2UpXHJcbiAgICAgICAgICAgICAgICBjb3N0OiAwLCAgICAgICAgICAgIC8vIG51bWJlciBvZiBwb2ludHMgc3VidHJhY3RlZCBwZXIgdXNlZCBoaW50IChpcnJlbGV2YW50IGlmIGFsbG93ZWQgaXMgc2V0IHRvIGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgZ2l2ZTogbnVsbCAgICAgICAgICAvLyBsYW1iZGEgZnVuY3Rpb24gdG8gZ2l2ZSBhIGhpbnQgZm9yIGEgcXVlc3Rpb25cclxuICAgICAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgICBpbml0KG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY29uZmlnID0gZnVuY3Rpb24ob3B0cykge1xyXG4gICAgICAgIGluaXQob3B0cyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgcXVlc3Rpb24gdGV4dC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5xdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0ZXh0O1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHF1ZXN0aW9uIGluZm8gb2JqZWN0LlxyXG4gICAgICogQWN0cyBhcyBnZXR0ZXIgKHdpdGggb25seSBvbmUgYXJndW1lbnQpIGFuZCBzZXR0ZXIgKHdpdGggdHdvIGFyZ3VtZW50cylcclxuICAgICAqL1xyXG4gICAgdGhpcy5pbmZvID0gZnVuY3Rpb24ocHJvcCwgdmFsdWUpIHtcclxuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAvLyBzZXR0ZXJcclxuICAgICAgICAgICAgaW5mb1twcm9wXSA9IHZhbHVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGdldHRlclxyXG4gICAgICAgICAgICByZXR1cm4gaW5mb1twcm9wXTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgZW50aXJlIGluZm8gb2JqZWN0LlxyXG4gICAgICovXHJcbiAgICB0aGlzLmdldEluZm8gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gaW5mbztcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBjb3JyZWN0IGFuc3dlciB0byB0aGUgcXVlc3Rpb24gYWZ0ZXIgdGhlIHF1ZXN0aW9uIGhhcyBiZWVuIGFuc3dlcmVkLlxyXG4gICAgICogSWYgdGhlIHF1ZXN0aW9uIGhhcyBub3QgYmVlbiBhbnN3ZXJlZCB5ZXQsIGl0IHJldHVybnMgbnVsbC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5zb2x1dGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChhbnN3ZXJlZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYW5zd2VyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIGhpbnQgZm9yIHRoZSBxdWVzdGlvbi5cclxuICAgICAqIElmIG5vIGhpbnRzIGFyZSBhbGxvd2VkLCBvciB0aGUgbWF4aW11bSBudW1iZXIgb2YgaGludHMgaGF2ZSBiZWVuIHVzZWQsIG51bGwgaXMgcmV0dXJuZWQuXHJcbiAgICAgKi9cclxuICAgIHRoaXMuaGludCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICghaGludHMuYWxsb3dlZCB8fCBoaW50c1VzZWQgPj0gaGludHMubWF4aW11bSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChoaW50cy5hbGxvd2VkICYmICFoaW50cy5naXZlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhpbnRzIGFsbG93ZWQgYnV0IG5vIGdpdmUgbWV0aG9kIHBhc3NlZFwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGhpbnRzVXNlZCsrO1xyXG5cclxuICAgICAgICByZXR1cm4gaGludHMuZ2l2ZShoaW50c1VzZWQsIGFuc3dlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3VibWl0cyBhbiBhbnN3ZXIgdG8gdGhlIHF1ZXN0aW9uLlxyXG4gICAgICogSWYgdGhlIHF1ZXN0aW9uIGhhcyBhbHJlYWR5IGJlZW4gYW5zd2VyZWQgb3Igbm8gY2hlY2tBbnN3ZXIgbGFtYmRhIGhhcyBiZWVuIHNldCwgdGhpcyBtZXRob2QgZG9lcyBub3RoaW5nLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmFuc3dlciA9IGZ1bmN0aW9uKHN1Ym1pdHRlZEFuc3dlcikge1xyXG4gICAgICAgIGlmIChhbnN3ZXJlZCB8fCFjaGVja0Fuc3dlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhbnN3ZXJlZCA9IHRydWU7XHJcblxyXG4gICAgICAgIC8vIGNoZWNrQW5zd2VyIG1ldGhvZCBzaG91bGQgcmV0dXJuIHRoZSBzdGF0dXMgcmVzdWx0c1xyXG4gICAgICAgIHBvaW50cyA9IGNoZWNrQW5zd2VyKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBpbmZvKTtcclxuXHJcbiAgICAgICAgLy8gaWYgaGludHMgYXJlIGFsbG93ZWQgYW5kIGhhdmUgYmVlbiB1c2VkLCBzdWJ0cmFjdCB0aGUgcG9pbnRzXHJcbiAgICAgICAgaWYgKGhpbnRzLmFsbG93ZWQgJiYgaGludHNVc2VkID4gMCkge1xyXG4gICAgICAgICAgICBwb2ludHMgLT0gKGhpbnRzVXNlZCAqIGhpbnRzLmNvc3QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZW5zdXJlIHRoYXQgbm8gbmVnYXRpdmUgcG9pbnRzIGFyZSBhd2FyZGVkXHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIHBvaW50cyk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucG9pbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKCFhbnN3ZXJlZCB8fCBwb2ludHMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHBvaW50cztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHN0YXRlIG9mIHRoZSBxdWVzdGlvbi5cclxuICAgICAqL1xyXG4gICAgdGhpcy5hbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBhbnN3ZXJlZDtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgaGludHMgYXJlIGFsbG93ZWQgZm9yIHRoaXMgcXVlc3Rpb24sIGZhbHNlIGlmIG5vdC5cclxuICAgICAqIElmIGhpbnRzIGhhdmUgbm90IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICB0aGlzLmhpbnRzQWxsb3dlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaGludHMuYWxsb3dlZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiByZW1haW5pbmcgaGludHMuXHJcbiAgICAgKiBJZiBubyBoaW50cyBhcmUgYWxsb3dlZCBmb3IgdGhpcyBxdWVzdGlvbiwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgdGhpcy5oaW50c1JlbWFpbmluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhbGxvd2VkID0gdGhpcy5oaW50c0FsbG93ZWQoKTtcclxuXHJcbiAgICAgICAgaWYgKGFsbG93ZWQgPT09IG51bGwgfHwgYWxsb3dlZCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gaGludHMubWF4aW11bSAtIGhpbnRzVXNlZDtcclxuICAgIH07XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyBhIHJhbmRvbSBpbnRlZ2VyIGJldHdlZW4gbWluIChpbmNsdXNpdmUpIGFuZCBtYXggKGluY2x1c2l2ZSlcclxuICogVXNpbmcgTWF0aC5yb3VuZCgpIHdpbGwgZ2l2ZSB5b3UgYSBub24tdW5pZm9ybSBkaXN0cmlidXRpb24hXHJcbiAqL1xyXG52YXIgZ2V0UmFuZG9tSW50ID0gZnVuY3Rpb24obWluLCBtYXgpIHtcclxuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgdGhlIHRleHQgYmV0d2VlbiB0d28gZGVsaW1pdGluZyB0ZXh0IG9jY3VycmVuY2VzXHJcbiAqL1xyXG52YXIgZ2V0U3RyaW5nQmV0d2VlbiA9IGZ1bmN0aW9uKHRleHQsIGZpcnN0U3RyaW5nLCBzZWNvbmRTdHJpbmcpIHtcclxuICAgIHZhciBmaXJzdFBvcyA9IHRleHQuaW5kZXhPZihmaXJzdFN0cmluZyk7XHJcbiAgICB2YXIgc2Vjb25kUG9zID0gdGV4dC5pbmRleE9mKHNlY29uZFN0cmluZyk7XHJcblxyXG4gICAgaWYgKGZpcnN0UG9zID49IDAgJiYgc2Vjb25kUG9zID49IDAgJiYgc2Vjb25kUG9zID4gZmlyc3RQb3MpIHtcclxuICAgICAgICByZXR1cm4gdGV4dC5zdWJzdHIoZmlyc3RQb3MgKyAxLCBzZWNvbmRQb3MgLSBmaXJzdFBvcyAtIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG59O1xyXG5cclxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cy5RdWVzdGlvbiA9IFF1ZXN0aW9uO1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuUXVpeiA9IFF1aXo7XHJcbn0iLCJhbmd1bGFyLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbigkbG9jYXRpb25Qcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAgICAgIC8vIGVuYWJsZSBIVE1MNSBwdXNoc3RhdGVcclxuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcblxyXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9ob21lJyk7XHJcblxyXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnaG9tZScsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9ob21lJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3BhcnRpYWxzL2hvbWUucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3F1aXonLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvcXVpeicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9xdWl6LnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9sb2dpbicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9sb2dpbi5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnbG9nb3V0Jywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ291dCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTG9nb3V0Q3RybCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdyZWdpc3RlcicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9yZWdpc3RlcicsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9wYXJ0aWFscy9yZWdpc3Rlci5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnYWJvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvYWJvdXQnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvcGFydGlhbHMvYWJvdXQucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdEcm9wZG93bkN0cmwnLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkc2NvcGUudG9nZ2xlRHJvcGRvd24gPSB0b2dnbGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuc2hvd0Ryb3Bkb3duID0gc2hvd0Ryb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5oaWRlRHJvcGRvd24gPSBoaWRlRHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmlzRHJvcGRvd25WaXNpYmxlID0gaXNEcm9wZG93blZpc2libGU7XHJcblxyXG4gICAgICAgICRzY29wZS5oYW5kbGVDbGlja091dHNpZGUgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNMSUNLRUQgT1VUU0lERVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gIXZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93RHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGlkZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0Ryb3Bkb3duVmlzaWJsZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZpc2libGU7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgVXNlclNydi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ2luIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBub3RpZnkgdXNlciBhYm91dCBlcnJvciBpbiBsb2dpbiBwcm9jZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCd1c2VybmFtZScpO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ291dEN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTcnYpIHtcclxuICAgICAgICBVc2VyU3J2LmxvZ291dCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcGxpY2F0aW9uIGNvbnRyb2wgYWJvdXQgbG9nb3V0IGV2ZW50XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dvdXQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUXVpekN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFF1aXpTcnYsIExvZ1NydiwgRm9jdXNTcnYsIG5nUHJvZ3Jlc3NGYWN0b3J5KSB7XHJcblxyXG4gICAgICAgIC8vIFByb2dyZXNzIGJhciBpbml0aWFsaXphdGlvblxyXG4gICAgICAgICRzY29wZS5wcm9ncmVzc2JhciA9IG5nUHJvZ3Jlc3NGYWN0b3J5LmNyZWF0ZUluc3RhbmNlKCk7XHJcbiAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldFBhcmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1wcm9ncmVzcycpKTtcclxuICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0QWJzb2x1dGUoKTtcclxuICAgICAgICAkc2NvcGUucHJvZ3Jlc3NiYXIuc2V0Q29sb3IoXCIjMzM2ZTdiXCIpO1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb24gPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgc3RhcnRRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIFF1aXpTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbyhcIlF1aXogc3RhcnRlZFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUXVlc3Rpb24oKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlUXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcXVlc3Rpb24gPSBRdWl6U3J2LmdldEN1cnJlbnRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgRm9jdXNTcnYoJ2Fuc3dlcicpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZW5kZXJRdWVzdGlvbiA9IGZ1bmN0aW9uKHRleHQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dFxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJbXCIsIFwiPHNwYW4gY2xhc3M9J1wiICsgY2xhc3NOYW1lICsgXCInPlwiKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJdXCIsIFwiPC9zcGFuPlwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc3VibWl0QW5zd2VyID0gZnVuY3Rpb24oc3VibWl0dGVkQW5zd2VyKSB7XHJcbiAgICAgICAgICAgIGlmIChzdWJtaXR0ZWRBbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHF1ZXN0aW9uLmFuc3dlcihzdWJtaXR0ZWRBbnN3ZXIpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgcHJvZ3Jlc3MgYmFyXHJcbiAgICAgICAgICAgICAgICAvLyRzY29wZS5wcm9ncmVzc2Jhci5zZXQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgZm9jdXMgdG8gbmV4dCBxdWVzdGlvbiBidXR0b25cclxuICAgICAgICAgICAgICAgIEZvY3VzU3J2KCdidG5OZXh0UXVlc3Rpb24nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBoYW5kbGVLZXlQcmVzcyA9IGZ1bmN0aW9uKGtleUV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChrZXlFdmVudC53aGljaCA9PSAxMykge1xyXG4gICAgICAgICAgICAgICAgc3VibWl0QW5zd2VyKCRzY29wZS5hbnN3ZXJPYmouYW5zd2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uQW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCFpc1F1aXpSdW5uaW5nKCkgfHwgcXVlc3Rpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmFuc3dlcmVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAocXVlc3Rpb24gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyUXVlc3Rpb24ocXVlc3Rpb24ucXVlc3Rpb24oKSwgJ3F1ZXN0aW9uLWhpZ2hsaWdodCcpICsgXCI/XCI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEFuc3dlclRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKHF1ZXN0aW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLnNvbHV0aW9uKCkuY29ycmVjdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIFF1aXpTcnYubmV4dFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuYW5zd2VyT2JqLmFuc3dlciA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICB1cGRhdGVRdWVzdGlvbigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zdGFydFF1aXogPSBzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmlzUXVpelJ1bm5pbmcgPSBpc1F1aXpSdW5uaW5nO1xyXG4gICAgICAgICRzY29wZS5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI7XHJcbiAgICAgICAgJHNjb3BlLmdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucztcclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb25UZXh0ID0gZ2V0UXVlc3Rpb25UZXh0O1xyXG4gICAgICAgICRzY29wZS5nZXRBbnN3ZXJUZXh0ID0gZ2V0QW5zd2VyVGV4dDtcclxuICAgICAgICAkc2NvcGUuaGFuZGxlS2V5UHJlc3MgPSBoYW5kbGVLZXlQcmVzcztcclxuICAgICAgICAkc2NvcGUuc3VibWl0QW5zd2VyID0gc3VibWl0QW5zd2VyO1xyXG4gICAgICAgICRzY29wZS5xdWVzdGlvbkFuc3dlcmVkID0gcXVlc3Rpb25BbnN3ZXJlZDtcclxuICAgICAgICAkc2NvcGUubmV4dFF1ZXN0aW9uID0gbmV4dFF1ZXN0aW9uO1xyXG5cclxuICAgICAgICAkc2NvcGUuYW5zd2VyT2JqID0ge1xyXG4gICAgICAgICAgICBhbnN3ZXI6IFwiXCJcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBpbml0aWFsbHkgdHJ5IHRvIHVwZGF0ZSBxdWVzdGlvblxyXG4gICAgICAgIHVwZGF0ZVF1ZXN0aW9uKCk7XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmlsdGVyKCdyZW5kZXJIdG1sJywgZnVuY3Rpb24oJHNjZSkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0ZXh0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkc2NlLnRydXN0QXNIdG1sKHRleHQpO1xyXG4gICAgICAgIH07XHJcbiAgICB9KTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgZnVuY3Rpb24oQXV0aFRva2VuU3J2KSB7XHJcbiAgICAgICAgdmFyIGFkZFRva2VuID0gZnVuY3Rpb24oY29uZmlnKSB7XHJcbiAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhUb2tlblNydi5nZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycyA9IGNvbmZpZy5oZWFkZXJzIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ1gtQXV0aCddID0gdG9rZW47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb25maWc7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVxdWVzdDogYWRkVG9rZW5cclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0F1dGhUb2tlblNydicsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcclxuICAgICAgICB2YXIgc3RvcmUgPSAkd2luZG93LnNlc3Npb25TdG9yYWdlO1xyXG4gICAgICAgIHZhciBrZXkgPSAnYXV0aC10b2tlbic7XHJcblxyXG4gICAgICAgIHZhciBnZXRUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0SXRlbShrZXkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZXRUb2tlbiA9IGZ1bmN0aW9uKHRva2VuKSB7XHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUuc2V0SXRlbShrZXksIHRva2VuKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGdldFRva2VuOiBnZXRUb2tlbixcclxuICAgICAgICAgICAgc2V0VG9rZW46IHNldFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdDb3VudHJ5U3J2JywgZnVuY3Rpb24oJGh0dHAsIEluZGV4ZWREQlNydiwgTG9nU3J2KSB7XHJcbiAgICAgICAgLy8gQ291bnRyaWVzIGFycmF5XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUFscGhhMyA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIEluZGV4ZWREQlxyXG4gICAgICAgIHZhciBkYXRhYmFzZSA9ICdtYWdlbGxhbic7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJ2NvdW50cnlTdG9yZSc7XHJcbiAgICAgICAgdmFyIGtleUNvdW50cmllcyA9ICdjb3VudHJpZXMnO1xyXG4gICAgICAgIHZhciBrZXlWZXJzaW9uID0gJ3ZlcnNpb24nO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gSW5kZXhlZERCU3J2LmluZGV4ZWREQkF2YWlsYWJsZSgpO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZENvdW50cmllcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkQ291bnRyaWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGluZGV4ZWREQiBpcyBhdmFpbGFibGVcclxuICAgICAgICAgICAgaWYgKGluZGV4ZWREQkF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBkYXRhYmFzZSBleGlzdHNcclxuICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYuY3JlYXRlRGF0YWJhc2UoZGF0YWJhc2UsIHN0b3JlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFbXB0eU9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0SW50ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFeHRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGRldGVybWluZUxvYWRTdHJhdGVneSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obG9hZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzID0gb2JqWydjb3VudHJpZXMnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbyhcImxvYWRlZCBjb3VudHJpZXMgZnJvbVwiLCBvYmpbJ2xvYWRTdHJhdGVneSddLnRvVXBwZXJDYXNlKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZGl0aW9uYWxseSBtYXAgY291bnRyaWVzIGJ5IGFscGhhMyBjb2RlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUFscGhhMyA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cmllcy5mb3JFYWNoKGZ1bmN0aW9uKGMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudHJpZXNCeUFscGhhM1tjWydhbHBoYTNDb2RlJ11dID0gYztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiZmFpbGVkIHRvIGxvYWQgY291bnRyaWVzXCIsIGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBub3QsIHdlIGFsd2F5cyB0cnkgdG8gZG93bmxvYWQgaXQgZnJvbSB0aGUgY291bnRyeSBBUEkgZW5kcG9pbnRcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRDb3VudHJpZXNGcm9tQVBJKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5ID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaW50ZXJuYWxWZXJzaW9uID0gb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGV4dGVybmFsVmVyc2lvbiA9IG9ialtcImV4dGVybmFsVmVyc2lvblwiXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaW50ZXJuYWxWZXJzaW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ZXJuYWxWZXJzaW9uID4gaW50ZXJuYWxWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnZGInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIG9ialsnbG9hZFN0cmF0ZWd5J10gPSBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkRGF0YSA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyYXRlZ3kgPSBvYmpbJ2xvYWRTdHJhdGVneSddO1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdhcGknOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDb3VudHJpZXNGcm9tQVBJKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGNvdW50cmllcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmUgY291bnRyaWVzIGFuZCB2ZXJzaW9uIG51bWJlciBpbiBkYXRhYmFzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlDb3VudHJpZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAgY291bnRyaWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlWZXJzaW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdkYic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21EQihvYmopXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihfb2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfb2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ1Vua25vd24gbG9hZCBzdHJhdGVneScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RW1wdHlPYmplY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7fSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRJbnRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleVZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBpdGVtLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0ZXJuYWxWZXJzaW9uID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRWZXJzaW9uRnJvbUFQSSgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbih2ZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdID0gdmVyc2lvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNGcm9tREIgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleUNvdW50cmllcylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21BUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdW50cmllcycpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRWZXJzaW9uRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzL3ZlcnNpb24nKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YS52ZXJzaW9uIHx8IDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q291bnRyeUJ5QWxwaGEzID0gZnVuY3Rpb24oYWxwaGEzKSB7XHJcbiAgICAgICAgICAgIGlmIChjb3VudHJpZXNCeUFscGhhMyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXNCeUFscGhhM1thbHBoYTNdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5pdDogaW5pdCxcclxuICAgICAgICAgICAgZ2V0Q291bnRyeUJ5QWxwaGEzOiBnZXRDb3VudHJ5QnlBbHBoYTNcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0ZvY3VzU3J2JywgZnVuY3Rpb24oJHRpbWVvdXQsICR3aW5kb3cpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaWQpIHtcclxuICAgICAgICAgICAgLy8gdGltZW91dCBtYWtlcyBzdXJlIHRoYXQgaXMgaW52b2tlZCBhZnRlciBhbnkgb3RoZXIgZXZlbnQgaGFzIGJlZW4gdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAvLyBlLmcuIGNsaWNrIGV2ZW50cyB0aGF0IG5lZWQgdG8gcnVuIGJlZm9yZSB0aGUgZm9jdXMgb3JcclxuICAgICAgICAgICAgLy8gaW5wdXRzIGVsZW1lbnRzIHRoYXQgYXJlIGluIGEgZGlzYWJsZWQgc3RhdGUgYnV0IGFyZSBlbmFibGVkIHdoZW4gdGhvc2UgZXZlbnRzXHJcbiAgICAgICAgICAgIC8vIGFyZSB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdJbmRleGVkREJTcnYnLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIGtleVBhdGggPSAnbmFtZSc7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREIgPSAkd2luZG93LmluZGV4ZWREQiB8fCAkd2luZG93LndlYmtpdEluZGV4ZWREQiB8fCAkd2luZG93Lm1zSW5kZXhlZERCO1xyXG4gICAgICAgIHZhciBJREJLZXlSYW5nZSA9ICR3aW5kb3cuSURCS2V5UmFuZ2UgfHwgJHdpbmRvdy53ZWJraXRJREJLZXlSYW5nZTtcclxuXHJcbiAgICAgICAgdmFyIElEQlRyYW5zYWN0aW9uID0gJHdpbmRvdy5JREJUcmFuc2FjdGlvbiB8fCAkd2luZG93LndlYmtpdElEQlRyYW5zYWN0aW9uO1xyXG5cclxuICAgICAgICBpZiAoSURCVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSA9IElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgfHwgJ3JlYWR3cml0ZSc7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSA9IElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSB8fCAncmVhZG9ubHknO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5kZXhlZERCID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBlIGlzIGFuIGluc3RhbmNlIG9mIElEQlZlcnNpb25DaGFuZ2VFdmVudFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IGlkYi5jcmVhdGVPYmplY3RTdG9yZShzdG9yZU5hbWUsIHsga2V5UGF0aDoga2V5UGF0aCB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkLCB1cGRhdGUsIGRlbGV0ZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZHJvcERhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBzdWNjZXNzZnVsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3AgZmFpbGVkXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFkZEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLmFkZChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwdXRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5wdXQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW1OYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IElEQktleVJhbmdlLm9ubHkoaXRlbU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKHJhbmdlKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gY3Vyc29yLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW1zID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjcmVhdGVEYXRhYmFzZTogY3JlYXRlRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGRyb3BEYXRhYmFzZTogZHJvcERhdGFiYXNlLFxyXG4gICAgICAgICAgICBhZGRJdGVtOiBhZGRJdGVtLFxyXG4gICAgICAgICAgICBwdXRJdGVtOiBwdXRJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW06IHJldHJpZXZlSXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtczogcmV0cmlldmVJdGVtcyxcclxuICAgICAgICAgICAgaW5kZXhlZERCQXZhaWxhYmxlOiBpbmRleGVkREJBdmFpbGFibGVcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0xvZ1NydicsIGZ1bmN0aW9uKEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBsb2dJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuaW5mb1wiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dFcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmVycm9yXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbmZvOiBsb2dJbmZvLFxyXG4gICAgICAgICAgICBlcnJvcjogbG9nRXJyb3JcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1F1aXpTcnYnLCBmdW5jdGlvbihBcHBDb25maWcsIENvdW50cnlTcnYsIExvZ1Nydikge1xyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG4gICAgICAgIHZhciBjb3VudHJpZXNCeUFscGhhMyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBxdWl6ID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIHNldENvdW50cmllcyA9IGZ1bmN0aW9uKF9jb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgY291bnRyaWVzID0gX2NvdW50cmllcztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY291bnRyaWVzTG9hZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXMgIT09IG51bGwgJiYgY291bnRyaWVzLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb3VudHJpZXNMb2FkZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJDb3VudHJpZXMgaGF2ZSBub3QgYmVlbiBsb2FkZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcXVpeiA9IGNyZWF0ZVF1aXooJ2NvdW50cnknKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHF1aXouc3RhcnQoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChxdWl6ID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouaGFzU3RhcnRlZCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVRdWl6ID0gZnVuY3Rpb24ocXVpelR5cGUpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChxdWl6VHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY291bnRyeSc6XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVDb3VudHJ5UXVpeigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNyZWF0ZUNvdW50cnlRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBjb3VudHJ5UXVpeiA9IG5ldyBRdWl6KCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZnVsbFBvaW50cyA9IDEwMDtcclxuICAgICAgICAgICAgdmFyIGhpbnRNYXhpbXVtID0gMztcclxuICAgICAgICAgICAgdmFyIGhpbnRDb3N0ID0gMjU7XHJcblxyXG4gICAgICAgICAgICB2YXIgbGFzdFF1ZXN0aW9uQm9udXMgPSAyLjU7XHJcblxyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25UeXBlcyA9IEFwcENvbmZpZ1sncXVpei5jb3VudHJ5LnR5cGVzJ107XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvblR5cGVzTGVuZ3RoID0gT2JqZWN0LmtleXMocXVlc3Rpb25UeXBlcykubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgLy8gc2VsZWN0IGNvdW50cmllcyBmb3IgcXVlc3Rpb25zXHJcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZENvdW50cmllcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgbnVtYmVyT2ZRdWVzdGlvbnMgPSBBcHBDb25maWdbJ3F1aXouY291bnRyeS5xdWVzdGlvbnMnXTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtYmVyT2ZRdWVzdGlvbnM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvdW50cnlPayA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlICghY291bnRyeU9rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50cnkgPSBjb3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIGNvdW50cmllcy5sZW5ndGggLSAxKV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50cnlPayA9IHNlbGVjdGVkQ291bnRyaWVzLmluZGV4T2YoY291bnRyeVsnYWxwaGEzQ29kZSddKSA8IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDb3VudHJpZXMucHVzaChjb3VudHJ5WydhbHBoYTNDb2RlJ10pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBjcmVhdGUgcXVlc3Rpb25zIGZvciBxdWl6XHJcbiAgICAgICAgICAgIHZhciBxY250ID0gMDtcclxuICAgICAgICAgICAgc2VsZWN0ZWRDb3VudHJpZXMuZm9yRWFjaChmdW5jdGlvbihhbHBoYTMpIHtcclxuICAgICAgICAgICAgICAgIHFjbnQrKztcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRyeSA9IENvdW50cnlTcnYuZ2V0Q291bnRyeUJ5QWxwaGEzKGFscGhhMyk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uVHlwZXNbZ2V0UmFuZG9tSW50KDAsIHF1ZXN0aW9uVHlwZXNMZW5ndGggLSAxKV07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHRleHQgPSBnZXRRdWVzdGlvblRleHQocXVlc3Rpb25UeXBlLCBjb3VudHJ5KTtcclxuICAgICAgICAgICAgICAgIHZhciBpbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHF1ZXN0aW9uVHlwZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHZhciBhbnN3ZXIgPSBnZXRRdWVzdGlvbkFuc3dlcihxdWVzdGlvblR5cGUsIGNvdW50cnkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoZWNrQW5zd2VyID0gZ2V0Q2hlY2tBbnN3ZXJMYW1iZGEocXVlc3Rpb25UeXBlLCBmdWxsUG9pbnRzLCBsYXN0UXVlc3Rpb25Cb251cyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGludHMgPSBnZXRRdWVzdGlvbkhpbnRzKHF1ZXN0aW9uVHlwZSwgaGludE1heGltdW0sIGhpbnRDb3N0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyB0aGUgbGFzdCBxdWVzdGlvbiBpcyB0aGUgYm9udXMgcXVlc3Rpb25cclxuICAgICAgICAgICAgICAgIGlmIChxY250ID49IG51bWJlck9mUXVlc3Rpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mb1snYm9udXMnXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY291bnRyeVF1aXouYWRkUXVlc3Rpb24obmV3IFF1ZXN0aW9uKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgIGluZm86IGluZm8sXHJcbiAgICAgICAgICAgICAgICAgICAgYW5zd2VyOiBhbnN3ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tBbnN3ZXI6IGNoZWNrQW5zd2VyLFxyXG4gICAgICAgICAgICAgICAgICAgIGhpbnRzOiBoaW50c1xyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJ5UXVpejtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25UZXh0ID0gZnVuY3Rpb24odHlwZSwgY291bnRyeSkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NBUElUQUxfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIGhlacOfdCBkaWUgSGF1cHRzdGFkdCB2b24gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJbXCIgKyBjb3VudHJ5LmNhcGl0YWwgKyBcIl0gaXN0IGRpZSBIYXVwdHN0YWR0IHZvbiB3ZWxjaGVtIExhbmRcIlxyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIHZpZWxlIE1lbnNjaGVuIGxlYmVuIGluIFtcIiArIGNvdW50cnkubmFtZSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIGdyb8OfIGlzdCBkaWUgRmzDpGNoZSB2b24gW1wiICsgY291bnRyeS5uYW1lICsgXCJdXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI/XCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbkFuc3dlciA9IGZ1bmN0aW9uKHR5cGUsIGNvdW50cnkpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhbHRTcGVsbGluZ3MgPSBjb3VudHJ5LmFsdFNwZWxsaW5ncyAhPT0gdW5kZWZpbmVkICYmIGNvdW50cnkuYWx0U3BlbGxpbmdzWydjYXBpdGFsJ10gIT09IHVuZGVmaW5lZCA/IGNvdW50cnkuYWx0U3BlbGxpbmdzWydjYXBpdGFsJ10gOiBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5jYXBpdGFsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbHRTcGVsbGluZ3M6IGFsdFNwZWxsaW5nc1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWx0U3BlbGxpbmdzID0gY291bnRyeS5hbHRTcGVsbGluZ3MgIT09IHVuZGVmaW5lZCAmJiBjb3VudHJ5LmFsdFNwZWxsaW5nc1snbmFtZSddICE9PSB1bmRlZmluZWQgPyBjb3VudHJ5LmFsdFNwZWxsaW5nc1snbmFtZSddIDogW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWx0U3BlbGxpbmdzOiBhbHRTcGVsbGluZ3NcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ1BPUFVMQVRJT05fT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdDogY291bnRyeS5wb3B1bGF0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdBUkVBX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3Q6IGNvdW50cnkuYXJlYVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCI/XCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDaGVja0Fuc3dlckxhbWJkYSA9IGZ1bmN0aW9uKHR5cGUsIGZ1bGxQb2ludHMsIGxhc3RRdWVzdGlvbkJvbnVzKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0FQSVRBTF9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0NPVU5UUllfT0ZfQ0FQSVRBTCc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGFuc3dlciwgc3VibWl0dGVkQW5zd2VyLCBpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3JyZWN0ID0gc3VibWl0dGVkQW5zd2VyID09PSBhbnN3ZXIuY29ycmVjdCB8fCAoYW5zd2VyLmFsdFNwZWxsaW5ncyAmJiBhbnN3ZXIuYWx0U3BlbGxpbmdzLmluZGV4T2Yoc3VibWl0dGVkQW5zd2VyKSA+PSAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludHMgPSBjb3JyZWN0ID8gZnVsbFBvaW50cyA6IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgKj0gbGFzdFF1ZXN0aW9uQm9udXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICdQT1BVTEFUSU9OX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQVJFQV9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYW5zd2VyLCBzdWJtaXR0ZWRBbnN3ZXIsIGluZm8pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FsY3VsYXRlIHBlcmNlbnRhZ2UgZGlmZmVyZW5jZSBmcm9tIGNvcnJlY3QgYW5zd2VyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclBlcmNlbnRhZ2UgPSBNYXRoLmFicyhzdWJtaXR0ZWRBbnN3ZXIgLSBhbnN3ZXIuY29ycmVjdCkgLyBhbnN3ZXIuY29ycmVjdCAqIDEwMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gNikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gOTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDgwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDE0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSA2MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMTYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDUwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAxOCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gNDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JQZXJjZW50YWdlIDw9IDIwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAzMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvclBlcmNlbnRhZ2UgPD0gMjUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50cyA9IDIwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yUGVyY2VudGFnZSA8PSAzMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzID0gMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAhPT0gdW5kZWZpbmVkICYmIGluZm8uYm9udXMgIT09IHVuZGVmaW5lZCAmJiBpbmZvLmJvbnVzID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHMgKj0gbGFzdFF1ZXN0aW9uQm9udXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2ludHM7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIj9cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRRdWVzdGlvbkhpbnRzID0gZnVuY3Rpb24odHlwZSwgaGludHNQb3NzaWJsZSwgaGludENvc3QpIHtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdDQVBJVEFMX09GX0NPVU5UUlknOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ09VTlRSWV9PRl9DQVBJVEFMJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhpbXVtOiBoaW50c1Bvc3NpYmxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3N0OiBoaW50Q29zdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2l2ZTogZnVuY3Rpb24oaGludHNVc2VkLCBhbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhbnN3ZXIuY29ycmVjdC5zdWJzdHIoMCwgaGludHNVc2VkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSAnUE9QVUxBVElPTl9PRl9DT1VOVFJZJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJ0FSRUFfT0ZfQ09VTlRSWSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZDogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoIWlzUXVpelJ1bm5pbmcoKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0TnVtYmVyT2ZRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5jdXJyZW50UXVlc3Rpb24oKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICghaXNRdWl6UnVubmluZygpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHF1aXoubmV4dFF1ZXN0aW9uKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaW5pdDogaW5pdCxcclxuICAgICAgICAgICAgc2V0Q291bnRyaWVzOiBzZXRDb3VudHJpZXMsXHJcbiAgICAgICAgICAgIGlzUXVpelJ1bm5pbmc6IGlzUXVpelJ1bm5pbmcsXHJcbiAgICAgICAgICAgIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcjogZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyLFxyXG4gICAgICAgICAgICBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnM6IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uOiBnZXRDdXJyZW50UXVlc3Rpb24sXHJcbiAgICAgICAgICAgIG5leHRRdWVzdGlvbjogbmV4dFF1ZXN0aW9uXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdVc2VyU3J2JywgZnVuY3Rpb24oJGh0dHAsIEF1dGhUb2tlblNydikge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS91c2VyJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFVzZXJGcm9tU3RvcmFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4odG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gdG9rZW4sIHdlIHJlamVjdCB0aGUgcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIHRva2VuIGluIHN0b3JhZ2VcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9uJywge1xyXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudG9rZW4gPSByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNhdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKHNlbGYudG9rZW4pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRVc2VyKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRva2VuIGxvY2FsbHlcclxuICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0VXNlcjogZ2V0VXNlcixcclxuICAgICAgICAgICAgZ2V0VXNlckZyb21TdG9yYWdlOiBnZXRVc2VyRnJvbVN0b3JhZ2UsXHJcbiAgICAgICAgICAgIGxvZ2luOiBsb2dpbixcclxuICAgICAgICAgICAgbG9nb3V0OiBsb2dvdXRcclxuICAgICAgICB9XHJcbiAgICB9KTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
