var magellan=angular.module("magellan",["ui.router","ngProgress"],["$httpProvider",function(n){n.interceptors.push("AuthInterceptor")}]);magellan.constant("AppConfig",{"log.info":!0,"log.error":!0,"quiz.questions.number":5}),magellan.controller("AppCtrl",["$scope","$state","UserSrv","CountrySrv","QuizSrv",function(n,t,e,r,o){n.app={config:{title:"Magellan",subtitle:"Test your knowledge about the countries of our world",author:"Michael Stifter"}},e.getUserFromStorage().then(function(t){n.user=t,r.init().then(function(t){n.$broadcast("countries.loaded",t),o.setCountries(t)})})["catch"](function(n){}),n.$on("app.login",function(e,u){n.user=u,r.init().then(function(t){n.$broadcast("countries.loaded",t),o.setCountries(t)}),t.go("quiz")}),n.$on("app.logout",function(e,r){n.user=null,t.go("home")})}]),angular.module("magellan").factory("AuthTokenSrv",["$window",function(n){var t=n.sessionStorage,e="auth-token",r=function(){return t.getItem(e)},o=function(n){n?t.setItem(e,n):t.removeItem(e)};return{getToken:r,setToken:o}}]),angular.module("magellan").factory("AuthInterceptor",["AuthTokenSrv",function(n){var t=function(t){var e=n.getToken();return e&&(t.headers=t.headers||{},t.headers["X-Auth"]=e),t};return{request:t}}]),angular.module("magellan").factory("CountrySrv",["$http","IndexedDBSrv","LogSrv",function(n,t,e){var r=null,o="magellan",u="countryStore",i="countries",a="version",s=t.indexedDBAvailable(),c=function(){return l()},l=function(){return s?new Promise(function(n,i){t.createDatabase(o,u).then(d).then(m).then(p).then(f).then(g).then(function(t){r=t.countries,e.info("loaded countries from",t.loadStrategy.toUpperCase()),n(r)})["catch"](function(n){e.error("failed to load countries",n),i(n)})}):v()},f=function(n){return new Promise(function(t,e){var r,o=n.internalVersion,u=n.externalVersion;r=null===o?"api":u>o?"api":"db",n.loadStrategy=r,t(n)})},g=function(n){return new Promise(function(e,r){var s=n.loadStrategy;switch(s){case"api":v().then(function(r){n.countries=r,t.putItem(o,u,{name:i,value:r}),t.putItem(o,u,{name:a,value:n.externalVersion}),e(n)})["catch"](function(n){r(n)});break;case"db":h(n).then(function(n){e(n)})["catch"](function(n){r(n)});break;default:r("Unknown load strategy")}})},d=function(){return new Promise(function(n,t){n({})})},m=function(n){return new Promise(function(e,r){t.retrieveItem(o,u,a).then(function(t){n.internalVersion=t.value,e(n)})["catch"](function(t){n.internalVersion=null,e(n)})})},p=function(n){return w().then(function(t){return n.externalVersion=t,n})},h=function(n){return new Promise(function(e,r){t.retrieveItem(o,u,i).then(function(t){n.countries=t.value,e(n)})["catch"](function(n){e(null)})})},v=function(){return new Promise(function(t,e){n.get("/api/countries").then(function(n){t(n.data)})["catch"](function(n){e(n)})})},w=function(){return new Promise(function(t,e){n.get("/api/countries/version").then(function(n){t(n.data.version||0)})["catch"](function(n){t(0)})})};return{init:c}}]),angular.module("magellan").controller("DropdownCtrl",["$scope",function(n){function t(){u=!u}function e(){u=!0}function r(){u=!1}function o(){return u}var u=!1;n.toggleDropdown=t,n.showDropdown=e,n.hideDropdown=r,n.isDropdownVisible=o}]),angular.module("magellan").factory("FocusSrv",["$timeout","$window",function(n,t){return function(e){n(function(){var n=t.document.getElementById(e);n&&n.focus()})}}]),angular.module("magellan").factory("IndexedDBSrv",["$window",function(n){var t="name",e=n.indexedDB||n.webkitIndexedDB||n.msIndexedDB,r=n.IDBKeyRange||n.webkitIDBKeyRange,o=n.IDBTransaction||n.webkitIDBTransaction;o&&(o.READ_WRITE=o.READ_WRITE||"readwrite",o.READ_ONLY=o.READ_ONLY||"readonly");var u=function(){return!!e},i=function(n,r){return new Promise(function(o,u){var i=e.open(n);i.onupgradeneeded=function(n){var e=n.target.result;e.createObjectStore(r,{keyPath:t})},i.onsuccess=function(n){o(n)},i.onerror=function(n){u(n)}})},a=function(n){return new Promise(function(t,r){var o=e.deleteDatabase(n);o.onsuccess=function(n){t(n)},o.onerror=function(n){r(n)}})},s=function(n,t,r){return new Promise(function(u,i){var a=e.open(n);a.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_WRITE),s=a.objectStore(t),c=s.add(r);c.onsuccess=function(n){u(n)},c.onerror=function(n){i(n)}}})},c=function(n,t,r){return new Promise(function(u,i){var a=e.open(n);a.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_WRITE),s=a.objectStore(t),c=s.put(r);c.onsuccess=function(n){u(n)},c.onerror=function(n){i(n)}}})},l=function(n,t,u){return new Promise(function(i,a){var s=null,c=e.open(n);c.onsuccess=function(n){var e=n.target.result,a=e.transaction(t,o.READ_ONLY),c=a.objectStore(t),l=r.only(u);c.openCursor(l).onsuccess=function(n){var t=n.target.result;t?(s=t.value,t["continue"]()):i(s)}},c.onerror=function(n){a(n)}})},f=function(n,t){return new Promise(function(r,u){var i=[],a=e.open(n);a.onsuccess=function(n){var e=n.target.result,u=e.transaction(t,o.READ_ONLY),a=u.objectStore(t);a.openCursor().onsuccess=function(n){var t=n.target.result;t?(i.push(t.value),t["continue"]()):r(i)}},a.onerror=function(n){u(n)}})};return{createDatabase:i,dropDatabase:a,addItem:s,putItem:c,retrieveItem:l,retrieveItems:f,indexedDBAvailable:u}}]),angular.module("magellan").factory("LogSrv",["AppConfig",function(n){var t=function(){n["log.info"]&&console.log.apply(console,arguments)},e=function(){n["log.error"]&&console.error.apply(console,arguments)};return{info:t,error:e}}]),angular.module("magellan").controller("LoginCtrl",["$scope","UserSrv","FocusSrv",function(n,t,e){n.login=function(e,r){t.login(e,r).then(function(t){n.$emit("app.login",t.data)})["catch"](function(n){console.error(n)})},e("username")}]),angular.module("magellan").controller("LogoutCtrl",["$scope","UserSrv",function(n,t){t.logout().then(function(){n.$emit("app.logout")})}]);var Quiz=function(){var n=[],t=!0;this.addQuestion=function(t){n.push(t)},this.getQuestions=function(){return n},this.isActive=function(){return t}},Question=function(n){n=n||{},this.type=n.type||this.getRandomType(),this.country=n.country||null,this.state=n.state||this.states.NOT_ANSWERED};Question.prototype.states={NOT_ANSWERED:1,CORRECT:2,INCORRECT:3},Question.prototype.types={CAPITAL_OF_COUNTRY:"capital-of-country",COUNTRY_OF_CAPITAL:"country-of-capital",INHABITANTS_OF_COUNTRY:"inhabitants-of-country"},Question.prototype.getRandomType=function(){var n=Object.keys(this.types);return this.types[n[getRandomInt(0,n.length-1)]]};var getRandomInt=function(n,t){return Math.floor(Math.random()*(t-n+1))+n},getStringBetween=function(n,t,e){var r=n.indexOf(t),o=n.indexOf(e);return r>=0&&o>=0&&o>r?n.substr(r+1,o-r-1):null};angular.module("magellan").controller("QuizCtrl",["$scope","QuizSrv","LogSrv","FocusSrv","ngProgressFactory",function(n,t,e,r,o){n.progressbar=o.createInstance();var u=function(){t.init().then(function(){r("answer")})["catch"](function(n){e.error("Could not start quiz",n)})},i=function(){return t.isQuizRunning()},a=function(){return t.getCurrentQuestionNumber()},s=function(){return t.getNumberOfQuizQuestions()},c=function(){return g(t.getQuestionText(),"question-highlight")+"?"},l=function(){return g(t.getAnswerText(),"answer-highlight-"+t.getAnswerStatus())},f=function(){return t.questionAnswered()},g=function(n,t){return n.replace("[","<span class='"+t+"'>").replace("]","</span>")},d=function(n){n&&t.submitAnswer(n)},f=function(){return t.questionAnswered()},m=function(){n.qu.answer="",t.nextQuestion(),n.progressbar.set(100*t.getProgressPercentage()),r("answer")},p=function(t){13==t.which&&d(n.qu.answer)};n.startQuiz=u,n.isQuizRunning=i,n.getCurrentQuestionNumber=a,n.getNumberOfQuizQuestions=s,n.getQuestionText=c,n.getAnswerText=l,n.submitAnswer=d,n.questionAnswered=f,n.nextQuestion=m,n.handleKeyPress=p,n.qu={answer:""}}]),angular.module("magellan").factory("QuizSrv",["AppConfig","LogSrv",function(n,t){var e=null,r=null,o=null,u=function(){return new Promise(function(t,e){s()||e("Countries not loaded"),null!==r&&r.isActive()===!0&&e("A quiz is currently being played"),r=new Quiz;for(var u=0;u<n["quiz.questions.number"];u++)r.addQuestion(new Question({country:a()}));o=0,t()})},i=function(n){e=n},a=function(){return e[getRandomInt(0,e.length-1)]},s=function(){return null!==e&&e.length>0},c=function(){return null!==r},l=function(){return r.getQuestions()[o]},f=function(){return null!==o?o+1:null},g=function(){return null!==r?r.getQuestions().length:null},d=function(n){var t=l(),e=p(t);t.state=n===e?t.states.CORRECT:t.states.INCORRECT},m=function(){var n=l();switch(n.type){case n.types.CAPITAL_OF_COUNTRY:return"Wie hei√üt die Hauptstadt von ["+(n.country.translations.de||n.country.name)+"]";case n.types.COUNTRY_OF_CAPITAL:return"["+n.country.capital+"] ist die Hauptstadt von welchem Land";case n.types.INHABITANTS_OF_COUNTRY:return"Wie viele Einwohner hat ["+(n.country.translations.de||n.country.name)+"]";default:t.error("Unknown question type",n.type)}},p=function(n){if(n&&n.type)switch(n.type){case n.types.CAPITAL_OF_COUNTRY:return n.country.capital;case n.types.COUNTRY_OF_CAPITAL:return n.country.translations.de||n.country.name;case n.types.INHABITANTS_OF_COUNTRY:return n.country.population;default:return t.error("Unknown question type",n.type),null}},h=function(){var n=l(),t=n.state;switch(t){case n.states.CORRECT:return"correct";case n.states.INCORRECT:return"incorrect";default:return null}},v=function(){var n=l();return n.state!==n.states.NOT_ANSWERED},w=function(){var n=l();return"["+p(n)+"]"},y=function(){f()+1<=g()&&o++},A=function(){return(f()-1)/g()};return{init:u,setCountries:i,isQuizRunning:c,getCurrentQuestionNumber:f,getNumberOfQuizQuestions:g,getQuestionText:m,getAnswerStatus:h,getAnswerText:w,submitAnswer:d,questionAnswered:v,nextQuestion:y,getProgressPercentage:A}}]),angular.module("magellan").filter("renderHtml",["$sce",function(n){return n.trustAsHtml}]),angular.module("magellan").config(["$locationProvider","$stateProvider","$urlRouterProvider",function(n,t,e){n.html5Mode(!0),e.otherwise("/home"),t.state("home",{url:"/home",templateUrl:"/build/views/home.partial.html"}).state("quiz",{url:"/quiz",templateUrl:"/build/views/quiz.partial.html"}).state("login",{url:"/login",templateUrl:"/build/views/login.partial.html"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}).state("register",{url:"/register",templateUrl:"/build/views/register.partial.html"}).state("about",{url:"/about",templateUrl:"/build/views/about.partial.html"})}]),angular.module("magellan").factory("UserSrv",["$http","AuthTokenSrv",function(n,t){var e=this,r=function(){return n.get("/api/user")},o=function(){return new Promise(function(n,e){var o=t.getToken();o?(t.setToken(o),r().then(function(t){n(t.data)})["catch"](function(n){e(n)})):e("No token in storage")})},u=function(o,u){return n.post("/api/session",{username:o,password:u}).then(function(n){return e.token=n.data,t.setToken(e.token),r()})},i=function(){return new Promise(function(n,r){e.token=null,t.setToken(),n()})};return{getUser:r,getUserFromStorage:o,login:u,logout:i}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjcmlwdC5qcyIsImF1dGgtdG9rZW4uc2VydmljZS5qcyIsImF1dGguaW50ZXJjZXB0b3IuanMiLCJjb3VudHJ5LnNlcnZpY2UuanMiLCJkcm9wZG93bi5jdHJsLmpzIiwiZm9jdXMuc2VydmljZS5qcyIsImluZGV4ZWQtZGIuc2VydmljZS5qcyIsImxvZy5zZXJ2aWNlLmpzIiwibG9naW4uY3RybC5qcyIsImxvZ291dC5jdHJsLmpzIiwibW9kZWxzLmpzIiwicXVpei5jdHJsLmpzIiwicXVpei5zZXJ2aWNlLmpzIiwicmVuZGVySHRtbC5maWx0ZXIuanMiLCJyb3V0ZXMuanMiLCJ1c2VyLnNlcnZpY2UuanMiXSwibmFtZXMiOlsibWFnZWxsYW4iLCJhbmd1bGFyIiwibW9kdWxlIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCJjb25zdGFudCIsImxvZy5pbmZvIiwibG9nLmVycm9yIiwicXVpei5xdWVzdGlvbnMubnVtYmVyIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRzdGF0ZSIsIlVzZXJTcnYiLCJDb3VudHJ5U3J2IiwiUXVpelNydiIsImFwcCIsImNvbmZpZyIsInRpdGxlIiwic3VidGl0bGUiLCJhdXRob3IiLCJnZXRVc2VyRnJvbVN0b3JhZ2UiLCJ0aGVuIiwidXNlciIsImluaXQiLCJjb3VudHJpZXMiLCIkYnJvYWRjYXN0Iiwic2V0Q291bnRyaWVzIiwiZXJyIiwiJG9uIiwiZXZlbnQiLCJkYXRhIiwiZ28iLCJmYWN0b3J5IiwiJHdpbmRvdyIsInN0b3JlIiwic2Vzc2lvblN0b3JhZ2UiLCJrZXkiLCJnZXRUb2tlbiIsImdldEl0ZW0iLCJzZXRUb2tlbiIsInRva2VuIiwic2V0SXRlbSIsInJlbW92ZUl0ZW0iLCJBdXRoVG9rZW5TcnYiLCJhZGRUb2tlbiIsImhlYWRlcnMiLCJyZXF1ZXN0IiwiJGh0dHAiLCJJbmRleGVkREJTcnYiLCJMb2dTcnYiLCJkYXRhYmFzZSIsImtleUNvdW50cmllcyIsImtleVZlcnNpb24iLCJpbmRleGVkREJBdmFpbGFibGUiLCJsb2FkQ291bnRyaWVzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjcmVhdGVEYXRhYmFzZSIsImdldEVtcHR5T2JqZWN0IiwiZ2V0SW50ZXJuYWxWZXJzaW9uIiwiZ2V0RXh0ZXJuYWxWZXJzaW9uIiwiZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5IiwibG9hZERhdGEiLCJvYmoiLCJpbmZvIiwidG9VcHBlckNhc2UiLCJlcnJvciIsImdldENvdW50cmllc0Zyb21BUEkiLCJzdHJhdGVneSIsImludGVybmFsVmVyc2lvbiIsImV4dGVybmFsVmVyc2lvbiIsInB1dEl0ZW0iLCJuYW1lIiwidmFsdWUiLCJnZXRDb3VudHJpZXNGcm9tREIiLCJfb2JqIiwicmV0cmlldmVJdGVtIiwiaXRlbSIsImdldFZlcnNpb25Gcm9tQVBJIiwidmVyc2lvbiIsImdldCIsInJlc3BvbnNlIiwidG9nZ2xlRHJvcGRvd24iLCJ2aXNpYmxlIiwic2hvd0Ryb3Bkb3duIiwiaGlkZURyb3Bkb3duIiwiaXNEcm9wZG93blZpc2libGUiLCIkdGltZW91dCIsImlkIiwiZWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJmb2N1cyIsImtleVBhdGgiLCJpbmRleGVkREIiLCJ3ZWJraXRJbmRleGVkREIiLCJtc0luZGV4ZWREQiIsIklEQktleVJhbmdlIiwid2Via2l0SURCS2V5UmFuZ2UiLCJJREJUcmFuc2FjdGlvbiIsIndlYmtpdElEQlRyYW5zYWN0aW9uIiwiUkVBRF9XUklURSIsIlJFQURfT05MWSIsImRiTmFtZSIsInN0b3JlTmFtZSIsIm9wZW4iLCJvbnVwZ3JhZGVuZWVkZWQiLCJlIiwiaWRiIiwidGFyZ2V0IiwicmVzdWx0IiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJvbnN1Y2Nlc3MiLCJvbmVycm9yIiwiZHJvcERhdGFiYXNlIiwiZGVsZXRlRGF0YWJhc2UiLCJhZGRJdGVtIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsInJlcXVlc3RBZGQiLCJhZGQiLCJwdXQiLCJpdGVtTmFtZSIsInJhbmdlIiwib25seSIsIm9wZW5DdXJzb3IiLCJjdXJzb3IiLCJyZXRyaWV2ZUl0ZW1zIiwiaXRlbXMiLCJBcHBDb25maWciLCJsb2dJbmZvIiwiY29uc29sZSIsImxvZyIsImFwcGx5IiwiYXJndW1lbnRzIiwibG9nRXJyb3IiLCJGb2N1c1NydiIsImxvZ2luIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsIiRlbWl0IiwibG9nb3V0IiwiUXVpeiIsInF1ZXN0aW9ucyIsImFjdGl2ZSIsInRoaXMiLCJhZGRRdWVzdGlvbiIsInF1ZXN0aW9uIiwiZ2V0UXVlc3Rpb25zIiwiaXNBY3RpdmUiLCJRdWVzdGlvbiIsIm9wdGlvbnMiLCJ0eXBlIiwiZ2V0UmFuZG9tVHlwZSIsImNvdW50cnkiLCJzdGF0ZSIsInN0YXRlcyIsIk5PVF9BTlNXRVJFRCIsInByb3RvdHlwZSIsIkNPUlJFQ1QiLCJJTkNPUlJFQ1QiLCJ0eXBlcyIsIkNBUElUQUxfT0ZfQ09VTlRSWSIsIkNPVU5UUllfT0ZfQ0FQSVRBTCIsIklOSEFCSVRBTlRTX09GX0NPVU5UUlkiLCJPYmplY3QiLCJrZXlzIiwiZ2V0UmFuZG9tSW50IiwibGVuZ3RoIiwibWluIiwibWF4IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiZ2V0U3RyaW5nQmV0d2VlbiIsInRleHQiLCJmaXJzdFN0cmluZyIsInNlY29uZFN0cmluZyIsImZpcnN0UG9zIiwiaW5kZXhPZiIsInNlY29uZFBvcyIsInN1YnN0ciIsIm5nUHJvZ3Jlc3NGYWN0b3J5IiwicHJvZ3Jlc3NiYXIiLCJjcmVhdGVJbnN0YW5jZSIsInN0YXJ0UXVpeiIsImlzUXVpelJ1bm5pbmciLCJnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIiLCJnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMiLCJnZXRRdWVzdGlvblRleHQiLCJyZW5kZXJRdWVzdGlvbiIsImdldEFuc3dlclRleHQiLCJnZXRBbnN3ZXJTdGF0dXMiLCJxdWVzdGlvbkFuc3dlcmVkIiwiY2xhc3NOYW1lIiwicmVwbGFjZSIsInN1Ym1pdEFuc3dlciIsImFuc3dlciIsIm5leHRRdWVzdGlvbiIsInF1Iiwic2V0IiwiZ2V0UHJvZ3Jlc3NQZXJjZW50YWdlIiwiaGFuZGxlS2V5UHJlc3MiLCJrZXlFdmVudCIsIndoaWNoIiwicXVpeiIsImN1cnJlbnRRdWVzdGlvbk5vIiwiY291bnRyaWVzTG9hZGVkIiwiaSIsImdldFJhbmRvbUNvdW50cnkiLCJfY291bnRyaWVzIiwiZ2V0Q3VycmVudFF1ZXN0aW9uIiwiY29ycmVjdEFuc3dlciIsImdldEFuc3dlclRvUXVlc3Rpb24iLCJ0cmFuc2xhdGlvbnMiLCJkZSIsImNhcGl0YWwiLCJwb3B1bGF0aW9uIiwiZmlsdGVyIiwiJHNjZSIsInRydXN0QXNIdG1sIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsImh0bWw1TW9kZSIsIm90aGVyd2lzZSIsInVybCIsInRlbXBsYXRlVXJsIiwic2VsZiIsImdldFVzZXIiLCJwb3N0Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxVQUFBQyxRQUFBQyxPQUFBLFlBQ0EsWUFDQSxlQ0NJLGdCREFKLFNBQUFDLEdBQ0FBLEVBQUFDLGFBQUFDLEtBQUEscUJBSUFMLFVBQUFNLFNBQUEsYUFDQUMsWUFBQSxFQUNBQyxhQUFBLEVBRUFDLHdCQUFBLElBR0FULFNBQUFVLFdBQUEsV0FBQSxTQUFBLFNBQUEsVUFBQSxhQUFBLFVBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FFQUosRUFBQUssS0FDQUMsUUFDQUMsTUFBQSxXQUNBQyxTQUFBLHVEQUNBQyxPQUFBLG9CQUtBUCxFQUFBUSxxQkFDQUMsS0FBQSxTQUFBQyxHQUVBWixFQUFBWSxLQUFBQSxFQUdBVCxFQUFBVSxPQUNBRixLQUFBLFNBQUFHLEdBQ0FkLEVBQUFlLFdBQUEsbUJBQUFELEdBR0FWLEVBQUFZLGFBQUFGLE9BWEFaLFNBY0EsU0FBQWUsTUFLQWpCLEVBQUFrQixJQUFBLFlBQUEsU0FBQUMs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QUE3TCxNQUFBMEMsRUFBQXBELEtBR0FhLEVBQUFKLFNBQUE4TCxFQUFBN0wsT0FFQThMLE9BSUF4RixFQUFBLFdBQ0EsTUFBQSxJQUFBdkYsU0FBQSxTQUFBQyxFQUFBQyxHQUNBNEssRUFBQTdMLE1BQUEsS0FHQUcsRUFBQUosV0FFQWlCLE1BSUEsUUFDQThLLFFBQUFBLEVBQ0FsTixtQkFBQUEsRUFDQXNILE1BQUFBLEVBQ0FJLE9BQUFBIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBtYWdlbGxhbiA9IGFuZ3VsYXIubW9kdWxlKFwibWFnZWxsYW5cIiwgW1xyXG4gICAgJ3VpLnJvdXRlcicsXHJcbiAgICAnbmdQcm9ncmVzcydcclxuXSwgZnVuY3Rpb24gY29uZmlnKCRodHRwUHJvdmlkZXIpIHtcclxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG59KTtcclxuXHJcbi8vIGRlZmluZSBhcHBsaWNhdGlvbiBjb25zdGFudHNcclxubWFnZWxsYW4uY29uc3RhbnQoXCJBcHBDb25maWdcIiwge1xyXG4gICAgXCJsb2cuaW5mb1wiOiB0cnVlLFxyXG4gICAgXCJsb2cuZXJyb3JcIjogdHJ1ZSxcclxuXHJcbiAgICBcInF1aXoucXVlc3Rpb25zLm51bWJlclwiOiA1XHJcbn0pO1xyXG5cclxubWFnZWxsYW4uY29udHJvbGxlcihcIkFwcEN0cmxcIiwgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIFVzZXJTcnYsIENvdW50cnlTcnYsIFF1aXpTcnYpIHtcclxuICAgIC8vIC0tLS0tLS0tLS0tIEFwcCBjb25maWcgLS0tLS0tLS0tLS0tXHJcbiAgICAkc2NvcGUuYXBwID0ge1xyXG4gICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICB0aXRsZTogXCJNYWdlbGxhblwiLFxyXG4gICAgICAgICAgICBzdWJ0aXRsZTogXCJUZXN0IHlvdXIga25vd2xlZGdlIGFib3V0IHRoZSBjb3VudHJpZXMgb2Ygb3VyIHdvcmxkXCIsXHJcbiAgICAgICAgICAgIGF1dGhvcjogXCJNaWNoYWVsIFN0aWZ0ZXJcIlxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gLS0tLS0tLS0tLS0gQXBwIGluaXRpYWxpemF0aW9uIC0tLS0tLS0tLS0tLVxyXG4gICAgVXNlclNydi5nZXRVc2VyRnJvbVN0b3JhZ2UoKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXIpIHtcclxuICAgICAgICAgICAgLy8gc3RvcmUgdXNlciBvYmplY3QgaW4gc2NvcGVcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xyXG5cclxuICAgICAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICAgICAgQ291bnRyeVNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGNvdW50cmllcyBpbiBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICBRdWl6U3J2LnNldENvdW50cmllcyhjb3VudHJpZXMpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgIC8vIHRoZSBvbmx5IGVycm9yIHRoYXQgY2FuIG9jY3VyIGlzIHRoYXQgdGhlcmUgaXMgbm8gdG9rZW4gaW4gc3RvcmFnZSwgd2UgZG8gbm90IG5lZWQgdG8gcmVhY3QgdG8gdGhhdFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEV2ZW50IGhhbmRsaW5nIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ2luJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAvLyBzdG9yZSB1c2VyIG9iamVjdCBpbiBzY29wZVxyXG4gICAgICAgICRzY29wZS51c2VyID0gZGF0YTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBjb3VudHJ5IHNlcnZpY2VcclxuICAgICAgICBDb3VudHJ5U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjb3VudHJpZXMubG9hZGVkJywgY291bnRyaWVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgY291bnRyaWVzIGluIHF1aXogc2VydmljZVxyXG4gICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIHF1aXogcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygncXVpeicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJHNjb3BlLiRvbignYXBwLmxvZ291dCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gcmVtb3ZlIHVzZXIgb2JqZWN0IGZyb20gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIGdvIHRvIGhvbWUgcGFnZVxyXG4gICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xyXG4gICAgfSk7XHJcbn0pOyIsInZhciBtYWdlbGxhbiA9IGFuZ3VsYXIubW9kdWxlKFwibWFnZWxsYW5cIiwgW1xyXG4gICAgJ3VpLnJvdXRlcicsXHJcbiAgICAnbmdQcm9ncmVzcydcclxuXSwgW1wiJGh0dHBQcm92aWRlclwiLCBmdW5jdGlvbiBjb25maWcoJGh0dHBQcm92aWRlcikge1xyXG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXV0aEludGVyY2VwdG9yJyk7XHJcbn1dKTtcclxuXHJcbi8vIGRlZmluZSBhcHBsaWNhdGlvbiBjb25zdGFudHNcclxubWFnZWxsYW4uY29uc3RhbnQoXCJBcHBDb25maWdcIiwge1xyXG4gICAgXCJsb2cuaW5mb1wiOiB0cnVlLFxyXG4gICAgXCJsb2cuZXJyb3JcIjogdHJ1ZSxcclxuXHJcbiAgICBcInF1aXoucXVlc3Rpb25zLm51bWJlclwiOiA1XHJcbn0pO1xyXG5cclxubWFnZWxsYW4uY29udHJvbGxlcihcIkFwcEN0cmxcIiwgW1wiJHNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiVXNlclNydlwiLCBcIkNvdW50cnlTcnZcIiwgXCJRdWl6U3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgJHN0YXRlLCBVc2VyU3J2LCBDb3VudHJ5U3J2LCBRdWl6U3J2KSB7XHJcbiAgICAvLyAtLS0tLS0tLS0tLSBBcHAgY29uZmlnIC0tLS0tLS0tLS0tLVxyXG4gICAgJHNjb3BlLmFwcCA9IHtcclxuICAgICAgICBjb25maWc6IHtcclxuICAgICAgICAgICAgdGl0bGU6IFwiTWFnZWxsYW5cIixcclxuICAgICAgICAgICAgc3VidGl0bGU6IFwiVGVzdCB5b3VyIGtub3dsZWRnZSBhYm91dCB0aGUgY291bnRyaWVzIG9mIG91ciB3b3JsZFwiLFxyXG4gICAgICAgICAgICBhdXRob3I6IFwiTWljaGFlbCBTdGlmdGVyXCJcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIEFwcCBpbml0aWFsaXphdGlvbiAtLS0tLS0tLS0tLS1cclxuICAgIFVzZXJTcnYuZ2V0VXNlckZyb21TdG9yYWdlKClcclxuICAgICAgICAudGhlbihmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICAgICAgIC8vIHN0b3JlIHVzZXIgb2JqZWN0IGluIHNjb3BlXHJcbiAgICAgICAgICAgICRzY29wZS51c2VyID0gdXNlcjtcclxuXHJcbiAgICAgICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIENvdW50cnlTcnYuaW5pdCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb3VudHJpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBjb3VudHJpZXMgaW4gcXVpeiBzZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgUXVpelNydi5zZXRDb3VudHJpZXMoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAvLyB0aGUgb25seSBlcnJvciB0aGF0IGNhbiBvY2N1ciBpcyB0aGF0IHRoZXJlIGlzIG5vIHRva2VuIGluIHN0b3JhZ2UsIHdlIGRvIG5vdCBuZWVkIHRvIHJlYWN0IHRvIHRoYXRcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAvLyAtLS0tLS0tLS0tLSBFdmVudCBoYW5kbGluZyAtLS0tLS0tLS0tLS1cclxuICAgICRzY29wZS4kb24oJ2FwcC5sb2dpbicsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gc3RvcmUgdXNlciBvYmplY3QgaW4gc2NvcGVcclxuICAgICAgICAkc2NvcGUudXNlciA9IGRhdGE7XHJcblxyXG4gICAgICAgIC8vIGluaXQgY291bnRyeSBzZXJ2aWNlXHJcbiAgICAgICAgQ291bnRyeVNydi5pbml0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY291bnRyaWVzLmxvYWRlZCcsIGNvdW50cmllcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2V0IGNvdW50cmllcyBpbiBxdWl6IHNlcnZpY2VcclxuICAgICAgICAgICAgICAgIFF1aXpTcnYuc2V0Q291bnRyaWVzKGNvdW50cmllcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBnbyB0byBxdWl6IHBhZ2VcclxuICAgICAgICAkc3RhdGUuZ28oJ3F1aXonKTtcclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS4kb24oJ2FwcC5sb2dvdXQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xyXG4gICAgICAgIC8vIHJlbW92ZSB1c2VyIG9iamVjdCBmcm9tIHNjb3BlXHJcbiAgICAgICAgJHNjb3BlLnVzZXIgPSBudWxsO1xyXG5cclxuICAgICAgICAvLyBnbyB0byBob21lIHBhZ2VcclxuICAgICAgICAkc3RhdGUuZ28oJ2hvbWUnKTtcclxuICAgIH0pO1xyXG59XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFRva2VuU3J2JywgW1wiJHdpbmRvd1wiLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJHdpbmRvdy5zZXNzaW9uU3RvcmFnZTtcclxuICAgICAgICB2YXIga2V5ID0gJ2F1dGgtdG9rZW4nO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0VG9rZW4gPSBmdW5jdGlvbih0b2tlbikge1xyXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnNldEl0ZW0oa2V5LCB0b2tlbik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRUb2tlbjogZ2V0VG9rZW4sXHJcbiAgICAgICAgICAgIHNldFRva2VuOiBzZXRUb2tlblxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgW1wiQXV0aFRva2VuU3J2XCIsIGZ1bmN0aW9uKEF1dGhUb2tlblNydikge1xyXG4gICAgICAgIHZhciBhZGRUb2tlbiA9IGZ1bmN0aW9uKGNvbmZpZykge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydYLUF1dGgnXSA9IHRva2VuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGFkZFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdDb3VudHJ5U3J2JywgW1wiJGh0dHBcIiwgXCJJbmRleGVkREJTcnZcIiwgXCJMb2dTcnZcIiwgZnVuY3Rpb24oJGh0dHAsIEluZGV4ZWREQlNydiwgTG9nU3J2KSB7XHJcbiAgICAgICAgLy8gQ291bnRyaWVzIGFycmF5XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIEluZGV4ZWREQlxyXG4gICAgICAgIHZhciBkYXRhYmFzZSA9ICdtYWdlbGxhbic7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJ2NvdW50cnlTdG9yZSc7XHJcbiAgICAgICAgdmFyIGtleUNvdW50cmllcyA9ICdjb3VudHJpZXMnO1xyXG4gICAgICAgIHZhciBrZXlWZXJzaW9uID0gJ3ZlcnNpb24nO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gSW5kZXhlZERCU3J2LmluZGV4ZWREQkF2YWlsYWJsZSgpO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZENvdW50cmllcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkQ291bnRyaWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGluZGV4ZWREQiBpcyBhdmFpbGFibGVcclxuICAgICAgICAgICAgaWYgKGluZGV4ZWREQkF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBkYXRhYmFzZSBleGlzdHNcclxuICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYuY3JlYXRlRGF0YWJhc2UoZGF0YWJhc2UsIHN0b3JlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFbXB0eU9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0SW50ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFeHRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGRldGVybWluZUxvYWRTdHJhdGVneSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obG9hZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzID0gb2JqWydjb3VudHJpZXMnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbyhcImxvYWRlZCBjb3VudHJpZXMgZnJvbVwiLCBvYmpbJ2xvYWRTdHJhdGVneSddLnRvVXBwZXJDYXNlKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiZmFpbGVkIHRvIGxvYWQgY291bnRyaWVzXCIsIGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBub3QsIHdlIGFsd2F5cyB0cnkgdG8gZG93bmxvYWQgaXQgZnJvbSB0aGUgY291bnRyeSBBUEkgZW5kcG9pbnRcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRDb3VudHJpZXNGcm9tQVBJKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5ID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaW50ZXJuYWxWZXJzaW9uID0gb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGV4dGVybmFsVmVyc2lvbiA9IG9ialtcImV4dGVybmFsVmVyc2lvblwiXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaW50ZXJuYWxWZXJzaW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ZXJuYWxWZXJzaW9uID4gaW50ZXJuYWxWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnZGInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIG9ialsnbG9hZFN0cmF0ZWd5J10gPSBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkRGF0YSA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyYXRlZ3kgPSBvYmpbJ2xvYWRTdHJhdGVneSddO1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdhcGknOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDb3VudHJpZXNGcm9tQVBJKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGNvdW50cmllcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmUgY291bnRyaWVzIGFuZCB2ZXJzaW9uIG51bWJlciBpbiBkYXRhYmFzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlDb3VudHJpZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAgY291bnRyaWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlWZXJzaW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdkYic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21EQihvYmopXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihfb2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfb2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ1Vua25vd24gbG9hZCBzdHJhdGVneScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RW1wdHlPYmplY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7fSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRJbnRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleVZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBpdGVtLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0ZXJuYWxWZXJzaW9uID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRWZXJzaW9uRnJvbUFQSSgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbih2ZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdID0gdmVyc2lvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNGcm9tREIgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleUNvdW50cmllcylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21BUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdW50cmllcycpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRWZXJzaW9uRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzL3ZlcnNpb24nKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YS52ZXJzaW9uIHx8IDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdEcm9wZG93bkN0cmwnLCBbXCIkc2NvcGVcIiwgZnVuY3Rpb24oJHNjb3BlKSB7XHJcbiAgICAgICAgdmFyIHZpc2libGUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnRvZ2dsZURyb3Bkb3duID0gdG9nZ2xlRHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLnNob3dEcm9wZG93biA9IHNob3dEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuaGlkZURyb3Bkb3duID0gaGlkZURyb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5pc0Ryb3Bkb3duVmlzaWJsZSA9IGlzRHJvcGRvd25WaXNpYmxlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB0b2dnbGVEcm9wZG93bigpIHtcclxuICAgICAgICAgICAgdmlzaWJsZSA9ICF2aXNpYmxlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd0Ryb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhpZGVEcm9wZG93bigpIHtcclxuICAgICAgICAgICAgdmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNEcm9wZG93blZpc2libGUoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2aXNpYmxlO1xyXG4gICAgICAgIH1cclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdGb2N1c1NydicsIFtcIiR0aW1lb3V0XCIsIFwiJHdpbmRvd1wiLCBmdW5jdGlvbigkdGltZW91dCwgJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihpZCkge1xyXG4gICAgICAgICAgICAvLyB0aW1lb3V0IG1ha2VzIHN1cmUgdGhhdCBpcyBpbnZva2VkIGFmdGVyIGFueSBvdGhlciBldmVudCBoYXMgYmVlbiB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgIC8vIGUuZy4gY2xpY2sgZXZlbnRzIHRoYXQgbmVlZCB0byBydW4gYmVmb3JlIHRoZSBmb2N1cyBvclxyXG4gICAgICAgICAgICAvLyBpbnB1dHMgZWxlbWVudHMgdGhhdCBhcmUgaW4gYSBkaXNhYmxlZCBzdGF0ZSBidXQgYXJlIGVuYWJsZWQgd2hlbiB0aG9zZSBldmVudHNcclxuICAgICAgICAgICAgLy8gYXJlIHRyaWdnZXJlZC5cclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICR3aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0luZGV4ZWREQlNydicsIFtcIiR3aW5kb3dcIiwgZnVuY3Rpb24oJHdpbmRvdykge1xyXG4gICAgICAgIHZhciBrZXlQYXRoID0gJ25hbWUnO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCID0gJHdpbmRvdy5pbmRleGVkREIgfHwgJHdpbmRvdy53ZWJraXRJbmRleGVkREIgfHwgJHdpbmRvdy5tc0luZGV4ZWREQjtcclxuICAgICAgICB2YXIgSURCS2V5UmFuZ2UgPSAkd2luZG93LklEQktleVJhbmdlIHx8ICR3aW5kb3cud2Via2l0SURCS2V5UmFuZ2U7XHJcblxyXG4gICAgICAgIHZhciBJREJUcmFuc2FjdGlvbiA9ICR3aW5kb3cuSURCVHJhbnNhY3Rpb24gfHwgJHdpbmRvdy53ZWJraXRJREJUcmFuc2FjdGlvbjtcclxuXHJcbiAgICAgICAgaWYgKElEQlRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgPSBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFIHx8ICdyZWFkd3JpdGUnO1xyXG4gICAgICAgICAgICBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkgPSBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkgfHwgJ3JlYWRvbmx5JztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREJBdmFpbGFibGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGluZGV4ZWREQiA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY3JlYXRlRGF0YWJhc2UgPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZSBpcyBhbiBpbnN0YW5jZSBvZiBJREJWZXJzaW9uQ2hhbmdlRXZlbnRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSBpZGIuY3JlYXRlT2JqZWN0U3RvcmUoc3RvcmVOYW1lLCB7IGtleVBhdGg6IGtleVBhdGggfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCwgdXBkYXRlLCBkZWxldGVcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIGVycm9yXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGRyb3BEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3Agc3VjY2Vzc2Z1bFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkcm9wIGZhaWxlZFxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBhZGRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5hZGQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcHV0SXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0QWRkID0gc3RvcmUucHV0KGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0QWRkLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHJldHJpZXZlSXRlbSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lLCBpdGVtTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBJREJLZXlSYW5nZS5vbmx5KGl0ZW1OYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUub3BlbkN1cnNvcihyYW5nZSkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGN1cnNvci52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtcyA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGlkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUub3BlbkN1cnNvcigpLm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY3JlYXRlRGF0YWJhc2U6IGNyZWF0ZURhdGFiYXNlLFxyXG4gICAgICAgICAgICBkcm9wRGF0YWJhc2U6IGRyb3BEYXRhYmFzZSxcclxuICAgICAgICAgICAgYWRkSXRlbTogYWRkSXRlbSxcclxuICAgICAgICAgICAgcHV0SXRlbTogcHV0SXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtOiByZXRyaWV2ZUl0ZW0sXHJcbiAgICAgICAgICAgIHJldHJpZXZlSXRlbXM6IHJldHJpZXZlSXRlbXMsXHJcbiAgICAgICAgICAgIGluZGV4ZWREQkF2YWlsYWJsZTogaW5kZXhlZERCQXZhaWxhYmxlXHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdMb2dTcnYnLCBbXCJBcHBDb25maWdcIiwgZnVuY3Rpb24oQXBwQ29uZmlnKSB7XHJcbiAgICAgICAgdmFyIGxvZ0luZm8gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKEFwcENvbmZpZ1tcImxvZy5pbmZvXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ0Vycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuZXJyb3JcIl0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluZm86IGxvZ0luZm8sXHJcbiAgICAgICAgICAgIGVycm9yOiBsb2dFcnJvclxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignTG9naW5DdHJsJywgW1wiJHNjb3BlXCIsIFwiVXNlclNydlwiLCBcIkZvY3VzU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgVXNlclNydi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ2luIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBub3RpZnkgdXNlciBhYm91dCBlcnJvciBpbiBsb2dpbiBwcm9jZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCd1c2VybmFtZScpO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ291dEN0cmwnLCBbXCIkc2NvcGVcIiwgXCJVc2VyU3J2XCIsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydikge1xyXG4gICAgICAgIFVzZXJTcnYubG9nb3V0KClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpbmZvcm0gYXBwbGljYXRpb24gY29udHJvbCBhYm91dCBsb2dvdXQgZXZlbnRcclxuICAgICAgICAgICAgICAgICRzY29wZS4kZW1pdCgnYXBwLmxvZ291dCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1dKTtcbi8vIG93biBjbGFzc2VzIGFuZCBmdW5jdGlvbnNcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVJWiAtLS0tLS0tLS0tXHJcbnZhciBRdWl6ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBxdWVzdGlvbnMgYXJyYXlcclxuICAgIHZhciBxdWVzdGlvbnMgPSBbXTtcclxuXHJcbiAgICAvLyBmbGFnIGluZGljYXRpbmcgaWYgcXVpeiBpcyBjdXJyZW50bHkgYWN0aXZlXHJcbiAgICB2YXIgYWN0aXZlID0gdHJ1ZTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBxdWVzdGlvbiB0byB0aGUgcXVlc3Rpb25zIGFycmF5XHJcbiAgICAgKiBAcGFyYW0gcXVlc3Rpb25cclxuICAgICAqL1xyXG4gICAgdGhpcy5hZGRRdWVzdGlvbiA9IGZ1bmN0aW9uKHF1ZXN0aW9uKSB7XHJcbiAgICAgICAgcXVlc3Rpb25zLnB1c2gocXVlc3Rpb24pO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdldFF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBxdWVzdGlvbnM7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaXNBY3RpdmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gYWN0aXZlO1xyXG4gICAgfTtcclxufTtcclxuXHJcbi8vIC0tLS0tLS0tLS0gUVVFU1RJT04gLS0tLS0tLS0tLVxyXG52YXIgUXVlc3Rpb24gPSBmdW5jdGlvbihvcHRpb25zKSB7XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuXHJcbiAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgdGhpcy5nZXRSYW5kb21UeXBlKCk7XHJcbiAgICB0aGlzLmNvdW50cnkgPSBvcHRpb25zLmNvdW50cnkgfHwgbnVsbDtcclxuICAgIHRoaXMuc3RhdGUgPSBvcHRpb25zLnN0YXRlIHx8IHRoaXMuc3RhdGVzLk5PVF9BTlNXRVJFRDtcclxufTtcclxuXHJcblF1ZXN0aW9uLnByb3RvdHlwZS5zdGF0ZXMgPSB7XHJcbiAgICBcIk5PVF9BTlNXRVJFRFwiOiAxLFxyXG4gICAgXCJDT1JSRUNUXCI6IDIsXHJcbiAgICBcIklOQ09SUkVDVFwiOiAzXHJcbn07XHJcblxyXG5RdWVzdGlvbi5wcm90b3R5cGUudHlwZXMgPSB7XHJcbiAgICBcIkNBUElUQUxfT0ZfQ09VTlRSWVwiOiBcImNhcGl0YWwtb2YtY291bnRyeVwiLFxyXG4gICAgXCJDT1VOVFJZX09GX0NBUElUQUxcIjogXCJjb3VudHJ5LW9mLWNhcGl0YWxcIixcclxuICAgIFwiSU5IQUJJVEFOVFNfT0ZfQ09VTlRSWVwiOiBcImluaGFiaXRhbnRzLW9mLWNvdW50cnlcIlxyXG59O1xyXG5cclxuUXVlc3Rpb24ucHJvdG90eXBlLmdldFJhbmRvbVR5cGUgPSBmdW5jdGlvbigpIHtcclxuICAgIHZhciB0eXBlcyA9IE9iamVjdC5rZXlzKHRoaXMudHlwZXMpO1xyXG5cclxuICAgIHJldHVybiB0aGlzLnR5cGVzW3R5cGVzW2dldFJhbmRvbUludCgwLCB0eXBlcy5sZW5ndGggLSAxKV1dO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldHVybnMgYSByYW5kb20gaW50ZWdlciBiZXR3ZWVuIG1pbiAoaW5jbHVzaXZlKSBhbmQgbWF4IChpbmNsdXNpdmUpXHJcbiAqIFVzaW5nIE1hdGgucm91bmQoKSB3aWxsIGdpdmUgeW91IGEgbm9uLXVuaWZvcm0gZGlzdHJpYnV0aW9uIVxyXG4gKi9cclxudmFyIGdldFJhbmRvbUludCA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7XHJcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRoZSB0ZXh0IGJldHdlZW4gdHdvIGRlbGltaXRpbmcgdGV4dCBvY2N1cnJlbmNlc1xyXG4gKi9cclxudmFyIGdldFN0cmluZ0JldHdlZW4gPSBmdW5jdGlvbih0ZXh0LCBmaXJzdFN0cmluZywgc2Vjb25kU3RyaW5nKSB7XHJcbiAgICB2YXIgZmlyc3RQb3MgPSB0ZXh0LmluZGV4T2YoZmlyc3RTdHJpbmcpO1xyXG4gICAgdmFyIHNlY29uZFBvcyA9IHRleHQuaW5kZXhPZihzZWNvbmRTdHJpbmcpO1xyXG5cclxuICAgIGlmIChmaXJzdFBvcyA+PSAwICYmIHNlY29uZFBvcyA+PSAwICYmIHNlY29uZFBvcyA+IGZpcnN0UG9zKSB7XHJcbiAgICAgICAgcmV0dXJuIHRleHQuc3Vic3RyKGZpcnN0UG9zICsgMSwgc2Vjb25kUG9zIC0gZmlyc3RQb3MgLSAxKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxufTtcclxuXG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29udHJvbGxlcignUXVpekN0cmwnLCBbXCIkc2NvcGVcIiwgXCJRdWl6U3J2XCIsIFwiTG9nU3J2XCIsIFwiRm9jdXNTcnZcIiwgXCJuZ1Byb2dyZXNzRmFjdG9yeVwiLCBmdW5jdGlvbigkc2NvcGUsIFF1aXpTcnYsIExvZ1NydiwgRm9jdXNTcnYsIG5nUHJvZ3Jlc3NGYWN0b3J5KSB7XHJcblxyXG4gICAgICAgIC8vIFByb2dyZXNzIGJhciBpbml0aWFsaXphdGlvblxyXG4gICAgICAgICRzY29wZS5wcm9ncmVzc2JhciA9IG5nUHJvZ3Jlc3NGYWN0b3J5LmNyZWF0ZUluc3RhbmNlKCk7XHJcblxyXG4gICAgICAgIHZhciBzdGFydFF1aXogPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgUXVpelNydi5pbml0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIEZvY3VzU3J2KCdhbnN3ZXInKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiQ291bGQgbm90IHN0YXJ0IHF1aXpcIiwgZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmlzUXVpelJ1bm5pbmcoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LmdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyUXVlc3Rpb24oUXVpelNydi5nZXRRdWVzdGlvblRleHQoKSwgXCJxdWVzdGlvbi1oaWdobGlnaHRcIikgKyBcIj9cIjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QW5zd2VyVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyUXVlc3Rpb24oUXVpelNydi5nZXRBbnN3ZXJUZXh0KCksIFwiYW5zd2VyLWhpZ2hsaWdodC1cIiArIFF1aXpTcnYuZ2V0QW5zd2VyU3RhdHVzKCkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbkFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LnF1ZXN0aW9uQW5zd2VyZWQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciByZW5kZXJRdWVzdGlvbiA9IGZ1bmN0aW9uKHRleHQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dFxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJbXCIsIFwiPHNwYW4gY2xhc3M9J1wiICsgY2xhc3NOYW1lICsgXCInPlwiKVxyXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCJdXCIsIFwiPC9zcGFuPlwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc3VibWl0QW5zd2VyID0gZnVuY3Rpb24oYW5zd2VyKSB7XHJcbiAgICAgICAgICAgIGlmIChhbnN3ZXIpIHtcclxuICAgICAgICAgICAgICAgIFF1aXpTcnYuc3VibWl0QW5zd2VyKGFuc3dlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25BbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5xdWVzdGlvbkFuc3dlcmVkKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUucXUuYW5zd2VyID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgIFF1aXpTcnYubmV4dFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBzZXQgcHJvZ3Jlc3MgYmFyXHJcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc2Jhci5zZXQoUXVpelNydi5nZXRQcm9ncmVzc1BlcmNlbnRhZ2UoKSAqIDEwMCk7XHJcblxyXG4gICAgICAgICAgICBGb2N1c1NydignYW5zd2VyJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGhhbmRsZUtleVByZXNzID0gZnVuY3Rpb24oa2V5RXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGtleUV2ZW50LndoaWNoID09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJtaXRBbnN3ZXIoJHNjb3BlLnF1LmFuc3dlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc3RhcnRRdWl6ID0gc3RhcnRRdWl6O1xyXG4gICAgICAgICRzY29wZS5pc1F1aXpSdW5uaW5nID0gaXNRdWl6UnVubmluZztcclxuICAgICAgICAkc2NvcGUuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyID0gZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyO1xyXG4gICAgICAgICRzY29wZS5nZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnM7XHJcbiAgICAgICAgJHNjb3BlLmdldFF1ZXN0aW9uVGV4dCA9IGdldFF1ZXN0aW9uVGV4dDtcclxuICAgICAgICAkc2NvcGUuZ2V0QW5zd2VyVGV4dCA9IGdldEFuc3dlclRleHQ7XHJcbiAgICAgICAgJHNjb3BlLnN1Ym1pdEFuc3dlciA9IHN1Ym1pdEFuc3dlcjtcclxuICAgICAgICAkc2NvcGUucXVlc3Rpb25BbnN3ZXJlZCA9IHF1ZXN0aW9uQW5zd2VyZWQ7XHJcbiAgICAgICAgJHNjb3BlLm5leHRRdWVzdGlvbiA9IG5leHRRdWVzdGlvbjtcclxuICAgICAgICAkc2NvcGUuaGFuZGxlS2V5UHJlc3MgPSBoYW5kbGVLZXlQcmVzcztcclxuXHJcbiAgICAgICAgJHNjb3BlLnF1ID0ge1xyXG4gICAgICAgICAgICBhbnN3ZXI6IFwiXCJcclxuICAgICAgICB9O1xyXG5cclxuICAgIH1dKTtcbid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdRdWl6U3J2JywgW1wiQXBwQ29uZmlnXCIsIFwiTG9nU3J2XCIsIGZ1bmN0aW9uKEFwcENvbmZpZywgTG9nU3J2KSB7XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcblxyXG4gICAgICAgIHZhciBxdWl6ID0gbnVsbDtcclxuICAgICAgICB2YXIgY3VycmVudFF1ZXN0aW9uTm8gPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNvdW50cmllc0xvYWRlZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiQ291bnRyaWVzIG5vdCBsb2FkZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHF1aXogIT09IG51bGwgJiYgcXVpei5pc0FjdGl2ZSgpID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiQSBxdWl6IGlzIGN1cnJlbnRseSBiZWluZyBwbGF5ZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIHF1aXogb2JqZWN0XHJcbiAgICAgICAgICAgICAgICBxdWl6ID0gbmV3IFF1aXooKTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IEFwcENvbmZpZ1sncXVpei5xdWVzdGlvbnMubnVtYmVyJ107IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHF1aXouYWRkUXVlc3Rpb24obmV3IFF1ZXN0aW9uKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeTogZ2V0UmFuZG9tQ291bnRyeSgpXHJcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbk5vID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZXRDb3VudHJpZXMgPSBmdW5jdGlvbihfY291bnRyaWVzKSB7XHJcbiAgICAgICAgICAgIGNvdW50cmllcyA9IF9jb3VudHJpZXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFJhbmRvbUNvdW50cnkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvdW50cmllc1tnZXRSYW5kb21JbnQoMCwgY291bnRyaWVzLmxlbmd0aCAtIDEpXTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgY291bnRyaWVzTG9hZGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXMgIT09IG51bGwgJiYgY291bnRyaWVzLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHF1aXogIT09IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcXVpei5nZXRRdWVzdGlvbnMoKVtjdXJyZW50UXVlc3Rpb25Ob107XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEN1cnJlbnRRdWVzdGlvbk51bWJlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFF1ZXN0aW9uTm8gIT09IG51bGwgPyBjdXJyZW50UXVlc3Rpb25ObyArIDEgOiBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHF1aXogIT09IG51bGwgPyBxdWl6LmdldFF1ZXN0aW9ucygpLmxlbmd0aCA6IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHN1Ym1pdEFuc3dlciA9IGZ1bmN0aW9uKGFuc3dlcikge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBjb3JyZWN0QW5zd2VyID0gZ2V0QW5zd2VyVG9RdWVzdGlvbihxdWVzdGlvbik7XHJcblxyXG4gICAgICAgICAgICBxdWVzdGlvbi5zdGF0ZSA9IGFuc3dlciA9PT0gY29ycmVjdEFuc3dlciA/IHF1ZXN0aW9uLnN0YXRlcy5DT1JSRUNUIDogcXVlc3Rpb24uc3RhdGVzLklOQ09SUkVDVDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25UZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbiA9IGdldEN1cnJlbnRRdWVzdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChxdWVzdGlvbi50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnR5cGVzLkNBUElUQUxfT0ZfQ09VTlRSWTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgaGVpw590IGRpZSBIYXVwdHN0YWR0IHZvbiBbXCIgKyAocXVlc3Rpb24uY291bnRyeS50cmFuc2xhdGlvbnMuZGUgfHwgcXVlc3Rpb24uY291bnRyeS5uYW1lKSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuQ09VTlRSWV9PRl9DQVBJVEFMOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIltcIiArIHF1ZXN0aW9uLmNvdW50cnkuY2FwaXRhbCArIFwiXSBpc3QgZGllIEhhdXB0c3RhZHQgdm9uIHdlbGNoZW0gTGFuZFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuSU5IQUJJVEFOVFNfT0ZfQ09VTlRSWTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJXaWUgdmllbGUgRWlud29obmVyIGhhdCBbXCIgKyAocXVlc3Rpb24uY291bnRyeS50cmFuc2xhdGlvbnMuZGUgfHwgcXVlc3Rpb24uY291bnRyeS5uYW1lKSArIFwiXVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiVW5rbm93biBxdWVzdGlvbiB0eXBlXCIsIHF1ZXN0aW9uLnR5cGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEFuc3dlclRvUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgICAgICBpZiAoIXF1ZXN0aW9uIHx8ICFxdWVzdGlvbi50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAocXVlc3Rpb24udHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5DQVBJVEFMX09GX0NPVU5UUlk6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmNvdW50cnkuY2FwaXRhbDtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnR5cGVzLkNPVU5UUllfT0ZfQ0FQSVRBTDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uY291bnRyeS50cmFuc2xhdGlvbnMuZGUgfHwgcXVlc3Rpb24uY291bnRyeS5uYW1lO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuSU5IQUJJVEFOVFNfT0ZfQ09VTlRSWTpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uY291bnRyeS5wb3B1bGF0aW9uO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiVW5rbm93biBxdWVzdGlvbiB0eXBlXCIsIHF1ZXN0aW9uLnR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEFuc3dlclN0YXR1cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHF1ZXN0aW9uLnN0YXRlO1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChzdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi5zdGF0ZXMuQ09SUkVDVDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJjb3JyZWN0XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi5zdGF0ZXMuSU5DT1JSRUNUOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcImluY29ycmVjdFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25BbnN3ZXJlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5zdGF0ZSAhPT0gcXVlc3Rpb24uc3RhdGVzLk5PVF9BTlNXRVJFRDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0QW5zd2VyVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBcIltcIiArIGdldEFuc3dlclRvUXVlc3Rpb24ocXVlc3Rpb24pICsgXCJdXCI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG5leHRRdWVzdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCkgKyAxIDw9IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucygpKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50UXVlc3Rpb25ObysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFByb2dyZXNzUGVyY2VudGFnZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gKGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpIC0gMSkgLyBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXQsXHJcbiAgICAgICAgICAgIHNldENvdW50cmllczogc2V0Q291bnRyaWVzLFxyXG4gICAgICAgICAgICBpc1F1aXpSdW5uaW5nOiBpc1F1aXpSdW5uaW5nLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI6IGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcixcclxuICAgICAgICAgICAgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zOiBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMsXHJcbiAgICAgICAgICAgIGdldFF1ZXN0aW9uVGV4dDogZ2V0UXVlc3Rpb25UZXh0LFxyXG4gICAgICAgICAgICBnZXRBbnN3ZXJTdGF0dXM6IGdldEFuc3dlclN0YXR1cyxcclxuICAgICAgICAgICAgZ2V0QW5zd2VyVGV4dDogZ2V0QW5zd2VyVGV4dCxcclxuICAgICAgICAgICAgc3VibWl0QW5zd2VyOiBzdWJtaXRBbnN3ZXIsXHJcbiAgICAgICAgICAgIHF1ZXN0aW9uQW5zd2VyZWQ6IHF1ZXN0aW9uQW5zd2VyZWQsXHJcbiAgICAgICAgICAgIG5leHRRdWVzdGlvbjogbmV4dFF1ZXN0aW9uLFxyXG4gICAgICAgICAgICBnZXRQcm9ncmVzc1BlcmNlbnRhZ2U6IGdldFByb2dyZXNzUGVyY2VudGFnZVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XG4ndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmlsdGVyKCdyZW5kZXJIdG1sJywgW1wiJHNjZVwiLCBmdW5jdGlvbigkc2NlKSB7XHJcbiAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWw7XHJcbiAgICB9XSk7XG5hbmd1bGFyLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbmZpZyhbXCIkbG9jYXRpb25Qcm92aWRlclwiLCBcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbiAgICAgICAgLy8gZW5hYmxlIEhUTUw1IHB1c2hzdGF0ZVxyXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2hvbWUnKTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hvbWUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvaG9tZS5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncXVpeicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9xdWl6JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3F1aXoucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL2xvZ2luLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9nb3V0JyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dvdXRDdHJsJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3JlZ2lzdGVyLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdhYm91dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hYm91dCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9hYm91dC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfV0pO1xuJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1VzZXJTcnYnLCBbXCIkaHR0cFwiLCBcIkF1dGhUb2tlblNydlwiLCBmdW5jdGlvbigkaHR0cCwgQXV0aFRva2VuU3J2KSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXInKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlckZyb21TdG9yYWdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhUb2tlblNydi5nZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbih0b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGdldFVzZXIoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBubyB0b2tlbiwgd2UgcmVqZWN0IHRoZSBwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gdG9rZW4gaW4gc3RvcmFnZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb24nLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IHJlc3BvbnNlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2F2ZSB0b2tlbiBsb2NhbGx5XHJcbiAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4oc2VsZi50b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFVzZXIoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnRva2VuID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyByZW1vdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRVc2VyOiBnZXRVc2VyLFxyXG4gICAgICAgICAgICBnZXRVc2VyRnJvbVN0b3JhZ2U6IGdldFVzZXJGcm9tU3RvcmFnZSxcclxuICAgICAgICAgICAgbG9naW46IGxvZ2luLFxyXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dFxyXG4gICAgICAgIH1cclxuICAgIH1dKTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG5hbmd1bGFyXHJcbiAgICAubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuZmFjdG9yeSgnQXV0aFRva2VuU3J2JywgZnVuY3Rpb24oJHdpbmRvdykge1xyXG4gICAgICAgIHZhciBzdG9yZSA9ICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2U7XHJcbiAgICAgICAgdmFyIGtleSA9ICdhdXRoLXRva2VuJztcclxuXHJcbiAgICAgICAgdmFyIGdldFRva2VuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHNldFRva2VuID0gZnVuY3Rpb24odG9rZW4pIHtcclxuICAgICAgICAgICAgaWYgKHRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5zZXRJdGVtKGtleSwgdG9rZW4pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3RvcmUucmVtb3ZlSXRlbShrZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0VG9rZW46IGdldFRva2VuLFxyXG4gICAgICAgICAgICBzZXRUb2tlbjogc2V0VG9rZW5cclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0F1dGhJbnRlcmNlcHRvcicsIGZ1bmN0aW9uKEF1dGhUb2tlblNydikge1xyXG4gICAgICAgIHZhciBhZGRUb2tlbiA9IGZ1bmN0aW9uKGNvbmZpZykge1xyXG4gICAgICAgICAgICB2YXIgdG9rZW4gPSBBdXRoVG9rZW5TcnYuZ2V0VG9rZW4oKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydYLUF1dGgnXSA9IHRva2VuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGFkZFRva2VuXHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdDb3VudHJ5U3J2JywgZnVuY3Rpb24oJGh0dHAsIEluZGV4ZWREQlNydiwgTG9nU3J2KSB7XHJcbiAgICAgICAgLy8gQ291bnRyaWVzIGFycmF5XHJcbiAgICAgICAgdmFyIGNvdW50cmllcyA9IG51bGw7XHJcblxyXG4gICAgICAgIC8vIEluZGV4ZWREQlxyXG4gICAgICAgIHZhciBkYXRhYmFzZSA9ICdtYWdlbGxhbic7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gJ2NvdW50cnlTdG9yZSc7XHJcbiAgICAgICAgdmFyIGtleUNvdW50cmllcyA9ICdjb3VudHJpZXMnO1xyXG4gICAgICAgIHZhciBrZXlWZXJzaW9uID0gJ3ZlcnNpb24nO1xyXG5cclxuICAgICAgICB2YXIgaW5kZXhlZERCQXZhaWxhYmxlID0gSW5kZXhlZERCU3J2LmluZGV4ZWREQkF2YWlsYWJsZSgpO1xyXG5cclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZENvdW50cmllcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkQ291bnRyaWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGluZGV4ZWREQiBpcyBhdmFpbGFibGVcclxuICAgICAgICAgICAgaWYgKGluZGV4ZWREQkF2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBkYXRhYmFzZSBleGlzdHNcclxuICAgICAgICAgICAgICAgICAgICBJbmRleGVkREJTcnYuY3JlYXRlRGF0YWJhc2UoZGF0YWJhc2UsIHN0b3JlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFbXB0eU9iamVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0SW50ZXJuYWxWZXJzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRFeHRlcm5hbFZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGRldGVybWluZUxvYWRTdHJhdGVneSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4obG9hZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyaWVzID0gb2JqWydjb3VudHJpZXMnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dTcnYuaW5mbyhcImxvYWRlZCBjb3VudHJpZXMgZnJvbVwiLCBvYmpbJ2xvYWRTdHJhdGVneSddLnRvVXBwZXJDYXNlKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY291bnRyaWVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nU3J2LmVycm9yKFwiZmFpbGVkIHRvIGxvYWQgY291bnRyaWVzXCIsIGVycik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBub3QsIHdlIGFsd2F5cyB0cnkgdG8gZG93bmxvYWQgaXQgZnJvbSB0aGUgY291bnRyeSBBUEkgZW5kcG9pbnRcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRDb3VudHJpZXNGcm9tQVBJKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGV0ZXJtaW5lTG9hZFN0cmF0ZWd5ID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaW50ZXJuYWxWZXJzaW9uID0gb2JqW1wiaW50ZXJuYWxWZXJzaW9uXCJdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGV4dGVybmFsVmVyc2lvbiA9IG9ialtcImV4dGVybmFsVmVyc2lvblwiXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaW50ZXJuYWxWZXJzaW9uID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ZXJuYWxWZXJzaW9uID4gaW50ZXJuYWxWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnYXBpJztcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYXRlZ3kgPSAnZGInO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIG9ialsnbG9hZFN0cmF0ZWd5J10gPSBzdHJhdGVneTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2FkRGF0YSA9IGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RyYXRlZ3kgPSBvYmpbJ2xvYWRTdHJhdGVneSddO1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RyYXRlZ3kpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdhcGknOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRDb3VudHJpZXNGcm9tQVBJKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdW50cmllcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGNvdW50cmllcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmUgY291bnRyaWVzIGFuZCB2ZXJzaW9uIG51bWJlciBpbiBkYXRhYmFzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlDb3VudHJpZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAgY291bnRyaWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4ZWREQlNydi5wdXRJdGVtKGRhdGFiYXNlLCBzdG9yZSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBrZXlWZXJzaW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdkYic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvdW50cmllc0Zyb21EQihvYmopXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihfb2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfb2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoJ1Vua25vd24gbG9hZCBzdHJhdGVneScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RW1wdHlPYmplY3QgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh7fSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRJbnRlcm5hbFZlcnNpb24gPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleVZlcnNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBpdGVtLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJpbnRlcm5hbFZlcnNpb25cIl0gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0RXh0ZXJuYWxWZXJzaW9uID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRWZXJzaW9uRnJvbUFQSSgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbih2ZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqW1wiZXh0ZXJuYWxWZXJzaW9uXCJdID0gdmVyc2lvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDb3VudHJpZXNGcm9tREIgPSBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgSW5kZXhlZERCU3J2LnJldHJpZXZlSXRlbShkYXRhYmFzZSwgc3RvcmUsIGtleUNvdW50cmllcylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcImNvdW50cmllc1wiXSA9IGl0ZW0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldENvdW50cmllc0Zyb21BUEkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdW50cmllcycpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRWZXJzaW9uRnJvbUFQSSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291bnRyaWVzL3ZlcnNpb24nKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuZGF0YS52ZXJzaW9uIHx8IDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdEcm9wZG93bkN0cmwnLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAkc2NvcGUudG9nZ2xlRHJvcGRvd24gPSB0b2dnbGVEcm9wZG93bjtcclxuICAgICAgICAkc2NvcGUuc2hvd0Ryb3Bkb3duID0gc2hvd0Ryb3Bkb3duO1xyXG4gICAgICAgICRzY29wZS5oaWRlRHJvcGRvd24gPSBoaWRlRHJvcGRvd247XHJcbiAgICAgICAgJHNjb3BlLmlzRHJvcGRvd25WaXNpYmxlID0gaXNEcm9wZG93blZpc2libGU7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gIXZpc2libGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93RHJvcGRvd24oKSB7XHJcbiAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGlkZURyb3Bkb3duKCkge1xyXG4gICAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0Ryb3Bkb3duVmlzaWJsZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZpc2libGU7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0ZvY3VzU3J2JywgZnVuY3Rpb24oJHRpbWVvdXQsICR3aW5kb3cpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaWQpIHtcclxuICAgICAgICAgICAgLy8gdGltZW91dCBtYWtlcyBzdXJlIHRoYXQgaXMgaW52b2tlZCBhZnRlciBhbnkgb3RoZXIgZXZlbnQgaGFzIGJlZW4gdHJpZ2dlcmVkLlxyXG4gICAgICAgICAgICAvLyBlLmcuIGNsaWNrIGV2ZW50cyB0aGF0IG5lZWQgdG8gcnVuIGJlZm9yZSB0aGUgZm9jdXMgb3JcclxuICAgICAgICAgICAgLy8gaW5wdXRzIGVsZW1lbnRzIHRoYXQgYXJlIGluIGEgZGlzYWJsZWQgc3RhdGUgYnV0IGFyZSBlbmFibGVkIHdoZW4gdGhvc2UgZXZlbnRzXHJcbiAgICAgICAgICAgIC8vIGFyZSB0cmlnZ2VyZWQuXHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkd2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5mYWN0b3J5KCdJbmRleGVkREJTcnYnLCBmdW5jdGlvbigkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIGtleVBhdGggPSAnbmFtZSc7XHJcblxyXG4gICAgICAgIHZhciBpbmRleGVkREIgPSAkd2luZG93LmluZGV4ZWREQiB8fCAkd2luZG93LndlYmtpdEluZGV4ZWREQiB8fCAkd2luZG93Lm1zSW5kZXhlZERCO1xyXG4gICAgICAgIHZhciBJREJLZXlSYW5nZSA9ICR3aW5kb3cuSURCS2V5UmFuZ2UgfHwgJHdpbmRvdy53ZWJraXRJREJLZXlSYW5nZTtcclxuXHJcbiAgICAgICAgdmFyIElEQlRyYW5zYWN0aW9uID0gJHdpbmRvdy5JREJUcmFuc2FjdGlvbiB8fCAkd2luZG93LndlYmtpdElEQlRyYW5zYWN0aW9uO1xyXG5cclxuICAgICAgICBpZiAoSURCVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSA9IElEQlRyYW5zYWN0aW9uLlJFQURfV1JJVEUgfHwgJ3JlYWR3cml0ZSc7XHJcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSA9IElEQlRyYW5zYWN0aW9uLlJFQURfT05MWSB8fCAncmVhZG9ubHknO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGluZGV4ZWREQkF2YWlsYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5kZXhlZERCID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBjcmVhdGVEYXRhYmFzZSA9IGZ1bmN0aW9uKGRiTmFtZSwgc3RvcmVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBlIGlzIGFuIGluc3RhbmNlIG9mIElEQlZlcnNpb25DaGFuZ2VFdmVudFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IGlkYi5jcmVhdGVPYmplY3RTdG9yZShzdG9yZU5hbWUsIHsga2V5UGF0aDoga2V5UGF0aCB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkLCB1cGRhdGUsIGRlbGV0ZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZHJvcERhdGFiYXNlID0gZnVuY3Rpb24oZGJOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBzdWNjZXNzZnVsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRyb3AgZmFpbGVkXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFkZEl0ZW0gPSBmdW5jdGlvbihkYk5hbWUsIHN0b3JlTmFtZSwgaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX1dSSVRFKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdEFkZCA9IHN0b3JlLmFkZChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdEFkZC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBwdXRJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9XUklURSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RBZGQgPSBzdG9yZS5wdXQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBZGQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcmV0cmlldmVJdGVtID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUsIGl0ZW1OYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkYiA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBpZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBJREJUcmFuc2FjdGlvbi5SRUFEX09OTFkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IElEQktleVJhbmdlLm9ubHkoaXRlbU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKHJhbmdlKS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gY3Vyc29yLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciByZXRyaWV2ZUl0ZW1zID0gZnVuY3Rpb24oZGJOYW1lLCBzdG9yZU5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gaWRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgSURCVHJhbnNhY3Rpb24uUkVBRF9PTkxZKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5vcGVuQ3Vyc29yKCkub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjcmVhdGVEYXRhYmFzZTogY3JlYXRlRGF0YWJhc2UsXHJcbiAgICAgICAgICAgIGRyb3BEYXRhYmFzZTogZHJvcERhdGFiYXNlLFxyXG4gICAgICAgICAgICBhZGRJdGVtOiBhZGRJdGVtLFxyXG4gICAgICAgICAgICBwdXRJdGVtOiBwdXRJdGVtLFxyXG4gICAgICAgICAgICByZXRyaWV2ZUl0ZW06IHJldHJpZXZlSXRlbSxcclxuICAgICAgICAgICAgcmV0cmlldmVJdGVtczogcmV0cmlldmVJdGVtcyxcclxuICAgICAgICAgICAgaW5kZXhlZERCQXZhaWxhYmxlOiBpbmRleGVkREJBdmFpbGFibGVcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ0xvZ1NydicsIGZ1bmN0aW9uKEFwcENvbmZpZykge1xyXG4gICAgICAgIHZhciBsb2dJbmZvID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChBcHBDb25maWdbXCJsb2cuaW5mb1wiXSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBsb2dFcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiAoQXBwQ29uZmlnW1wibG9nLmVycm9yXCJdKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbmZvOiBsb2dJbmZvLFxyXG4gICAgICAgICAgICBlcnJvcjogbG9nRXJyb3JcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclNydiwgRm9jdXNTcnYpIHtcclxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgVXNlclNydi5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBhcHBsaWNhdGlvbiBjb250cm9sIGFib3V0IGxvZ2luIGV2ZW50XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdhcHAubG9naW4nLCByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBub3RpZnkgdXNlciBhYm91dCBlcnJvciBpbiBsb2dpbiBwcm9jZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBmb2N1cyB1c2VybmFtZSBmaWVsZFxyXG4gICAgICAgIEZvY3VzU3J2KCd1c2VybmFtZScpO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmNvbnRyb2xsZXIoJ0xvZ291dEN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIFVzZXJTcnYpIHtcclxuICAgICAgICBVc2VyU3J2LmxvZ291dCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gaW5mb3JtIGFwcGxpY2F0aW9uIGNvbnRyb2wgYWJvdXQgbG9nb3V0IGV2ZW50XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2FwcC5sb2dvdXQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9KTsiLCIvLyBvd24gY2xhc3NlcyBhbmQgZnVuY3Rpb25zXHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVSVogLS0tLS0tLS0tLVxyXG52YXIgUXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgLy8gcXVlc3Rpb25zIGFycmF5XHJcbiAgICB2YXIgcXVlc3Rpb25zID0gW107XHJcblxyXG4gICAgLy8gZmxhZyBpbmRpY2F0aW5nIGlmIHF1aXogaXMgY3VycmVudGx5IGFjdGl2ZVxyXG4gICAgdmFyIGFjdGl2ZSA9IHRydWU7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgcXVlc3Rpb24gdG8gdGhlIHF1ZXN0aW9ucyBhcnJheVxyXG4gICAgICogQHBhcmFtIHF1ZXN0aW9uXHJcbiAgICAgKi9cclxuICAgIHRoaXMuYWRkUXVlc3Rpb24gPSBmdW5jdGlvbihxdWVzdGlvbikge1xyXG4gICAgICAgIHF1ZXN0aW9ucy5wdXNoKHF1ZXN0aW9uKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5nZXRRdWVzdGlvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gcXVlc3Rpb25zO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmlzQWN0aXZlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGFjdGl2ZTtcclxuICAgIH07XHJcbn07XHJcblxyXG4vLyAtLS0tLS0tLS0tIFFVRVNUSU9OIC0tLS0tLS0tLS1cclxudmFyIFF1ZXN0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcblxyXG4gICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlIHx8IHRoaXMuZ2V0UmFuZG9tVHlwZSgpO1xyXG4gICAgdGhpcy5jb3VudHJ5ID0gb3B0aW9ucy5jb3VudHJ5IHx8IG51bGw7XHJcbiAgICB0aGlzLnN0YXRlID0gb3B0aW9ucy5zdGF0ZSB8fCB0aGlzLnN0YXRlcy5OT1RfQU5TV0VSRUQ7XHJcbn07XHJcblxyXG5RdWVzdGlvbi5wcm90b3R5cGUuc3RhdGVzID0ge1xyXG4gICAgXCJOT1RfQU5TV0VSRURcIjogMSxcclxuICAgIFwiQ09SUkVDVFwiOiAyLFxyXG4gICAgXCJJTkNPUlJFQ1RcIjogM1xyXG59O1xyXG5cclxuUXVlc3Rpb24ucHJvdG90eXBlLnR5cGVzID0ge1xyXG4gICAgXCJDQVBJVEFMX09GX0NPVU5UUllcIjogXCJjYXBpdGFsLW9mLWNvdW50cnlcIixcclxuICAgIFwiQ09VTlRSWV9PRl9DQVBJVEFMXCI6IFwiY291bnRyeS1vZi1jYXBpdGFsXCIsXHJcbiAgICBcIklOSEFCSVRBTlRTX09GX0NPVU5UUllcIjogXCJpbmhhYml0YW50cy1vZi1jb3VudHJ5XCJcclxufTtcclxuXHJcblF1ZXN0aW9uLnByb3RvdHlwZS5nZXRSYW5kb21UeXBlID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgdHlwZXMgPSBPYmplY3Qua2V5cyh0aGlzLnR5cGVzKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy50eXBlc1t0eXBlc1tnZXRSYW5kb21JbnQoMCwgdHlwZXMubGVuZ3RoIC0gMSldXTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gKGluY2x1c2l2ZSkgYW5kIG1heCAoaW5jbHVzaXZlKVxyXG4gKiBVc2luZyBNYXRoLnJvdW5kKCkgd2lsbCBnaXZlIHlvdSBhIG5vbi11bmlmb3JtIGRpc3RyaWJ1dGlvbiFcclxuICovXHJcbnZhciBnZXRSYW5kb21JbnQgPSBmdW5jdGlvbihtaW4sIG1heCkge1xyXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0dXJucyB0aGUgdGV4dCBiZXR3ZWVuIHR3byBkZWxpbWl0aW5nIHRleHQgb2NjdXJyZW5jZXNcclxuICovXHJcbnZhciBnZXRTdHJpbmdCZXR3ZWVuID0gZnVuY3Rpb24odGV4dCwgZmlyc3RTdHJpbmcsIHNlY29uZFN0cmluZykge1xyXG4gICAgdmFyIGZpcnN0UG9zID0gdGV4dC5pbmRleE9mKGZpcnN0U3RyaW5nKTtcclxuICAgIHZhciBzZWNvbmRQb3MgPSB0ZXh0LmluZGV4T2Yoc2Vjb25kU3RyaW5nKTtcclxuXHJcbiAgICBpZiAoZmlyc3RQb3MgPj0gMCAmJiBzZWNvbmRQb3MgPj0gMCAmJiBzZWNvbmRQb3MgPiBmaXJzdFBvcykge1xyXG4gICAgICAgIHJldHVybiB0ZXh0LnN1YnN0cihmaXJzdFBvcyArIDEsIHNlY29uZFBvcyAtIGZpcnN0UG9zIC0gMSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn07XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ21hZ2VsbGFuJylcclxuICAgIC5jb250cm9sbGVyKCdRdWl6Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgUXVpelNydiwgTG9nU3J2LCBGb2N1c1NydiwgbmdQcm9ncmVzc0ZhY3RvcnkpIHtcclxuXHJcbiAgICAgICAgLy8gUHJvZ3Jlc3MgYmFyIGluaXRpYWxpemF0aW9uXHJcbiAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyID0gbmdQcm9ncmVzc0ZhY3RvcnkuY3JlYXRlSW5zdGFuY2UoKTtcclxuXHJcbiAgICAgICAgdmFyIHN0YXJ0UXVpeiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBRdWl6U3J2LmluaXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgRm9jdXNTcnYoJ2Fuc3dlcicpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dTcnYuZXJyb3IoXCJDb3VsZCBub3Qgc3RhcnQgcXVpelwiLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGlzUXVpelJ1bm5pbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuaXNRdWl6UnVubmluZygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYuZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUXVpelNydi5nZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0UXVlc3Rpb25UZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJRdWVzdGlvbihRdWl6U3J2LmdldFF1ZXN0aW9uVGV4dCgpLCBcInF1ZXN0aW9uLWhpZ2hsaWdodFwiKSArIFwiP1wiO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRBbnN3ZXJUZXh0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJRdWVzdGlvbihRdWl6U3J2LmdldEFuc3dlclRleHQoKSwgXCJhbnN3ZXItaGlnaGxpZ2h0LVwiICsgUXVpelNydi5nZXRBbnN3ZXJTdGF0dXMoKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uQW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFF1aXpTcnYucXVlc3Rpb25BbnN3ZXJlZCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHJlbmRlclF1ZXN0aW9uID0gZnVuY3Rpb24odGV4dCwgY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIltcIiwgXCI8c3BhbiBjbGFzcz0nXCIgKyBjbGFzc05hbWUgKyBcIic+XCIpXHJcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIl1cIiwgXCI8L3NwYW4+XCIpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzdWJtaXRBbnN3ZXIgPSBmdW5jdGlvbihhbnN3ZXIpIHtcclxuICAgICAgICAgICAgaWYgKGFuc3dlcikge1xyXG4gICAgICAgICAgICAgICAgUXVpelNydi5zdWJtaXRBbnN3ZXIoYW5zd2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbkFuc3dlcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBRdWl6U3J2LnF1ZXN0aW9uQW5zd2VyZWQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbmV4dFF1ZXN0aW9uID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5xdS5hbnN3ZXIgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgUXVpelNydi5uZXh0UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHNldCBwcm9ncmVzcyBiYXJcclxuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzYmFyLnNldChRdWl6U3J2LmdldFByb2dyZXNzUGVyY2VudGFnZSgpICogMTAwKTtcclxuXHJcbiAgICAgICAgICAgIEZvY3VzU3J2KCdhbnN3ZXInKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaGFuZGxlS2V5UHJlc3MgPSBmdW5jdGlvbihrZXlFdmVudCkge1xyXG4gICAgICAgICAgICBpZiAoa2V5RXZlbnQud2hpY2ggPT0gMTMpIHtcclxuICAgICAgICAgICAgICAgIHN1Ym1pdEFuc3dlcigkc2NvcGUucXUuYW5zd2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zdGFydFF1aXogPSBzdGFydFF1aXo7XHJcbiAgICAgICAgJHNjb3BlLmlzUXVpelJ1bm5pbmcgPSBpc1F1aXpSdW5uaW5nO1xyXG4gICAgICAgICRzY29wZS5nZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXI7XHJcbiAgICAgICAgJHNjb3BlLmdldE51bWJlck9mUXVpelF1ZXN0aW9ucyA9IGdldE51bWJlck9mUXVpelF1ZXN0aW9ucztcclxuICAgICAgICAkc2NvcGUuZ2V0UXVlc3Rpb25UZXh0ID0gZ2V0UXVlc3Rpb25UZXh0O1xyXG4gICAgICAgICRzY29wZS5nZXRBbnN3ZXJUZXh0ID0gZ2V0QW5zd2VyVGV4dDtcclxuICAgICAgICAkc2NvcGUuc3VibWl0QW5zd2VyID0gc3VibWl0QW5zd2VyO1xyXG4gICAgICAgICRzY29wZS5xdWVzdGlvbkFuc3dlcmVkID0gcXVlc3Rpb25BbnN3ZXJlZDtcclxuICAgICAgICAkc2NvcGUubmV4dFF1ZXN0aW9uID0gbmV4dFF1ZXN0aW9uO1xyXG4gICAgICAgICRzY29wZS5oYW5kbGVLZXlQcmVzcyA9IGhhbmRsZUtleVByZXNzO1xyXG5cclxuICAgICAgICAkc2NvcGUucXUgPSB7XHJcbiAgICAgICAgICAgIGFuc3dlcjogXCJcIlxyXG4gICAgICAgIH07XHJcblxyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1F1aXpTcnYnLCBmdW5jdGlvbihBcHBDb25maWcsIExvZ1Nydikge1xyXG4gICAgICAgIHZhciBjb3VudHJpZXMgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgcXVpeiA9IG51bGw7XHJcbiAgICAgICAgdmFyIGN1cnJlbnRRdWVzdGlvbk5vID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb3VudHJpZXNMb2FkZWQoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkNvdW50cmllcyBub3QgbG9hZGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChxdWl6ICE9PSBudWxsICYmIHF1aXouaXNBY3RpdmUoKSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkEgcXVpeiBpcyBjdXJyZW50bHkgYmVpbmcgcGxheWVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBxdWl6IG9iamVjdFxyXG4gICAgICAgICAgICAgICAgcXVpeiA9IG5ldyBRdWl6KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBBcHBDb25maWdbJ3F1aXoucXVlc3Rpb25zLm51bWJlciddOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBxdWl6LmFkZFF1ZXN0aW9uKG5ldyBRdWVzdGlvbih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnk6IGdldFJhbmRvbUNvdW50cnkoKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50UXVlc3Rpb25ObyA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0Q291bnRyaWVzID0gZnVuY3Rpb24oX2NvdW50cmllcykge1xyXG4gICAgICAgICAgICBjb3VudHJpZXMgPSBfY291bnRyaWVzO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRSYW5kb21Db3VudHJ5ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb3VudHJpZXNbZ2V0UmFuZG9tSW50KDAsIGNvdW50cmllcy5sZW5ndGggLSAxKV07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGNvdW50cmllc0xvYWRlZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY291bnRyaWVzICE9PSBudWxsICYmIGNvdW50cmllcy5sZW5ndGggPiAwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBpc1F1aXpSdW5uaW5nID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6ICE9PSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHF1aXouZ2V0UXVlc3Rpb25zKClbY3VycmVudFF1ZXN0aW9uTm9dO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRRdWVzdGlvbk5vICE9PSBudWxsID8gY3VycmVudFF1ZXN0aW9uTm8gKyAxIDogbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBxdWl6ICE9PSBudWxsID8gcXVpei5nZXRRdWVzdGlvbnMoKS5sZW5ndGggOiBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzdWJtaXRBbnN3ZXIgPSBmdW5jdGlvbihhbnN3ZXIpIHtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgY29ycmVjdEFuc3dlciA9IGdldEFuc3dlclRvUXVlc3Rpb24ocXVlc3Rpb24pO1xyXG5cclxuICAgICAgICAgICAgcXVlc3Rpb24uc3RhdGUgPSBhbnN3ZXIgPT09IGNvcnJlY3RBbnN3ZXIgPyBxdWVzdGlvbi5zdGF0ZXMuQ09SUkVDVCA6IHF1ZXN0aW9uLnN0YXRlcy5JTkNPUlJFQ1Q7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFF1ZXN0aW9uVGV4dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSBnZXRDdXJyZW50UXVlc3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAocXVlc3Rpb24udHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5DQVBJVEFMX09GX0NPVU5UUlk6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIGhlacOfdCBkaWUgSGF1cHRzdGFkdCB2b24gW1wiICsgKHF1ZXN0aW9uLmNvdW50cnkudHJhbnNsYXRpb25zLmRlIHx8IHF1ZXN0aW9uLmNvdW50cnkubmFtZSkgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnR5cGVzLkNPVU5UUllfT0ZfQ0FQSVRBTDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJbXCIgKyBxdWVzdGlvbi5jb3VudHJ5LmNhcGl0YWwgKyBcIl0gaXN0IGRpZSBIYXVwdHN0YWR0IHZvbiB3ZWxjaGVtIExhbmRcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnR5cGVzLklOSEFCSVRBTlRTX09GX0NPVU5UUlk6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiV2llIHZpZWxlIEVpbndvaG5lciBoYXQgW1wiICsgKHF1ZXN0aW9uLmNvdW50cnkudHJhbnNsYXRpb25zLmRlIHx8IHF1ZXN0aW9uLmNvdW50cnkubmFtZSkgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihcIlVua25vd24gcXVlc3Rpb24gdHlwZVwiLCBxdWVzdGlvbi50eXBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRBbnN3ZXJUb1F1ZXN0aW9uID0gZnVuY3Rpb24ocXVlc3Rpb24pIHtcclxuICAgICAgICAgICAgaWYgKCFxdWVzdGlvbiB8fCAhcXVlc3Rpb24udHlwZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzd2l0Y2ggKHF1ZXN0aW9uLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24udHlwZXMuQ0FQSVRBTF9PRl9DT1VOVFJZOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBxdWVzdGlvbi5jb3VudHJ5LmNhcGl0YWw7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FzZSBxdWVzdGlvbi50eXBlcy5DT1VOVFJZX09GX0NBUElUQUw6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmNvdW50cnkudHJhbnNsYXRpb25zLmRlIHx8IHF1ZXN0aW9uLmNvdW50cnkubmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIHF1ZXN0aW9uLnR5cGVzLklOSEFCSVRBTlRTX09GX0NPVU5UUlk6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLmNvdW50cnkucG9wdWxhdGlvbjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIExvZ1Nydi5lcnJvcihcIlVua25vd24gcXVlc3Rpb24gdHlwZVwiLCBxdWVzdGlvbi50eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRBbnN3ZXJTdGF0dXMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgc3RhdGUgPSBxdWVzdGlvbi5zdGF0ZTtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAoc3RhdGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24uc3RhdGVzLkNPUlJFQ1Q6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiY29ycmVjdFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgcXVlc3Rpb24uc3RhdGVzLklOQ09SUkVDVDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJpbmNvcnJlY3RcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uQW5zd2VyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24uc3RhdGUgIT09IHF1ZXN0aW9uLnN0YXRlcy5OT1RfQU5TV0VSRUQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldEFuc3dlclRleHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uID0gZ2V0Q3VycmVudFF1ZXN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gXCJbXCIgKyBnZXRBbnN3ZXJUb1F1ZXN0aW9uKHF1ZXN0aW9uKSArIFwiXVwiO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBuZXh0UXVlc3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKGdldEN1cnJlbnRRdWVzdGlvbk51bWJlcigpICsgMSA8PSBnZXROdW1iZXJPZlF1aXpRdWVzdGlvbnMoKSkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uTm8rKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBnZXRQcm9ncmVzc1BlcmNlbnRhZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIChnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIoKSAtIDEpIC8gZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0LFxyXG4gICAgICAgICAgICBzZXRDb3VudHJpZXM6IHNldENvdW50cmllcyxcclxuICAgICAgICAgICAgaXNRdWl6UnVubmluZzogaXNRdWl6UnVubmluZyxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFF1ZXN0aW9uTnVtYmVyOiBnZXRDdXJyZW50UXVlc3Rpb25OdW1iZXIsXHJcbiAgICAgICAgICAgIGdldE51bWJlck9mUXVpelF1ZXN0aW9uczogZ2V0TnVtYmVyT2ZRdWl6UXVlc3Rpb25zLFxyXG4gICAgICAgICAgICBnZXRRdWVzdGlvblRleHQ6IGdldFF1ZXN0aW9uVGV4dCxcclxuICAgICAgICAgICAgZ2V0QW5zd2VyU3RhdHVzOiBnZXRBbnN3ZXJTdGF0dXMsXHJcbiAgICAgICAgICAgIGdldEFuc3dlclRleHQ6IGdldEFuc3dlclRleHQsXHJcbiAgICAgICAgICAgIHN1Ym1pdEFuc3dlcjogc3VibWl0QW5zd2VyLFxyXG4gICAgICAgICAgICBxdWVzdGlvbkFuc3dlcmVkOiBxdWVzdGlvbkFuc3dlcmVkLFxyXG4gICAgICAgICAgICBuZXh0UXVlc3Rpb246IG5leHRRdWVzdGlvbixcclxuICAgICAgICAgICAgZ2V0UHJvZ3Jlc3NQZXJjZW50YWdlOiBnZXRQcm9ncmVzc1BlcmNlbnRhZ2VcclxuICAgICAgICB9O1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZpbHRlcigncmVuZGVySHRtbCcsIGZ1bmN0aW9uKCRzY2UpIHtcclxuICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbDtcclxuICAgIH0pOyIsImFuZ3VsYXIubW9kdWxlKCdtYWdlbGxhbicpXHJcbiAgICAuY29uZmlnKGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyLCAkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbiAgICAgICAgLy8gZW5hYmxlIEhUTUw1IHB1c2hzdGF0ZVxyXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2hvbWUnKTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2hvbWUnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYnVpbGQvdmlld3MvaG9tZS5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgncXVpeicsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9xdWl6JyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3F1aXoucGFydGlhbC5odG1sJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL2xvZ2luLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdsb2dvdXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvbG9nb3V0JyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dvdXRDdHJsJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3JlZ2lzdGVyJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2J1aWxkL3ZpZXdzL3JlZ2lzdGVyLnBhcnRpYWwuaHRtbCdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdhYm91dCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hYm91dCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9idWlsZC92aWV3cy9hYm91dC5wYXJ0aWFsLmh0bWwnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfSk7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnbWFnZWxsYW4nKVxyXG4gICAgLmZhY3RvcnkoJ1VzZXJTcnYnLCBmdW5jdGlvbigkaHR0cCwgQXV0aFRva2VuU3J2KSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXInKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VXNlckZyb21TdG9yYWdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IEF1dGhUb2tlblNydi5nZXRUb2tlbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIEF1dGhUb2tlblNydi5zZXRUb2tlbih0b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGdldFVzZXIoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBubyB0b2tlbiwgd2UgcmVqZWN0IHRoZSBwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gdG9rZW4gaW4gc3RvcmFnZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ2luID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb24nLCB7XHJcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2tlbiA9IHJlc3BvbnNlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2F2ZSB0b2tlbiBsb2NhbGx5XHJcbiAgICAgICAgICAgICAgICBBdXRoVG9rZW5TcnYuc2V0VG9rZW4oc2VsZi50b2tlbik7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFVzZXIoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGxvZ291dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnRva2VuID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyByZW1vdmUgdG9rZW4gbG9jYWxseVxyXG4gICAgICAgICAgICAgICAgQXV0aFRva2VuU3J2LnNldFRva2VuKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBnZXRVc2VyOiBnZXRVc2VyLFxyXG4gICAgICAgICAgICBnZXRVc2VyRnJvbVN0b3JhZ2U6IGdldFVzZXJGcm9tU3RvcmFnZSxcclxuICAgICAgICAgICAgbG9naW46IGxvZ2luLFxyXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dFxyXG4gICAgICAgIH1cclxuICAgIH0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
